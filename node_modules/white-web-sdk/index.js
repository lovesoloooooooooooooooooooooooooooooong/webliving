"use strict";require("core-js/modules/es.reflect.construct.js");require("core-js/modules/es.reflect.get.js");require("regenerator-runtime/runtime.js");require("core-js/modules/es.object.create.js");require("core-js/modules/es.object.define-property.js");require("core-js/modules/es.object.define-properties.js");require("core-js/modules/es.object.get-own-property-descriptor.js");require("core-js/modules/es.object.get-own-property-descriptors.js");require("core-js/modules/es.object.get-own-property-names.js");require("core-js/modules/es.symbol.js");require("core-js/modules/es.object.get-prototype-of.js");require("core-js/modules/es.date.to-string.js");require("core-js/modules/es.object.to-string.js");require("core-js/modules/es.regexp.to-string.js");require("core-js/modules/es.number.constructor.js");require("core-js/modules/es.parse-int.js");require("core-js/modules/es.object.freeze.js");require("core-js/modules/es.object.set-prototype-of.js");require("core-js/modules/es.array-buffer.constructor.js");require("core-js/modules/es.array-buffer.slice.js");require("core-js/modules/es.data-view.js");require("core-js/modules/es.number.max-safe-integer.js");require("core-js/modules/es.function.bind.js");require("core-js/modules/es.function.name.js");require("core-js/modules/es.array.for-each.js");require("core-js/modules/web.dom-collections.for-each.js");require("core-js/modules/es.array.map.js");require("core-js/modules/es.array.join.js");require("core-js/modules/es.regexp.exec.js");require("core-js/modules/es.string.split.js");require("core-js/modules/es.array.concat.js");require("core-js/modules/es.date.now.js");require("core-js/modules/web.timers.js");require("core-js/modules/es.promise.js");require("core-js/modules/es.array.splice.js");require("core-js/modules/es.string.match.js");require("core-js/modules/es.string.replace.js");require("core-js/modules/es.array.index-of.js");require("core-js/modules/es.number.is-safe-integer.js");require("core-js/modules/es.array.iterator.js");require("core-js/modules/web.dom-collections.iterator.js");require("core-js/modules/es.array.sort.js");require("core-js/modules/es.string.iterator.js");require("core-js/modules/web.url.js");require("core-js/modules/es.string.search.js");require("core-js/modules/es.array.is-array.js");require("core-js/modules/es.array.slice.js");require("core-js/modules/es.array.fill.js");require("core-js/modules/es.object.keys.js");require("core-js/modules/es.number.is-nan.js");require("core-js/modules/es.array.find.js");require("core-js/modules/es.array.filter.js");require("core-js/modules/es.array.some.js");require("core-js/modules/es.regexp.constructor.js");require("core-js/modules/es.symbol.description.js");require("core-js/modules/es.array.find-index.js");require("core-js/modules/es.object.seal.js");require("core-js/modules/es.object.assign.js");require("core-js/modules/es.string.from-code-point.js");require("core-js/modules/es.number.is-finite.js");require("core-js/modules/es.number.is-integer.js");require("core-js/modules/es.number.parse-float.js");require("core-js/modules/es.number.parse-int.js");require("core-js/modules/es.date.to-json.js");require("core-js/modules/web.url.to-json.js");require("core-js/modules/es.symbol.iterator.js");require("core-js/modules/es.array.every.js");require("core-js/modules/es.array.last-index-of.js");require("core-js/modules/es.array.reduce.js");require("core-js/modules/es.array.reduce-right.js");require("core-js/modules/es.string.anchor.js");require("core-js/modules/es.parse-float.js");require("core-js/modules/es.array.includes.js");require("core-js/modules/es.string.includes.js");require("core-js/modules/es.number.min-safe-integer.js");require("core-js/modules/es.array.reverse.js");require("core-js/modules/es.string.repeat.js");require("core-js/modules/es.number.to-fixed.js");require("core-js/modules/es.string.ends-with.js");require("core-js/modules/es.string.starts-with.js");require("core-js/modules/es.weak-set.js");require("core-js/modules/es.set.js");require("core-js/modules/es.map.js");require("core-js/modules/es.string.trim.js");require("core-js/modules/es.weak-map.js");require("core-js/modules/es.array.from.js");require("core-js/modules/es.string.italics.js");require("core-js/modules/es.string.bold.js");require("core-js/modules/es.string.code-point-at.js");require("core-js/modules/es.string.pad-start.js");require("core-js/modules/es.typed-array.uint8-array.js");require("core-js/modules/es.typed-array.copy-within.js");require("core-js/modules/es.typed-array.every.js");require("core-js/modules/es.typed-array.fill.js");require("core-js/modules/es.typed-array.filter.js");require("core-js/modules/es.typed-array.find.js");require("core-js/modules/es.typed-array.find-index.js");require("core-js/modules/es.typed-array.for-each.js");require("core-js/modules/es.typed-array.includes.js");require("core-js/modules/es.typed-array.index-of.js");require("core-js/modules/es.typed-array.iterator.js");require("core-js/modules/es.typed-array.join.js");require("core-js/modules/es.typed-array.last-index-of.js");require("core-js/modules/es.typed-array.map.js");require("core-js/modules/es.typed-array.reduce.js");require("core-js/modules/es.typed-array.reduce-right.js");require("core-js/modules/es.typed-array.reverse.js");require("core-js/modules/es.typed-array.set.js");require("core-js/modules/es.typed-array.slice.js");require("core-js/modules/es.typed-array.some.js");require("core-js/modules/es.typed-array.sort.js");require("core-js/modules/es.typed-array.subarray.js");require("core-js/modules/es.typed-array.to-locale-string.js");require("core-js/modules/es.typed-array.to-string.js");var _Object$freeze;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toArray(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest()}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map:undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class)};return _wrapNativeSuper(Class)}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e14){throw _e14},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e15){didErr=true;err=_e15},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var Bv=Object.create;var kn=Object.defineProperty,jv=Object.defineProperties,Uu=Object.getOwnPropertyDescriptor,zv=Object.getOwnPropertyDescriptors,Uv=Object.getOwnPropertyNames,Vu=Object.getOwnPropertySymbols,Vv=Object.getPrototypeOf,Wu=Object.prototype.hasOwnProperty,Wv=Object.prototype.propertyIsEnumerable;var Hu=function Hu(e,t,i){return t in e?kn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},T=function T(e,t){for(var i in t||(t={})){Wu.call(t,i)&&Hu(e,i,t[i])}if(Vu){var _iterator=_createForOfIteratorHelper(Vu(t)),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var i=_step.value;Wv.call(t,i)&&Hu(e,i,t[i])}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return e},z=function z(e,t){return jv(e,zv(t))},_u=function _u(e){return kn(e,"__esModule",{value:!0})};var OP=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};var No=function No(e,t){_u(e);for(var i in t){kn(e,i,{get:t[i],enumerable:!0})}},Hv=function Hv(e,t,i){if(t&&_typeof(t)=="object"||typeof t=="function"){var _iterator2=_createForOfIteratorHelper(Uv(t)),_step2;try{var _loop=function _loop(){var r=_step2.value;!Wu.call(e,r)&&r!=="default"&&kn(e,r,{get:function get(){return t[r]},enumerable:!(i=Uu(t,r))||i.enumerable})};for(_iterator2.s();!(_step2=_iterator2.n()).done;){_loop()}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}return e},x=function x(e){return Hv(_u(kn(e!=null?Bv(Vv(e)):{},"default",e&&e.__esModule&&"default"in e?{get:function get(){return e["default"]},enumerable:!0}:{value:e,enumerable:!0})),e)},sr=function sr(e,t,i,r){for(var n=r>1?void 0:r?Uu(t,i):t,s=e.length-1,o;s>=0;s--){(o=e[s])&&(n=(r?o(t,i,n):o(n))||n)}return r&&n&&kn(t,i,n),n};No(exports,{AdminObserverId:function AdminObserverId(){return re},AkkoVersion:function AkkoVersion(){return Oe},AnimationMode:function AnimationMode(){return Q},ApplianceNames:function ApplianceNames(){return X},AsyncModuleLoadMode:function AsyncModuleLoadMode(){return Rr},CNode:function CNode(){return gr},CursorNames:function CursorNames(){return le},DefaultHotKeys:function DefaultHotKeys(){return nu},DeviceType:function DeviceType(){return Se},DisplayerConsumer:function DisplayerConsumer(){return gu},EventPhase:function EventPhase(){return vi},EventScope:function EventScope(){return Be},InvisiblePlugin:function InvisiblePlugin(){return ys},KeyboardKind:function KeyboardKind(){return Nt},LoggerReportMode:function LoggerReportMode(){return gi},ObserverMode:function ObserverMode(){return Ei},PPTKind:function PPTKind(){return mn},PPTTaskStatus:function PPTTaskStatus(){return Sl},PPTTaskStep:function PPTTaskStep(){return wl},PlayerConsumer:function PlayerConsumer(){return yu},PlayerPhase:function PlayerPhase(){return Xe},RenderEngine:function RenderEngine(){return Lr},RoomConsumer:function RoomConsumer(){return xo},RoomErrorLevel:function RoomErrorLevel(){return Fr},RoomPhase:function RoomPhase(){return te},ScenePathType:function ScenePathType(){return ot},ScreenType:function ScreenType(){return Lt},ShapeType:function ShapeType(){return Ml},UpdateEventKind:function UpdateEventKind(){return j},ViewMode:function ViewMode(){return ae},ViewVisionMode:function ViewVisionMode(){return Pe},WhiteVersion:function WhiteVersion(){return AP},WhiteWebSdk:function WhiteWebSdk(){return zu},autorun:function autorun(){return tc.autorun},contentModeAspectFill:function contentModeAspectFill(){return _b},contentModeAspectFillScale:function contentModeAspectFillScale(){return hu},contentModeAspectFit:function contentModeAspectFit(){return $b},contentModeAspectFitScale:function contentModeAspectFitScale(){return Kb},contentModeAspectFitSpace:function contentModeAspectFitSpace(){return Gb},contentModeScale:function contentModeScale(){return Co},createPPTTask:function createPPTTask(){return Ob},createPlugins:function createPlugins(){return bu},injectCustomStyle:function injectCustomStyle(){return fv},isPlayer:function isPlayer(){return Lv},isRoom:function isRoom(){return Nv},listenDisposed:function listenDisposed(){return ua},listenUpdated:function listenUpdated(){return ha},previewPPT:function previewPPT(){return Zd},reaction:function reaction(){return tc.reaction},setAsyncModuleLoadMode:function setAsyncModuleLoadMode(){return bb},toJS:function toJS(){return se},unlistenDisposed:function unlistenDisposed(){return pa},unlistenUpdated:function unlistenUpdated(){return da}});var _v="2.15.13",$v="cn-hz",Gv={identifier:"link.netless/white-model-render",origin:"https://sdk.netless.link"},Kv=["api.netless.link"],Xv={pptApi:"api.netless.link"},Yv={argusOptions:{reportResourceURL:"https://rest-argus-ad.agoralab.co/v3/report",vid:3}},C={sdkVersion:_v,defaultRegion:$v,modules:Gv,shuntApiHosts:Kv,hosts:Xv,log:Yv};var $u=x(require("mobx"));(0,$u.configure)({useProxies:window.__netlessMobXUseProxies,isolateGlobalState:!0});var zL=x(require("@netless/canvas-polyfill"));var ph={};No(ph,{ActionFrameType:function ActionFrameType(){return be},AdminObserverId:function AdminObserverId(){return re},AkkoApp:function AkkoApp(){return uh},AkkoFetcher:function AkkoFetcher(){return Oi},AkkoVersion:function AkkoVersion(){return Oe},Environment:function Environment(){return Ct},EventPhase:function EventPhase(){return vi},EventScope:function EventScope(){return Be},FramePicker:function FramePicker(){return zt},ImagePhase:function ImagePhase(){return $r},KickReason:function KickReason(){return ji},Library:function Library(){return Rc},MagixPhase:function MagixPhase(){return L},ReconstructorFactory:function ReconstructorFactory(){return vf},ReconstructorPhase:function ReconstructorPhase(){return de},ReconstructorSeekingResult:function ReconstructorSeekingResult(){return Ht},SocketErrorCode:function SocketErrorCode(){return ut},UpdateEventKind:function UpdateEventKind(){return j},__context:function __context(){return tm},copy:function copy(){return se},createBuffer:function createBuffer(){return vt},createElement:function createElement(){return Am},event:function event(){return Lp},findClass:function findClass(){return ih},findClassId:function findClassId(){return Hm},findIdentifierWith:function findIdentifierWith(){return Ls},getAuthorId:function getAuthorId(){return sm},getClassReflection:function getClassReflection(){return Bi},getCurrentTimestamp:function getCurrentTimestamp(){return nm},getEnvironment:function getEnvironment(){return rm},getLibrary:function getLibrary(){return qo},getResource:function getResource(){return jp},getSnapshot:function getSnapshot(){return hm},getUser:function getUser(){return lm},getUserIds:function getUserIds(){return cm},getUsersCount:function getUsersCount(){return am},hasUser:function hasUser(){return om},isAkkoObject:function isAkkoObject(){return im},isAkkoWrappedObject:function isAkkoWrappedObject(){return Je},isAkkoWrappedObjectAccessible:function isAkkoWrappedObjectAccessible(){return Vm},isBuffer:function isBuffer(){return ge},isInstanceOf:function isInstanceOf(){return Vt},listenDisposed:function listenDisposed(){return ua},listenUpdated:function listenUpdated(){return ha},noEffects:function noEffects(){return _r},resolve:function resolve(){return ep},socketFactory:function socketFactory(){return Jo},"transient":function transient(){return Is},translateToAckFrame:function translateToAckFrame(){return Op},unlistenDisposed:function unlistenDisposed(){return pa},unlistenUpdated:function unlistenUpdated(){return da},wrapBuffer:function wrapBuffer(){return ri}});var Qv=Object.defineProperty,qv=Object.defineProperties,Zv=Object.getOwnPropertyDescriptors,Gu=Object.getOwnPropertySymbols,Jv=Object.prototype.hasOwnProperty,eS=Object.prototype.propertyIsEnumerable,Ku=function Ku(e,t,i){return t in e?Qv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},ic=function ic(e,t){for(var i in t||(t={})){Jv.call(t,i)&&Ku(e,i,t[i])}if(Gu){var _iterator3=_createForOfIteratorHelper(Gu(t)),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var i=_step3.value;eS.call(t,i)&&Ku(e,i,t[i])}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return e},tS=function tS(e,t){return qv(e,Zv(t))},DP=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},rc=/*#__PURE__*/function(){function rc(){_classCallCheck(this,rc)}_createClass(rc,[{key:"id",get:function get(){return this._id===void 0&&(this._id="".concat(rc.nextBufferId),rc.nextBufferId+=1),this._id}}]);return rc}(),nc=rc;nc.nextBufferId=0;var sc=8,Xu=rS(),iS=nS();function Yu(e,t,i){var r=new String(new Number(i).toString(16)),n=2*sc-r.length;for(var s=0;s<sc;++s){var o=2*s-n;if(o<-1)e.setUint8(t+s,0);else if(o===-1){var a=r.substr(0,1),c=Xu[a];e.setUint8(t+s,c)}else{var _a2=r.substr(o,2),_c2=Xu[_a2];e.setUint8(t+s,_c2)}}}function Qu(e,t){var i="";for(var r=0;r<sc;++r){var n=e.getUint8(t+r);i+=iS[n]}return parseInt(i,16)}function rS(){var e={};for(var t=0;t<256;++t){var i=t.toString(16);i.length===1&&(e["0"+i]=t),e[i]=t}return Object.freeze(e)}function nS(){var e=[];for(var t=0;t<256;++t){var i=t.toString(16);i.length===1?e[t]="0"+i:e[t]=i}return Object.freeze(e)}var oc=/*#__PURE__*/function(_nc){_inherits(oc,_nc);var _super=_createSuper(oc);function oc(e,t){var _this;_classCallCheck(this,oc);_this=_super.call(this);_this.buffer=e,_this.create=t;return _this}_createClass(oc,[{key:"readonly",get:function get(){return!0}},{key:"byteLength",get:function get(){return this.buffer.byteLength}},{key:"primitiveBuffer",get:function get(){return this.buffer}},{key:"isEqualsTo",value:function isEqualsTo(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t){if(this.getUint8(t)!==e.getUint8(t))return!1}return!0}},{key:"slice",value:function slice(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.buffer.length-e;var i=this.create(t),r=i.buffer;for(var n=0;n<t;++n){r.writeUInt8(this.buffer.readUInt8(e+n),n)}return i}},{key:"getFloat64",value:function getFloat64(e){return this.buffer.readDoubleLE(e)}},{key:"getUint16",value:function getUint16(e){return this.buffer.readUInt16LE(e)}},{key:"getInt32",value:function getInt32(e){return this.buffer.readInt32LE(e)}},{key:"getUint32",value:function getUint32(e){return this.buffer.readUInt32LE(e)}},{key:"getUint8",value:function getUint8(e){return this.buffer.readUInt8(e)}},{key:"getUint64",value:function getUint64(e){return Qu(this,e)}}]);return oc}(nc),qu=/*#__PURE__*/function(_oc){_inherits(qu,_oc);var _super2=_createSuper(qu);function qu(){_classCallCheck(this,qu);return _super2.apply(this,arguments)}_createClass(qu,[{key:"readonly",get:function get(){return!1}},{key:"freeze",value:function freeze(){return Object.setPrototypeOf(this,oc.prototype),this}},{key:"fill",value:function fill(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:e.byteLength-i;var n=e.primitiveBuffer;if(n instanceof ArrayBuffer){var s=new DataView(n),o=this.buffer.byteLength-t,a=Math.min(r,o);for(var c=0;c<a;++c){this.buffer.writeUInt8(s.getUint8(c+i),c+t)}return a}else return n.copy(this.buffer,t,i,i+r)}},{key:"setFloat64",value:function setFloat64(e,t){this.buffer.writeDoubleLE(t,e)}},{key:"setUint16",value:function setUint16(e,t){this.buffer.writeUInt16LE(t,e)}},{key:"setInt32",value:function setInt32(e,t){this.buffer.writeInt32LE(t,e)}},{key:"setUint32",value:function setUint32(e,t){this.buffer.writeUInt32LE(t,e)}},{key:"setUint8",value:function setUint8(e,t){this.buffer.writeUInt8(t,e)}},{key:"setUint64",value:function setUint64(e,t){Yu(this,e,t)}}]);return qu}(oc),ac=/*#__PURE__*/function(_nc2){_inherits(ac,_nc2);var _super3=_createSuper(ac);function ac(e){var _this2;_classCallCheck(this,ac);_this2=_super3.call(this);_this2.arrayBuffer=e,_this2.dataView=new DataView(e);return _this2}_createClass(ac,[{key:"readonly",get:function get(){return!0}},{key:"byteLength",get:function get(){return this.arrayBuffer.byteLength}},{key:"primitiveBuffer",get:function get(){return this.arrayBuffer}},{key:"isEqualsTo",value:function isEqualsTo(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t){if(this.getUint8(t)!==e.getUint8(t))return!1}return!0}},{key:"slice",value:function slice(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.dataView.byteLength-e;var i=new ArrayBuffer(t),r=new DataView(i);for(var n=0;n<t;++n){r.setUint8(n,this.dataView.getUint8(e+n))}return new lc(i)}},{key:"getFloat64",value:function getFloat64(e){return this.dataView.getFloat64(e,!0)}},{key:"getUint16",value:function getUint16(e){return this.dataView.getUint16(e,!0)}},{key:"getInt32",value:function getInt32(e){return this.dataView.getInt32(e,!0)}},{key:"getUint32",value:function getUint32(e){return this.dataView.getUint32(e,!0)}},{key:"getUint8",value:function getUint8(e){return this.dataView.getUint8(e)}},{key:"getUint64",value:function getUint64(e){return Qu(this,e)}}]);return ac}(nc),lc=/*#__PURE__*/function(_ac){_inherits(lc,_ac);var _super4=_createSuper(lc);function lc(){_classCallCheck(this,lc);return _super4.apply(this,arguments)}_createClass(lc,[{key:"readonly",get:function get(){return!1}},{key:"freeze",value:function freeze(){return Object.setPrototypeOf(this,ac.prototype),this}},{key:"fill",value:function fill(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Number.MAX_SAFE_INTEGER;var n=e.primitiveBuffer,s=this.dataView.byteLength-t,o=Math.min(r,s);if(n instanceof ArrayBuffer){var a=new DataView(n);for(var c=0;c<o;++c){this.dataView.setUint8(c+t,a.getUint8(c+i))}}else for(var _a3=0;_a3<o;++_a3){this.dataView.setUint8(_a3+t,n.readUInt8(_a3+i))}return o}},{key:"setFloat64",value:function setFloat64(e,t){this.dataView.setFloat64(e,t,!0)}},{key:"setUint16",value:function setUint16(e,t){this.dataView.setUint16(e,t,!0)}},{key:"setInt32",value:function setInt32(e,t){this.dataView.setInt32(e,t,!0)}},{key:"setUint32",value:function setUint32(e,t){this.dataView.setUint32(e,t,!0)}},{key:"setUint8",value:function setUint8(e,t){this.dataView.setUint8(e,t)}},{key:"setUint64",value:function setUint64(e,t){Yu(this,e,t)}}]);return lc}(ac),sS=function sS(){var _this3=this;_classCallCheck(this,sS);this.create=function(e){return _this3.nodeBuffer?new qu(_this3.nodeBuffer.alloc(e),_this3.create):new lc(new ArrayBuffer(e))},this.wrap=function(e){return _this3.nodeBuffer&&e instanceof _this3.nodeBuffer?new qu(e,_this3.create):new lc(e)},typeof Buffer=="function"?this.nodeBuffer=global.Buffer:this.nodeBuffer=null},Zu=new sS,vt=Zu.create,ri=Zu.wrap;function ge(e){return e instanceof oc||e instanceof ac}var O;(function(e){e.Any="any",e.Never="never",e.Undefined="undefined",e.Null="null",e.String="string",e.Number="number",e.Boolean="boolean",e.Function="function",e.Object="object",e.And="and",e.Or="or",e.Generic="generic",e.Generator="generator",e.Reference="reference",e.GlobalReference="globalReference"})(O||(O={}));var Ju=/*#__PURE__*/function(){function Ju(){_classCallCheck(this,Ju);this.singletonMap=Ju.createSingletonMap()}_createClass(Ju,[{key:"getSingletonType",value:function getSingletonType(e){return this.singletonMap[e]}},{key:"getFunctionType",value:function getFunctionType(){return{typeEnum:O.Function}}},{key:"getObjectType",value:function getObjectType(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},e=_ref.key,t=_ref.index,i=_ref.properties;return{typeEnum:O.Object,key:e||this.getSingletonType(O.Undefined),index:t||this.getSingletonType(O.Undefined),properties:i||{}}}},{key:"getCompoundType",value:function getCompoundType(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return{typeEnum:e,children:t}}},{key:"getGenericType",value:function getGenericType(e){return{index:e,typeEnum:O.Generic}}},{key:"getGeneratorType",value:function getGeneratorType(_ref2){var e=_ref2.template,t=_ref2.params;return{typeEnum:O.Generator,template:e,params:t||[]}}},{key:"getReferenceType",value:function getReferenceType(e){return{typeEnum:O.Reference,name:e}}},{key:"getGlobalReferenceType",value:function getGlobalReferenceType(e,t){return{typeEnum:O.GlobalReference,path:e,name:t}}}],[{key:"createSingletonMap",value:function createSingletonMap(){var e={},t=[O.Any,O.Never,O.Undefined,O.Null,O.String,O.Number,O.Boolean];for(var _i2=0,_t2=t;_i2<_t2.length;_i2++){var i=_t2[_i2];e[i]={typeEnum:i}}return Object.freeze(e)}}]);return Ju}();var Qe=new Ju,FP=Qe.getSingletonType.bind(Qe),BP=Qe.getFunctionType.bind(Qe),jP=Qe.getObjectType.bind(Qe),zP=Qe.getCompoundType.bind(Qe),UP=Qe.getGenericType.bind(Qe),VP=Qe.getGeneratorType.bind(Qe),WP=Qe.getReferenceType.bind(Qe),HP=Qe.getGlobalReferenceType.bind(Qe),yi=/*#__PURE__*/function(_Error){_inherits(yi,_Error);var _super5=_createSuper(yi);function yi(e){var _this4;_classCallCheck(this,yi);_this4=_super5.call(this,e);_this4.name="RuntimeError";return _this4}return yi}(/*#__PURE__*/_wrapNativeSuper(Error)),oS=/*#__PURE__*/function(){function oS(e,t,i,r){_classCallCheck(this,oS);this.akkoVersion=e,this.akkoObjectBaseClass=t,this.libraryFactory=i,this.onCreatedLibrary=r,this.classHandlers={}}_createClass(oS,[{key:"baseClass",value:function baseClass(){return this.akkoObjectBaseClass}},{key:"wrapSuperClass",value:function wrapSuperClass(e){if(e===Object)return this.akkoObjectBaseClass;if(typeof e!="function")return e;{var t=e;for(;t!==this.akkoObjectBaseClass;){var i=Object.getPrototypeOf(t.prototype);if(!i)throw new yi("class ".concat(e.name," can't be extended, it's out of library"));t=i.constructor}return e}}},{key:"declareClass",value:function declareClass(_ref3){var e=_ref3.classId,t=_ref3.clazz,i=_ref3.superClass,r=_ref3.memberDecorators;if(this.classHandlers[e])throw new yi("class id ".concat(e," was declared"));this.classHandlers[e]={classId:e,clazz:t,superClass:i,memberDecorators:r||{}}}},{key:"createLibrary",value:function createLibrary(e,t){var i={};for(var n in t.classes){var s=t.classes[n],o=this.classHandlers[n],a=[];var _iterator4=_createForOfIteratorHelper(s.members),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var c=_step4.value;var h=o.memberDecorators[c.name];a.push(tS(ic({},c),{decorators:h||Object.freeze([])}))}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}i[n]={classId:o.classId,clazz:o.clazz,superClass:o.superClass,objectFormatId:s.objectFormatId,members:a}}var r=this.libraryFactory({appIdentifier:t.identifier,appVersion:t.version,akkoVersion:t.akko,formatBase64:t.formatBase64,formatHash:t.formatHash,rootConstructor:e,classDeclarations:i});return Object.defineProperty(e,"__library",{enumerable:!1,configurable:!1,writable:!1,value:r}),this.onCreatedLibrary(r),e}}]);return oS}();function aS(e){var t=new oS(e.akkoVersion,e.akkoObjectBaseClass,e.libraryFactory,e.onCreatedLibrary);return Object.freeze({baseClass:t.baseClass.bind(t),wrapSuperClass:t.wrapSuperClass.bind(t),declareClass:t.declareClass.bind(t),createLibrary:t.createLibrary.bind(t),creator:e.coreFunctions.creator,updater:e.coreFunctions.updater,wrapper:e.coreFunctions.wrapper,unwrapper:e.coreFunctions.unwrapper,jsxUnwrapper:e.coreFunctions.jsxUnwrapper,getter:e.coreFunctions.getter,setter:e.coreFunctions.setter,caller:e.coreFunctions.caller,remover:e.coreFunctions.remover,prefix:e.coreFunctions.prefix,postfix:e.coreFunctions.postfix})}function ep(){var t=[];for(var _len=arguments.length,e=new Array(_len),_key=0;_key<_len;_key++){e[_key]=arguments[_key]}return e.map(function(i){return lS(i)}).forEach(function(i){t.length===0||!cS(i)?t=i:t=hS(t,i)}),t.join("/")}function lS(e){var t=e.split("/");return t.length>0&&(t[0]==="."&&t.shift(),t[t.length-1]===""&&t.pop()),t}function cS(e){return e.length>0&&e[0]!==""}function hS(e,t){var i=tp(e),r=tp(t);if(i.pureCells.length>r.doubleDotsCount){for(var n=0;n<r.doubleDotsCount;++n){i.pureCells.pop()}return[].concat(_toConsumableArray(ip(i.doubleDotsCount)),_toConsumableArray(i.pureCells),_toConsumableArray(r.pureCells))}else{var _n2=r.doubleDotsCount-i.pureCells.length;return[].concat(_toConsumableArray(ip(i.doubleDotsCount+_n2)),_toConsumableArray(r.pureCells))}}function tp(e){var t=[],i=0;var _iterator5=_createForOfIteratorHelper(e),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var r=_step5.value;r===".."?i+=1:t.push(r)}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return{doubleDotsCount:i,pureCells:t}}function ip(e){var t=[];for(var i=0;i<e;++i){t.push("..")}return t}var rp=function rp(e){var _this5=this;_classCallCheck(this,rp);this.contextsStack=[],this.context=function(t){switch(t){case"index":{var i=aS({akkoVersion:_this5.akkoVersion,akkoObjectBaseClass:_this5.akkoObjectBaseClass,libraryFactory:_this5.libraryFactory,coreFunctions:_this5.coreFunctions,onCreatedLibrary:function onCreatedLibrary(){return _this5.contextsStack.pop()}});return _this5.contextsStack.push(i),i}case"module":{var _i3=_this5.contextsStack[_this5.contextsStack.length-1];if(!_i3)throw new yi("can't import index out of library");return _i3}default:throw new yi("unexpect mode ".concat(JSON.stringify(t)));}},this.isAkkoObject=function(t){return t instanceof _this5.akkoObjectBaseClass},this.getLibrary=function(t){if(typeof t=="function"){var i=t.__library;if(_typeof(i)=="object")return i}else if(_this5.isAkkoObject(t))return _this5.getLibrary(t.constructor)},this.akkoVersion=e.akkoVersion,this.akkoObjectBaseClass=e.akkoObjectBaseClass,this.libraryFactory=e.libraryFactory,this.coreFunctions=Object.freeze(ic({},e.coreFunctions))};function np(e){return e.type===Lo.Property}function sp(e){return e.type===Lo.Method}var Lo;(function(e){e.Method="method",e.Property="property"})(Lo||(Lo={}));var Cn;(function(e){e.Value="value",e.Readonly="readonly",e.Writeonly="writeonly",e.Accessible="accessible"})(Cn||(Cn={}));var Ai=/*#__PURE__*/function(){function Ai(e){var _this6=this;_classCallCheck(this,Ai);this.invoker=e,this.timer=null,this.fireAt=-1,this.invokeWhenTimeout=function(){var t=Date.now();if(t>=_this6.fireAt)_this6.timer=null,_this6.fireAt=-1,_this6.invoker();else{var i=_this6.fireAt-t;_this6.timer=setTimeout(_this6.invokeWhenTimeout,i)}}}_createClass(Ai,[{key:"isRunning",get:function get(){return this.timer!==null}},{key:"refreshAndInvokeAfterInterval",value:function refreshAndInvokeAfterInterval(e){var t=Date.now();if(this.timer===null)this.timer=setTimeout(this.invokeWhenTimeout,e),this.fireAt=t+e;else{var i=t+e;i<=this.fireAt&&(clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)),this.fireAt=i}}},{key:"cancel",value:function cancel(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}}]);return Ai}();function Do(e){return(typeof window==="undefined"?"undefined":_typeof(window))=="object"&&"requestIdleCallback"in window?new uS(e):new dS}var dS=/*#__PURE__*/function(){function dS(){_classCallCheck(this,dS)}_createClass(dS,[{key:"invokeOnIdle",value:function invokeOnIdle(e){for(var _len2=arguments.length,t=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){t[_key2-1]=arguments[_key2]}return new Promise(function(i,r){try{i(e.apply(void 0,t))}catch(n){r(n)}})}},{key:"invoke",value:function invoke(e){for(var _len3=arguments.length,t=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){t[_key3-1]=arguments[_key3]}return e.apply(void 0,t)}}]);return dS}(),uS=/*#__PURE__*/function(){function uS(e){var _this7=this;_classCallCheck(this,uS);this.queue=[],this.isWaitingIdle=!1,this.onFire=function(){try{if(_this7.queue.length>0){var _this7$config=_this7.config,t=_this7$config.checkingTimeMod,i=_this7$config.maxInvokingDuration,r=_this7$config.maxPaddingDuration,n=Date.now(),s;for(s=0;s<_this7.queue.length;++s){var o=_this7.queue[s];if(_this7.handle(o),n<o.beginAt+r&&s!==0&&s%t==0&&Date.now()-n>i)break}_this7.queue.splice(0,s+1),_this7.isWaitingIdle=!1,_this7.queue.length>0&&_this7.requestNextFire()}}catch(t){console.error("[Error] IdleQueue is crash (akko-core)"),console.error(t)}},this.handle=function(_ref4){var t=_ref4.invoker,i=_ref4.params,r=_ref4.resolve,n=_ref4.reject;try{r(t.apply(void 0,_toConsumableArray(i)))}catch(s){n(s)}},this.config=Object.freeze(ic({},e))}_createClass(uS,[{key:"invoke",value:function invoke(e){for(var _len4=arguments.length,t=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){t[_key4-1]=arguments[_key4]}return this.queue.length>0&&this.queue.splice(0).forEach(this.handle),e.apply(void 0,t)}},{key:"invokeOnIdle",value:function invokeOnIdle(e){var _this8=this;for(var _len5=arguments.length,t=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){t[_key5-1]=arguments[_key5]}return new Promise(function(i,r){var n=Date.now();_this8.queue.push({invoker:e,params:t,beginAt:n,resolve:i,reject:r}),!_this8.isWaitingIdle&&_this8.queue.length===1&&(_this8.isWaitingIdle=!0,_this8.requestNextFire())})}},{key:"requestNextFire",value:function requestNextFire(){window.requestIdleCallback(this.onFire,{timeout:this.config.timeout})}}]);return uS}(),ct=/*#__PURE__*/function(){function ct(e,t){_classCallCheck(this,ct);this.isFreezed=!1,this.shouldInvokeAfterFreeze=!1,this.latestInvokeTimestamp=0,this.timer=-1,this._limitDuration=e,this.invoker=t,this.invokeWhenTimeout=this.invokeWhenTimeout.bind(this)}_createClass(ct,[{key:"limitDuration",get:function get(){return this._limitDuration},set:function set(e){if(this._limitDuration!==e){if(this._limitDuration=e,this.timer!==-1){clearTimeout(this.timer);var t=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,t)}this.invoke()}}},{key:"isWaitingToInvoke",get:function get(){return this.shouldInvokeAfterFreeze||this.timer!==-1}},{key:"invoke",value:function invoke(){if(this.isFreezed)this.shouldInvokeAfterFreeze=!0;else if(this.timer===-1){var e=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,e)}}},{key:"nextInvokeTimeDuration",value:function nextInvokeTimeDuration(){var e=Date.now(),t=this.latestInvokeTimestamp+this.limitDuration-e;return Math.max(0,t)}},{key:"invokeWhenTimeout",value:function invokeWhenTimeout(){this.timer=-1,this.latestInvokeTimestamp=Date.now(),this.invoker()}},{key:"cancel",value:function cancel(){this.isFreezed?this.shouldInvokeAfterFreeze=!1:this.timer!==-1&&(clearTimeout(this.timer),this.timer=-1)}},{key:"freeze",value:function freeze(){this.isFreezed||(this.timer!==-1&&(clearTimeout(this.timer),this.timer=-1,this.shouldInvokeAfterFreeze=!0),this.isFreezed=!0)}},{key:"unfreeze",value:function unfreeze(){!this.isFreezed||(this.isFreezed=!1,this.shouldInvokeAfterFreeze&&(this.shouldInvokeAfterFreeze=!1,this.invoke()))}}]);return ct}(),cc=Object.freeze(["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]),St=/*#__PURE__*/function(){function St(e,t,i,r){_classCallCheck(this,St);this.x=e,this.y=t,this.z=i,this.suffix=r,Object.freeze(this)}_createClass(St,[{key:"withoutSuffix",value:function withoutSuffix(){return new St(this.x,this.y,this.z)}},{key:"toString",value:function toString(){var e="".concat(this.x,".").concat(this.y,".").concat(this.z);return this.suffix&&(e+="-".concat(this.suffix.greekLetter,".").concat(this.suffix.number)),e}}],[{key:"parse",value:function parse(e){if(!/^\d+\.\d+\.\d+(-\w+\.\d+)?$/i.test(e))throw new Error("invalid version format ".concat(JSON.stringify(e)));var t=e.match(/-\w+\.\d+$/),i,r=e;t&&(i=St.parseSuffix(e,t[0].replace(/^-/i,"")),r=e.substring(0,e.length-t[0].length));var _St$parseVersionArray=St.parseVersionArray(e,r),_St$parseVersionArray2=_slicedToArray(_St$parseVersionArray,3),n=_St$parseVersionArray2[0],s=_St$parseVersionArray2[1],o=_St$parseVersionArray2[2];return new St(n,s,o,i)}},{key:"parseSuffix",value:function parseSuffix(e,t){var i=t.split("."),r=i[0];if(cc.indexOf(r)===-1)throw new Error("invalid Greek letter ".concat(JSON.stringify(r)," of ").concat(JSON.stringify(e)));var n=parseInt(i[1],10);if(!Number.isSafeInteger(n))throw new Error("invalid version number ".concat(JSON.stringify(n)," of ").concat(JSON.stringify(e)));return Object.freeze({greekLetter:r,number:n})}},{key:"parseVersionArray",value:function parseVersionArray(e,t){var i=[];var _iterator6=_createForOfIteratorHelper(t.split(".")),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var r=_step6.value;var n=parseInt(r,10);if(!Number.isSafeInteger(n))throw new Error("invalid version number ".concat(JSON.stringify(r)," of ").concat(JSON.stringify(e)));i.push(n)}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}return i}},{key:"compare",value:function compare(e,t){var i=e.x-t.x;if(i!==0||(i=e.y-t.y,i!==0)||(i=e.z-t.z,i!==0))return i;if(!e.suffix&&t.suffix)return 1;if(e.suffix&&!t.suffix)return-1;if(!e.suffix&&!t.suffix)return 0;var r=e.suffix.greekLetter,n=t.suffix.greekLetter;return i=cc.indexOf(r)-cc.indexOf(n),i!==0?i:e.suffix.number-t.suffix.number}}]);return St}(),Oe="1.4.4";var pS=Object.defineProperty,op=Object.getOwnPropertySymbols,mS=Object.prototype.hasOwnProperty,fS=Object.prototype.propertyIsEnumerable,ap=function ap(e,t,i){return t in e?pS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},gS=function gS(e,t){for(var i in t||(t={})){mS.call(t,i)&&ap(e,i,t[i])}if(op){var _iterator7=_createForOfIteratorHelper(op(t)),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var i=_step7.value;fS.call(t,i)&&ap(e,i,t[i])}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}}return e},$P=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};function xn(e,t){return e===void 0?t:e}var yS=/*#__PURE__*/function(){function yS(e){_classCallCheck(this,yS);var t={},i=[];for(var r in e){var n=e[r],s=xn(n.enablePing,!0),o=xn(n.useSSL,!0),a=[],c={};for(var h in n.hosts){h==="*"?a.push.apply(a,_toConsumableArray(this.readStringArray(n.hosts[h]))):c[h]=this.readStringArray(n.hosts[h])}i.push(r),t[r]=Object.freeze({enablePing:s,useSSL:o,hosts:Object.freeze({"default":Object.freeze(a),regions:Object.freeze(c)})})}this.keys=Object.freeze(i.sort()),this.hosts=Object.freeze(gS({},t))}_createClass(yS,[{key:"readStringArray",value:function readStringArray(e){return typeof e=="string"?Object.freeze([e]):Object.freeze(_toConsumableArray(e))}},{key:"host",value:function host(e){var t=this.hosts[e];if(!t)throw new Error("cannot find host ".concat(JSON.stringify(e)));return t}}]);return yS}(),bS=/*#__PURE__*/function(){function bS(e,t){_classCallCheck(this,bS);this.nextIndex=0,this.enablePing=e.enablePing,this.useSSL=e.useSSL;var i;if(t===void 0?i=e.hosts["default"]:i=e.hosts.regions[t]||e.hosts["default"],i.length===0)throw t===void 0?new Error("expect region: unexpect undefined"):new Error("invalid region ".concat(JSON.stringify(t),": cannot find any hosts of region"));this.hosts=i}_createClass(bS,[{key:"hostsCount",get:function get(){return this.hosts.length}},{key:"host",value:function host(){return this.hosts[this.nextIndex]}},{key:"markSuccess",value:function markSuccess(e){}},{key:"markFail",value:function markFail(e){var t=this.nextIndex+1;t>=this.hosts.length&&(t=0),this.nextIndex=t}}]);return bS}(),vS=/*#__PURE__*/function(){function vS(e){_classCallCheck(this,vS);this.fetcher=e}_createClass(vS,[{key:"fetch",value:function fetch(e,t,i){var _this9=this;return new Promise(function(r,n){var s=setTimeout(o,i);function o(){s=null,n(new Error("timeout"))}_this9.fetcher(e,t).then(function(a){s!==null&&(clearTimeout(s),r(a))})["catch"](function(a){s!==null&&(clearTimeout(s),n(a))})})}}]);return vS}(),Fo=/*#__PURE__*/function(){function Fo(e){_classCallCheck(this,Fo);var t=new yS(e.configmap),i={};this.fetcher=new vS(e.fetcher),this.keys=t.keys,this.onIngoreFetchError=e.onIngoreFetchError,this.retryCount=e.retryCount,this.retryLoopsCount=e.retryLoopsCount,this.timeout=Fo.parseTimeoutFromParams(e.timeout),this.bussySleepDuration=xn(e.bussySleepDuration,3*1e3);var _iterator8=_createForOfIteratorHelper(this.keys),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var r=_step8.value;i[r]=new bS(t.host(r),e.region)}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}this.loops=Object.freeze(i)}_createClass(Fo,[{key:"fetch",value:function fetch(e){var _this10=this;var t=this.parseFetchingContext(e),i=t.key,r=this.loop(i);return function(n,s){return _this10.fetchWithKey(t,r,n,s)}}},{key:"origin",value:function origin(e,t){var i=this.loop(t),r=i.host(),n=e;return /:$/im.test(n)||(n+=":"),this.replaceProtocol(n,i.useSSL)+"//"+r}},{key:"reportSuccess",value:function reportSuccess(e,t){this.loop(e).markSuccess(t)}},{key:"reportFail",value:function reportFail(e,t){this.loop(e).markFail(t)}},{key:"fetchWithKey",value:function(){var _fetchWithKey=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(e,t,i,r){var n,s,o,a,h,d,u,p,f,m,g,c;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:n=(r&&r.method||"get").toLowerCase(),s=e.enableRetry;s===void 0&&(s=this.checkIsIdempotent(n));o=s?this.getFetchingCount(e,t):1,a=null;h=0;case 4:if(!(h<o)){_context.next=28;break}d=Date.now();_context.prev=6;u=t.host();p=this.replaceURL(i,u,t.useSSL);f=e.timeout.length;m=h<f?e.timeout[h]:e.timeout[f-1];_context.next=13;return this.fetcher.fetch(p,r,m);case 13:g=_context.sent;if(this.isServerBussyCode(g.status)){_context.next=16;break}return _context.abrupt("return",(t.markSuccess(Date.now()-d),g));case 16:_context.t0=h<o-1;if(!_context.t0){_context.next=20;break}_context.next=20;return new Promise(function(y){return setTimeout(y,e.bussySleepDuration)});case 20:_context.next=25;break;case 22:_context.prev=22;_context.t1=_context["catch"](6);a=_context.t1,t.markFail(Date.now()-d);case 25:++h;_context.next=4;break;case 28:this.onIngoreFetchError&&a&&this.onIngoreFetchError(a);c="fail to ".concat(n," ").concat(i);throw o>1&&(c+=" after ".concat(o," times retries")),a?a=new Error("".concat(c," and the last Error is: ").concat(a.message)):a=new Error(c),a;case 31:case"end":return _context.stop();}}},_callee,this,[[6,22]])}));function fetchWithKey(_x2,_x3,_x4,_x5){return _fetchWithKey.apply(this,arguments)}return fetchWithKey}()},{key:"getFetchingCount",value:function getFetchingCount(e,t){var i,r;return typeof e.retryCount=="number"&&(i=e.retryCount+1),typeof e.retryLoopsCount=="number"&&(r=(e.retryLoopsCount+1)*t.hostsCount),i!==void 0&&r!==void 0?Math.max(i,r):i!==void 0?i:r!==void 0?r:t.hostsCount}},{key:"replaceURL",value:function replaceURL(e,t,i){var _URL=new URL(e),r=_URL.protocol,n=_URL.port,s=_URL.pathname,o=_URL.search,a=this.replaceProtocol(r,i),c=t;return n&&(c+=":"+n),"".concat(a,"//").concat(c).concat(s).concat(o)}},{key:"parseFetchingContext",value:function parseFetchingContext(e){var t=e;return typeof t=="string"&&(t={key:t}),Object.freeze({key:t.key,enableRetry:t.enableRetry,timeout:Fo.parseTimeoutFromParams(t.timeout,this.timeout),retryCount:xn(t.retryCount,this.retryCount),retryLoopsCount:xn(t.retryLoopsCount,this.retryLoopsCount),bussySleepDuration:xn(t.bussySleepDuration,this.bussySleepDuration)})}},{key:"checkIsIdempotent",value:function checkIsIdempotent(e){switch(e){case"put":case"options":case"head":case"patch":case"delete":case"get":return!0;default:return!1;}}},{key:"isServerBussyCode",value:function isServerBussyCode(e){switch(e){case 503:case 504:return!0;default:return!1;}}},{key:"replaceProtocol",value:function replaceProtocol(e,t){switch(e){case"http:":case"https:":return t?"https:":"http:";case"ws:":case"wss:":return t?"wss:":"ws:";default:return e;}}},{key:"loop",value:function loop(e){var t=this.loops[e];if(!t)throw new Error("undefined key ".concat(JSON.stringify(e)));return t}}],[{key:"parseTimeoutFromParams",value:function parseTimeoutFromParams(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Fo.defaultTimeout;if(typeof e=="number")return Object.freeze([e]);if(Array.isArray(e)){if(e.length===0)throw new Error("timeout cannot be []");return Object.freeze(_toConsumableArray(e))}else return t}}]);return Fo}(),Oi=Fo;Oi.defaultTimeout=Object.freeze([5*1e3,10*1e3,25*1e3]);var dp=x(require("spark-md5"));var kp=x(require("spark-md5"));var SS=Object.defineProperty,wS=Object.defineProperties,kS=Object.getOwnPropertyDescriptors,lp=Object.getOwnPropertySymbols,CS=Object.prototype.hasOwnProperty,xS=Object.prototype.propertyIsEnumerable,cp=function cp(e,t,i){return t in e?SS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},hp=function hp(e,t){for(var i in t||(t={})){CS.call(t,i)&&cp(e,i,t[i])}if(lp){var _iterator9=_createForOfIteratorHelper(lp(t)),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var i=_step9.value;xS.call(t,i)&&cp(e,i,t[i])}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}}return e},IS=function IS(e,t){return wS(e,kS(t))},KP=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};function PS(e){var t=new String(e),i=0,r=0;for(var n=0;n<t.length;++n){r=t.charCodeAt(n),r<128?i+=1:r<2048?i+=2:(r&64512)==55296&&(t.charCodeAt(n+1)&64512)==56320?(++n,i+=4):i+=3}return i}function MS(e,t,i){var r=t;if(i<1)return"";var n=r+i,s=[],o=null,a=0,c;for(;r<n;){c=e.getUint8(r++),c<128?s[a++]=c:c>191&&c<224?s[a++]=(c&31)<<6|e.getUint8(r++)&63:c>239&&c<365?(c=((c&7)<<18|(e.getUint8(r++)&63)<<12|(e.getUint8(r++)&63)<<6|e.getUint8(r++)&63)-65536,s[a++]=55296+(c>>10),s[a++]=56320+(c&1023)):s[a++]=(c&15)<<12|(e.getUint8(r++)&63)<<6|e.getUint8(r++)&63,a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))}function TS(e,t){var i=new String(e),r,n;for(var s=0;s<i.length;++s){r=i.charCodeAt(s),r<128?t.pushUint8(r):r<2048?(t.pushUint8(r>>6|192),t.pushUint8(r&63|128)):(r&64512)==55296&&((n=i.charCodeAt(s+1))&64512)==56320?(r=65536+((r&1023)<<10)+(n&1023),++s,t.pushUint8(r>>18|240),t.pushUint8(r>>12&63|128),t.pushUint8(r>>6&63|128),t.pushUint8(r&63|128)):(t.pushUint8(r>>12|224),t.pushUint8(r>>6&63|128),t.pushUint8(r&63|128))}}var Vr=Math.pow(2,32),ES=Math.pow(2,16),In=Vr-1,XP=ES-1,AS=256,OS=/*#__PURE__*/function(){function OS(){_classCallCheck(this,OS);this._length=0,this.bufferChunks=[],this.appendNewChunk()}_createClass(OS,[{key:"length",get:function get(){return this._length}},{key:"toBuffer",value:function toBuffer(){var e=vt(this.length),t=0;var _iterator10=_createForOfIteratorHelper(this.bufferChunks),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var i=_step10.value;e.fill(i.buffer,t,0,i.length),t+=i.length}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}return e}},{key:"generateHash",value:function generateHash(e,t){var i=0,r=e;for(;;){if(i>=this.bufferChunks.length)return"";var a=this.bufferChunks[i].length;if(r<a)break;r-=a,i+=1}var n=t,s=new dp["default"],o=[0];for(;i<this.bufferChunks.length;++i){var _this$bufferChunks$i=this.bufferChunks[i],_a4=_this$bufferChunks$i.buffer,c=_this$bufferChunks$i.length;for(var h=r;h<c;++h){if(o[0]=_a4.getUint8(h),s.appendBinary(String.fromCharCode.apply(String,o)),n-=1,n<=0)return s.end(!0)}r=0}return s.end(!0)}},{key:"pushBuffer",value:function pushBuffer(e,t,i){var r=Math.min(i,this.currentChunk.buffer.byteLength-this.currentChunk.length);r>0&&(this.currentChunk.buffer.fill(e,this.currentChunk.length,t,r),this.currentChunk.length+=r,this._length+=r);var n=i-r;n>0&&(this.currentChunk={buffer:e.slice(t+r,n),length:n},this.bufferChunks.push(this.currentChunk),this._length+=n)}},{key:"pushUint8",value:function pushUint8(e){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint8(this.currentChunk.length,e),this.currentChunk.length+=1,this._length+=1}},{key:"pushUint8Holder",value:function pushUint8Holder(){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=1,this._length+=1,function(i){return t.setUint8(e,i)}}},{key:"pushUint16",value:function pushUint16(e){this.currentChunk.length+2>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint16(this.currentChunk.length,e),this.currentChunk.length+=2,this._length+=2}},{key:"pushInt32",value:function pushInt32(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setInt32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32",value:function pushUint32(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32Holder",value:function pushUint32Holder(){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=4,this._length+=4,function(i){return t.setUint32(e,i)}}},{key:"pushFloat64",value:function pushFloat64(e){this.currentChunk.length+8>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setFloat64(this.currentChunk.length,e),this.currentChunk.length+=8,this._length+=8}},{key:"appendNewChunk",value:function appendNewChunk(){var e=vt(AS);this.currentChunk={buffer:e,length:0},this.bufferChunks.push(this.currentChunk)}}]);return OS}(),W;(function(e){e[e.Never=0]="Never",e[e.Undefined=1]="Undefined",e[e.Null=2]="Null",e[e.String=3]="String",e[e.Integer32=4]="Integer32",e[e.Integer53=5]="Integer53",e[e.Float=6]="Float",e[e.Function=7]="Function",e[e.Object=8]="Object",e[e.Array=9]="Array",e[e.True=10]="True",e[e.False=11]="False",e[e.Buffer=12]="Buffer",e[e.HangUpObject=13]="HangUpObject"})(W||(W={}));var ue;(function(e){e[e.Array=0]="Array",e[e.DeducedObject=1]="DeducedObject",e[e.AssertedObject=2]="AssertedObject",e[e.HangUpObject=3]="HangUpObject"})(ue||(ue={}));var Z;(function(e){e[e.Array=0]="Array",e[e.Object=1]="Object",e[e.HangUpObject=2]="HangUpObject"})(Z||(Z={}));var up="__identifier",hc="__hangUpMetadata",Pn=/*#__PURE__*/function(){function Pn(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(){};_classCallCheck(this,Pn);this.decorateObjectEnums=Object.freeze([1]),this.decorateObject=e}_createClass(Pn,[{key:"createObject",value:function createObject(e,t){var i=t===0?[]:{};return Object.defineProperty(i,up,{enumerable:!1,configurable:!0,value:e}),i}},{key:"findIdentifier",value:function findIdentifier(e){return e[up]}},{key:"findHangUpMetadata",value:function findHangUpMetadata(e){return e[hc]}},{key:"checkObjectEnum",value:function checkObjectEnum(e){return e.constructor===Array?0:hc in e?2:1}},{key:"length",value:function length(e){return e.length}},{key:"keys",value:function keys(e){return Object.keys(e)}},{key:"hasKey",value:function hasKey(e,t){return t in e}},{key:"getValue",value:function getValue(e,t){return e[t]}},{key:"setValue",value:function setValue(e,t,i){e[t]=i}},{key:"completeHangUpObject",value:function completeHangUpObject(e,t){Object.defineProperty(e,hc,{enumerable:!1,configurable:!0,value:Object.freeze(hp({},t))})}}]);return Pn}();function pp(){var e={};return e.id=-1,e.key=e,e.index=e,e.properties=Object.freeze({}),Object.freeze(e)}var mp="0".charCodeAt(0),RS="9".charCodeAt(0)+1,NS="a".charCodeAt(0),LS="f".charCodeAt(0)+1,or=15,DS=/*#__PURE__*/function(){function DS(){_classCallCheck(this,DS);var e=[],t=[];for(var i=0;i<16;++i){var r=i.toString(16).charCodeAt(0);e[i]=r,t[r]=i}this.integerToCode=Object.freeze(e),this.codeToInteger=Object.freeze(t)}_createClass(DS,[{key:"cleanUnmeaningZero",value:function cleanUnmeaningZero(e,t){for(;e.length>t&&this.codeToInteger[e[e.length-1]]===0;){e.pop()}}},{key:"pushInt53",value:function pushInt53(e,t){var i=t|0,r=(t-i)/Vr;this.pushUint32(e,i),this.pushUint32(e,r)}},{key:"readInt53",value:function readInt53(e,t){var i=2,r=this.readInt32(e,t);return this.readInt32(e,t+4*i)*Vr+r}},{key:"pushUint32",value:function pushUint32(e,t){var i=e.length;e[i]=this.integerToCode[t&or],e[i+1]=this.integerToCode[t>>4&or],e[i+2]=this.integerToCode[t>>8&or],e[i+3]=this.integerToCode[t>>12&or],e[i+4]=this.integerToCode[t>>16&or],e[i+5]=this.integerToCode[t>>20&or],e[i+6]=this.integerToCode[t>>24&or],e[i+7]=this.integerToCode[t>>28&or]}},{key:"readUint32",value:function readUint32(e,t){var i=this.readInt32(e,t);return i<0&&(i+=Vr),i}},{key:"readInt32",value:function readInt32(e,t){var i=0;for(var r=0;r<8;++r){var n=this.codeToInteger[e.charCodeAt(t+r)];if(n===void 0)return NaN;i|=n<<4*r}return i}},{key:"parseCode",value:function parseCode(e){return this.codeToInteger[e]}},{key:"toCode",value:function toCode(e){return this.integerToCode[e]}},{key:"increment",value:function increment(e,t){var i=t;for(;;){if(e.length<=i){e[i]=mp+1;break}var r=!0;switch(e[i]+=1,e[i]){case RS:{e[i]=NS;break}case LS:{e[i]=mp,i+=1,r=!1;break}}if(r)break}}},{key:"parseString",value:function parseString(e){var t=new String(e),i=[];for(var r=0;r<t.length;++r){i.push(t.charCodeAt(r))}return i}},{key:"stringify",value:function stringify(e){return String.fromCharCode.apply(String,e)}}]);return DS}(),qe=new DS,Wr="",ar=-1,dc=16;function fp(e){return qe.readInt53(e,0)}function ni(e,t){var i=[];return qe.pushInt53(i,e),typeof t=="number"&&(qe.pushInt53(i,t),qe.cleanUnmeaningZero(i,dc)),new yp(e,i)}function gp(e,t){if(e>In)throw new Error("observerId ".concat(e," is out of range 0 ~ ").concat(In));var i=[],r=new vp(e,i);return qe.pushUint32(i,e),r.makeSureNextGenerationIdAfter(t),r}var yp=/*#__PURE__*/function(){function yp(e,t){_classCallCheck(this,yp);this.scopeId=e,this.codes=t}_createClass(yp,[{key:"generate",value:function generate(){var e=qe.stringify(this.codes);return qe.increment(this.codes,dc),e}},{key:"createdCount",get:function get(){var e=4*2,t=dc,i=0,r=0;for(var n=0;n<e;++n){var s=this.codes[t+n];s===void 0?s=0:s=qe.parseCode(s),i|=s<<4*n}t+=e;for(var _n3=0;_n3<e;++_n3){var _s2=this.codes[t+_n3];_s2===void 0?_s2=0:_s2=qe.parseCode(_s2),r|=_s2<<4*_n3}return r*Vr+i}},{key:"clone",value:function clone(){return new yp(this.scopeId,_toConsumableArray(this.codes))}}]);return yp}(),bp=8,vp=/*#__PURE__*/function(){function vp(e,t){_classCallCheck(this,vp);this.observerId=e,this.codes=t,this._createdCount=0}_createClass(vp,[{key:"scopeId",get:function get(){return 0}},{key:"createdCount",get:function get(){return this._createdCount}},{key:"generate",value:function generate(){return this._createdCount+=1,qe.increment(this.codes,bp),qe.stringify(this.codes)}},{key:"clone",value:function clone(){return new vp(this.observerId,_toConsumableArray(this.codes))}},{key:"makeSureNextGenerationIdAfter",value:function makeSureNextGenerationIdAfter(e){var t=[];for(var i=0;i<e.length;++i){var r=e.charCodeAt(i);if(qe.parseCode(r)===void 0)throw new Error("invalid generationId");t[i]=r}for(var _i4=0;_i4<t.length;++_i4){this.codes[_i4+bp]=t[_i4]}}}]);return vp}(),Bo=/*#__PURE__*/function(_Error2){_inherits(Bo,_Error2);var _super6=_createSuper(Bo);function Bo(e){var _this11;_classCallCheck(this,Bo);_this11=_super6.call(this,e);_this11.name="SerializerError";return _this11}return Bo}(/*#__PURE__*/_wrapNativeSuper(Error)),ht=/*#__PURE__*/function(_Error3){_inherits(ht,_Error3);var _super7=_createSuper(ht);function ht(e){var _this12;_classCallCheck(this,ht);_this12=_super7.call(this,e);_this12.name="DeserializerError";return _this12}return ht}(/*#__PURE__*/_wrapNativeSuper(Error)),FS=Math.pow(2,31)-1,BS=-Math.pow(2,31),jS=/*#__PURE__*/function(){function jS(e,t,i,r){_classCallCheck(this,jS);this.writer=e,this.objectFormats=t,this.objectAdapter=i,this.assertObjectFormat=r,this.anyObjectFormat=pp(),this.serializeTasksQueue=[],this.serializeBufferQueue=[],this.didObjectInQueueSet={},this.bufferIndexMap={}}_createClass(jS,[{key:"serialize",value:function serialize(e,t){var i=this.writer.putUint32Holder(),r=this.writer.didWriteBytes,n=1;this.objectFormats.length!==1&&(this.writer.writeUint32(e.length),n=e.length);for(var a=0;a<n;++a){var c=this.objectFormats[a]||this.anyObjectFormat,h=e[a];this.serializeValue(c,h)}for(;this.serializeTasksQueue.length>0;){this.handleSerializeTask(this.serializeTasksQueue.shift())}this.writer.writeBigInt(Wr),this.writer.writeUint32(this.serializeBufferQueue.length);var _iterator11=_createForOfIteratorHelper(this.serializeBufferQueue),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var _a5=_step11.value;this.writer.writeUint8(_a5.readonly?255:0),this.writer.writeBuffer(_a5)}}catch(err){_iterator11.e(err)}finally{_iterator11.f()}var s=this.writer.didWriteBytes-r,o=t?this.writer.generateHash(r,s):mc;this.serializeHash(o),i(s+Ri)}},{key:"serializeValue",value:function serializeValue(e,t){_typeof(t)!="object"?this.serializeNotObjectValue(t):t===null?this.writer.writeUint8(W.Null):ge(t)?this.serializeBufferValue(t):this.serializeObjectValue(e,t)}},{key:"handleSerializeTask",value:function handleSerializeTask(_ref5){var e=_ref5.identifier,t=_ref5.object,i=_ref5.objectEnum,r=_ref5.deducedFormat;switch(this.writer.writeBigInt(e),i){case Z.Array:{this.writer.writeUint8(ue.Array),this.handleArraySerializeTask(t,r);break}case Z.Object:{var n=this.assertObjectFormat(t),s=n?ue.AssertedObject:ue.DeducedObject,o=n||r,a=!n;this.writer.writeUint8(s),this.handleObjectSerializeTask(t,o,a);break}case Z.HangUpObject:{var _n4=this.objectAdapter.findHangUpMetadata(t),_St$parse=St.parse(_n4.version),_s3=_St$parse.x,_o2=_St$parse.y,_a6=_St$parse.z;this.writer.writeUint8(ue.HangUpObject),this.writer.writeUint32(_n4.objectFormatId),this.writer.writeUint16(_s3),this.writer.writeUint16(_o2),this.writer.writeUint16(_a6),this.writer.writeUint8(W.Never),this.handleHangUpObjectSerializeTask(t);break}}}},{key:"serializeNotObjectValue",value:function serializeNotObjectValue(e){switch(_typeof(e)){case"undefined":{this.writer.writeUint8(W.Undefined);break}case"string":{this.writer.writeUint8(W.String),this.writer.writeString(e);break}case"number":{Number.isSafeInteger(e)?BS<=e&&e<=FS?(this.writer.writeUint8(W.Integer32),this.writer.writeInt32(e)):(this.writer.writeUint8(W.Integer53),this.writer.writeInt53(e)):(this.writer.writeUint8(W.Float),this.writer.writeFloat64(e));break}case"boolean":{e?this.writer.writeUint8(W.True):this.writer.writeUint8(W.False);break}default:throw new Bo("not support ".concat(_typeof(e)," now"));}}},{key:"serializeBufferValue",value:function serializeBufferValue(e){var t=this.bufferIndexMap[e.id];t===void 0&&(t=this.serializeBufferQueue.length,this.bufferIndexMap[e.id]=t,this.serializeBufferQueue[t]=e),this.writer.writeUint8(W.Buffer),this.writer.writeUint32(t)}},{key:"serializeObjectValue",value:function serializeObjectValue(e,t){var i=this.objectAdapter.findIdentifier(t),r=this.objectAdapter.checkObjectEnum(t),n;switch(r){case Z.Array:{n=W.Array;break}case Z.Object:{n=W.Object;break}case Z.HangUpObject:{n=W.HangUpObject;break}default:throw new Error("unrecognized object enum ".concat(r));}this.writer.writeUint8(n),this.writer.writeUint8(0),this.writer.writeBigInt(i),this.pushToSerializeTaskQueueIfFirstCall({identifier:i,object:t,deducedFormat:e,objectEnum:r})}},{key:"pushToSerializeTaskQueueIfFirstCall",value:function pushToSerializeTaskQueueIfFirstCall(e){this.didObjectInQueueSet[e.identifier]||(this.didObjectInQueueSet[e.identifier]=!0,this.serializeTasksQueue.push(e))}},{key:"handleArraySerializeTask",value:function handleArraySerializeTask(e,t){var i=this.objectAdapter.length(e),r=t.index;this.writer.writeUint32(i);for(var n=0;n<i;++n){this.serializeValue(r,this.objectAdapter.getValue(e,n))}}},{key:"handleObjectSerializeTask",value:function handleObjectSerializeTask(e,t,i){this.writer.writeUint32(t.id);for(var r in t.properties){var n=t.properties[r];this.objectAdapter.hasKey(e,r)?this.serializeValue(n,this.objectAdapter.getValue(e,r)):this.writer.writeUint8(W.Never)}if(i){var _r2=this.writer.putUint32Holder(),_n5=0;var _iterator12=_createForOfIteratorHelper(this.objectAdapter.keys(e)),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var s=_step12.value;s in t.properties||(this.writer.writeString(s),this.serializeValue(t.key,this.objectAdapter.getValue(e,s)),_n5+=1)}}catch(err){_iterator12.e(err)}finally{_iterator12.f()}_r2(_n5)}else this.writer.writeUint32(0)}},{key:"handleHangUpObjectSerializeTask",value:function handleHangUpObjectSerializeTask(e){var t=this.writer.putUint32Holder(),i=0;var _iterator13=_createForOfIteratorHelper(this.objectAdapter.keys(e)),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var r=_step13.value;this.writer.writeString(r),this.serializeValue(this.anyObjectFormat,this.objectAdapter.getValue(e,r)),i+=1}}catch(err){_iterator13.e(err)}finally{_iterator13.f()}t(i)}},{key:"serializeHash",value:function serializeHash(e){for(var t=0;t<Ri;++t){t<e.length?this.writer.writeUint8(e.charCodeAt(t)):this.writer.writeUint8(0)}}}]);return jS}(),Sp=/*#__PURE__*/function(){function Sp(e,t,i,r){_classCallCheck(this,Sp);this.reader=e,this.format=t,this.objectAdapter=i,this.valuesLength=r,this.objectStateMap={},this.holdersMap={},this.deserializeBufferSetterQueue=[],this.cacheMap=Object.freeze([{},{},{}])}_createClass(Sp,[{key:"deserialize",value:function deserialize(e){var t=Sp.simpleObjectAdapter,i=this.reader.readUint32(),r=this.reader.didReadBytes,n=this.deserializeRootValuesLength(),s=[];for(var c=0;c<n;++c){this.deserializeValue(t,s,c)}for(;;){var _c3=this.reader.readBigInt();if(_c3===Wr)break;this.deserializeArrayOrObjectBody(_c3)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var o=this.reader.didReadBytes-r;if(i!==o+Ri)throw new ht("expect bytes ".concat(i,", instead of ").concat(o));var a=this.deserializeHash();if(!e&&a!==mc&&a!==this.reader.generateHash(r,o))throw new ht("hash isn't matched");return s}},{key:"deserializeRootValuesLength",value:function deserializeRootValuesLength(){return this.valuesLength!==1?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function invokeObjectDecorator(){var e=Object.freeze([]);var _iterator14=_createForOfIteratorHelper(this.objectAdapter.decorateObjectEnums),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var t=_step14.value;var i=this.cacheMap[t];for(var r in i){var n=i[r],s=this.objectStateMap[r];if(s){var o=this.holdersMap[r]||e,a=s.type,c=s.objectFormat;this.objectAdapter.decorateObject(n,a,o,c)}}}}catch(err){_iterator14.e(err)}finally{_iterator14.f()}}},{key:"deserializeValue",value:function deserializeValue(e,t,i){var r=this.reader.readUint8(),n;switch(r){case W.Undefined:{e.setValue(t,i,void 0);break}case W.Null:{e.setValue(t,i,null);break}case W.String:{e.setValue(t,i,this.reader.readString());break}case W.Integer32:{e.setValue(t,i,this.reader.readInt32());break}case W.Integer53:{e.setValue(t,i,this.reader.readInt53());break}case W.Float:{e.setValue(t,i,this.reader.readFloat64());break}case W.True:{e.setValue(t,i,!0);break}case W.False:{e.setValue(t,i,!1);break}case W.Array:{this.reader.readUint8(),n=this.reader.readBigInt();var s=this.readAndPushToDeserializeTaskQueueIfNeed(n,Z.Array);e.setValue(t,i,s);break}case W.Object:{this.reader.readUint8(),n=this.reader.readBigInt();var _s4=this.readAndPushToDeserializeTaskQueueIfNeed(n,Z.Object);e.setValue(t,i,_s4);break}case W.HangUpObject:{this.reader.readUint8(),n=this.reader.readBigInt();var _s5=this.readAndPushToDeserializeTaskQueueIfNeed(n,Z.HangUpObject);e.setValue(t,i,_s5);break}case W.Buffer:{var _s6=this.reader.readUint32(),o=this.deserializeBufferSetterQueue[_s6];o||(o=this.deserializeBufferSetterQueue[_s6]=[]),o.push(function(a){return e.setValue(t,i,a)});break}case W.Never:break;default:throw new Bo("unrecognized primitiveType ".concat(JSON.stringify(r)));}return n}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function readAndPushToDeserializeTaskQueueIfNeed(e,t){var i=this.cacheMap[t],r=i[e];return r||(i[e]=r=this.objectAdapter.createObject(e,t)),r}},{key:"deserializeArrayOrObjectBody",value:function deserializeArrayOrObjectBody(e){var t=this.reader.readUint8();switch(t){case ue.Array:{this.objectStateMap[e]={type:t},this.handleArrayDeserializerTask(this.cacheMap[Z.Array][e]);break}case ue.DeducedObject:case ue.AssertedObject:{var i=this.cacheMap[Z.Object][e],r=this.reader.readUint32(),n=this.format.findObjectFormat(r);this.objectStateMap[e]={type:t,objectFormat:n},this.handleObjectDeserializerTask(i,n);break}case ue.HangUpObject:{var _i5=this.cacheMap[Z.HangUpObject][e],_r3=this.reader.readUint32(),_n6=this.reader.readUint16(),s=this.reader.readUint16(),o=this.reader.readUint16();this.objectStateMap[e]={type:t},this.reader.readUint8(),this.handleHangUpObjectDeserializerTask(_i5,{objectFormatId:_r3,version:"".concat(_n6,".").concat(s,".").concat(o)});break}}}},{key:"handleAllDeserializeBuffers",value:function handleAllDeserializeBuffers(){var e=this.reader.readUint32();for(var t=0;t<e;++t){var i=this.reader.readUint8(),r=this.reader.readBuffer();i&&r.freeze();var n=this.deserializeBufferSetterQueue[t];var _iterator15=_createForOfIteratorHelper(n),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var s=_step15.value;s(r)}}catch(err){_iterator15.e(err)}finally{_iterator15.f()}}}},{key:"handleArrayDeserializerTask",value:function handleArrayDeserializerTask(e){var t=this.reader.readUint32();for(var i=0;i<t;++i){this.deserializeValueAndRecordHolders(e,i)}}},{key:"handleObjectDeserializerTask",value:function handleObjectDeserializerTask(e,t){for(var r in t.properties){this.deserializeValueAndRecordHolders(e,r)}var i=this.reader.readUint32();for(var _r4=0;_r4<i;++_r4){var n=this.reader.readString();this.deserializeValueAndRecordHolders(e,n)}}},{key:"handleHangUpObjectDeserializerTask",value:function handleHangUpObjectDeserializerTask(e,t){var i=this.reader.readUint32();for(var r=0;r<i;++r){var n=this.reader.readString();this.deserializeValueAndRecordHolders(e,n)}this.objectAdapter.completeHangUpObject(e,t)}},{key:"deserializeValueAndRecordHolders",value:function deserializeValueAndRecordHolders(e,t){var i=this.deserializeValue(this.objectAdapter,e,t);if(i!==void 0){var r=this.holdersMap[i];r||(this.holdersMap[i]=r=[]),r.push({object:e,key:t})}}},{key:"deserializeHash",value:function deserializeHash(){var e=new Array(Ri);for(var t=0;t<Ri;++t){e[t]=this.reader.readUint8()}return String.fromCharCode.apply(String,e)}}]);return Sp}(),wp=Sp;wp.simpleObjectAdapter=new Pn;var uc=/*#__PURE__*/function(){function uc(e,t,i,r){_classCallCheck(this,uc);this.reader=e,this.format=t,this.objectFormats=i,this.objectAdapter=r,this.arrayCacheMap={},this.objectCacheMap={},this.objectStateMap={},this.holdersMap={},this.deserializeTasksQueue=[],this.deserializeBufferSetterQueue=[]}_createClass(uc,[{key:"deserialize",value:function deserialize(e){var t=uc.simpleObjectAdapter,i=this.reader.readUint32(),r=this.reader.didReadBytes,n=this.deserializeRootValuesLength(),s=[];for(var c=0;c<n;++c){var h=this.objectFormats[c]||uc.neverObjectFormat;this.deserializeValue(h,t,s,c)}for(;;){var _c4=this.reader.readBigInt();if(_c4===Wr)break;var _h2=this.takeNextDeserializerTask(_c4);this.handleDeserializerTask(_h2)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var o=this.reader.didReadBytes-r;if(i!==o+Ri)throw new ht("expect bytes ".concat(i,", instead of ").concat(o));var a=this.deserializeHash();if(!e&&a!==mc&&a!==this.reader.generateHash(r,o))throw new ht("hash isn't matched");return s}},{key:"deserializeRootValuesLength",value:function deserializeRootValuesLength(){return this.objectFormats.length!==1?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function invokeObjectDecorator(){var e=Object.freeze([]);for(var t in this.objectCacheMap){var i=this.objectCacheMap[t],r=this.holdersMap[t]||e,_this$objectStateMap$=this.objectStateMap[t],n=_this$objectStateMap$.objectFormat,s=_this$objectStateMap$.type;this.objectAdapter.decorateObject(i,s,r,n)}}},{key:"deserializeValueAndRecordHolders",value:function deserializeValueAndRecordHolders(e,t,i){var r=this.deserializeValue(e,this.objectAdapter,t,i);if(r!==void 0){var n=this.holdersMap[r];n||(this.holdersMap[r]=n=[]),n.push({object:t,key:i})}}},{key:"deserializeValue",value:function deserializeValue(e,t,i,r){var n=this.reader.readUint8(),s;switch(n){case W.Undefined:{t.setValue(i,r,void 0);break}case W.Null:{t.setValue(i,r,null);break}case W.String:{t.setValue(i,r,this.reader.readString());break}case W.Integer32:{t.setValue(i,r,this.reader.readInt32());break}case W.Integer53:{t.setValue(i,r,this.reader.readInt53());break}case W.Float:{t.setValue(i,r,this.reader.readFloat64());break}case W.True:{t.setValue(i,r,!0);break}case W.False:{t.setValue(i,r,!1);break}case W.Object:{s=this.reader.readBigInt();var o=this.readAndPushToDeserializeTaskQueueIfNeed(s,e,!1);t.setValue(i,r,o);break}case W.Array:{s=this.reader.readBigInt();var _o3=this.readAndPushToDeserializeTaskQueueIfNeed(s,e,!0);t.setValue(i,r,_o3);break}case W.Buffer:{var _o4=this.reader.readUint32(),a=this.deserializeBufferSetterQueue[_o4];a||(a=this.deserializeBufferSetterQueue[_o4]=[]),a.push(function(c){return t.setValue(i,r,c)});break}}return s}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function readAndPushToDeserializeTaskQueueIfNeed(e,t,i){var r=i?this.arrayCacheMap:this.objectCacheMap,n=r[e];return n||(r[e]=n=this.objectAdapter.createObject(e,i?Z.Array:Z.Object),this.deserializeTasksQueue.push({isArray:i,identifier:e,deducedFormat:t,object:n})),n}},{key:"takeNextDeserializerTask",value:function takeNextDeserializerTask(e){for(var t=0;t<this.deserializeTasksQueue.length;++t){var i=this.deserializeTasksQueue[t];if(e===i.identifier)return this.deserializeTasksQueue.splice(t,1),i}throw new ht("can't find identifier ".concat(e," in task queue"))}},{key:"handleDeserializerTask",value:function handleDeserializerTask(e){var t=this.reader.readUint8(),i=e.identifier;switch(t){case ue.Array:{if(!e.isArray)throw new ht("expect array");this.objectStateMap[i]={type:t,objectFormat:e.deducedFormat},this.handleArrayDeserializerTask(e.object,e.deducedFormat);break}case ue.DeducedObject:{if(e.isArray)throw new ht("expect object");this.objectStateMap[i]={type:t,objectFormat:e.deducedFormat},this.handleObjectDeserializerTask(e.object,e.deducedFormat);break}case ue.AssertedObject:{if(e.isArray)throw new ht("expect object");var r=this.reader.readUint32(),n=this.format.findObjectFormat(r);this.objectStateMap[i]={type:t,objectFormat:n},this.handleObjectDeserializerTask(e.object,n);break}}}},{key:"handleAllDeserializeBuffers",value:function handleAllDeserializeBuffers(){var e=this.reader.readUint32();for(var t=0;t<e;++t){var i=this.reader.readUint8(),r=this.reader.readBuffer();i&&r.freeze();var n=this.deserializeBufferSetterQueue[t];var _iterator16=_createForOfIteratorHelper(n),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var s=_step16.value;s(r)}}catch(err){_iterator16.e(err)}finally{_iterator16.f()}}}},{key:"handleArrayDeserializerTask",value:function handleArrayDeserializerTask(e,t){var i=t.index,r=this.reader.readUint32();for(var n=0;n<r;++n){this.deserializeValueAndRecordHolders(i,e,n)}}},{key:"handleObjectDeserializerTask",value:function handleObjectDeserializerTask(e,t){for(var r in t.properties){this.deserializeValueAndRecordHolders(t.properties[r],e,r)}var i=this.reader.readUint32();for(var _r5=0;_r5<i;++_r5){var n=this.reader.readString();this.deserializeValueAndRecordHolders(t.key,e,n)}}},{key:"deserializeHash",value:function deserializeHash(){var e=new Array(Ri);for(var t=0;t<Ri;++t){e[t]=this.reader.readUint8()}return String.fromCharCode.apply(String,e)}}]);return uc}(),pc=uc;pc.neverObjectFormat=pp(),pc.simpleObjectAdapter=new Pn;var si;(function(e){e[e.V0=0]="V0",e[e.V1=1]="V1"})(si||(si={}));var zS=St.parse("1.4.2");function oi(e){var t=e;return typeof t=="string"&&(t=St.parse(t)),St.compare(t,zS)<0?0:1}var bi=/*#__PURE__*/function(){function bi(e){_classCallCheck(this,bi);this.format=e.format,this.objectAdapter=e.objectAdapter,this.assertObjectFormat=e.assertObjectFormat||function(){}}_createClass(bi,[{key:"serialize",value:function serialize(_ref6){var e=_ref6.writer,t=_ref6.values,i=_ref6.objectFormats,r=_ref6.includesHash;new jS(e,i,this.objectAdapter,this.assertObjectFormat).serialize(t,r)}},{key:"deserialize",value:function deserialize(_ref7){var e=_ref7.reader,t=_ref7.objectFormats,i=_ref7.ignoreHashChecking,r=_ref7.version;switch(r){case si.V0:return new pc(e,this.format,t,this.objectAdapter).deserialize(i);case si.V1:return new wp(e,this.format,this.objectAdapter,t.length).deserialize(i);default:return[];}}}]);return bi}(),US="0".charCodeAt(0),Fe=/*#__PURE__*/function(){function Fe(){_classCallCheck(this,Fe);this.buffer=new OS}_createClass(Fe,[{key:"generateHash",value:function generateHash(e,t){return this.buffer.generateHash(e,t)}},{key:"didWriteBytes",get:function get(){return this.buffer.length}},{key:"writeBuffer",value:function writeBuffer(e){this.buffer.pushUint32(e.byteLength),e.byteLength>0&&this.buffer.pushBuffer(e,0,e.byteLength)}},{key:"writeUint8",value:function writeUint8(e){this.buffer.pushUint8(e)}},{key:"putUint8Holder",value:function putUint8Holder(){return this.buffer.pushUint8Holder()}},{key:"writeUint16",value:function writeUint16(e){this.buffer.pushUint16(e)}},{key:"writeInt32",value:function writeInt32(e){this.buffer.pushInt32(e)}},{key:"writeUint32",value:function writeUint32(e){this.buffer.pushUint32(e)}},{key:"putUint32Holder",value:function putUint32Holder(){return this.buffer.pushUint32Holder()}},{key:"writeInt53",value:function writeInt53(e){var t=e|0,i=(e-t)/Vr;this.buffer.pushInt32(t),this.buffer.pushInt32(i)}},{key:"writeFloat64",value:function writeFloat64(e){this.buffer.pushFloat64(e)}},{key:"writeString",value:function writeString(e){var t=PS(e);this.writeInt32(t),TS(e,this.buffer)}},{key:"writeBigInt",value:function writeBigInt(e){var t=new String(e);if(t.length>255)throw new Bo("length of identifier ".concat(t.length," is greater than 255"));this.buffer.pushUint8(t.length);var i=Math.ceil(t.length/2);for(var r=0;r<i;++r){var n=t.charCodeAt(r*2),s=t.charCodeAt(r*2+1);Number.isNaN(s)&&(s=US);var o=qe.parseCode(n),a=qe.parseCode(s);if(o===void 0||a===void 0)throw new Bo("invalid big integer ".concat(JSON.stringify(e)));this.buffer.pushUint8(o|a<<4)}}},{key:"writeReadSlice",value:function writeReadSlice(e){var _iterator17=_createForOfIteratorHelper(e),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var _step17$value=_step17.value,t=_step17$value.offset,i=_step17$value.byteLength,r=_step17$value.buffer;this.buffer.pushBuffer(r,t,i)}}catch(err){_iterator17.e(err)}finally{_iterator17.f()}}},{key:"toBuffer",value:function toBuffer(){return this.buffer.toBuffer()}}]);return Fe}(),VS=[],WS=[0],HS=[0,0],_S=[0,0,0],$S=[0,0,0,0],GS=[0,0,0,0,0],KS=[0,0,0,0,0,0],XS=[0,0,0,0,0,0,0],YS=[0,0,0,0,0,0,0,0];function QS(e){switch(e){case 0:return VS;case 1:return WS;case 2:return HS;case 3:return _S;case 4:return $S;case 5:return GS;case 6:return KS;case 7:return XS;case 8:return YS;default:return[];}}var ye=/*#__PURE__*/function(){function ye(e){_classCallCheck(this,ye);this._offset=0,this.buffer=e}_createClass(ye,[{key:"offset",get:function get(){return this._offset}},{key:"generateHash",value:function generateHash(e,t){var i=Math.min(e+t-1,this.buffer.byteLength-1),r=new kp["default"],n=[0];for(var s=e;s<=i;++s){n[0]=this.buffer.getUint8(s),r.appendBinary(String.fromCharCode.apply(String,n))}return r.end(!0)}},{key:"didReadBytes",get:function get(){return this._offset}},{key:"readBuffer",value:function readBuffer(){var e=this.buffer.getUint32(this._offset);this._offset+=4;var t=this.buffer.slice(this._offset,e);return this._offset+=e,t}},{key:"readUint8",value:function readUint8(){var e=this.buffer.getUint8(this._offset);return this._offset+=1,e}},{key:"readUint16",value:function readUint16(){var e=this.buffer.getUint16(this._offset);return this._offset+=2,e}},{key:"readInt32",value:function readInt32(){var e=this.buffer.getInt32(this._offset);return this._offset+=4,e}},{key:"readUint32",value:function readUint32(){var e=this.buffer.getUint32(this._offset);return this._offset+=4,e}},{key:"readInt53",value:function readInt53(){var e=this.buffer.getInt32(this._offset);this._offset+=4;var t=this.buffer.getInt32(this._offset);return this._offset+=4,t*Vr+e}},{key:"readFloat64",value:function readFloat64(){var e=this.buffer.getFloat64(this._offset);return this._offset+=8,e}},{key:"readString",value:function readString(){var e=this.readInt32(),t=MS(this.buffer,this._offset,e);return this._offset+=e,t}},{key:"readBigInt",value:function readBigInt(){var e=this.readUint8(),t=Math.ceil(e/2),i=QS(e);for(var r=0;r<t;++r){var n=this.readUint8(),s=n&15,o=n>>4&15;i[r*2]=qe.toCode(s),r*2+1<e&&(i[r*2+1]=qe.toCode(o))}return String.fromCharCode.apply(String,i)}},{key:"skipBytes",value:function skipBytes(e){return this._offset+=e,e}},{key:"sliceLatestBytes",value:function sliceLatestBytes(e){return[{offset:this._offset-e,buffer:this.buffer,byteLength:e}]}}]);return ye}(),Ri=16,mc=function(){var e=[];for(var t=0;t<Ri;++t){e[t]=0}return String.fromCharCode.apply(String,e)}(),Ni=/*#__PURE__*/function(_Error4){_inherits(Ni,_Error4);var _super8=_createSuper(Ni);function Ni(e){var _this13;_classCallCheck(this,Ni);_this13=_super8.call(this,e);_this13.name="FormatError";return _this13}return Ni}(/*#__PURE__*/_wrapNativeSuper(Error)),Li;(function(e){e[e.Indeterminate=0]="Indeterminate",e[e.Circular=1]="Circular",e[e.Noncircular=2]="Noncircular"})(Li||(Li={}));var Mn;(function(e){e[e.Border=0]="Border",e[e.Compound=1]="Compound",e[e.Object=2]="Object",e[e.Handle=3]="Handle"})(Mn||(Mn={}));var qS=/*#__PURE__*/function(){function qS(e,t,i){_classCallCheck(this,qS);this.templateEnvironment=e,this.templateType=t,this.params=i,this.expandedParamNodes=[],this.convertTypeToGeneratorParam=this.convertTypeToGeneratorParam.bind(this);for(var r=0;r<i.length;++r){this.expandedParamNodes[r]=void 0}}_createClass(qS,[{key:"getExpandedExpression",value:function getExpandedExpression(){return this.expandNode(this.templateType)}},{key:"expandNode",value:function expandNode(e){switch(e.typeEnum){case O.Any:case O.Never:case O.Undefined:case O.Null:case O.String:case O.Number:case O.Boolean:case O.Function:return{type:e,clazz:0};case O.Object:{var t=e,i={};for(var r in t.properties){var n=t.properties[r];i[r]=this.expandNode(n)}return{type:t,clazz:2,key:this.expandNode(t.key),index:this.expandNode(t.index),properties:i}}case O.And:case O.Or:{var _t3=e,_i6=[];var _iterator18=_createForOfIteratorHelper(_t3.children),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var _r6=_step18.value;_i6.push(this.expandNode(_r6))}}catch(err){_iterator18.e(err)}finally{_iterator18.f()}return{type:_t3,clazz:1,children:_i6}}case O.Generator:return this.expandGeneratorType(e);case O.Generic:return this.expandGenericType(e);case O.Reference:case O.GlobalReference:return this.expandReferenceType(e);}throw new Ni("unrecognized enum type "+e.typeEnum)}},{key:"expandGeneratorType",value:function expandGeneratorType(e){var t=e.params.map(this.convertTypeToGeneratorParam),i=this.templateEnvironment.getTemplate(e.template);return{clazz:3,handle:i.getHandle(t)}}},{key:"convertTypeToGeneratorParam",value:function convertTypeToGeneratorParam(e){var t=this.expandNode(e);return t.clazz===3?t.handle:t.type}},{key:"expandGenericType",value:function expandGenericType(_ref8){var e=_ref8.index;var t=this.expandedParamNodes[e];if(!t){var i=this.params[e];if(!i)throw new Ni("generic index ".concat(e," is out of range: 0 ~ ").concat(this.params.length-1));t=this.covertParamTypeToExpandedNode(i),this.expandedParamNodes[e]=t}return t}},{key:"expandReferenceType",value:function expandReferenceType(e){var t=this.templateEnvironment.replaceReferenceType(e),i;return t.typeEnum===O.Generator?i=t:i={typeEnum:O.Generator,template:t,params:[]},this.expandGeneratorType(i)}},{key:"covertParamTypeToExpandedNode",value:function covertParamTypeToExpandedNode(e){return"id"in e?this.expandNode(e):{clazz:3,handle:e}}}]);return qS}(),dt=/*#__PURE__*/function(){function dt(e){_classCallCheck(this,dt);this.rootExpandedNode=e}_createClass(dt,[{key:"getCollapsedExpression",value:function getCollapsedExpression(){return this.collapseNode(this.rootExpandedNode)}},{key:"collapseNode",value:function collapseNode(e){switch(e.clazz){case Mn.Border:return{id:dt.generateId(),hasCircular:!1,types:[e.type.typeEnum]};case Mn.Object:return this.collapseObjectExpandedNode(e);case Mn.Handle:return this.collapseHandleExpandedNode(e);case Mn.Compound:return this.collapseCompoundExpandedNode(e,e.type.typeEnum);default:throw new Error("invalid class ".concat(e.clazz));}}},{key:"collapseObjectExpandedNode",value:function collapseObjectExpandedNode(_ref9){var e=_ref9.key,t=_ref9.index,i=_ref9.properties;var r=this.collapseNode(e),n=this.collapseNode(t),s=r.hasCircular||n.hasCircular,o={};for(var c in i){var h=i[c],d=this.collapseNode(h);o[c]=d,s=s||d.hasCircular}var a={key:r,index:n,properties:o};return this.isCollapsedObjectHasNeverPropertyTypes(a)?dt.neverCollapsedNode:{id:dt.generateId(),hasCircular:s,types:[O.Object],object:a}}},{key:"collapseHandleExpandedNode",value:function collapseHandleExpandedNode(_ref10){var e=_ref10.handle;switch(e.state){case Li.Noncircular:return e.collapsedNode;case Li.Indeterminate:case Li.Circular:return{id:dt.generateId(),hasCircular:!0,types:[O.Object],handle:e};default:throw new Error("invalid state ".concat(e.state));}}},{key:"collapseCompoundExpandedNode",value:function collapseCompoundExpandedNode(_ref11,t){var e=_ref11.children;var i=[];var _iterator19=_createForOfIteratorHelper(e),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var _r7=_step19.value;i.push(this.collapseNode(_r7))}}catch(err){_iterator19.e(err)}finally{_iterator19.f()}if(i.length===0)return dt.neverCollapsedNode;if(i.length===1)return i[0];for(var _i8=0,_i7=i;_i8<_i7.length;_i8++){var r=_i7[_i8];if(r.handle&&r.handle.state===Li.Indeterminate){var n=t===O.And?"&":"|";throw new Ni("can not operate an indeterminate expression with \"".concat(n,"\" sign"))}}return t===O.And?this.pruneAndMergeNodes(i):this.flattenNodes(i)}},{key:"pruneAndMergeNodes",value:function pruneAndMergeNodes(e){var t=this.collectCrossTypeEnumsWith(e);if(t.length===0||t.find(function(r){return r===O.Never}))return dt.neverCollapsedNode;var i=this.collectAllObjectCollapsedNodesIn(e);return this.handleObjectCollapsedNodesWithTypeEnums(i,t,O.And)}},{key:"flattenNodes",value:function flattenNodes(e){var t=this.collectUnionTypeEnumsWith(e);if(t=t.filter(function(r){return r!==O.Never}),t.length===0)return dt.neverCollapsedNode;if(t.find(function(r){return r===O.Any}))return{id:dt.generateId(),hasCircular:!1,types:[O.Any]};var i=this.collectAllObjectCollapsedNodesIn(e);return this.handleObjectCollapsedNodesWithTypeEnums(i,t,O.Or)}},{key:"collectCrossTypeEnumsWith",value:function collectCrossTypeEnumsWith(e){var t={};var _iterator20=_createForOfIteratorHelper(e),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var _r8=_step20.value.types;var _iterator21=_createForOfIteratorHelper(_r8),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var n=_step21.value;var s=t[n];s===void 0&&(s=0),t[n]=s+1}}catch(err){_iterator21.e(err)}finally{_iterator21.f()}}}catch(err){_iterator20.e(err)}finally{_iterator20.f()}var i=[];for(var r in t){t[r]===e.length&&i.push(r)}return i}},{key:"collectUnionTypeEnumsWith",value:function collectUnionTypeEnumsWith(e){var t={};var _iterator22=_createForOfIteratorHelper(e),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var _r9=_step22.value.types;var _iterator23=_createForOfIteratorHelper(_r9),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var n=_step23.value;t[n]=!0}}catch(err){_iterator23.e(err)}finally{_iterator23.f()}}}catch(err){_iterator22.e(err)}finally{_iterator22.f()}var i=[];for(var r in t){t[r]&&i.push(r)}return i}},{key:"collectAllObjectCollapsedNodesIn",value:function collectAllObjectCollapsedNodesIn(e){var t=[];var _iterator24=_createForOfIteratorHelper(e),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var i=_step24.value;(i.object||i.handle)&&t.push(i)}}catch(err){_iterator24.e(err)}finally{_iterator24.f()}return t}},{key:"handleObjectCollapsedNodesWithTypeEnums",value:function handleObjectCollapsedNodesWithTypeEnums(e,t,i){var _r10;var r=e;if(r.length===0)return{id:dt.generateId(),hasCircular:!1,types:t};if(r.length===1)return IS(hp({},r[0]),{id:dt.generateId(),types:t});var n=[];if(r=r.filter(function(o){return o.handle?(n.push(o),!1):!0}),n.length>=2){var o=i===O.And?"&":"|";throw new Ni("can not ".concat(n.length," circular expression with \"").concat(o,"\" sign"))}(_r10=r).push.apply(_r10,n);var s=r[0].object;for(var _o5=1;_o5<r.length;++_o5){if(i===O.And&&this.isCollapsedObjectHasNeverPropertyTypes(s))return dt.neverCollapsedNode;var a=r[_o5],c=this.getObjectFromObjectCollapsedNode(a);i===O.And?s=this.factorizeWithAndOperation(s,c):s=this.factorizeWithOrOperation(s,c)}return this.isCollapsedObjectHasNeverPropertyTypes(s)?dt.neverCollapsedNode:{id:dt.generateId(),types:t,hasCircular:this.hasCircularIn(r),object:s}}},{key:"getObjectFromObjectCollapsedNode",value:function getObjectFromObjectCollapsedNode(e){var t=e;for(;;){if(t.object)return t.object;t=t.handle.collapsedNode}}},{key:"hasCircularIn",value:function hasCircularIn(e){var _iterator25=_createForOfIteratorHelper(e),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var t=_step25.value.hasCircular;if(t)return!0}}catch(err){_iterator25.e(err)}finally{_iterator25.f()}return!1}},{key:"factorizeWithAndOperation",value:function factorizeWithAndOperation(e,t){var i=[],r=[],n=[];for(var o in e.properties){o in t.properties?i.push(o):r.push(o)}for(var _o6 in t.properties){_o6 in e.properties||n.push(_o6)}var s={};for(var _i10=0,_i9=i;_i10<_i9.length;_i10++){var _o7=_i9[_i10];var a=e.properties[_o7],c=t.properties[_o7];s[_o7]=this.pruneAndMergeNodes([a,c])}for(var _i11=0,_r11=r;_i11<_r11.length;_i11++){var _o8=_r11[_i11];s[_o8]=e.properties[_o8]}for(var _i12=0,_n7=n;_i12<_n7.length;_i12++){var _o9=_n7[_i12];s[_o9]=t.properties[_o9]}return{key:this.pruneAndMergeKeyOrIndexNodes(e.key,t.key),index:this.pruneAndMergeKeyOrIndexNodes(e.index,t.index),properties:s}}},{key:"factorizeWithOrOperation",value:function factorizeWithOrOperation(e,t){var i=[];for(var n in e.properties){n in t.properties&&i.push(n)}var r={};for(var _i14=0,_i13=i;_i14<_i13.length;_i14++){var _n8=_i13[_i14];var s=e.properties[_n8],o=t.properties[_n8];r[_n8]=this.flattenNodes([s,o])}return{key:this.flattenNodesKeyOrIndexNodes(e.key,t.key),index:this.flattenNodesKeyOrIndexNodes(e.index,t.index),properties:r}}},{key:"pruneAndMergeKeyOrIndexNodes",value:function pruneAndMergeKeyOrIndexNodes(e,t){return this.isCollapsedNodeTypeEqual(e,O.Undefined)?t:this.isCollapsedNodeTypeEqual(t,O.Undefined)?e:this.pruneAndMergeNodes([e,t])}},{key:"flattenNodesKeyOrIndexNodes",value:function flattenNodesKeyOrIndexNodes(e,t){return this.isCollapsedNodeTypeEqual(e,O.Undefined)?t:this.isCollapsedNodeTypeEqual(t,O.Undefined)?e:this.flattenNodes([e,t])}},{key:"isCollapsedObjectHasNeverPropertyTypes",value:function isCollapsedObjectHasNeverPropertyTypes(e){if(this.isCollapsedNodeTypeEqual(e.key,O.Never)||this.isCollapsedNodeTypeEqual(e.index,O.Never))return!0;for(var t in e.properties){if(this.isCollapsedNodeTypeEqual(e.properties[t],O.Never))return!0}return!1}},{key:"isCollapsedNodeTypeEqual",value:function isCollapsedNodeTypeEqual(e,t){return e.types.length!==1?!1:e.types[0]===t}}],[{key:"generateId",value:function generateId(){var e=this.nextId;return this.nextId+=1,"".concat(e)}}]);return dt}(),fc=dt;fc.nextId=0,fc.neverCollapsedNode={id:dt.generateId(),hasCircular:!1,types:[O.Never]};var ZS=2500,JS=/*#__PURE__*/function(){function JS(e){_classCallCheck(this,JS);this.replaceReferenceType=e,this.templatesTable={}}_createClass(JS,[{key:"getTemplate",value:function getTemplate(e){if(e.id===void 0)throw new Ni("templateType don't have id");var t=this.templatesTable[e.id];return t||(t=new Cp(this,e),this.templatesTable[e.id]=t),t}}]);return JS}(),Cp=/*#__PURE__*/function(){function Cp(e,t){_classCallCheck(this,Cp);this.templateEnvironment=e,this.templateType=t,this.handlesCache=[]}_createClass(Cp,[{key:"getHandle",value:function getHandle(e){var t=this.getHandleByParams(e);if(!t){t={state:Li.Indeterminate},this.setHandleWithParams(t,_toConsumableArray(e));var i=this.createCollapsedNode(e);t.collapsedNode=i,t.state=i.hasCircular?Li.Circular:Li.Noncircular}return t}},{key:"createCollapsedNode",value:function createCollapsedNode(e){var t=new qS(this.templateEnvironment,this.templateType,e).getExpandedExpression();return new fc(t).getCollapsedExpression()}},{key:"getHandleByParams",value:function getHandleByParams(e){var _iterator26=_createForOfIteratorHelper(this.handlesCache),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var t=_step26.value;if(Cp.isParamsEquals(t.params,e))return t.handle}}catch(err){_iterator26.e(err)}finally{_iterator26.f()}}},{key:"setHandleWithParams",value:function setHandleWithParams(e,t){if(this.handlesCache.length>=ZS)throw new Ni("the template's definition is divergence");this.handlesCache.push({handle:e,params:t})}}],[{key:"isParamsEquals",value:function isParamsEquals(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i){var r=e[i],n=t[i];if(r!==n&&(!("id"in r)||!("id"in n)||r.id!==n.id))return!1}return!0}}]);return Cp}(),e1=/*#__PURE__*/function(){function e1(e){_classCallCheck(this,e1);this.collapsedNodeToRecordMap={},this.recordMap={},this.nextRecordId=0,this.templateEnvironment=new JS(e);var t=this.nextRecordId;this.nextRecordId+=1,this.recordMap[t]=this.anyObjectFormatRecord={id:t,key:t,index:t,properties:{}}}_createClass(e1,[{key:"covert",value:function covert(e){var t=this.templateEnvironment.getTemplate(e).getHandle([]).collapsedNode,i=this.findRecordId(t);return this.recordMap[i]}},{key:"getObjectFormatRecords",value:function getObjectFormatRecords(){var e=[];for(var t in this.recordMap){e.push(this.recordMap[t])}return e}},{key:"findRecordId",value:function findRecordId(e){if(e.types.some(function(t){return t===O.Object})){var t=this.collapsedNodeToRecordMap[e.id];if(!t){var i={id:this.nextRecordId};this.nextRecordId+=1,this.collapsedNodeToRecordMap[e.id]=i,this.recordMap[i.id]=i,this.convertCollapsedNodeAndFillObjectFormatRecord(e,i),t=i}return t.id}else return this.anyObjectFormatRecord.id}},{key:"convertCollapsedNodeAndFillObjectFormatRecord",value:function convertCollapsedNodeAndFillObjectFormatRecord(e,t){var i=e;for(;i.handle;){i=i.handle.collapsedNode}var r=i.object,n={};for(var s in r.properties){n[s]=this.findRecordId(r.properties[s])}t.key=this.findRecordId(r.key),t.index=this.findRecordId(r.index),t.properties=n}}]);return e1}(),xp=/*#__PURE__*/function(){function xp(){_classCallCheck(this,xp);this.replaceReferenceType=function(){throw new Ni("not define referenceTypeReplacer")}}_createClass(xp,[{key:"createWithRecords",value:function createWithRecords(e,t){var i=new e1(t||this.replaceReferenceType),r=[],n={};var _iterator27=_createForOfIteratorHelper(e),_step27;try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var _step27$value=_step27.value,_c5=_step27$value.type,h=_step27$value.interrupter;var d=i.covert(_c5);h&&(n[d.id]=h),r.push(d.id)}}catch(err){_iterator27.e(err)}finally{_iterator27.f()}var s=i.getObjectFormatRecords().map(function(c){var h=n[c.id];return h?h(c):c}),o=new gc(s),a=[];for(var _i15=0,_r12=r;_i15<_r12.length;_i15++){var c=_r12[_i15];a.push(o.findObjectFormat(c))}return{format:o,objectFormats:a}}},{key:"createWithBuffer",value:function createWithBuffer(e){return new gc(gc.deserialize(e))}}]);return xp}(),gc=/*#__PURE__*/function(){function gc(e){_classCallCheck(this,gc);this.records={},this.formats={};var t=null;var _iterator28=_createForOfIteratorHelper(e),_step28;try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var i=_step28.value;var r={};this.records[i.id]=i,this.formats[i.id]=r,this.isAnyObjectFormatRecord(i)&&(t=r)}}catch(err){_iterator28.e(err)}finally{_iterator28.f()}var _iterator29=_createForOfIteratorHelper(e),_step29;try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var _i16=_step29.value;this.completeObjectFormat(this.formats[_i16.id],_i16)}}catch(err){_iterator29.e(err)}finally{_iterator29.f()}if(!t)throw new Error("can't find any object format");this.anyObjectFormat=t,this.objectFormatIds=Object.freeze(e.map(function(i){return i.id}).sort())}_createClass(gc,[{key:"isAnyObjectFormatRecord",value:function isAnyObjectFormatRecord(e){for(var t in e.properties){return!1}return e.index===e.id&&e.key===e.id}},{key:"completeObjectFormat",value:function completeObjectFormat(e,t){e.id=t.id,e.key=this.formats[t.key],e.index=this.formats[t.index],e.properties={};for(var i in t.properties){e.properties[i]=this.formats[t.properties[i]]}Object.freeze(e.properties),Object.freeze(e)}},{key:"findObjectFormat",value:function findObjectFormat(e){var t=this.formats[e];if(!t)throw new Error("can't find ObjectFormat with id ".concat(e));return t}},{key:"serialize",value:function serialize(){var e=[],t=new Fe;for(var i in this.records){e.push(this.records[i])}e.sort(function(i,r){return i.id-r.id}),t.writeUint32(e.length);for(var _i17=0,_e2=e;_i17<_e2.length;_i17++){var _i18=_e2[_i17];this.serializeRecord(_i18,t)}return t.toBuffer()}},{key:"serializeRecord",value:function serializeRecord(e,t){if(e.id>In)throw new Ni("ObjectFormat's number can't greater than ".concat(In));var i=Object.keys(e.properties).sort();if(i.length>In)throw new Ni("ObjectFormat's properties number can't greater than ".concat(In));t.writeUint32(e.id),t.writeUint32(e.key),t.writeUint32(e.index),t.writeUint32(i.length);var _iterator30=_createForOfIteratorHelper(i),_step30;try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var r=_step30.value;t.writeString(r),t.writeUint32(e.properties[r])}}catch(err){_iterator30.e(err)}finally{_iterator30.f()}}}],[{key:"deserialize",value:function deserialize(e){var t=[],i=new ye(e),r=i.readUint32();for(var n=0;n<r;++n){var s=i.readUint32(),o=i.readUint32(),a=i.readUint32(),c=i.readUint32(),h={};for(var d=0;d<c;++d){var u=i.readString(),p=i.readUint32();h[u]=p}t.push({id:s,key:o,index:a,properties:h})}return t}}]);return gc}(),re=Math.pow(2,32)-1;var zp=x(require("atob"));var t1=Object.defineProperty,Ip=Object.getOwnPropertySymbols,i1=Object.prototype.hasOwnProperty,r1=Object.prototype.propertyIsEnumerable,Pp=function Pp(e,t,i){return t in e?t1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},jo=function jo(e,t){for(var i in t||(t={})){i1.call(t,i)&&Pp(e,i,t[i])}if(Ip){var _iterator31=_createForOfIteratorHelper(Ip(t)),_step31;try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var i=_step31.value;r1.call(t,i)&&Pp(e,i,t[i])}}catch(err){_iterator31.e(err)}finally{_iterator31.f()}}return e},iM=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},n1=/*#__PURE__*/function(){function n1(e){_classCallCheck(this,n1);this.sockets=[],this.logger=e}_createClass(n1,[{key:"socketsCount",get:function get(){return this.sockets.length}},{key:"addSocket",value:function addSocket(e){this.sockets.indexOf(e)===-1&&this.sockets.push(e)}},{key:"removeSocket",value:function removeSocket(e){var t=this.sockets.indexOf(e);t!==-1&&this.sockets.splice(t,1)}},{key:"forEachSockets",value:function forEachSockets(e){this.sockets.forEach(e)}},{key:"emit",value:function emit(e,t){var _iterator32=_createForOfIteratorHelper(this.sockets),_step32;try{for(_iterator32.s();!(_step32=_iterator32.n()).done;){var i=_step32.value;try{i.emit(e,t)}catch(r){this.logger.error(r)}}}catch(err){_iterator32.e(err)}finally{_iterator32.f()}}}]);return n1}(),zo=/*#__PURE__*/function(){function zo(e){_classCallCheck(this,zo);this.typesMap={},this.typeToIndexMap={},this.typesMap=Object.freeze(this.createTypesMap(e)),this.typeToIndexMap=Object.freeze(this.createTypeToIndexMap(this.typesMap))}_createClass(zo,[{key:"createTypesMap",value:function createTypesMap(e){var t={};for(var i=0;i<e.length;++i){t[i]=e[i]}return t}},{key:"createTypeToIndexMap",value:function createTypeToIndexMap(e){var t={};for(var i in e){var r=parseInt(i,10),n=e[r];if(n in t)throw new Error("find duplicated type \"".concat(n," in parameters of new TypesMap(...)\""));t[n]=r}return t}},{key:"hasType",value:function hasType(e){return e in this.typeToIndexMap}},{key:"findTypeId",value:function findTypeId(e){var t=this.typeToIndexMap[e];if(t===void 0)throw new Error("can't find id with type ".concat(e));return t}},{key:"findTypeById",value:function findTypeById(e){var t=this.typesMap[e];if(!t)throw new Error("can't find type with id ".concat(e));return t}},{key:"extendsTypesMap",value:function extendsTypesMap(e){var t=[];for(var i in this.typesMap){t.push(this.typesMap[i])}for(var _i19 in e.typesMap){t.push(e.typesMap[_i19])}return new zo(t)}}],[{key:"create",value:function create(e){return new zo(e)}}]);return zo}(),Tn;(function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"})(Tn||(Tn={}));var s1=/*#__PURE__*/function(){function s1(){_classCallCheck(this,s1);this.eventListeners={}}_createClass(s1,[{key:"on",value:function on(e,t){var i=this.eventListeners[e];i||(i=[],this.eventListeners[e]=i),i.indexOf(t)===-1&&i.push(t)}},{key:"off",value:function off(e,t){var i=this.eventListeners[e];if(i){var r=i.indexOf(t);r!==-1&&(i.splice(r,1),i.length===0&&delete this.eventListeners[e])}}},{key:"once",value:function once(e,t){var _this14=this;var i=function i(r){try{t(r)}finally{_this14.off(e,i)}};this.on(e,i)}},{key:"dispatchToListeners",value:function dispatchToListeners(e,t){var i=this.eventListeners[e];if(i){var _iterator33=_createForOfIteratorHelper(i),_step33;try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){var r=_step33.value;try{r(t)}catch(n){console.error(n)}}}catch(err){_iterator33.e(err)}finally{_iterator33.f()}}}}]);return s1}(),yc=Math.pow(2,32);function bc(e,t,i){var r=i%yc,n=(i-r)/yc;e.setInt32(t,r),e.setInt32(t+4,n)}function vc(e,t){var i=e.getInt32(t);return e.getInt32(t+4)*yc+i}var Cs;(function(e){e[e.Buffer=0]="Buffer",e[e.String=1]="String",e[e.Integer=2]="Integer"})(Cs||(Cs={}));function o1(e){switch(_typeof(e)){case"number":return 2;case"string":return 1;default:return 0;}}var a1=/*#__PURE__*/function(){function a1(e,t,i){var _this15=this;_classCallCheck(this,a1);this.typesMap=e,this.socket=t,this.receiver=i,this.latestThreePackageBytes=[0,0,0],this.nextSelfPackageId=0,this._latestReceivedRemoteId=-1,this.onMessage=function(r){try{if(!_this15.receivedPackageHeadBuffer)_this15.receivedPackageHeadBuffer=ri(r.data);else{var n=_this15.receivedPackageHeadBuffer,s=ri(r.data),o=_this15.parsePackage(n,s);_this15._latestReceivedRemoteId=Math.max(o.id,_this15._latestReceivedRemoteId),_this15.receivedPackageHeadBuffer=void 0,_this15.receiver(null,o)}}catch(n){_this15.receiver(n,null)}},t.binaryType="arraybuffer",t.addEventListener("message",this.onMessage)}_createClass(a1,[{key:"bufferedAmount",get:function get(){return this.socket.bufferedAmount}},{key:"maxPackageBytesInLatestThree",get:function get(){return Math.max.apply(Math,[0].concat(_toConsumableArray(this.latestThreePackageBytes)))}},{key:"latestReceivedRemoteId",get:function get(){return this._latestReceivedRemoteId}},{key:"sendPackage",value:function sendPackage(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=Object.freeze({id:this.nextSelfPackageId,receivedId:this._latestReceivedRemoteId,type:e,data:t});this.nextSelfPackageId+=1;var r=this.createPackageHead(i),n=this.wrapPackageData(i.data),s=r.byteLength+n.byteLength;return this.socket.send(r.primitiveBuffer),this.socket.send(n.primitiveBuffer),this.latestThreePackageBytes[0]=this.latestThreePackageBytes[1],this.latestThreePackageBytes[1]=this.latestThreePackageBytes[2],this.latestThreePackageBytes[2]=s,i.id}},{key:"createPackageHead",value:function createPackageHead(e){var t=vt(18);return bc(t,0,e.id),bc(t,8,e.receivedId),t.setUint8(16,this.typesMap.findTypeId(e.type)),t.setUint8(17,o1(e.data)),t}},{key:"wrapPackageData",value:function wrapPackageData(e){if(typeof e=="string"){var t=new String(e),i=vt(t.length*2);for(var r=0;r<t.length;++r){i.setUint16(r*2,t.charCodeAt(r)&65535)}return i}else if(typeof e=="number"){var _t4=vt(8);return bc(_t4,0,e),_t4}else return e}},{key:"parsePackage",value:function parsePackage(e,t){var i=vc(e,0),r=vc(e,8),n=e.getUint8(16),s=e.getUint8(17),o;switch(s){case Cs.String:{var a=t.byteLength/2,c=[];for(var h=0;h<a;++h){c[h]=t.getUint16(h*2)}o=String.fromCharCode.apply(String,c);break}case Cs.Integer:{o=vc(t,0);break}case Cs.Buffer:{o=t;break}default:throw new Error("unrecognized data type ".concat(s));}return Object.freeze({id:i,receivedId:r,type:this.typesMap.findTypeById(n),data:o})}}]);return a1}(),Mp=/*#__PURE__*/function(){function Mp(e,t,i,r,n){var _this16=this;_classCallCheck(this,Mp);this.receivedWhenNotWorkingBuffer=[],this.remoteHeartbeatTimeout=void 0,this.crashByChannelError=!1,this.isWorking=!1,this.isLimit=!1,this.becameLimitTimestamp=0,this.sendHeartbeat=function(){_this16.isWorking&&(_this16.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(_this16.akkoSocket.params.heartbeatInterval),_this16.chanel.sendPackage("heartbeat"))},this.handleRemoteHeartbeatTimeout=function(){_this16.crashByChannelError||(_this16.crashByChannelError=!0,_this16.callbacks.onRemoteHeartbeatTimeout())},this.onReceivedPackage=function(s,o){if(!_this16.crashByChannelError)if(!s&&o){if(_this16.isWorking)try{_this16.handleReceivedPackage(o)}finally{_this16.delayRemoteHeartbeatTimeoutChecking()}else _this16.receivedWhenNotWorkingBuffer.push(o);}else s&&!o&&_this16.callbacks.onParseMessageFailed(s)},this.akkoSocket=e,this.logger=i,this.chanel=new a1(r,t,this.onReceivedPackage),this.callbacks=Object.freeze(jo({},n)),this.sendHeartbeatDelayer=new Ai(this.sendHeartbeat),this.remoteHeartbeatTimeoutDelayer=new Ai(this.handleRemoteHeartbeatTimeout)}_createClass(Mp,[{key:"send",value:function send(e,t){if(this.isWorking)if(t instanceof Array){var _iterator34=_createForOfIteratorHelper(t),_step34;try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){var i=_step34.value;this.sendPackage(e,i)}}catch(err){_iterator34.e(err)}finally{_iterator34.f()}}else this.sendPackage(e,t)}},{key:"sendPackage",value:function sendPackage(e,t){if(this.checkBufferedAmountOverflow())throw this.crashByChannelError||(this.crashByChannelError=!0,this.callbacks.onSendingBufferOverflow()),new Error("sending buffer overflow");this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage(e,t)}},{key:"checkBufferedAmountOverflow",value:function checkBufferedAmountOverflow(){var e=!1,_this$akkoSocket$para=this.akkoSocket.params,t=_this$akkoSocket$para.sendingBufferCrash,i=_this$akkoSocket$para.sendingBufferLimit,r=_this$akkoSocket$para.sendingBufferLimitDuration,_this$chanel=this.chanel,n=_this$chanel.bufferedAmount,s=_this$chanel.maxPackageBytesInLatestThree;if(n>t+s)e=!0;else if(n>i+s){var o=Date.now();this.isLimit?o-this.becameLimitTimestamp>r&&(this.isLimit=!1,e=!0):(this.isLimit=!0,this.becameLimitTimestamp=o)}else this.isLimit=!1;return e}},{key:"dispatchClose",value:function dispatchClose(e){var t=JSON.stringify(e);this.chanel.sendPackage("close",t)}},{key:"start",value:function start(){this.isWorking||(this.isWorking=!0,this.delayRemoteHeartbeatTimeoutChecking(),this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage("setHeartbeatTimeout",this.akkoSocket.params.heartbeatTimeout),this.cleanReceivedWhenNotWorkingBuffer())}},{key:"cleanReceivedWhenNotWorkingBuffer",value:function cleanReceivedWhenNotWorkingBuffer(){var e=this.receivedWhenNotWorkingBuffer.splice(0,this.receivedWhenNotWorkingBuffer.length);if(e.length>0)try{var _iterator35=_createForOfIteratorHelper(e),_step35;try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var t=_step35.value;this.handleReceivedPackage(t)}}catch(err){_iterator35.e(err)}finally{_iterator35.f()}}finally{this.delayRemoteHeartbeatTimeoutChecking()}}},{key:"stop",value:function stop(){this.isWorking&&(this.isWorking=!1,this.sendHeartbeatDelayer.cancel(),this.remoteHeartbeatTimeoutDelayer.cancel(),this.remoteHeartbeatTimeout=void 0)}},{key:"handleReceivedPackage",value:function handleReceivedPackage(e){if(!Mp.sessionEventTypesMap.hasType(e.type))this.callbacks.onEvent(e.type,e.data);else if(e.type==="setHeartbeatTimeout")typeof e.data=="number"&&e.data>0?this.remoteHeartbeatTimeout=e.data:this.logger.warn("illegal remote heartbeat timeout: ".concat(e.data));else if(e.type==="close"){var t;if(typeof e.data=="string")try{t=JSON.parse(e.data)}catch(i){this.logger.warn("parse close payload as JSON failed: ".concat(i.message))}this.callbacks.onCloseByRemote(t)}}},{key:"delayRemoteHeartbeatTimeoutChecking",value:function delayRemoteHeartbeatTimeoutChecking(){this.remoteHeartbeatTimeout===void 0?this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatTimeout):this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.remoteHeartbeatTimeout)}}]);return Mp}(),Sc=Mp;Sc.sessionEventTypesMap=zo.create(["heartbeat","setHeartbeatTimeout","close"]);var l1=25*1e3,c1=/*#__PURE__*/function(){function c1(e,t){var _this17=this;_classCallCheck(this,c1);this.socket=e,this.logger=t,this.paddingExecutors=[],this.createdAt=Date.now(),this.isConnecting=!0,this.onOpen=function(){if(_this17.isConnecting){_this17.finishConnecting();var i=Date.now()-_this17.createdAt;var _iterator36=_createForOfIteratorHelper(_this17.paddingExecutors.splice(0)),_step36;try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var r=_step36.value;r.resolve({duration:i})}}catch(err){_iterator36.e(err)}finally{_iterator36.f()}}},this.onError=function(i){if(_this17.isConnecting){_this17.finishConnecting();var r=new Error(i.message||"connect failed");var _iterator37=_createForOfIteratorHelper(_this17.paddingExecutors.splice(0)),_step37;try{for(_iterator37.s();!(_step37=_iterator37.n()).done;){var n=_step37.value;n.reject(r)}}catch(err){_iterator37.e(err)}finally{_iterator37.f()}}},this.onTimeout=function(){if(_this17.isConnecting){_this17.finishConnecting();var i=new Error("timeout");var _iterator38=_createForOfIteratorHelper(_this17.paddingExecutors.splice(0)),_step38;try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var _r13=_step38.value;_r13.reject(i)}}catch(err){_iterator38.e(err)}finally{_iterator38.f()}try{var r=1e3;_this17.socket.close(r)}catch(r){_this17.logger.error(r)}}},e.addEventListener("open",this.onOpen),e.addEventListener("error",this.onError),this.timeoutTimer=setTimeout(this.onTimeout,l1)}_createClass(c1,[{key:"waitToConnected",value:function waitToConnected(){var _this18=this;return new Promise(function(e,t){_this18.paddingExecutors.push({resolve:e,reject:t})})}},{key:"finishConnecting",value:function finishConnecting(){this.timeoutTimer&&clearTimeout(this.timeoutTimer),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("error",this.onError),this.isConnecting=!1,this.timeoutTimer=null}}]);return c1}(),h1=3e3,d1=/*#__PURE__*/function(_s7){_inherits(d1,_s7);var _super9=_createSuper(d1);function d1(e,t,i,r){var _this19;_classCallCheck(this,d1);_this19=_super9.call(this);_this19.connectingManager=null,_this19.connectFailError=void 0,_this19.onError=function(){_this19.logger.warn("websocket received error")},_this19.onCloseByRemote=function(n){if(_this19._phase!==we.Connected)return;var s=1e3;_this19.sessionChannel.stop(),_this19.closeSocket(s),_this19.updatePhase(we.Disconnected);var o=n&&n.error,a=n&&n.reason;o?_this19.params.onDisconnect({reason:wt.RemoteError,message:o,remoteCode:n.errorCode}):_this19.params.onDisconnect({reason:wt.Normal,message:a||"ok"})},_this19.onClose=function(_ref12){var _ref12$code=_ref12.code,n=_ref12$code===void 0?1e3:_ref12$code,s=_ref12.reason;if(_this19._phase!==we.Connected)return;var o=_this19.errorMessageWithCode(n)||"disconnected with code ".concat(n," \"").concat(s,"\"");_this19.sessionChannel.stop(),_this19.updatePhase(we.Disconnected),_this19.params.onDisconnect({reason:wt.WebSocketError,message:o,webSocketCode:n})},_this19.socket=e,_this19.socket.binaryType="arraybuffer",_this19.logger=t,_this19.params=Object.freeze(jo({},r)),_this19.sessionChannel=new Sc(_assertThisInitialized(_this19),e,t,i,{onCloseByRemote:_this19.onCloseByRemote,onEvent:function onEvent(n,s){return _this19.dispatchToListeners(n,s)},onRemoteHeartbeatTimeout:function onRemoteHeartbeatTimeout(){return _this19.onCommunicationErrorMessage("remote heartbeat timeout")},onSendingBufferOverflow:function onSendingBufferOverflow(){return _this19.onCommunicationErrorMessage("sending buffer overflow")},onParseMessageFailed:function onParseMessageFailed(n){return _this19.onCommunicationErrorMessage("parse message failed: "+n.message)}}),_this19.initializePhaseWithSocketReadyState();return _this19}_createClass(d1,[{key:"initializePhaseWithSocketReadyState",value:function initializePhaseWithSocketReadyState(){switch(this.socket.readyState){case Tn.CONNECTING:{this._phase=we.Connecting,this.connect();break}case Tn.OPEN:{this._phase=we.Connected,this.addSessionListeners(),this.sessionChannel.start();break}default:{var e=Tn[this.socket.readyState];throw e||(e="".concat(this.socket.readyState)),new Error("invalid readyState of WebSocket: ".concat(e))}}}},{key:"phase",get:function get(){return this._phase}},{key:"updatePhase",value:function updatePhase(e){if(this._phase!==e)try{this.params.onPhaseChanged(e)}finally{this._phase=e}}},{key:"emit",value:function emit(e,t){if(this._phase!==we.Connected)throw new Error("AkkoSocket can't emit when phase is ".concat(this.phase));try{this.sessionChannel.send(e,t)}catch(i){var r=1e3;throw this.disconnectForceWithCode(r),this.params.onDisconnect({reason:wt.WebSocketError,message:i.message}),i}}},{key:"connect",value:function(){var _connect=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;this.connectingManager=new c1(this.socket,this.logger);_context2.next=4;return this.connectingManager.waitToConnected();case 4:this.addSessionListeners();this.sessionChannel.start();this.updatePhase(we.Connected);_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2["catch"](0);this.updatePhase(we.Disconnected),this.connectFailError=_context2.t0;case 12:_context2.prev=12;this.connectingManager=null;return _context2.finish(12);case 15:case"end":return _context2.stop();}}},_callee2,this,[[0,9,12,15]])}));function connect(){return _connect.apply(this,arguments)}return connect}()},{key:"addSessionListeners",value:function addSessionListeners(){this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("error",this.onError)}},{key:"waitToConnected",value:function waitToConnected(){if(this.connectFailError)throw this.connectFailError;if(this._phase===we.Connected)return Promise.resolve({duration:0});if(this._phase===we.Connecting)return this.connectingManager.waitToConnected();throw new Error("AkkoSocket's phase had became ".concat(this._phase))}},{key:"disconnect",value:function disconnect(e){return e?this.disconnectWithCodeAndReason({reason:e}):this.disconnectWithCodeAndReason()}},{key:"disconnectWithErrorDescription",value:function disconnectWithErrorDescription(_ref13){var e=_ref13.message,t=_ref13.code;return this.disconnectWithCodeAndReason({error:e,errorCode:t})}},{key:"disconnectForce",value:function disconnectForce(){if(this._phase!==we.Connected)return;var e=1e3;this.disconnectForceWithCode(e)}},{key:"disconnectForceWithCode",value:function disconnectForceWithCode(e){this.sessionChannel.stop(),this.closeSocket(e),this.updatePhase(we.Disconnected)}},{key:"disconnectWithCodeAndReason",value:function(){var _disconnectWithCodeAndReason=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee3(e){var t,i;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!this.didCallDisconnect){_context3.next=2;break}throw new Error("AkkoSocket did call disconnect");case 2:this.didCallDisconnect=!0;t=!0;_context3.t0=this._phase;_context3.next=_context3.t0===we.Disconnecting?7:_context3.t0===we.Disconnected?7:_context3.t0===we.Connecting?8:17;break;case 7:throw new Error("AkkoSocket can't disconnect when phase is ".concat(this.phase));case 8:_context3.prev=8;_context3.next=11;return this.waitToConnected();case 11:_context3.next=16;break;case 13:_context3.prev=13;_context3.t1=_context3["catch"](8);t=!1;case 16:return _context3.abrupt("break",17);case 17:if(!t){_context3.next=26;break}this.updatePhase(we.Disconnecting);this.sessionChannel.dispatchClose(e);_context3.next=22;return this.waitUtilCloseAndCheckTimeout();case 22:if(!_context3.sent){_context3.next=25;break}i=1e3;this.closeSocket(i);case 25:this.sessionChannel.stop(),this.updatePhase(we.Disconnected);case 26:case"end":return _context3.stop();}}},_callee3,this,[[8,13]])}));function disconnectWithCodeAndReason(_x6){return _disconnectWithCodeAndReason.apply(this,arguments)}return disconnectWithCodeAndReason}()},{key:"waitUtilCloseAndCheckTimeout",value:function waitUtilCloseAndCheckTimeout(){var _this20=this;var e=null,t=new Promise(function(r){e=setTimeout(function(){e=null,r(!0)},h1)}),i=new Promise(function(r){_this20.socket.readyState===Tn.CLOSED?r(!1):_this20.socket.addEventListener("close",function(){return r(!1)})});return Promise.race([t,i]).then(function(r){return e!==null&&clearTimeout(e),r})}},{key:"onCommunicationErrorMessage",value:function onCommunicationErrorMessage(e){this._phase===we.Connected&&(this.disconnectForce(),this.params.onDisconnect({reason:wt.CommunicationError,message:e}))}},{key:"closeSocket",value:function closeSocket(e){try{this.socket.close(e)}catch(t){this.logger.error(t)}}},{key:"errorMessageWithCode",value:function errorMessageWithCode(e){switch(e){case 1e3:return"CLOSE_NORMAL";case 1001:return"CLOSE_GOING_AWAY";case 1002:return"CLOSE_PROTOCOL_ERROR";case 1003:return"CLOSE_UNSUPPORTED";case 1005:return"CLOSE_NO_STATUS";case 1006:return"CLOSE_ABNORMAL";case 1007:return"Unsupported Data";case 1008:return"Policy Violation";case 1009:return"CLOSE_TOO_LARGE";case 1010:return"Missing Extension";case 1011:return"Internal Error";case 1012:return"Service Restart";case 1013:return"Try Again Later";case 1015:return"TLS Handshake";default:return;}}}]);return d1}(s1),Tp=/*#__PURE__*/function(){function Tp(e){_classCallCheck(this,Tp);this.eventTypesMap=Sc.sessionEventTypesMap.extendsTypesMap(zo.create(e))}_createClass(Tp,[{key:"createSocket",value:function createSocket(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new d1(e,t,this.eventTypesMap,jo(jo({},Tp.defaultSocketParams),i))}},{key:"createCombinedSockets",value:function createCombinedSockets(e){return new n1(e)}}]);return Tp}(),wc=Tp;wc.defaultSocketParams=Object.freeze({heartbeatInterval:40*1e3,heartbeatTimeout:50*1e3,sendingBufferLimit:5*1024*1024,sendingBufferLimitDuration:30*1e3,sendingBufferCrash:100*1024*1024,onDisconnect:function onDisconnect(){},onPhaseChanged:function onPhaseChanged(){}});var we;(function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnecting="disconnecting",e.Disconnected="disconnected"})(we||(we={}));var wt;(function(e){e.Normal="normal",e.WebSocketError="webSocketError",e.CommunicationError="communicationError",e.RemoteError="remoteError"})(wt||(wt={}));var u1=Object.defineProperty,p1=Object.defineProperties,m1=Object.getOwnPropertyDescriptors,Ep=Object.getOwnPropertySymbols,f1=Object.prototype.hasOwnProperty,g1=Object.prototype.propertyIsEnumerable,Ap=function Ap(e,t,i){return t in e?u1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Qt=function Qt(e,t){for(var i in t||(t={})){f1.call(t,i)&&Ap(e,i,t[i])}if(Ep){var _iterator39=_createForOfIteratorHelper(Ep(t)),_step39;try{for(_iterator39.s();!(_step39=_iterator39.n()).done;){var i=_step39.value;g1.call(t,i)&&Ap(e,i,t[i])}}catch(err){_iterator39.e(err)}finally{_iterator39.f()}}return e},ai=function ai(e,t){return p1(e,m1(t))},oM=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};function y1(e){var t=e.readInt32();e.readInt32();var i=[];for(var r=0;r<t;++r){var n=e.readUint32();i.push({userId:n,nextFrameId:0,session:"",payload:void 0})}return i}var be;(function(e){e[e.Invoker=0]="Invoker",e[e.Event=1]="Event",e[e.Ack=2]="Ack",e[e.Enter=3]="Enter",e[e.Leave=4]="Leave"})(be||(be={}));function kc(e){return e.type===0}function Uo(e){return e.type===1}function Vo(e){return e.type===3}function Wo(e){return e.type===4}var Be;(function(e){e[e.System=0]="System",e[e.App=1]="App",e[e.Custom=2]="Custom",e[e.Magix=3]="Magix"})(Be||(Be={}));var b1=/*#__PURE__*/function(){function b1(e,t){_classCallCheck(this,b1);var i=e.format.anyObjectFormat;this.serialization=e,this.rootClassReflection=t,this.rootObjectFormats=Object.freeze([this.rootClassReflection.objectFormat]),this.oneAnyObjectFormats=Object.freeze([i]),this.twoAnyObjectFormats=Object.freeze([i,i])}_createClass(b1,[{key:"serializeSnapshotFrame",value:function serializeSnapshotFrame(e){var t=new Fe;return this.serializeFrameHeader(t,e),this.serializeUsers(t,e.users),this.serialization.serialize({writer:t,values:[e.rootObject],objectFormats:this.rootObjectFormats,includesHash:!0}),t.toBuffer()}},{key:"serializeUsers",value:function serializeUsers(e,t){var i=[this.serialization.format.anyObjectFormat];e.writeUint32(t.length);var _iterator40=_createForOfIteratorHelper(t),_step40;try{for(_iterator40.s();!(_step40=_iterator40.n()).done;){var r=_step40.value;e.writeUint32(r.userId),e.writeUint32(r.nextFrameId),e.writeString(r.session),this.serialization.serialize({writer:e,values:[r.payload],objectFormats:i,includesHash:!0})}}catch(err){_iterator40.e(err)}finally{_iterator40.f()}}},{key:"deserializeSnapshotFrame",value:function deserializeSnapshotFrame(e,t,i){var r=new ye(e),n=this.deserializeFrameHeader(r),s;t!==si.V0?s=this.deserializeUsers(r,t,i):s=y1(r);var _this$serialization$d=this.serialization.deserialize({reader:r,objectFormats:this.rootObjectFormats,ignoreHashChecking:i,version:t}),_this$serialization$d2=_slicedToArray(_this$serialization$d,1),o=_this$serialization$d2[0];return ai(Qt({},n),{users:s,rootObject:o})}},{key:"deserializeUsers",value:function deserializeUsers(e,t,i){var r=e.readUint32(),n=[],s=[this.serialization.format.anyObjectFormat];for(var o=0;o<r;++o){var a=e.readUint32(),c=e.readUint32(),h=e.readString(),_this$serialization$d3=this.serialization.deserialize({reader:e,objectFormats:s,ignoreHashChecking:i,version:t}),_this$serialization$d4=_slicedToArray(_this$serialization$d3,1),d=_this$serialization$d4[0];n.push({userId:a,nextFrameId:c,session:h,payload:d})}return Object.freeze(n)}},{key:"serializeActionFrame",value:function serializeActionFrame(e,t){var i=new Fe;if(this.serializeFrameHeader(i,e),i.writeUint8(e.type),i.writeInt53(e.scopeId),i.writeInt53(e.beginObjectId),kc(e)){i.writeUint32(e.methodId);var r=this.rootClassReflection.methodNames[e.methodId],n=this.rootClassReflection.methods[r].parameterFormatObjects;this.serialization.serialize({writer:i,values:e.parameters,objectFormats:n,includesHash:t})}else Uo(e)?(i.writeUint8(e.scope),i.writeString(e.event),this.serialization.serialize({writer:i,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t})):Vo(e)?(i.writeString(e.session),this.serialization.serialize({writer:i,values:[e.userPayload,e.connectedPayload],objectFormats:this.twoAnyObjectFormats,includesHash:t})):Wo(e)&&this.serialization.serialize({writer:i,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t});return i.toBuffer()}},{key:"deserializeActionFrame",value:function deserializeActionFrame(e,t,i){var r=new ye(e),n=this.deserializeFrameHeader(r),s=r.readUint8(),o=0,a=0,c;switch(t!==si.V0&&(o=r.readInt53(),a=r.readInt53()),s){case be.Invoker:{var h=r.readUint32(),d=this.rootClassReflection.methodNames[h],u=this.rootClassReflection.methods[d].parameterFormatObjects,p=this.serialization.deserialize({reader:r,objectFormats:u,ignoreHashChecking:i,version:t});return t===si.V0&&(c=r.readBigInt()),ai(Qt({},n),{type:s,scopeId:o,beginObjectId:a,beginGenerationId:c,methodId:h,parameters:p})}case be.Event:{var _h3=r.readUint8(),_d2=r.readString(),_this$serialization$d5=this.serialization.deserialize({reader:r,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:i,version:t}),_this$serialization$d6=_slicedToArray(_this$serialization$d5,1),_u2=_this$serialization$d6[0];return t===si.V0&&(c=r.readBigInt()),ai(Qt({},n),{type:s,scopeId:o,beginObjectId:a,beginGenerationId:c,scope:_h3,event:_d2,payload:_u2})}case be.Ack:return ai(Qt({},n),{type:s,scopeId:o,beginObjectId:a});case be.Enter:{var _h4=r.readString(),_this$serialization$d7=this.serialization.deserialize({reader:r,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:i,version:t}),_this$serialization$d8=_slicedToArray(_this$serialization$d7,2),_d3=_this$serialization$d8[0],_u3=_this$serialization$d8[1];return ai(Qt({},n),{type:s,scopeId:o,beginObjectId:a,session:_h4,userPayload:_d3,connectedPayload:_u3})}case be.Leave:{var _this$serialization$d9=this.serialization.deserialize({reader:r,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:i,version:t}),_this$serialization$d10=_slicedToArray(_this$serialization$d9,1),_h5=_this$serialization$d10[0];return ai(Qt({},n),{type:s,scopeId:o,beginObjectId:a,payload:_h5})}default:throw new Error("invalid type ".concat(s));}}},{key:"serializeFrameHeader",value:function serializeFrameHeader(e,t){e.writeUint32(t.frameId),e.writeUint32(t.originalFrameId),e.writeInt53(t.timestamp),e.writeUint32(t.authorId)}},{key:"deserializeFrameHeader",value:function deserializeFrameHeader(e){var t=e.readUint32(),i=e.readUint32(),r=e.readInt53(),n=e.readUint32();return{frameId:t,originalFrameId:i,timestamp:r,authorId:n}}}]);return b1}(),Cc=Math.pow(2,32),v1=Math.pow(2,16),dM=Cc-1,uM=v1-1,Ho=1,Di=4,xc=8,Hr=5*Di;function Ic(e,t){var i=e.getInt32(t);return e.getInt32(t+Di)*Cc+i}function Op(e){var t=new ye(e),i=new Fe;for(var r=0;r<Hr;++r){i.writeUint8(t.readUint8())}return i.writeUint8(be.Ack),i.toBuffer()}var zt=/*#__PURE__*/function(){function zt(e){_classCallCheck(this,zt);if(e.byteLength<Hr)throw new Error("Buffer is to short");this.frameBuffer=e}_createClass(zt,[{key:"frameId",get:function get(){return this.frameBuffer.getUint32(0)},set:function set(e){this.frameBuffer.setUint32(0,e)}},{key:"originalFrameId",get:function get(){return this.frameBuffer.getUint32(1*Di)},set:function set(e){this.frameBuffer.setUint32(1*Di,e)}},{key:"timestamp",get:function get(){return Ic(this.frameBuffer,2*Di)},set:function set(e){var t=e|0,i=(e-t)/Cc;this.frameBuffer.setInt32(2*Di,t),this.frameBuffer.setInt32(3*Di,i)}},{key:"authorId",get:function get(){return this.frameBuffer.getUint32(4*Di)},set:function set(e){this.frameBuffer.setUint32(4*Di,e)}},{key:"type",get:function get(){return this.frameBuffer.getUint8(Hr)}},{key:"scopeId",get:function get(){return Ic(this.frameBuffer,Hr+Ho)}},{key:"beginObjectId",get:function get(){return Ic(this.frameBuffer,Hr+xc+Ho)}},{key:"scope",get:function get(){return this.frameBuffer.getUint8(Hr+2*xc+Ho)}},{key:"fetchEventContent",value:function fetchEventContent(){var e=new ye(this.frameBuffer),t=Hr+2*xc+Ho;if(e.skipBytes(t),this.type===be.Event){var i=e.readUint8();return{event:e.readString(),scope:i}}}}]);return zt}(),Pc=/*#__PURE__*/function(_Pn){_inherits(Pc,_Pn);var _super10=_createSuper(Pc);function Pc(){_classCallCheck(this,Pc);return _super10.call(this)}_createClass(Pc,[{key:"createObject",value:function createObject(e,t){var i=_get(_getPrototypeOf(Pc.prototype),"createObject",this).call(this,e,t);return Pc.objectsCollection&&Pc.objectsCollection.push(i),i}}],[{key:"startCollection",value:function startCollection(){this.objectsCollection=[]}},{key:"completeCollection",value:function completeCollection(){try{if(!this.objectsCollection)return[];var _iterator41=_createForOfIteratorHelper(this.objectsCollection),_step41;try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var e=_step41.value;delete e.__identifier}}catch(err){_iterator41.e(err)}finally{_iterator41.f()}return this.objectsCollection}finally{this.objectsCollection=void 0}}}]);return Pc}(Pn),xs=Pc;xs.objectsCollection=void 0;function Mc(e,t){return new b1(e,t)}var S1=/*#__PURE__*/function(){function S1(){_classCallCheck(this,S1);this.listeners=[]}_createClass(S1,[{key:"currentNode",get:function get(){return this._currentNode}},{key:"addListener",value:function addListener(e){this.listeners.push(e)}},{key:"runWith",value:function runWith(e,t){var i=this._currentNode;this._currentNode=e,this.dispatch(e,!0);try{return t()}finally{this._currentNode=i,this.dispatch(e,!1),i&&this.dispatch(i,!0)}}},{key:"dispatch",value:function dispatch(e,t){var _iterator42=_createForOfIteratorHelper(this.listeners),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var i=_step42.value;try{i(e,t)}catch(r){console.error(r)}}}catch(err){_iterator42.e(err)}finally{_iterator42.f()}}}]);return S1}(),kt;(function(e){e[e.SingleForward=0]="SingleForward",e[e.DoubleForward=1]="DoubleForward"})(kt||(kt={}));var Y=new S1,Re;(function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.Displayer=3]="Displayer"})(Re||(Re={}));var lr;(function(e){e[e.Uncommitted=0]="Uncommitted",e[e.Committed=1]="Committed",e[e.Rejected=2]="Rejected"})(lr||(lr={}));var ne;(function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"})(ne||(ne={}));var w1=/*#__PURE__*/function(){function w1(e){_classCallCheck(this,w1);this.operator=e,this.floatObjects={}}_createClass(w1,[{key:"collectValue",value:function collectValue(e){var _this21=this;if(!(_typeof(e)!="object"||e===null)){var t=this.operator.identifier(e);return t in this.floatObjects||(this.floatObjects[t]=e,this.operator.forEach(e,function(i){_this21.collectValue(i)})),t}}}]);return w1}(),Rp=function Rp(){_classCallCheck(this,Rp)};function Tc(e){return e instanceof Rp}function Ec(e){var t=function t(i,r,n){return n};return Object.setPrototypeOf(t,Rp.prototype),Object.defineProperty(t,"payload",{enumerable:!0,configurable:!1,writable:!1,value:e}),t}var Is=Ec(null),_r=Ec(null),k1=function k1(e){var _this22=this;_classCallCheck(this,k1);this.filters=[],this.filter=function(i,r,n){var _iterator43=_createForOfIteratorHelper(_this22.filters),_step43;try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var s=_step43.value;if(s(i,r,n))return!0}}catch(err){_iterator43.e(err)}finally{_iterator43.f()}return!1};var t=[];var _iterator44=_createForOfIteratorHelper(e),_step44;try{var _loop2=function _loop2(){var i=_step44.value;var r=void 0;if(typeof i=="function")r=i;else if(typeof i=="string")r=function r(n){return n===i};else if(i instanceof RegExp)r=function r(n){return i.test(n)};else throw new Error("unrecognized condition "+i);t.push(r)};for(_iterator44.s();!(_step44=_iterator44.n()).done;){_loop2()}}catch(err){_iterator44.e(err)}finally{_iterator44.f()}this.filters=Object.freeze(t)},En;(function(e){e.System="system",e.App="app",e.Custom="custom",e.Magix="magix"})(En||(En={}));var vi;(function(e){e.Dispatched="dispatched",e.Updated="updated",e.Canceled="canceled"})(vi||(vi={}));function _o(e,t){return{event:e.event,payload:e.payload,authorId:e.authorId,scope:C1(e.scope),phase:t}}function C1(e){switch(e){case Be.System:return En.System;case Be.App:return En.App;case Be.Custom:return En.Custom;default:return En.Magix;}}var Np=function Np(e){_classCallCheck(this,Np);this.eventFilter=new k1(e).filter};function Ac(e){return _typeof(e)=="object"&&e!==null&&e instanceof Np}function Lp(){for(var _len6=arguments.length,e=new Array(_len6),_key6=0;_key6<_len6;_key6++){e[_key6]=arguments[_key6]}return Ec(new Np(e))}var ke="__reflection",x1=/*#__PURE__*/function(){function x1(e,t,i,r){_classCallCheck(this,x1);this.isRootClass=t,this.id=i.classId,this.name=i.clazz.name,this.clazz=i.clazz,this.superClass=i.superClass,this.objectFormat=e.findObjectFormat(i.objectFormatId);var n={},s={},o=[i].concat(_toConsumableArray(r));for(var a=o.length-1;a>=0;--a){var c=o[a],h=c.clazz;var _iterator45=_createForOfIteratorHelper(c.members),_step45;try{for(_iterator45.s();!(_step45=_iterator45.n()).done;){var d=_step45.value;np(d)?n[d.name]=this.createProperty(d,h,this.objectFormat):sp(d)&&(s[d.name]=this.createMethod(d,h,e))}}catch(err){_iterator45.e(err)}finally{_iterator45.f()}}this.properties=Object.freeze(n),this.methods=Object.freeze(s),this.methodNames=Object.freeze(Object.keys(this.methods))}_createClass(x1,[{key:"createProperty",value:function createProperty(e,t,i){var r=e.decorators.some(function(n){return n===Is});return Object.freeze({name:e.name,mode:e.mode,belongsClass:t,isTransient:r,isPublic:e.isPublic,objectFormat:i.properties[e.name],decorators:e.decorators})}},{key:"createMethod",value:function createMethod(e,t,i){var r=e.name,n=e.parameters,s=e.decorators,o=[];var _iterator46=_createForOfIteratorHelper(n),_step46;try{for(_iterator46.s();!(_step46=_iterator46.n()).done;){var a=_step46.value;o.push(i.findObjectFormat(a))}}catch(err){_iterator46.e(err)}finally{_iterator46.f()}return Object.freeze({name:r,belongsClass:t,isPublic:e.isPublic,parameterFormatObjects:Object.freeze(o),decorators:Object.freeze(_toConsumableArray(s))})}}]);return x1}(),I1=/*#__PURE__*/function(_Pn2){_inherits(I1,_Pn2);var _super11=_createSuper(I1);function I1(e,t,i,r,n){var _this23;_classCallCheck(this,I1);_this23=_super11.call(this,function(s,o,a,c){return _this23.handleDecorateObject(s,o,a,c)});_this23.decorateObjectEnums=Object.freeze([Z.Object,Z.Array]),_this23.proxyRuntime=e,_this23.idGenerator=i,_this23.covertIdToClass=t,_this23.toOverrideObjects=r,_this23.overrideNodeCatcher=n;return _this23}_createClass(I1,[{key:"createObject",value:function createObject(e,t){if(t===Z.HangUpObject)throw new ht("not support hang up object: ".concat(e));return _get(_getPrototypeOf(I1.prototype),"createObject",this).call(this,e,t)}},{key:"handleDecorateObject",value:function handleDecorateObject(e,t,i,r){var n=e.__identifier,s=this.proxyRuntime.objectOperator,o=this.getClassReflection(t,r),a=this.toOverrideObjects[n];if(!a||!this.isTypeMatch(a,t))switch(t){case ue.Array:{a=s.createObject(this.idGenerator.generate(),[]);break}case ue.DeducedObject:{a=s.createObject(this.idGenerator.generate(),{});break}case ue.AssertedObject:{Object.setPrototypeOf(e,o.clazz.prototype),a=s.createObject(this.idGenerator.generate(),e);break}default:throw new ht("invalid ObjectType ".concat(t));}var _iterator47=_createForOfIteratorHelper(i),_step47;try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){var _step47$value=_step47.value,c=_step47$value.object,h=_step47$value.key;c[h]=a}}catch(err){_iterator47.e(err)}finally{_iterator47.f()}this.overrideNodeCatcher(a,e,o)}},{key:"isTypeMatch",value:function isTypeMatch(e,t){switch(this.proxyRuntime.objectOperator.kind(e)){case Re.Array:return t===ue.Array;case Re.FlatObject:return t===ue.DeducedObject;case Re.AkkoObject:return t===ue.AssertedObject;default:return!1;}}},{key:"getClassReflection",value:function getClassReflection(e,t){if(e===ue.AssertedObject){if(!t)throw new ht("expect object format");var i=this.covertIdToClass(t.id);if(!i)throw new ht("can't find class by object format id ".concat(t.id));return i[ke]}else return null}}]);return I1}(Pn),Dp=/*#__PURE__*/function(){function Dp(e){var _this24=this;_classCallCheck(this,Dp);this.assertObjectFormat=function(i){var r=_this24.proxyRuntime.objectOperator.getClassReflection(i);if(r)return r.objectFormat};var t=new w1(e.proxyRuntime.objectOperator);this.format=e.format,this.snapshotObjectFormats=e.snapshotObjectFormats,this.idGenerator=e.idGenerator,this.proxyRuntime=e.proxyRuntime,this.covertIdToClass=e.covertIdToClass,t.collectValue(e.rootObject),this.floatObjects=t.floatObjects}_createClass(Dp,[{key:"recoverFrom",value:function recoverFrom(e,t){var i=[],r=new I1(this.proxyRuntime,this.covertIdToClass,this.idGenerator,this.floatObjects,function(c,h,d){return i.push({object:c,tempObject:h,classReflection:d})}),n=new bi({format:this.format,objectAdapter:r,assertObjectFormat:this.assertObjectFormat}),s=!t,_n$deserialize=n.deserialize({reader:e,objectFormats:this.snapshotObjectFormats,ignoreHashChecking:s,version:Dp.akkoSerVersion}),_n$deserialize2=_slicedToArray(_n$deserialize,1),o=_n$deserialize2[0],a;for(var _i21=0,_i20=i;_i21<_i20.length;_i21++){var _i20$_i=_i20[_i21],c=_i20$_i.object,h=_i20$_i.tempObject,d=_i20$_i.classReflection;this.proxyRuntime.objectOperator.override(c,h,d),h===o&&(a=c)}return a}}]);return Dp}(),Fp=Dp;Fp.akkoSerVersion=oi(Oe);var $o,Ps=null,Oc=null;Y.addListener(function(e,t){t&&e.tools?($o=e.coreFunctions,Oc=e.tools.idGenerator,Ps=e.proxyRuntime):($o=null,Oc=null,Ps=null)});var P1=/*#__PURE__*/function(){function P1(e,t){_classCallCheck(this,P1);this.format=t.format,this.covertIdToClass=t.covertObjectFormatIdToClass,this.description=Object.freeze({roomUUID:e,appIdentifier:t.appIdentifier,appVersion:t.appVersion,appHash:t.appHash,akkoVersion:t.akkoVersion})}_createClass(P1,[{key:"createSnapshot",value:function createSnapshot(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;if(!Y.currentNode)throw new Error("can't call createSnapshot out of Magix");var i=$o.wrapper(e),r=new Fe,n=this.readObjectFormatWith(i),s=t;return r.writeUint8(t?255:0),t&&(r.writeString(this.description.roomUUID),r.writeString(this.description.appIdentifier),r.writeString(this.description.appVersion),r.writeString(this.description.appHash),r.writeString(this.description.akkoVersion)),r.writeUint32(n.id),Ps.frameHandler.createSerialization(this.format).serialize({writer:r,values:[i],objectFormats:[n],includesHash:s}),r.toBuffer().freeze()}},{key:"recoverWithSnapshot",value:function recoverWithSnapshot(e,t){if(!Y.currentNode)throw new Error("can't call recoverWithSnapshot out of Magix");var i=$o.wrapper(t),r=new ye(e),n=this.readDescription(r),s=r.readUint32();if(i&&this.readObjectFormatWith(i).id!==s)throw new Error("target's class isn't matching");var o=this.format.findObjectFormat(s),a=this.shouldOverrideTarget(n)?i:void 0;return new Fp({rootObject:a,format:this.format,snapshotObjectFormats:[o],idGenerator:Oc,proxyRuntime:Ps,covertIdToClass:this.covertIdToClass}).recoverFrom(r,n!==void 0)}},{key:"readObjectFormatWith",value:function readObjectFormatWith(e){var t=Ps.objectOperator;if(t.kind(e)!==Re.AkkoObject)throw new Error("can't only create snapshot of AkkoObject");return t.getClassReflection(e).objectFormat}},{key:"readDescription",value:function readDescription(e){if(!e.readUint8())return;var t=e.readString(),i=e.readString(),r=e.readString(),n=e.readString(),s=e.readString();if(i!==this.description.appIdentifier)throw new Error("invalid snapshot: appIdentifier not matches");if(r!==this.description.appVersion)throw new Error("invalid snapshot: appVersion not matches");if(n!==this.description.appHash)throw new Error("invalid snapshot: appHash not matches");if(s!==this.description.akkoVersion)throw new Error("invalid snapshot: akkoVersion not matches");return{roomUUID:t,appIdentifier:i,appVersion:r,appHash:n,akkoVersion:s}}},{key:"shouldOverrideTarget",value:function shouldOverrideTarget(e){return e?e.roomUUID===this.description.roomUUID:!0}}]);return P1}();function Bp(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return new P1(t,e)}var Go;Y.addListener(function(e,t){t&&e.tools?Go=e.tools.extra:Go=void 0});function jp(){if(!Go)throw new Error("you can not call this function out of Magix");return Go.resource}var Ct;(function(e){e.Real="real",e.Illusion="illusion",e.NoEffects="noEffects"})(Ct||(Ct={}));var M1=/*#__PURE__*/function(){function M1(e){_classCallCheck(this,M1);this.atob=e}_createClass(M1,[{key:"parse",value:function parse(e){var t=new String(this.atob(e)),i=vt(t.length);for(var r=0;r<t.length;++r){i.setUint8(r,t.charCodeAt(r))}return i}}]);return M1}();function Ms(e){var t={};var _loop3=function _loop3(i){var r=e[i];typeof r=="function"?t[i]=function(){var s;try{for(var _len7=arguments.length,n=new Array(_len7),_key7=0;_key7<_len7;_key7++){n[_key7]=arguments[_key7]}s=r.apply(t,n)}catch(o){console.error(o)}return s}:t[i]=r};for(var i in e){_loop3(i)}return Object.freeze(t)}var Fi="__identifier";function An(e,t){Object.defineProperty(e,Fi,{enumerable:!1,configurable:!0,value:t})}var Up=/*#__PURE__*/function(){function Up(e,t){_classCallCheck(this,Up);this.foundObjects=[],this.idGenerator=e,this.operator=t}_createClass(Up,[{key:"complete",value:function complete(){var _iterator48=_createForOfIteratorHelper(this.foundObjects),_step48;try{for(_iterator48.s();!(_step48=_iterator48.n()).done;){var e=_step48.value;delete e[Fi]}}catch(err){_iterator48.e(err)}finally{_iterator48.f()}}},{key:"bind",value:function bind(e){if(_typeof(e)!="object"||e===null||ge(e))return e;{var t=e;if(this.operator.isDisplayerObject(t)&&(t=this.operator.copyDisplayer(t)),t.constructor===Array)return this.bindArray(t);if(t.constructor===Object)return this.bindObject(t)}throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function bindArray(e){var t=e[Fi];t===void 0&&(t=this.idGenerator.generate(),An(e,t),this.foundObjects.push(e));for(var i=0;i<e.length;++i){this.bind(e[i])}}},{key:"bindObject",value:function bindObject(e){var t=e[Fi];t===void 0&&(t=this.idGenerator.generate(),An(e,t),this.foundObjects.push(e));for(var i in e){this.bind(e[i])}}}]);return Up}(),Vp=/*#__PURE__*/function(){function Vp(e,t,i){_classCallCheck(this,Vp);this.nodes={},this.idGenerator=e,this.operator=t,this.adapter=i}_createClass(Vp,[{key:"bind",value:function bind(e,t){var i=null,r=this.bindValue(e,t),n=this.findIdentifier(r);if(n!==void 0){var _this$nodes$n=this.nodes[n],s=_this$nodes$n.wrapped,o=_this$nodes$n.copied;i={wrapped:s,copied:o}}return{value:r,binder:i}}},{key:"completeBinding",value:function completeBinding(){for(var e in this.nodes){var t=this.nodes[e].binded;delete t[Fi]}}},{key:"bindValue",value:function bindValue(e,t){if(_typeof(e)!="object"||e===null)return e;if(ge(e))return e.readonly?e:e.slice();{var i=e;if(this.operator.isDisplayerObject(i)&&(i=this.operator.copyDisplayer(i)),i.constructor===Array)return this.bindArray(i,t);if(i.constructor===Object)return this.bindObject(i,t)}throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function bindArray(e,t){var i=e[Fi];if(i===void 0){i=this.idGenerator.generate();var r=this.adapter.createObject(i,Z.Array),n=[];An(e,i),An(n,i),this.nodes[i]={identifier:i,binded:e,copied:n,wrapped:r};for(var s=0;s<e.length;++s){var o=this.bindValue(e[s],t.index),a=this.findIdentifier(o);if(a===void 0)this.adapter.setValue(r,s,o),n[s]=o;else{var _this$nodes$a=this.nodes[a],c=_this$nodes$a.copied,h=_this$nodes$a.wrapped;this.adapter.setValue(r,s,h),n[s]=c}}}return e}},{key:"bindObject",value:function bindObject(e,t){var i=e[Fi];if(i===void 0){i=this.idGenerator.generate();var r={},n=this.adapter.createObject(i,Z.Object),s=[],o=[];An(e,i),An(r,i),this.nodes[i]={identifier:i,binded:e,copied:r,wrapped:n};for(var a in t.properties){a in e&&(s.push(a),o.push(t.properties[a]))}for(var _a7 in e){_a7!==Fi&&!(_a7 in t.properties)&&(s.push(_a7),o.push(t.key))}for(var _a8=0;_a8<s.length;++_a8){var c=s[_a8],h=o[_a8],d=this.bindValue(e[c],h),u=this.findIdentifier(d);if(u===void 0)this.adapter.setValue(n,c,d),r[c]=d;else{var _this$nodes$u=this.nodes[u],p=_this$nodes$u.copied,f=_this$nodes$u.wrapped;this.adapter.setValue(n,c,f),r[c]=p}}}return e}},{key:"findIdentifier",value:function findIdentifier(e){if(_typeof(e)=="object"&&e!==null)return e[Fi]}}]);return Vp}(),On=/*#__PURE__*/function(){function On(e){_classCallCheck(this,On);this._phase=e.phase||e.getCurrentPhase(),this.getCurrentPhase=e.getCurrentPhase,this.onPhaseChanged=e.onPhaseChanged}_createClass(On,[{key:"phase",get:function get(){return this._phase}},{key:"touch",value:function touch(){var e=this.getCurrentPhase(),t=this._phase;t!==e&&(this._phase=e,this.onPhaseChanged&&this.onPhaseChanged(e,t))}}]);return On}(),T1=/*#__PURE__*/function(){function T1(e,t){_classCallCheck(this,T1);this.paddingInvokers=null,this.logger=e,this.callbacks=Qt({},t)}_createClass(T1,[{key:"hasKey",value:function hasKey(e){return e in this.callbacks}},{key:"callback",value:function callback(e,t){var i=this.callbacks[e];if(i)if(this.paddingInvokers)this.paddingInvokers.push({key:e,payload:t});else try{i(t)}catch(r){this.logger.error(r)}}},{key:"isPadding",get:function get(){return!!this.paddingInvokers},set:function set(e){if(this.isPadding!==e)if(e)this.paddingInvokers=[];else{var _iterator49=_createForOfIteratorHelper(this.paddingInvokers),_step49;try{for(_iterator49.s();!(_step49=_iterator49.n()).done;){var _step49$value=_step49.value,t=_step49$value.key,i=_step49$value.payload;try{this.callbacks[t](i)}catch(r){this.logger.error(r)}}}catch(err){_iterator49.e(err)}finally{_iterator49.f()}this.paddingInvokers=null}}}]);return T1}(),E1=/*#__PURE__*/function(){function E1(e){_classCallCheck(this,E1);this.base64Parser=new M1(e)}_createClass(E1,[{key:"create",value:function create(e){if(!this.isSupportedAkkoVersion(e.akkoVersion))throw new yi("can not support library (built by akko ".concat(e.akkoVersion,")"));var t=this.createFormat(e.formatBase64),i=this.createClassReflections(t,e.rootConstructor,e.classDeclarations),r=this.createObjectFormatToClassMap(i),n=function n(s){return r[s]};return new Rc(e.appIdentifier,e.appVersion,e.formatHash,e.akkoVersion,e.rootConstructor,n,t,i)}},{key:"isSupportedAkkoVersion",value:function isSupportedAkkoVersion(e){var t=Oe.split("."),i=e.split(".");return i.length<2||t[0]!==i[0]||t[1]!==i[1]?!1:t.length>=3?t[2]>=i[2]:!0}},{key:"createFormat",value:function createFormat(e){var t=new xp,i=this.base64Parser.parse(e);return t.createWithBuffer(i)}},{key:"createClassReflections",value:function createClassReflections(e,t,i){var r={};for(var n in i){var s=i[n],o=s.clazz,a=o===t,_this$searchThisAndSu=this.searchThisAndSuperClassDeclarations(s,i),_this$searchThisAndSu2=_toArray(_this$searchThisAndSu),c=_this$searchThisAndSu2[0],h=_this$searchThisAndSu2.slice(1),d=new x1(e,a,c,h);if(Object.getOwnPropertyDescriptor(o,ke)!==void 0)throw new yi("class ".concat(o.name," has defined  reserved word static property \"").concat(ke));Object.defineProperty(o,ke,{value:d,writable:!1,configurable:!1}),r[n]=d}return Object.freeze(r)}},{key:"createObjectFormatToClassMap",value:function createObjectFormatToClassMap(e){var t={};for(var i in e){var r=e[i],n=r.objectFormat.id;t[n]=r.clazz}return Object.freeze(t)}},{key:"searchThisAndSuperClassDeclarations",value:function searchThisAndSuperClassDeclarations(e,t){var i=[],r=e;for(;i.push(r),!(!r.superClass||r.superClass===Object);){r=this.findClassDeclarationsWithConstructor(r.superClass,t)}return i}},{key:"findClassDeclarationsWithConstructor",value:function findClassDeclarationsWithConstructor(e,t){for(var i in t){var r=t[i];if(r.clazz===e)return r}throw new yi("can not find superClass")}}]);return E1}(),Rc=/*#__PURE__*/function(){function Rc(e,t,i,r,n,s,o,a){_classCallCheck(this,Rc);this.appIdentifier=e,this.appVersion=t,this.appHash=i,this.akkoVersion=r,this.rootClass=n,this.covertObjectFormatIdToClass=s,this.format=o,this.classReflections=a}_createClass(Rc,[{key:"classReflection",value:function classReflection(e){var t=this.classReflections[e];if(!t)throw new Error("can't find class with id ".concat(e));return t}}]);return Rc}(),Wp,Hp,_p,$p,Gp,Kp,Xp,Yp,Qp,qp,Zp;function A1(){return{creator:function creator(e){return e},updater:function updater(e){return e},wrapper:function wrapper(e){return e},unwrapper:function unwrapper(e){return e},jsxUnwrapper:function jsxUnwrapper(e){return e},getter:function getter(e,t){return e[t]},setter:function setter(e,t,i){return e[t]=i},caller:function caller(e,t,i,r){return(r||e)[t].apply(e,i)},remover:function remover(e,t){return delete e[t]},prefix:function prefix(e,t,i){return e[t]+=i},postfix:function postfix(e,t,i){var r=e[t];return e[t]+=i,r}}}function O1(){return{creator:function creator(e){return Wp(e)},updater:function updater(e){return Hp(e)},wrapper:function wrapper(e){return _p(e)},unwrapper:function unwrapper(e){return $p(e)},jsxUnwrapper:function jsxUnwrapper(e){return Gp(e)},getter:function getter(e,t){return Kp(e,t)},setter:function setter(e,t,i){return Xp(e,t,i)},caller:function caller(e,t,i,r){return Yp(e,t,i,r)},remover:function remover(e,t){return Qp(e,t)},prefix:function prefix(e,t,i){return qp(e,t,i)},postfix:function postfix(e,t,i){return Zp(e,t,i)}}}function Jp(e){Wp=e.creator,Hp=e.updater,_p=e.wrapper,$p=e.unwrapper,Gp=e.jsxUnwrapper,Kp=e.getter,Xp=e.setter,Yp=e.caller,Qp=e.remover,qp=e.prefix,Zp=e.postfix}var em=Object.freeze(A1());Jp(em);Y.addListener(function(e,t){Jp(t?e.coreFunctions:em)});var Ko;Y.addListener(function(e,t){t?Ko=e.coreFunctions.creator:Ko=void 0});function Xo(){if(!Ko){var e=this.constructor&&this.constructor.name;throw e?new Error("can't construct ".concat(e," out of Magix, it's an AkkoObject")):new Error("can't construct an AkkoObject out of Magix")}Ko(this)}Object.setPrototypeOf(Xo.prototype,Object.prototype);var Yo;Y.addListener(function(e,t){t?Yo=e.proxyRuntime.objectOperator:Yo=void 0});var Qo=R1();function R1(){var e=new E1(zp["default"].bind(null));return new rp({akkoVersion:Oe,akkoObjectBaseClass:Xo,libraryFactory:e.create.bind(e),coreFunctions:O1()})}var tm=Qo.context,qo=Qo.getLibrary;function im(e){if(!Yo)throw new Error("can't call isAkkoObject out of Magix");return Yo.isValidObject(e)||Qo.isAkkoObject(e)}function Bi(e){if(typeof e=="function"){var t=e[ke];if(_typeof(t)=="object"&&t!==null)return t}else if(Qo.isAkkoObject(e))return Bi(e.constructor)}var je;Y.addListener(function(e,t){t&&e.tools?je=e.tools:je=void 0});function rm(){if(!je)throw cr();return je.environment}function nm(){if(!je)throw cr();return je.timestamp}function sm(){if(!je)throw cr();return je.functions.getAuthorId()}function om(e){if(!je)throw cr();return je.functions.hasUser(e)}function am(){if(!je)throw cr();return je.functions.getUsersCount()}function lm(e){if(!je)throw cr();return je.functions.getUser(e)}function cm(){if(!je)throw cr();return je.functions.getUserIds()}function hm(){if(!je)throw cr();return je.snapshot}function cr(){return new Error("you can not call this function out of Magix")}var ji;(function(e){e.RoomDelete="roomDelete",e.RoomZombie="roomZombie",e.RoomBan="roomBan",e.GatewayAdjust="GatewayAdjust",e.KickByAdmin="kickByAdmin",e.ReplaceByOther="replaceByOther",e.Crash="crash"})(ji||(ji={}));var j;(function(e){e[e.Inserted=0]="Inserted",e[e.Updated=1]="Updated",e[e.Removed=2]="Removed"})(j||(j={}));function dm(e){var t=new ye(e),i=t.readUint32(),r=[],n=t.readUint32();for(var s=0;s<n;++s){var o=t.readInt53(),a=t.readUint32();r.push(Object.freeze({beginScopeId:o,count:a}))}return Object.freeze({userId:i,initializeSlices:Object.freeze(r)})}var zi;(function(e){e[e.Readonly=0]="Readonly",e[e.Writable=1]="Writable"})(zi||(zi={}));var Nc=/*#__PURE__*/function(){function Nc(e,t){_classCallCheck(this,Nc);var i=t.format.anyObjectFormat;this.serialization=new bi({format:t.format,objectAdapter:new xs}),this.objectOperator=e,this.oneAnyObjectFormats=Object.freeze([i]),this.twoAnyObjectFormats=Object.freeze([i,i])}_createClass(Nc,[{key:"serialize",value:function serialize(e){var t=new Fe,i=ni(ar),r=new Up(i,this.objectOperator);t.writeUint8(e.kind);try{switch(e.kind){case zi.Writable:{var n=e.userPayload,s=e.connectedPayload;r.bind(n),r.bind(s),this.serialization.serialize({writer:t,values:[n,s],objectFormats:this.twoAnyObjectFormats,includesHash:!1});break}case zi.Readonly:{var _n9=e.payload;r.bind(_n9),this.serialization.serialize({writer:t,values:[_n9],objectFormats:this.oneAnyObjectFormats,includesHash:!1});break}}return t.toBuffer()}finally{r.complete()}}},{key:"deserialize",value:function deserialize(e){try{xs.startCollection();var t=new ye(e),i=t.readUint8();switch(i){case zi.Writable:{var _this$serialization$d11=this.serialization.deserialize({reader:t,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:!0,version:Nc.akkoSerVersion}),_this$serialization$d12=_slicedToArray(_this$serialization$d11,2),r=_this$serialization$d12[0],n=_this$serialization$d12[1];return{kind:i,userPayload:r,connectedPayload:n}}case zi.Readonly:{var _this$serialization$d13=this.serialization.deserialize({reader:t,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:!0,version:Nc.akkoSerVersion}),_this$serialization$d14=_slicedToArray(_this$serialization$d13,1),_r14=_this$serialization$d14[0];return{kind:i,payload:_r14}}default:throw new Error("invalid kind ".concat(i));}}finally{xs.completeCollection()}}}]);return Nc}(),Zo=Nc;Zo.akkoSerVersion=oi(Oe);var um=/*#__PURE__*/function(){function um(){_classCallCheck(this,um)}_createClass(um,[{key:"serialize",value:function serialize(e){var t=new Fe;return t.writeString(e.libIdentifier),t.writeString(e.appIdentifier),t.writeString(e.appVersion),t.writeString(e.appHash),t.toBuffer()}},{key:"deserialize",value:function deserialize(e){var t=new ye(e),i=t.readString(),r=t.readString(),n=t.readString(),s=t.readString();return{libIdentifier:i,appIdentifier:r,appVersion:n,appHash:s}}}]);return um}();function pm(e){var t=new ye(e),i=t.readString(),r=t.readString(),n=t.readString();return Object.freeze({session:i,sessionToken:r,slice:n})}function mm(e){return N1(e)}function fm(e){return L1(e)}function N1(e){var t=new Fe;return t.writeUint32(e.id),t.writeInt53(e.timestamp),t.toBuffer()}function L1(e){var t=new ye(e),i=t.readUint32(),r=t.readInt53();return Object.freeze({id:i,timestamp:r})}var gm=/*#__PURE__*/function(){function gm(e){_classCallCheck(this,gm);if(this.storageSlices=[],this.usingSlice=void 0,this.nextScopeId=0,e){var _iterator50=_createForOfIteratorHelper(e),_step50;try{for(_iterator50.s();!(_step50=_iterator50.n()).done;){var t=_step50.value;this.appendScopeSlice(t)}}catch(err){_iterator50.e(err)}finally{_iterator50.f()}}}_createClass(gm,[{key:"allocScopeId",value:function allocScopeId(){if(this.usingSlice){var e=this.nextScopeId;return e===this.usingSlice.beginScopeId+this.usingSlice.count-1?(this.usingSlice=this.storageSlices.shift(),this.usingSlice&&(this.nextScopeId=this.usingSlice.beginScopeId)):this.nextScopeId+=1,e}else return}},{key:"appendScopeSlice",value:function appendScopeSlice(e){this.usingSlice?this.storageSlices.push(e):(this.usingSlice=e,this.nextScopeId=e.beginScopeId)}}]);return gm}();function ym(e){var t=new ye(e),i=[],r=t.readUint32();for(var n=0;n<r;++n){var s=t.readInt53(),o=t.readUint32();i.push(Object.freeze({beginScopeId:s,count:o}))}return Object.freeze(i)}var Jo=new wc(["error","snapshot","action","chunk","session-build","update-online","allocate-user","release-user","allocate-scope","update-access","ban-access","hang-up","library-description","ping","pong"]),ut;(function(e){e[e.Undefined=0]="Undefined",e[e.NoUserToRelease=1]="NoUserToRelease",e[e.WritableAccessForbidden=2]="WritableAccessForbidden",e[e.StuffedOfWritableUsers=3]="StuffedOfWritableUsers",e[e.WrongWritablePhase=4]="WrongWritablePhase"})(ut||(ut={}));var bm=/*#__PURE__*/function(){function bm(e,t,i){_classCallCheck(this,bm);this.nextFrameId=0,this.userId=e,this.scopeStorage=t,this.nextFrameId=i}_createClass(bm,[{key:"createFrameId",value:function createFrameId(){var e=this.nextFrameId;return this.nextFrameId+=1,e}},{key:"appendScopeSlices",value:function appendScopeSlices(e){var _iterator51=_createForOfIteratorHelper(e),_step51;try{for(_iterator51.s();!(_step51=_iterator51.n()).done;){var t=_step51.value;this.scopeStorage.appendScopeSlice(t)}}catch(err){_iterator51.e(err)}finally{_iterator51.f()}}},{key:"allocateIdentifierGenerator",value:function allocateIdentifierGenerator(){var e=this.scopeStorage.allocScopeId();if(e===void 0)throw new yi("run out of scope ID");return ni(e)}}]);return bm}(),vm=/*#__PURE__*/function(){function vm(e,t){_classCallCheck(this,vm);if(this.users={},this._usersCount=0,this.paddingImageCreatingTask=null,this.proxyRuntime=e,t){var _iterator52=_createForOfIteratorHelper(t),_step52;try{for(_iterator52.s();!(_step52=_iterator52.n()).done;){var i=_step52.value;this.users[i.userId]={userId:i.userId,nextFrameId:i.nextFrameId,session:i.session,payload:i.payload},this._usersCount+=1}}catch(err){_iterator52.e(err)}finally{_iterator52.f()}}else this.users[re]={userId:re,nextFrameId:0,session:"",payload:void 0},this._usersCount+=1}_createClass(vm,[{key:"hasUser",value:function hasUser(e){return e in this.users}},{key:"userIds",get:function get(){var e=[];for(var t in this.users){e.push(parseInt(t,10))}return e.sort()}},{key:"usersCount",get:function get(){return this._usersCount}},{key:"user",value:function user(e,t){var i=this.users[e];if(i){var r=i.payload;return t||(r=this.proxyRuntime.objectOperator.wrapDisplayer(this.proxyRuntime,r)),{userId:e,session:i.session,payload:r}}else return}},{key:"snapshotUsers",value:function snapshotUsers(){var e=[];var _iterator53=_createForOfIteratorHelper(this.userIds),_step53;try{for(_iterator53.s();!(_step53=_iterator53.n()).done;){var t=_step53.value;var i=this.users[t];e.push({userId:t,nextFrameId:i.nextFrameId,session:i.session,payload:i.payload})}}catch(err){_iterator53.e(err)}finally{_iterator53.f()}return e}},{key:"createImageAuthor",value:function createImageAuthor(e,t){var _this25=this;var i=e.userId,r=this.users[i];if(r){var n=new gm(e.initializeSlices),s=new bm(e.userId,n,r.nextFrameId);try{t(s)}catch(o){console.error(o)}return Promise.resolve()}else return new Promise(function(n){_this25.paddingImageCreatingTask={allocatedUser:e,complete:function complete(s){n(),s&&t(s)}}})}},{key:"cancelImageAuthorCreating",value:function cancelImageAuthorCreating(){this.paddingImageCreatingTask&&(this.paddingImageCreatingTask.complete(null),this.paddingImageCreatingTask=null)}},{key:"updateUserNextFrameId",value:function updateUserNextFrameId(e,t){var i=this.users[e];i&&(i.nextFrameId=t)}},{key:"userEnter",value:function userEnter(e,t,i,r){var _this26=this;e in this.users||(this._usersCount+=1),this.users[e]={userId:e,nextFrameId:t,session:i,payload:r},this.proxyRuntime.observeUpdate(function(){if(_this26.paddingImageCreatingTask){var _this26$paddingImageC=_this26.paddingImageCreatingTask.allocatedUser,n=_this26$paddingImageC.userId,s=_this26$paddingImageC.initializeSlices;if(n===e){var o=new gm(s),a=new bm(e,o,t);_this26.paddingImageCreatingTask.complete(a),_this26.paddingImageCreatingTask=null}}_this26.proxyRuntime.reportUsersChanged(_this26._usersCount)})}},{key:"userLeave",value:function userLeave(e){e in this.users&&(this._usersCount-=1,delete this.users[e]),this.proxyRuntime.reportUsersChanged(this._usersCount)}}]);return vm}(),Lc=/*#__PURE__*/function(){function Lc(e){_classCallCheck(this,Lc);this.didCompleteInit=!1,this.proxyRuntime=e.proxyRuntime,this.imageUsers=e.imageUsers,this.onEventFire=e.onEventFire,this.onEventFireACK=e.onEventFireACK,this.onCatchErrorWhenAppendFrame=e.onCatchErrorWhenAppendFrame;var t=Bi(e.library.rootClass),i=[],r={},n={};for(var s in t.methods){var o=t.methods[s],a=Lc.findEventPayloadWithDecorators(o.decorators);a&&i.push(Object.freeze({filter:a.eventFilter,method:s})),n[s]=Lc.findNoEffectsWithDecorators(o.decorators)}for(var _s8=0;_s8<t.methodNames.length;++_s8){r[t.methodNames[_s8]]=_s8}this.methodNames=t.methodNames,this.methodNameToIdMap=Object.freeze(r),this.eventHandlers=Object.freeze(i),this.noEffectsMethods=Object.freeze(n)}_createClass(Lc,[{key:"completeInit",value:function completeInit(){this.didCompleteInit=!0}},{key:"methodNameToId",value:function methodNameToId(e){return this.methodNameToIdMap[e]}},{key:"isNoEffectMethod",value:function isNoEffectMethod(e){return this.noEffectsMethods[e]}},{key:"dispatch",value:function dispatch(e,t){var i=this.proxyRuntime.rootObject.target,r=Be.Custom;var _iterator54=_createForOfIteratorHelper(this.eventHandlers),_step54;try{for(_iterator54.s();!(_step54=_iterator54.n()).done;){var _step54$value=_step54.value,n=_step54$value.filter,s=_step54$value.method;n(e,t,r)&&this.proxyRuntime.rootObject.getRootMethod(s).apply(i,[e,t,r])}}catch(err){_iterator54.e(err)}finally{_iterator54.f()}}},{key:"invoke",value:function invoke(e,t){var i=this.proxyRuntime.rootObject.target;return this.proxyRuntime.rootObject.getRootMethod(e).apply(i,t)}},{key:"appendAction",value:function appendAction(e,t){var _this27=this;(t.mode===ne.Real||t.mode===ne.RealAck)&&this.imageUsers.updateUserNextFrameId(e.authorId,e.originalFrameId+1);var i=!this.isForcesOnIllusionLine(t.mode);try{var r;return this.proxyRuntime.block.runWithMagix(t,function(){kc(e)?r=_this27.invokeActionFrame(e):Uo(e)?_this27.handleEventActionFrame(e):Vo(e)?_this27.handleEnterActionFrame(e):Wo(e)&&_this27.handleLeaveActionFrame(e)}),r}catch(r){this.onCatchErrorWhenAppendFrame&&this.onCatchErrorWhenAppendFrame(e.authorId,r);return}finally{i&&(this.frameId=e.frameId,this.timestamp=e.timestamp)}}},{key:"callbackEventIfNeed",value:function callbackEventIfNeed(e){if(this.didCompleteInit)if(Uo(e)){var t=this.proxyRuntime.rootObject.observerId;e.authorId===t?this.onEventFireACK({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId}):this.onEventFire({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId})}else Vo(e)?this.onEventFire({event:"Enter",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.connectedPayload),scope:Be.System,authorId:e.authorId}):Wo(e)&&this.onEventFire({event:"Leave",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:Be.System,authorId:e.authorId})}},{key:"invokeActionFrame",value:function invokeActionFrame(_ref14){var e=_ref14.methodId,t=_ref14.parameters;var i=this.proxyRuntime.rootObject.target,r=this.methodNames[e];return this.proxyRuntime.rootObject.getRootMethod(r).apply(i,t)}},{key:"handleEventActionFrame",value:function handleEventActionFrame(e){if(e.beginGenerationId!==void 0&&e.scope===Be.System)switch(e.event){case"Enter":{var t=e.authorId,i=e.originalFrameId+1,r="",n;this.imageUsers.userEnter(t,i,r,n);break}case"Leave":{this.imageUsers.userLeave(e.authorId);break}}this.invokeEventCallbacks(e.event,e.payload,e.scope)}},{key:"handleEnterActionFrame",value:function handleEnterActionFrame(e){var t=e.authorId,i=e.originalFrameId+1,r=e.session,n=e.userPayload;this.imageUsers.userEnter(t,i,r,n),this.invokeEventCallbacks("Enter",e.connectedPayload,Be.System)}},{key:"handleLeaveActionFrame",value:function handleLeaveActionFrame(_ref15){var e=_ref15.authorId,t=_ref15.payload;this.imageUsers.userLeave(e),this.invokeEventCallbacks("Leave",t,Be.System)}},{key:"invokeEventCallbacks",value:function invokeEventCallbacks(e,t,i){var r=this.proxyRuntime.rootObject.target;var _iterator55=_createForOfIteratorHelper(this.eventHandlers),_step55;try{for(_iterator55.s();!(_step55=_iterator55.n()).done;){var _step55$value=_step55.value,n=_step55$value.filter,s=_step55$value.method;n(e,t,i)&&this.proxyRuntime.rootObject.getRootMethod(s).apply(r,[e,t,i])}}catch(err){_iterator55.e(err)}finally{_iterator55.f()}}},{key:"isForcesOnIllusionLine",value:function isForcesOnIllusionLine(e){switch(e){case ne.Real:case ne.RealAck:return!1;case ne.Illusion:case ne.IllusionRebuild:return!0;case ne.Outside:return this.proxyRuntime.hasDoubleLines&&this.proxyRuntime.hasBranch;default:throw new Error("invalid mode ".concat(e));}}}],[{key:"findEventPayloadWithDecorators",value:function findEventPayloadWithDecorators(e){var _iterator56=_createForOfIteratorHelper(e),_step56;try{for(_iterator56.s();!(_step56=_iterator56.n()).done;){var t=_step56.value;if(Tc(t)&&Ac(t.payload))return t.payload}}catch(err){_iterator56.e(err)}finally{_iterator56.f()}}},{key:"findNoEffectsWithDecorators",value:function findNoEffectsWithDecorators(e){var _iterator57=_createForOfIteratorHelper(e),_step57;try{for(_iterator57.s();!(_step57=_iterator57.n()).done;){var t=_step57.value;if(t===_r)return!0}}catch(err){_iterator57.e(err)}finally{_iterator57.f()}return!1}}]);return Lc}(),Dc=/*#__PURE__*/function(){function Dc(e,t,i){_classCallCheck(this,Dc);this.observerId=e,this.logger=t,this.onLengthChanged=i,this.queue=[]}_createClass(Dc,[{key:"length",get:function get(){return this.queue.length}},{key:"pushIllusionActionFrameGetter",value:function pushIllusionActionFrameGetter(e){this.queue.push(e),this.onLengthChanged(this.queue.length)}},{key:"forFrames",value:function forFrames(e){var _iterator58=_createForOfIteratorHelper(this.queue),_step58;try{for(_iterator58.s();!(_step58=_iterator58.n()).done;){var t=_step58.value;e(t)}}catch(err){_iterator58.e(err)}finally{_iterator58.f()}}},{key:"replaceActionFrame",value:function replaceActionFrame(e){var t=this.isAckFrame(e),i,r,n;if(t){var s=this.takeIllusionFrame(e.frameId,e.originalFrameId),o=new zt(s.get());i=Date.now()-s.timestamp,o.frameId=e.frameId,o.originalFrameId=e.originalFrameId,o.timestamp=e.timestamp,r=o.frameBuffer,n=s.section}else{if(e.type===be.Ack)throw new Error("received others' ACK frame");r=e.frameBuffer}return{replacedBuffer:r,isAck:t,rttTimeInterval:i,section:n}}},{key:"takeIllusionFrame",value:function takeIllusionFrame(e,t){var i=this.queue.findIndex(function(n){return n.frameId===t});if(i>0&&this.logger.warn("received frame can't touch first illusion frame"),i===-1)throw new Error("not found frameId ".concat(t," match to ACK frameId"));var r=this.queue.splice(i,1)[0];return this.onLengthChanged(this.queue.length),r}},{key:"isAckFrame",value:function isAckFrame(e){switch(e.type){case be.Ack:case be.Invoker:return e.authorId===this.observerId;case be.Event:{if(e.scope===Be.Custom)return e.authorId===this.observerId;break}default:break;}return!1}}]);return Dc}();function Rn(e){return e.beginGenerationId===void 0?ni(e.scopeId,e.beginObjectId):gp(e.authorId,e.beginGenerationId)}var D1=/*#__PURE__*/function(){function D1(e,t,i,r,n,s,o){_classCallCheck(this,D1);this.logger=e,this.strategy=t,this.proxyRuntime=i,this.triggerInvoker=r,this.assertAppendFrameId=n,this.onReceivedRttReport=s,this.onIllusionQueueLengthChanged=o,this.observerId=null,this._illusionQueue=null}_createClass(D1,[{key:"illusionQueue",get:function get(){return this._illusionQueue}},{key:"waitUtilIllusionQueueEmpty",value:function waitUtilIllusionQueueEmpty(){var _this28=this;return this._illusionQueue.length===0?Promise.resolve():new Promise(function(e){_this28.onIllusionQueueEmpty=e})}},{key:"setObserverId",value:function setObserverId(e){if(this._illusionQueue)throw new Error("did set observer ID");this.observerId=e,this._illusionQueue=new Dc(e,this.logger,this.onIllusionQueueLengthChanged)}},{key:"cleanObserverId",value:function cleanObserverId(){var e=this._illusionQueue;this.observerId=null,this._illusionQueue=null,this.onIllusionQueueLengthChanged(e.length)}},{key:"appendActionFramesWithDoubleMode",value:function appendActionFramesWithDoubleMode(e){var t;var _iterator59=_createForOfIteratorHelper(e),_step59;try{for(_iterator59.s();!(_step59=_iterator59.n()).done;){var i=_step59.value;var r=this.proxyRuntime.frameHandler.deserializeActionFrame(i,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking,{mode:ne.Real}),n=Rn(r);this.assertAppendFrameId(r),t=this.triggerInvoker.appendAction(r,{authorId:r.authorId,mode:ne.Real,timestamp:r.timestamp,identifierGenerator:n}),this.triggerInvoker.callbackEventIfNeed(r)}}catch(err){_iterator59.e(err)}finally{_iterator59.f()}return t}},{key:"appendActionFrames",value:function appendActionFrames(e){var _this29=this;var t=[],i=[],r=!1,n=!1;var _iterator60=_createForOfIteratorHelper(e),_step60;try{for(_iterator60.s();!(_step60=_iterator60.n()).done;){var _o10=_step60.value;var _a9=new zt(_o10),_c6=this._illusionQueue.replaceActionFrame(_a9);_c6.isAck||(r=!0),!n&&_a9.type===be.Leave&&_a9.authorId===this.observerId&&(n=!0);var _h6={frameBuffer:_c6.replacedBuffer,frameSection:_c6.section};r?i.push(_h6):t.push(_h6),_c6.rttTimeInterval!==void 0&&this.onReceivedRttReport(_c6.rttTimeInterval)}}catch(err){_iterator60.e(err)}finally{_iterator60.f()}this.proxyRuntime.block.runWithDisableObserve(function(){var _iterator61=_createForOfIteratorHelper(t),_step61;try{for(_iterator61.s();!(_step61=_iterator61.n()).done;){var _step61$value=_step61.value,o=_step61$value.frameBuffer,a=_step61$value.frameSection;var c=_this29.proxyRuntime.frameHandler.deserializeActionFrame(o,_this29.strategy.deserializerVersion,_this29.strategy.ignoreHashChecking,{mode:ne.RealAck,frameSection:a}),h=Rn(c);_this29.assertAppendFrameId(c),_this29.triggerInvoker.appendAction(c,{authorId:c.authorId,mode:ne.RealAck,timestamp:c.timestamp,frameSection:a,identifierGenerator:h}),_this29.triggerInvoker.callbackEventIfNeed(c),a.completeACK()}}catch(err){_iterator61.e(err)}finally{_iterator61.f()}});var s;if(i.length>0){this.proxyRuntime.mergeBranch();var _iterator62=_createForOfIteratorHelper(i),_step62;try{for(_iterator62.s();!(_step62=_iterator62.n()).done;){var _step62$value=_step62.value,o=_step62$value.frameBuffer,a=_step62$value.frameSection;var c=this.proxyRuntime.frameHandler.deserializeActionFrame(o,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking,{mode:ne.Real,frameSection:a}),h=Rn(c);this.assertAppendFrameId(c),s=this.triggerInvoker.appendAction(c,{authorId:c.authorId,mode:ne.Real,timestamp:c.timestamp,frameSection:a,identifierGenerator:h}),this.triggerInvoker.callbackEventIfNeed(c)}}catch(err){_iterator62.e(err)}finally{_iterator62.f()}this._illusionQueue.length>0&&(n?this._illusionQueue=new Dc(this.observerId,this.logger,this.onIllusionQueueLengthChanged):this.rebuildIllusionBranch())}return this.proxyRuntime.hasBranch&&this.proxyRuntime.hasDoubleLines&&this._illusionQueue.length===0&&this.proxyRuntime.mergeBranch(),this.onIllusionQueueEmpty&&this._illusionQueue.length===0&&(this.onIllusionQueueEmpty(),this.onIllusionQueueEmpty=void 0),s}},{key:"rebuildIllusionBranch",value:function rebuildIllusionBranch(){var _this30=this;this.proxyRuntime.forkBranchRuntime();var e=this._illusionQueue;this._illusionQueue=new Dc(this.observerId,this.logger,this.onIllusionQueueLengthChanged),e.forFrames(function(t){var i=new zt(t.get()),r=_this30.proxyRuntime.createFrameSection(t.section),n={frameId:t.frameId,timestamp:t.timestamp,section:r,get:function get(){return i.frameBuffer}};_this30._illusionQueue.pushIllusionActionFrameGetter(n);var s=_this30.proxyRuntime.frameHandler.deserializeActionFrame(i.frameBuffer,_this30.strategy.deserializerVersion,_this30.strategy.ignoreHashChecking,{mode:ne.IllusionRebuild,frameSection:r}),o=Rn(s);_this30.triggerInvoker.appendAction(s,{authorId:s.authorId,mode:ne.IllusionRebuild,timestamp:s.timestamp,frameSection:r,identifierGenerator:o}),r.completeRebuild()}),e.length>0&&this.onIllusionQueueLengthChanged(this._illusionQueue.length)}}]);return D1}(),F1=/*#__PURE__*/function(){function F1(e,t){_classCallCheck(this,F1);this.objectOperator=t,this.rootClassReflection=Bi(e.rootClass);var i=new bi({format:e.format,objectAdapter:new xs});this.flatFrameSerialization=Mc(i,this.rootClassReflection)}_createClass(F1,[{key:"serialize",value:function serialize(e,t,i){var r=new Up(e,this.objectOperator);try{this.replaceWithBindsActionFrame(r,t);var n=ai(Qt({},t),{beginObjectId:e.createdCount});return this.flatFrameSerialization.serializeActionFrame(n,i)}finally{r.complete()}}},{key:"replaceWithBindsActionFrame",value:function replaceWithBindsActionFrame(e,t){if(Uo(t))e.bind(t.payload);else if(kc(t)){var _iterator63=_createForOfIteratorHelper(t.parameters),_step63;try{for(_iterator63.s();!(_step63=_iterator63.n()).done;){var i=_step63.value;e.bind(i)}}catch(err){_iterator63.e(err)}finally{_iterator63.f()}}else Vo(t)?(e.bind(t.userPayload),e.bind(t.connectedPayload)):Wo(t)&&e.bind(t.payload)}}]);return F1}(),B1=/*#__PURE__*/function(){function B1(e){_classCallCheck(this,B1);this.author=e.author,this.objectOperator=e.objectOperator,this.rootClassReflection=e.rootClassReflection,this.objectAdapter=e.objectAdapter,this.flatFrameSerialization=e.flatFrameSerialization,this.includesFrameHash=e.includesFrameHash}_createClass(B1,[{key:"appendScopeSlices",value:function appendScopeSlices(e){this.author.appendScopeSlices(e)}},{key:"handleInvokerArgs",value:function handleInvokerArgs(e,t,i){var r=this.objectOperator,n=this.objectAdapter,s=this.rootClassReflection,o=new Vp(i,r,n);try{var a=s.methods[e].parameterFormatObjects,c=[],h=[];for(var d=0;d<t.length;++d){var _o$bind=o.bind(t[d],a[d]),u=_o$bind.value,p=_o$bind.binder;p?(c[d]=p.copied,h[d]=p.wrapped):(c[d]=u,h[d]=u)}return{copied:c,wrapped:h}}finally{o.completeBinding()}}},{key:"handlePayload",value:function handlePayload(e,t){var i=this.objectOperator,r=this.objectAdapter,n=this.flatFrameSerialization.serialization.format.anyObjectFormat,s=new Vp(t,i,r);try{var _s$bind=s.bind(e,n),o=_s$bind.value,a=_s$bind.binder,c=o,h=o;return a&&(c=a.copied,h=a.wrapped),{copied:c,wrapped:h}}finally{s.completeBinding()}}},{key:"serializeEventFrameGetter",value:function serializeEventFrameGetter(e,t,i,r){var _this31=this;var n=this.author.createFrameId(),s={frameId:n,originalFrameId:n,timestamp:i,authorId:this.author.userId,type:be.Event,scopeId:r.scopeId,beginObjectId:r.createdCount,event:e,payload:t,scope:Be.Custom};return{frameId:n,getter:function getter(){return _this31.flatFrameSerialization.serializeActionFrame(s,_this31.includesFrameHash)}}}},{key:"serializeInvokerFrameGetter",value:function serializeInvokerFrameGetter(e,t,i,r){var _this32=this;var n=this.author.createFrameId(),s={frameId:n,originalFrameId:n,timestamp:i,authorId:this.author.userId,type:be.Invoker,scopeId:r.scopeId,beginObjectId:r.createdCount,methodId:e,parameters:t};return{frameId:n,getter:function getter(){return _this32.flatFrameSerialization.serializeActionFrame(s,_this32.includesFrameHash)}}}}]);return B1}(),Sm=/*#__PURE__*/function(){function Sm(e,t){_classCallCheck(this,Sm);this.onGeneratedFrameBuffer=e,this.onGenreateFrameFailed=t,this.pendding={},this._count=0}_createClass(Sm,[{key:"count",get:function get(){return this._count}},{key:"createEventFrameGetter",value:function createEventFrameGetter(e,t,i,r,n,s){var _this33=this;var _r$serializeEventFram=r.serializeEventFrameGetter(e,t,i,s),o=_r$serializeEventFram.frameId,a=_r$serializeEventFram.getter,c=new Bc(o,i,n,function(){try{var h=new zt(a());return _this33.fireGenerate(c,h),h.frameBuffer}catch(h){throw _this33.onGenreateFrameFailed(h),h}});return this.fireCreate(c),c}},{key:"createInvokerFrameGetter",value:function createInvokerFrameGetter(e,t,i,r,n,s){var _this34=this;var _r$serializeInvokerFr=r.serializeInvokerFrameGetter(e,t,i,s),o=_r$serializeInvokerFr.frameId,a=_r$serializeInvokerFr.getter,c=new Bc(o,i,n,function(){try{var h=new zt(a());return _this34.fireGenerate(c,h),h.frameBuffer}catch(h){throw _this34.onGenreateFrameFailed(h),h}});return this.fireCreate(c),c}},{key:"fireCreate",value:function fireCreate(e){this.pendding[e.id]||(this.pendding[e.id]=e,this._count+=1)}},{key:"fireGenerate",value:function fireGenerate(e,t){e.id in this.pendding&&(delete this.pendding[e.id],this._count-=1),this.onGeneratedFrameBuffer(t.frameBuffer)}}]);return Sm}();Sm.callGetMaxDuration=1200;var Fc=/*#__PURE__*/function(){function Fc(e,t,i,r){_classCallCheck(this,Fc);this.frameId=e,this.timestamp=t,this.section=i,this.getter=r,this.buffer=null,this.id="".concat(Fc.nextId),Fc.nextId+=1}_createClass(Fc,[{key:"get",value:function get(){return this.buffer||(this.buffer=this.getter()),this.buffer}}]);return Fc}(),Bc=Fc;Bc.nextId=0;var j1=700,wm=/*#__PURE__*/function(){function wm(e){var _this35=this;_classCallCheck(this,wm);if(this.modifiable=!0,this.generator=null,this.didDestroy=!1,this.assertAppendFrameId=function(t){var i=t.frameId,r=_this35.triggerInvoker.frameId+1;if(r!==i)throw new Error("find unexpected frame id ".concat(i,", wanna ").concat(r))},this.invokeMethod=function(t,i){_this35.assertEnableSendActionFrames();var r,n=Date.now(),s=_this35.generator;if(!s)throw new Error("cannot invoke ".concat(t,", frameGenerator is not prepare"));var o=s.author.allocateIdentifierGenerator(),a=_this35.proxyRuntime.block.runWithContinuousUpdated(function(){var c=_this35.proxyRuntime.createFrameSection(),h={authorId:s.author.userId,mode:ne.Illusion,frameSection:c,timestamp:n,identifierGenerator:o};r=_this35.proxyRuntime.block.runWithMagix(h,function(){var d=_this35.triggerInvoker.methodNameToId(t),u=s.handleInvokerArgs(t,i,o),p=o.clone();try{return _this35.triggerInvoker.invoke(t,u.wrapped)}finally{var f=_this35.pending.createInvokerFrameGetter(d,u.copied,n,s,c,p);_this35.branchImageHelper.illusionQueue.pushIllusionActionFrameGetter(f),_this35.callbacks.onGeneratedActionFrame?(_this35.phaseNode.touch(),_this35.callbacks.onGeneratedActionFrame(f)):f.get()}})});return _this35.callbacks.onModified&&a.didUpdated&&_this35.callbacks.onModified(),r},this.currentPhase=function(){var t=_this35.branchImageHelper.illusionQueue;return t&&t.length===0&&_this35.pending.count===0?$r.Real:$r.Illusion},this.clientCrashWithError=function(t){_this35.callbacks.onClientCrashWithError&&Promise.resolve().then(function(){return _this35.callbacks.onClientCrashWithError(t)})["catch"](function(i){return console.error(i)})},this.library=e.library,this.logger=e.logger,this.proxyRuntime=e.proxyRuntime,this.serializer=new F1(e.library,e.proxyRuntime.objectOperator),this.imageUsers=e.imageUsers,this.strategy=e.strategy,this.callbacks=Ms(e.callbacks||{}),this.eventFireNode=new T1(e.logger,{fire:this.callbacks.onEventFire,ack:this.callbacks.onEventFireACK}),this.eventFireNode.isPadding=!0,this.triggerInvoker=new Lc({library:this.library,imageUsers:this.imageUsers,proxyRuntime:e.proxyRuntime,onEventFire:function onEventFire(t){return _this35.eventFireNode.callback("fire",t)},onEventFireACK:function onEventFireACK(t){return _this35.eventFireNode.callback("ack",t)},onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}),this.triggerInvoker.frameId=e.frameId,this.triggerInvoker.timestamp=e.timestamp,this.proxyRuntime.rootObject.onInvokedTriggerMethod=this.invokeMethod,e.actionFrames){var _iterator64=_createForOfIteratorHelper(e.actionFrames),_step64;try{for(_iterator64.s();!(_step64=_iterator64.n()).done;){var t=_step64.value;var i=this.proxyRuntime.frameHandler.deserializeActionFrame(t,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking),r=Rn(i);this.triggerInvoker.appendAction(i,{authorId:i.authorId,timestamp:i.timestamp,mode:ne.Real,identifierGenerator:r})}}catch(err){_iterator64.e(err)}finally{_iterator64.f()}}this.phaseNode=new On({phase:$r.Real,getCurrentPhase:this.currentPhase,onPhaseChanged:this.callbacks.onPhaseChanged}),this.branchImageHelper=new D1(this.logger,this.strategy,this.proxyRuntime,this.triggerInvoker,this.assertAppendFrameId,this.callbacks.onReceivedRttReport||function(){},this.callbacks.onIllusionQueueLengthChanged||function(){}),this.pending=new Sm(function(){return _this35.phaseNode.touch()},this.clientCrashWithError),this.triggerInvoker.completeInit(),this.eventFireNode.hasKey("fire")&&Promise.resolve().then(function(){return _this35.eventFireNode.isPadding=!1})["catch"](function(t){return console.error(t)})}_createClass(wm,[{key:"hasDoubleLines",get:function get(){return this.proxyRuntime.hasDoubleLines}},{key:"trigger",get:function get(){return this.proxyRuntime.rootObject.displayer}},{key:"phase",get:function get(){return this.phaseNode.phase}},{key:"userIds",get:function get(){return this.imageUsers.userIds}},{key:"usersCount",get:function get(){return this.imageUsers.usersCount}},{key:"pendingReportChanged",get:function get(){return this.proxyRuntime.pendingReportChanged},set:function set(e){this.proxyRuntime.pendingReportChanged=e}},{key:"hasUser",value:function hasUser(e){return this.imageUsers.hasUser(e)}},{key:"user",value:function user(e){return this.imageUsers.user(e,!1)}},{key:"verifiedFrameId",get:function get(){return this.triggerInvoker.frameId}},{key:"frameId",get:function get(){var e=this.triggerInvoker.frameId,t=this.branchImageHelper.illusionQueue;return t&&(e+=t.length),e},set:function set(e){var t=this.branchImageHelper.illusionQueue,i=e;t&&(i-=t.length),this.triggerInvoker.frameId=i}},{key:"timestamp",get:function get(){return this.triggerInvoker.timestamp}},{key:"appendActionFrames",value:function appendActionFrames(e){this.appendActionFramesToRuntime(e)}},{key:"appendActionFramesToRuntime",value:function appendActionFramesToRuntime(e){var _this36=this;var t,i;this.eventFireNode.isPadding=!0;try{t=this.proxyRuntime.block.runWithContinuousUpdated(function(){_this36.proxyRuntime.hasDoubleLines?_this36.proxyRuntime.hasBranch?i=_this36.branchImageHelper.appendActionFrames(e):i=_this36.branchImageHelper.appendActionFramesWithDoubleMode(e):i=_this36.appendActionFramesWithSingleMode(e)}),this.phaseNode.touch()}finally{this.eventFireNode.isPadding=!1}return this.callbacks.onModified&&t.didUpdated&&this.callbacks.onModified(),i}},{key:"appendScopeSlices",value:function appendScopeSlices(e){this.generator&&this.generator.appendScopeSlices(e)}},{key:"appendActionFramesWithSingleMode",value:function appendActionFramesWithSingleMode(e){var t;var _iterator65=_createForOfIteratorHelper(e),_step65;try{for(_iterator65.s();!(_step65=_iterator65.n()).done;){var i=_step65.value;var r=this.proxyRuntime.frameHandler.deserializeActionFrame(i,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking),n=Rn(r);this.assertAppendFrameId(r),t=this.triggerInvoker.appendAction(r,{authorId:r.authorId,mode:ne.Real,timestamp:r.timestamp,identifierGenerator:n}),this.triggerInvoker.callbackEventIfNeed(r)}}catch(err){_iterator65.e(err)}finally{_iterator65.f()}return t}},{key:"dispatch",value:function dispatch(e,t){var _this37=this;this.assertEnableSendActionFrames();var i=Date.now(),r=this.generator;if(!r)throw new Error("cannot dispatch event ".concat(e,", generator is not prepare"));var n=r.author.allocateIdentifierGenerator(),s=this.proxyRuntime.block.runWithContinuousUpdated(function(){var o=_this37.proxyRuntime.createFrameSection(),a={authorId:r.author.userId,mode:ne.Illusion,timestamp:i,frameSection:o,identifierGenerator:n};_this37.proxyRuntime.block.runWithMagix(a,function(){var c=r.handlePayload(t,n),h=n.clone();try{return _this37.triggerInvoker.dispatch(e,c.wrapped)}finally{var d=_this37.pending.createEventFrameGetter(e,c.copied,i,r,o,h);_this37.branchImageHelper.illusionQueue.pushIllusionActionFrameGetter(d),_this37.callbacks.onGeneratedActionFrame?(_this37.phaseNode.touch(),_this37.callbacks.onGeneratedActionFrame(d)):d.get()}})});this.eventFireNode.callback("fire",{event:e,payload:t,scope:Be.Custom,authorId:r.author.userId}),this.callbacks.onModified&&s.didUpdated&&this.callbacks.onModified()}},{key:"snapshot",value:function snapshot(){var _this38=this;var e=this.generator?this.generator.author.userId:re,t={frameId:this.frameId,originalFrameId:this.frameId,timestamp:this.timestamp,authorId:e,rootObject:this.proxyRuntime.rootObject.snapshotRootObject(),users:this.imageUsers.snapshotUsers()},i={authorId:e,mode:ne.Outside,timestamp:t.timestamp,identifierGenerator:ni(ar)};return this.proxyRuntime.block.runWithMagix(i,function(){return _this38.proxyRuntime.frameHandler.serializeSnapshotFrame(t)})}},{key:"setAllocatedUser",value:function setAllocatedUser(e){var _this39=this;return this.imageUsers.createImageAuthor(e,function(t){var _this39$serializer=_this39.serializer,i=_this39$serializer.objectOperator,r=_this39$serializer.rootClassReflection,n=_this39$serializer.flatFrameSerialization,s=_this39.proxyRuntime.frameHandler.objectAdapter,o=_this39.strategy.includesFrameHash;_this39.generator=new B1({author:t,objectOperator:i,rootClassReflection:r,flatFrameSerialization:n,objectAdapter:s,includesFrameHash:o}),_this39.proxyRuntime.reportObserverIdChanged(e.userId),_this39.branchImageHelper.setObserverId(t.userId)})}},{key:"removeAllocatedUser",value:function(){var _removeAllocatedUser=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.imageUsers.cancelImageAuthorCreating();this.generator=null;this.proxyRuntime.reportObserverIdChanged(re);_context4.next=5;return this.branchImageHelper.waitUtilIllusionQueueEmpty();case 5:this.branchImageHelper.cleanObserverId();case 6:case"end":return _context4.stop();}}},_callee4,this)}));function removeAllocatedUser(){return _removeAllocatedUser.apply(this,arguments)}return removeAllocatedUser}()},{key:"destroy",value:function destroy(){this.didDestroy||(this.imageUsers.cancelImageAuthorCreating(),this.generator=null,this.didDestroy=!0,this.proxyRuntime.dispose(),this.phaseNode.touch())}},{key:"createInvokerFrameBuffer",value:function createInvokerFrameBuffer(e){var t=this.triggerInvoker.methodNameToId(e.method);if(t===void 0)throw new Error("can't find method ".concat(JSON.stringify(e.method)));if(this.triggerInvoker.isNoEffectMethod(e.method))throw new Error("can't create frame for no effects method ".concat(JSON.stringify(e.method)));var i=ai(Qt({},this.createFrameHeader(e)),{type:be.Invoker,scopeId:e.identifierGenerator.scopeId,methodId:t,parameters:e.parameters});return this.serializeActionFrame(e.identifierGenerator,i)}},{key:"createEventFrameBuffer",value:function createEventFrameBuffer(e){var t=ai(Qt({},this.createFrameHeader(e)),{type:be.Event,scopeId:e.identifierGenerator.scopeId,scope:e.scope,event:e.event,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createEnterFrameBuffer",value:function createEnterFrameBuffer(e){var t=ai(Qt({},this.createFrameHeader(e)),{type:be.Enter,scopeId:e.identifierGenerator.scopeId,session:e.session,userPayload:e.userPayload,connectedPayload:e.connectedPayload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createLeaveFrameBuffer",value:function createLeaveFrameBuffer(e){var t=ai(Qt({},this.createFrameHeader(e)),{type:be.Leave,scopeId:e.identifierGenerator.scopeId,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createFrameHeader",value:function createFrameHeader(_ref16){var e=_ref16.frameId,t=_ref16.originalFrameId,i=_ref16.authorId;return{frameId:e,originalFrameId:t===void 0?e:t,timestamp:Date.now(),authorId:i,beginObjectId:0}}},{key:"serializeActionFrame",value:function serializeActionFrame(e,t){var _this40=this;var i={authorId:this.generator?this.generator.author.userId:re,mode:ne.Outside,timestamp:t.timestamp,identifierGenerator:e};return this.proxyRuntime.block.runWithMagix(i,function(){return _this40.serializer.serialize(e,t,_this40.strategy.includesFrameHash)})}},{key:"assertEnableSendActionFrames",value:function assertEnableSendActionFrames(){if(this.didDestroy)throw new Error("image was desctroy");var e=this.branchImageHelper.illusionQueue;if((e?e.length:0)>=j1)throw this.clientCrashWithError(new Error("illusion queue is overflow")),new Error("can't modify. illusion queue is overflow")}}]);return wm}(),$r;(function(e){e.Real="real",e.Illusion="illusion"})($r||($r={}));var ea=/*#__PURE__*/function(){function ea(e){_classCallCheck(this,ea);this.proxyManager=e}_createClass(ea,[{key:"createAccessUpdaterSerialization",value:function createAccessUpdaterSerialization(e){return new Zo(this.proxyManager.objectOperator,e)}},{key:"createWithParameters",value:function createWithParameters(e){var t=this.findOriginProxyRuntime(e),i=this.proxyManager.createProxyRuntime(e.library,t),r=new vm(i),n=Date.now();i.setupWithParameters(e.constructorScopeId,e.args,n,{logger:e.logger,observerId:e.observerId,imageUsers:r,pendingReportChanged:e.pendingReportChanged,snapshotManager:Bp(e.library,e.roomUUID),toolsExtra:e.toolsExtra});var s=new wm({frameId:0,timestamp:n,library:e.library,logger:e.logger,proxyRuntime:i,actionFrames:[],imageUsers:r,strategy:ea.wrapStrategy(e),callbacks:e.callbacks});return t?i.rootObject.initializeWithOriginRootObject(t.rootObject):i.rootObject.initialize(),s}},{key:"parseSnapshotFrame",value:function parseSnapshotFrame(e,t){var i=this.proxyManager.createProxyRuntime(e),r=si.V1,n=!1;return i.frameHandler.deserializeSnapshotFrame(t,r,n)}},{key:"createWithSnapshot",value:function createWithSnapshot(e){var t=this.findOriginProxyRuntime(e),i=this.proxyManager.createProxyRuntime(e.library,t),r=e.snapshotDeserializerVersion;r===void 0&&(r=oi(Oe));var n=i.frameHandler.deserializeSnapshotFrame(e.snapshotFrame,r,e.ignoreHashChecking),s=n.rootObject,o=new vm(i,n.users);i.setupWithRootObject(s,{logger:e.logger,observerId:e.observerId,imageUsers:o,pendingReportChanged:e.pendingReportChanged,snapshotManager:Bp(e.library,e.roomUUID),toolsExtra:e.toolsExtra});var a=new wm({frameId:n.frameId,timestamp:n.timestamp,library:e.library,logger:e.logger,actionFrames:e.actionFrames,proxyRuntime:i,imageUsers:o,strategy:ea.wrapStrategy(e),callbacks:e.callbacks});return t?i.rootObject.initializeWithOriginRootObject(t.rootObject):i.rootObject.initialize(),a}},{key:"findOriginProxyRuntime",value:function findOriginProxyRuntime(_ref17){var e=_ref17.originalImage;if(e)return e.proxyRuntime}}],[{key:"wrapStrategy",value:function wrapStrategy(e){var t=e.actionDeserializerVersion;return t===void 0&&(t=oi(Oe)),Object.freeze({roomUUID:e.roomUUID,ignoreHashChecking:e.ignoreHashChecking,includesFrameHash:e.includesFrameHash,deserializerVersion:t})}}]);return ea}(),km=Object.freeze(z1());function z1(){return[{methodName:"toString",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"toLocaleString",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"join",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"indexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"lastIndexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"every",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"some",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"forEach",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"reduce",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"reduceRight",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"concat",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"reverse",returnArray:!0,lengthChanged:!1,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"slice",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"splice",returnArray:!0,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e,t){var i,r=t[0];if(r>=0&&r<e.length)if(t.length>1){var n=t[1];n===void 0&&(n=0);var s=t.length-2;s<0&&(s=0),s===n?s>0&&(i={beginIndex:r,length:s}):i={beginIndex:r,length:e.length-r}}else i={beginIndex:r,length:e.length-r};return i}},{methodName:"map",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"filter",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"sort",returnArray:!0,lengthChanged:!1,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}},{methodName:"push",returnArray:!1,lengthChanged:!0,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:e.length-1,length:1}}},{methodName:"pop",returnArray:!1,lengthChanged:!0,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:e.length,length:1}}},{methodName:"shift",returnArray:!1,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length+1}}},{methodName:"unshift",returnArray:!1,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function pickTouchedSegment(e){return{beginIndex:0,length:e.length}}}]}var U1=/*#__PURE__*/function(){function U1(e){_classCallCheck(this,U1);this.nodes={};var t={};var _iterator66=_createForOfIteratorHelper(e),_step66;try{var _loop4=function _loop4(){var _step66$value=_step66.value,i=_step66$value.clazz,r=_step66$value.banList,n=_step66$value.proxyList;var s={},o=i.name;t[o]=Object.freeze({clazz:i,methods:s});var _iterator67=_createForOfIteratorHelper(r),_step67;try{var _loop5=function _loop5(){var a=_step67.value;s[a]=function(){throw new Error("".concat(o,".").concat(a," is ban in Magix"))}};for(_iterator67.s();!(_step67=_iterator67.n()).done;){_loop5()}}catch(err){_iterator67.e(err)}finally{_iterator67.f()}var _iterator68=_createForOfIteratorHelper(n),_step68;try{var _loop6=function _loop6(){var a=_step68.value;s[a]=function(){throw new Error("".concat(o,".").concat(a," is not defined"))}};for(_iterator68.s();!(_step68=_iterator68.n()).done;){_loop6()}}catch(err){_iterator68.e(err)}finally{_iterator68.f()}Object.seal(s)};for(_iterator66.s();!(_step66=_iterator66.n()).done;){_loop4()}}catch(err){_iterator66.e(err)}finally{_iterator66.f()}this.nodes=t}_createClass(U1,[{key:"findMethod",value:function findMethod(e,t){var i=this.findNode(e);if(i)return i.methods[t]}},{key:"proxyMethod",value:function proxyMethod(e,t,i){var r=this.findNode(e);if(!r)throw new Error("invalid class");if(!(t in r.methods))throw new Error("invalid method ".concat(JSON.stringify(t)));r.methods[t]=i}},{key:"findNode",value:function findNode(e){var t=e.name,i=this.nodes[t];if(i&&i.clazz===e)return i}}]);return U1}();function Cm(){return new U1([{clazz:Object,proxyList:["assign"],banList:["getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","create","defineProperty","defineProperties"]},{clazz:Array,proxyList:[],banList:["from"]},{clazz:String,proxyList:["fromCodePoint","fromCharCode"],banList:[]},{clazz:Number,proxyList:["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"],banList:[]}])}var V1=Object.defineProperty,xm=Object.getOwnPropertySymbols,W1=Object.prototype.hasOwnProperty,H1=Object.prototype.propertyIsEnumerable,Im=function Im(e,t,i){return t in e?V1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Ts=function Ts(e,t){for(var i in t||(t={})){W1.call(t,i)&&Im(e,i,t[i])}if(xm){var _iterator69=_createForOfIteratorHelper(xm(t)),_step69;try{for(_iterator69.s();!(_step69=_iterator69.n()).done;){var i=_step69.value;H1.call(t,i)&&Im(e,i,t[i])}}catch(err){_iterator69.e(err)}finally{_iterator69.f()}}return e},GM=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},_1=/*#__PURE__*/function(){function _1(e){_classCallCheck(this,_1);this.usersCache={},this.observerId=e.observerId,this.environment=e.environment,this.authorId=e.authorId,this.core=e.coreFunctions,this.roomObserver=e.roomObserver,this.imageUsers=e.imageUsers}_createClass(_1,[{key:"getAuthorId",value:function getAuthorId(){var e;return this.environment===Ct.NoEffects&&this.observerId===this.authorId&&((e=this.roomObserver)==null||e.reportObservedObserverId()),this.authorId}},{key:"hasUser",value:function hasUser(e){var t;return this.environment===Ct.NoEffects&&((t=this.roomObserver)==null||t.reportObservedUsers()),this.imageUsers.hasUser(e)}},{key:"getUsersCount",value:function getUsersCount(){var e;return this.environment===Ct.NoEffects&&((e=this.roomObserver)==null||e.reportObservedUsers()),this.imageUsers.usersCount}},{key:"getUser",value:function getUser(e){var t;var i;return this.imageUsers.hasUser(e)&&(i=this.usersCache[e],i||(i=this.usersCache[e]=this.core.creator(this.imageUsers.user(e,!0)))),this.environment===Ct.NoEffects&&((t=this.roomObserver)==null||t.reportObservedUsers()),i}},{key:"getUserIds",value:function getUserIds(){var e;return this.userIdsCache||(this.userIdsCache=this.core.creator(this.imageUsers.userIds)),this.environment===Ct.NoEffects&&((e=this.roomObserver)==null||e.reportObservedUsers()),this.userIdsCache}}]);return _1}(),jc=/*#__PURE__*/function(){function jc(e){_classCallCheck(this,jc);this._hasDoubleLines=!1,this._branchRuntime=null,this.logger=e.logger,this.observerId=e.observerId,this.proxyRuntime=e.proxyRuntime,this.imageUsers=e.imageUsers,this.toolsExtra=e.toolsExtra,this.snapshotManager=e.snapshotManager}_createClass(jc,[{key:"hasDoubleLines",get:function get(){return this._hasDoubleLines}},{key:"branchRuntime",get:function get(){return this._branchRuntime}},{key:"changeToDoubleLines",value:function changeToDoubleLines(){this._hasDoubleLines=!0}},{key:"forkBranchRuntime",value:function forkBranchRuntime(){return this._branchRuntime=ow(this.logger),this._branchRuntime}},{key:"releaseBranchRuntime",value:function releaseBranchRuntime(){this._branchRuntime&&(this._branchRuntime=null)}},{key:"getForwardMode",value:function getForwardMode(){return!this._hasDoubleLines||this._branchRuntime?kt.SingleForward:kt.DoubleForward}},{key:"runWithMagix",value:function runWithMagix(e,t){var i=e.authorId,r=this.getEnvironment(e.mode),n=this.getForwardMode(),s=jc.coreFunctionsSwitcher.switchCoreFunctions(e.mode),o=Object.freeze({idGenerator:e.identifierGenerator,environment:r,timestamp:e.timestamp,snapshot:this.snapshotManager,extra:this.toolsExtra,functions:new _1({observerId:this.observerId,environment:r,authorId:i,coreFunctions:s,roomObserver:this.proxyRuntime.roomObserver,imageUsers:this.imageUsers})}),a={mode:e.mode,coreFunctions:s,frameSection:e.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:n,tools:o};return Y.runWith(a,t)}},{key:"runWithSerialization",value:function runWithSerialization(e,t){var i=this.getForwardMode(),r=jc.coreFunctionsSwitcher.switchCoreFunctions(e.mode),n={mode:e.mode,coreFunctions:r,frameSection:e.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:i};return Y.runWith(n,t)}},{key:"isForcesOnIllusionLine",value:function isForcesOnIllusionLine(e){switch(e){case Ze.Real:case Ze.RealAck:return!1;case Ze.Illusion:case Ze.IllusionRebuild:return!0;case Ze.Outside:return this._hasDoubleLines&&!!this._branchRuntime;default:throw new Error("invalid mode ".concat(e));}}},{key:"getEnvironment",value:function getEnvironment(e){switch(e){case Ze.Illusion:case Ze.IllusionRebuild:return Ct.Illusion;case Ze.Real:case Ze.RealAck:return Ct.Real;case Ze.Outside:return Ct.NoEffects;default:throw new Error("invalid mode ".concat(e));}}}],[{key:"coreFunctionsSwitcher",get:function get(){return this._coreFunctionsSwitcher||(this._coreFunctionsSwitcher=new zn),this._coreFunctionsSwitcher}}]);return jc}();function Pm(e,t,i){return t.constructor===Object?Wn(e,i,t):Hn(e,i,t)}var ta="__identifier";function Mm(e,t){Object.defineProperty(e,ta,{enumerable:!1,configurable:!0,value:t})}var ia;Y.addListener(function(e,t){t?ia=e.coreFunctions.creator:ia=void 0});var $1=/*#__PURE__*/function(){function $1(e,t,i){_classCallCheck(this,$1);this.proxyRuntime=e,this.identifierGenerator=t,this.banFunction=i,this.proxyNodes={},this.modifyObjects=[]}_createClass($1,[{key:"complete",value:function complete(){var _iterator70=_createForOfIteratorHelper(this.modifyObjects),_step70;try{for(_iterator70.s();!(_step70=_iterator70.n()).done;){var e=_step70.value;delete e[ta]}}catch(err){_iterator70.e(err)}finally{_iterator70.f()}}},{key:"wrap",value:function wrap(e){if(this.banFunction&&typeof e=="function")throw new Error("can't wrap function");if(_typeof(e)!="object"||e===null||ge(e))return e;if(Je(e))throw new Error("can't let displayer node pass Magix border");if(e.constructor===Array)return this.wrapArray(e);if(e.constructor===Object)return this.wrapObject(e);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"wrapArray",value:function wrapArray(e){var t=e[ta],i;if(t===void 0){t=this.identifierGenerator.generate(),Mm(e,t),i=this.createProxyNode([],t);var r=i.target();for(var n=0;n<e.length;++n){r[n]=this.wrap(e[n])}this.proxyNodes[t]=i,this.modifyObjects.push(e)}else i=this.proxyNodes[t];return i}},{key:"wrapObject",value:function wrapObject(e){var t=e[ta],i;if(t===void 0){t=this.identifierGenerator.generate(),Mm(e,t),i=this.createProxyNode({},t);var r=i.target(),n=Object.keys(e).sort();var _iterator71=_createForOfIteratorHelper(n),_step71;try{for(_iterator71.s();!(_step71=_iterator71.n()).done;){var s=_step71.value;r[s]=this.wrap(e[s])}}catch(err){_iterator71.e(err)}finally{_iterator71.f()}this.proxyNodes[t]=i,this.modifyObjects.push(e)}else i=this.proxyNodes[t];return i}},{key:"createProxyNode",value:function createProxyNode(e,t){return ia?ia(e,t):Pm(this.proxyRuntime,e,t)}}]);return $1}(),Nn=/*#__PURE__*/function(){function Nn(e){_classCallCheck(this,Nn);this.pendingBuffer={},this.observer=e.create(Wr,"room observer")}_createClass(Nn,[{key:"pendingReportChanged",get:function get(){return!!this.pendingBuffer},set:function set(e){!!this.pendingBuffer!==e&&(e?this.pendingBuffer={}:(this.firePendingReportChanges(this.pendingBuffer),this.pendingBuffer=null))}},{key:"reportObserverIdChanged",value:function reportObserverIdChanged(e){this.report(Nn.selfUserId,e,j.Updated)}},{key:"reportUsersChanged",value:function reportUsersChanged(e){this.report(Nn.users,e,j.Updated)}},{key:"reportObservedObserverId",value:function reportObservedObserverId(){this.observer.reportObservedKey(Nn.selfUserId)}},{key:"reportObservedUsers",value:function reportObservedUsers(){this.observer.reportObservedKey(Nn.users)}},{key:"firePendingReportChanges",value:function firePendingReportChanges(e){for(var t in e){var _e$t=e[t],i=_e$t.value,r=_e$t.kind;this.observer.reportChanged(Nn.users,i,r)}}},{key:"report",value:function report(e,t,i){if(this.pendingBuffer){var r=this.pendingBuffer[e];r?(r.value=t,r.kind=i):this.pendingBuffer[e]={value:t,kind:i}}else this.observer.reportChanged(e,t,i)}}]);return Nn}(),zc=Nn;zc.selfUserId="userId",zc.users="users";function Uc(e,t){Object.defineProperty(e,xt,{enumerable:!1,writable:!1,configurable:!0,value:t})}var G1=/*#__PURE__*/function(){function G1(){_classCallCheck(this,G1);this.didTouchedSet={}}_createClass(G1,[{key:"copyProxyNode",value:function copyProxyNode(e){var t=e.identifier;this.didTouchedSet[t]||(this.didTouchedSet[t]=!0,pt(e)?this.copyAkkoObjectProxyNode(e):wi(e)?this.copyFlatObjectProxyNode(e):ki(e)&&this.copyArrayProxyNode(e))}},{key:"copyAkkoObjectProxyNode",value:function copyAkkoObjectProxyNode(e){var t=e.realTarget;if(t){var i={};for(var r in t){var n=Object.getOwnPropertyDescriptor(t,r);if(n&&!n.get&&!n.set){var s=t[r];Ce(s)&&this.copyProxyNode(s),i[r]=s}}Uc(i,e),Object.setPrototypeOf(i,e.struct.classReflection.clazz.prototype),e.illuTarget=i}}},{key:"copyFlatObjectProxyNode",value:function copyFlatObjectProxyNode(e){var t=e.realTarget;if(t){var i={};for(var r in t){var n=t[r];Ce(n)&&this.copyProxyNode(n),i[r]=n}Uc(i,e),e.illuTarget=i}}},{key:"copyArrayProxyNode",value:function copyArrayProxyNode(e){var t=e.realTarget;if(t){var i=[];for(var r=0;r<t.length;++r){if(r in t){var n=t[r];Ce(n)&&this.copyProxyNode(n),i[r]=n}}Uc(i,e),e.illuTarget=i}}}]);return G1}(),ra=new(/*#__PURE__*/function(){function _class(){_classCallCheck(this,_class)}_createClass(_class,[{key:"addProperty",value:function addProperty(e,t,i){}},{key:"removeProperty",value:function removeProperty(e,t){}},{key:"setProperty",value:function setProperty(e,t,i){}},{key:"unbindDelegate",value:function unbindDelegate(e){}},{key:"callbackDelegates",value:function callbackDelegates(){return{didUpdated:!1}}}]);return _class}());function he(){return ra}function Tm(e,t){var i=ra;try{return ra=e,t(),{didUpdated:e.didUpdated}}finally{ra=i}}var Vc=/*#__PURE__*/function(){function Vc(){_classCallCheck(this,Vc);this.disable=!1,this.delegates={},this.unbindsDelegated={},this.updatedObjects={},this._didUpdated=!1}_createClass(Vc,[{key:"didUpdated",get:function get(){return this._didUpdated}},{key:"callbackDelegates",value:function callbackDelegates(){for(var e in this.delegates){if(e in this.unbindsDelegated)delete this.delegates[e];else{var t=this.delegates[e],i=this.updatedObjects[e];t.updateDisplayer(i)}}for(var _e3 in this.delegates){var _t5=this.delegates[_e3],_i22=this.updatedObjects[_e3];_t5.reportChanged(_i22)}}},{key:"unbindDelegate",value:function unbindDelegate(e){this.disable||(this.unbindsDelegated[e.identifier]=!0)}},{key:"addProperty",value:function addProperty(e,t,i){if(this.disable||(this._didUpdated=!0,e.didDispose))return;var r=this.getBufferObject(e),n=r[t];if(n)switch(n.value=i,n.kind){case j.Removed:{n.kind=j.Updated;break}case j.Inserted:{n.kind=j.Inserted;break}case j.Updated:{n.kind=j.Updated;break}}else r[t]={kind:j.Inserted,value:i,isIndex:typeof t=="number"}}},{key:"setProperty",value:function setProperty(e,t,i){if(this.disable||(this._didUpdated=!0,e.didDispose))return;var r=this.getBufferObject(e),n=r[t];if(n)switch(n.value=i,n.kind){case j.Removed:{n.kind=j.Updated;break}case j.Inserted:{n.kind=j.Inserted;break}case j.Updated:{n.kind=j.Updated;break}}else r[t]={kind:j.Updated,value:i,isIndex:typeof t=="number"}}},{key:"removeProperty",value:function removeProperty(e,t){if(this.disable||(this._didUpdated=!0,e.didDispose))return;var i=this.getBufferObject(e),r=i[t];if(r)switch(r.kind){case j.Removed:break;case j.Inserted:{delete i[t];break}case j.Updated:{r.kind=j.Removed,r.value=void 0;break}}else i[t]={kind:j.Removed,value:void 0,isIndex:typeof t=="number"}}},{key:"getBufferObject",value:function getBufferObject(e){var t=e.identifier,i=this.updatedObjects[t];return i||(this.delegates[t]=e,this.updatedObjects[t]=i={}),i}}]);return Vc}(),K1=/*#__PURE__*/function(){function K1(e,t,i){_classCallCheck(this,K1);this.runtime=e,this.observerAdapter=t,i?this.pendingUpdatedSection=new Vc:this.pendingUpdatedSection=null}_createClass(K1,[{key:"pendingReportChanged",get:function get(){return!!this.pendingUpdatedSection},set:function set(e){!!this.pendingUpdatedSection!==e&&(e?this.pendingUpdatedSection=new Vc:(this.pendingUpdatedSection.callbackDelegates(),this.pendingUpdatedSection=null))}},{key:"runWithMagix",value:function runWithMagix(e,t){return this.runtime.runWithMagix(e,t)}},{key:"runWithDisableObserve",value:function runWithDisableObserve(e){var t=he();try{return t.disable=!0,e()}finally{t.disable=!1}}},{key:"runWithContinuousUpdated",value:function runWithContinuousUpdated(e){var t,i,r;return this.pendingUpdatedSection?(i=this.pendingUpdatedSection,r=!1):(i=new Vc,r=!0),this.observerAdapter?this.observerAdapter.observeUpdate(function(){t=Tm(i,e),r&&i.callbackDelegates()}):(t=Tm(i,e),r&&i.callbackDelegates()),t}}]);return K1}();function X1(e){for(var t in e){return!0}return!1}var Em=/*#__PURE__*/function(){function Em(e){var _this41=this;_classCallCheck(this,Em);this.cache={},this.clean=function(){var t=_this41.adapter.createObserverCollection();for(var i in _this41.cache){var r=_this41.cache[i];for(var n in r){var s=r[n].hub;s&&t.addObserverHub(s)}delete _this41.cache[i]}t.clean()},this.adapter=e,this.delayer=new Ai(this.clean)}_createClass(Em,[{key:"valueWithArgs",value:function valueWithArgs(e,t,i,r,n){var _this42=this;var s;if(this.isComplicate(r))return n.call(e,i,r);{var o=i+JSON.stringify(r),a=this.cache[t];a||(a=this.cache[t]={});var c;if(o in a)c=a[o],(s=c.hub)==null||s.replay();else{var h,d;try{h=this.adapter.collectObservations(function(){return n.call(e,i,r)},function(u){return d=u}),c={hub:d,result:h}}catch(u){c={hub:d,error:u}}d&&(d.onChanged=function(){return _this42.onExpire(t,o)}),a[o]=c}return this.touchCache(),this.returnNode(c)}}},{key:"isComplicate",value:function isComplicate(e){var t=5;if(e.length>=t)return!0;var _iterator72=_createForOfIteratorHelper(e),_step72;try{for(_iterator72.s();!(_step72=_iterator72.n()).done;){var i=_step72.value;if(typeof i!="string"&&typeof i!="number")return!0}}catch(err){_iterator72.e(err)}finally{_iterator72.f()}return!1}},{key:"valueWithKey",value:function valueWithKey(e,t,i,r){var _this43=this;var n;var s=this.cache[t];s||(s=this.cache[t]={});var o;if(i in s)o=s[i],(n=o.hub)==null||n.replay();else{var a,c;try{a=this.adapter.collectObservations(function(){return r.call(e,i)},function(h){return c=h}),o={hub:c,result:a}}catch(h){o={hub:c,error:h}}c&&(c.onChanged=function(){return _this43.onExpire(t,i)}),s[i]=o}return this.touchCache(),this.returnNode(o)}},{key:"onExpire",value:function onExpire(e,t){var i=this.cache[e];t in i&&(delete i[t],X1(i)||delete this.cache[e])}},{key:"returnNode",value:function returnNode(e){if(e.error)throw e.error;return e.hub&&e.hub.replay(),e.result}},{key:"touchCache",value:function touchCache(){if(!this.delayer.isRunning){var e=Em.cacheDuration,t=Em.cacheRate,i=e+Math.random()*t;this.delayer.refreshAndInvokeAfterInterval(i)}}}]);return Em}(),Wc=Em;Wc.cacheDuration=60*1e3,Wc.cacheRate=.3;var Y1=/*#__PURE__*/function(){function Y1(e,t,i,_ref18){var r=_ref18.observerAdapter,n=_ref18.escapeObjectFilter,s=_ref18.jsxFactory;_classCallCheck(this,Y1);this.objectOperator=e,this.library=t,this.disposedListeners=[],this.observerAdapter=r,this.escapeObjectFilter=n||function(){return!1},this.jsxFactory=s,this.roomObserver=r&&new zc(r),this.noEffectsIdGenerator=ni(ar),this.frameHandler=new kw(this,this.library),this.cache=this.observerAdapter&&new Wc(this.observerAdapter),i&&i.library===this.library?this.structMap=Ts({},i.structMap):this.structMap={}}_createClass(Y1,[{key:"runtime",get:function get(){return this._runtime}},{key:"block",get:function get(){return this.proxyBlock}},{key:"rootObject",get:function get(){return this._rootObject}},{key:"hasDoubleLines",get:function get(){return this._runtime.hasDoubleLines}},{key:"hasBranch",get:function get(){return!!this._runtime.branchRuntime}},{key:"pendingReportChanged",get:function get(){var e,t;return!!(((e=this.roomObserver)==null?void 0:e.pendingReportChanged)||((t=this.proxyBlock)==null?void 0:t.pendingReportChanged))},set:function set(e){this.roomObserver&&(this.roomObserver.pendingReportChanged=e),this.proxyBlock&&(this.proxyBlock.pendingReportChanged=e),this._rootObject.pendingUpdatedRootObject=e}},{key:"forkBranchRuntime",value:function forkBranchRuntime(){this._runtime.forkBranchRuntime()}},{key:"mergeBranch",value:function mergeBranch(){var e=this._runtime;e.branchRuntime.syncTwoBranches(),e.releaseBranchRuntime()}},{key:"observeUpdate",value:function observeUpdate(e){this.observerAdapter?this.observerAdapter.observeUpdate(e):e()}},{key:"reportUsersChanged",value:function reportUsersChanged(e){var t;(t=this.roomObserver)==null||t.reportUsersChanged(e)}},{key:"reportObserverIdChanged",value:function reportObserverIdChanged(e){var t;this._runtime.observerId=e,(t=this.roomObserver)==null||t.reportObserverIdChanged(e)}},{key:"createFrameSection",value:function createFrameSection(e){var t=this._runtime;t.hasDoubleLines||(new G1().copyProxyNode(this._rootObject.snapshotRootObject()),t.changeToDoubleLines());var i=t.branchRuntime;i||(i=t.forkBranchRuntime());var r;return e&&(r=e.takeCreatedProxyNodes()),i.createFrameSection(r)}},{key:"setupWithParameters",value:function setupWithParameters(e,t,i,r){var _this44=this;this.setupRuntime(r);var n=re,s=ni(e),o=this.pushValues(s,t,!0),a={authorId:n,mode:ne.Real,timestamp:i,identifierGenerator:s},c=this.runtime.runWithMagix(a,function(){var h=_this44.library.rootClass;return _construct(h,_toConsumableArray(o))}).__proxy;this._rootObject=new Um(this._runtime,c,this.observerAdapter),this._rootObject.pendingUpdatedRootObject=r.pendingReportChanged}},{key:"setupWithRootObject",value:function setupWithRootObject(e,t){if(this.setupRuntime(t),!pt(e))throw new Error("rootObject should be AkkoObjectProxyNode");this._rootObject=new Um(this._runtime,e,this.observerAdapter),this._rootObject.pendingUpdatedRootObject=t.pendingReportChanged}},{key:"setupRuntime",value:function setupRuntime(e){if(this._runtime)throw new Error("did bind runtime params");this._runtime=new jc({logger:e.logger,observerId:e.observerId,imageUsers:e.imageUsers,snapshotManager:e.snapshotManager,proxyRuntime:this,toolsExtra:e.toolsExtra}),this.roomObserver&&(this.roomObserver.pendingReportChanged=e.pendingReportChanged),this.proxyBlock=new K1(this._runtime,this.observerAdapter,e.pendingReportChanged)}},{key:"pullValue",value:function pullValue(e){return _typeof(e)!="object"||e===null?e:Ce(e)?e.displayer:ge(e)?e.readonly?e:e.slice():this.escapeObjectFilter(e)?e:void 0}},{key:"pushValues",value:function pushValues(e,t,i){var r=[],n=new $1(this,e,i);try{for(var s=0;s<t.length;++s){r[s]=n.wrap(t[s])}return r}finally{n.complete()}}},{key:"getAkkoObjectStruct",value:function getAkkoObjectStruct(e){var t=this.structMap[e.id];return t||(t=this.structMap[e.id]=new cw(e)),t}},{key:"listenDisposed",value:function listenDisposed(e){this.disposedListeners.indexOf(e)===-1&&this.disposedListeners.push(e)}},{key:"unlistenDisposed",value:function unlistenDisposed(e){var t=this.disposedListeners.indexOf(e);t!==-1&&this.disposedListeners.splice(t,1)}},{key:"dispose",value:function dispose(){var _iterator73=_createForOfIteratorHelper(this.disposedListeners.splice(0)),_step73;try{for(_iterator73.s();!(_step73=_iterator73.n()).done;){var e=_step73.value;try{e()}catch(t){console.error(t)}}}catch(err){_iterator73.e(err)}finally{_iterator73.f()}}}]);return Y1}(),Si=Cm();Si.proxyMethod(Object,"assign",function(){var t;for(var _len8=arguments.length,e=new Array(_len8),_key8=0;_key8<_len8;_key8++){e[_key8]=arguments[_key8]}if(e.length>0){var n=e[0];n&&Ce(n)&&(t=n)}for(var _n10=0;_n10<e.length;++_n10){e[_n10]=qc(e[_n10])}var i=Object.assign.apply(this,e),r=i[xt];return t&&t!==r&&(r=t,dr(t,i)),r});Si.proxyMethod(String,"fromCodePoint",function(){for(var _len9=arguments.length,e=new Array(_len9),_key9=0;_key9<_len9;_key9++){e[_key9]=arguments[_key9]}for(var t=0;t<e.length;++t){e[t]=qc(e[t])}return String.fromCodePoint.apply(this,e)});Si.proxyMethod(String,"fromCharCode",function(){for(var _len10=arguments.length,e=new Array(_len10),_key10=0;_key10<_len10;_key10++){e[_key10]=arguments[_key10]}for(var t=0;t<e.length;++t){e[t]=qc(e[t])}return String.fromCharCode.apply(this,e)});Si.proxyMethod(Number,"isFinite",Number.isFinite);Si.proxyMethod(Number,"isInteger",Number.isInteger);Si.proxyMethod(Number,"isNaN",Number.isNaN);Si.proxyMethod(Number,"isSafeInteger",Number.isSafeInteger);Si.proxyMethod(Number,"parseFloat",Number.parseFloat);Si.proxyMethod(Number,"parseInt",Number.parseInt);var na;Y.addListener(function(e,t){t?na=e.proxyRuntime.jsxFactory:na=void 0});function Am(){if(!na)throw Y.currentNode?new Error("can't create JSX. you didn't set jsxFactory"):new Error("can't create JSX. maybe you called it out of Magix");for(var _len11=arguments.length,e=new Array(_len11),_key11=0;_key11<_len11;_key11++){e[_key11]=arguments[_key11]}return na.apply(void 0,e)}var Q1=/*#__PURE__*/function(){function Q1(){_classCallCheck(this,Q1);this.unwrappedMap={}}_createClass(Q1,[{key:"unwrap",value:function unwrap(e){return Ce(e)?this.unwrapProxyNode(e):ge(e)?e.readonly?e:e.slice():e}},{key:"unwrapProxyNode",value:function unwrapProxyNode(e){if(pt(e))return e.displayer;{var t=e.identifier,i=this.unwrappedMap[t];if(!i){var r=e.target();if(wi(e)){this.unwrappedMap[t]=i={};for(var n in r){i[n]=this.unwrap(r[n])}}else if(ki(e)){this.unwrappedMap[t]=i=[];for(var _n11=0;_n11<r.length;++_n11){i[_n11]=this.unwrap(r[_n11])}}}return i}}}]);return Q1}();function ve(e){if(!(_typeof(e)!="object"||e===null)){if(Ce(e))return e;{var t=e[xt];return Ce(t)?t:void 0}}}function Es(e){return e instanceof Xo?e.__proxy:e}var As=/*#__PURE__*/function(){function As(){_classCallCheck(this,As)}_createClass(As,[{key:"updater",value:function updater(e){return e}},{key:"getter",value:function getter(e,t){var i=ve(e);return i?i.getValue(t):e[t]}},{key:"caller",value:function caller(e,t,i,r){if(typeof e=="function"){if(ke in e)return e[t].apply(e,i);{var n=Si.findMethod(e,t);if(n)return n.apply(e,i);if(typeof Function.prototype[t]=="function")return e[t].apply(e,_toConsumableArray(i));throw new Error("can't call ".concat(e.name,".").concat(t,", it's not supported"))}}else{var _n12,s;return r&&(_n12=r[t]),Ce(e)?(s=e.target(),_n12||(_n12=e.getMethod(t))):(s=e,_n12||(_n12=e[t])),_n12.apply(s,i)}}},{key:"setter",value:function setter(e,t,i){var r=ve(e),n=i;return n=Es(n),r?r.setValue(t,n):e[t]=n}},{key:"prefix",value:function prefix(e,t,i){var r=ve(e);return r?r.prefix(t,i):e[t]+=i}},{key:"postfix",value:function postfix(e,t,i){var r=ve(e);if(r)return r.postfix(t,i);{var n=e[t];return e[t]+=i,n}}},{key:"remover",value:function remover(e,t){var i=ve(e);return i?i.removeKey(t):delete e[t]}},{key:"wrapper",value:function wrapper(e){return _typeof(e)!="object"||e===null?e:e[xt]||e}},{key:"unwrapper",value:function unwrapper(e){return Ce(e)?e.target():e}},{key:"jsxUnwrapper",value:function jsxUnwrapper(e){return new Q1().unwrap(e)}}]);return As}(),Hc,hr,Ln,q1=/*#__PURE__*/function(_As){_inherits(q1,_As);var _super12=_createSuper(q1);function q1(){_classCallCheck(this,q1);return _super12.apply(this,arguments)}_createClass(q1,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(Hc=e.tools&&e.tools.idGenerator,hr=e.frameSection,Ln=e.proxyRuntime):(Hc=void 0,hr=void 0,Ln=void 0)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Hc.generate();var i;if(e.constructor===Array)i=Hn(Ln,t,e);else if(e.constructor===Object)i=Wn(Ln,t,e);else{var r=e.constructor[ke];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=Ln.getAkkoObjectStruct(r);i=Ds(Ln,t,e,n)}return hr.addCreatedObject(i),i}},{key:"updater",value:function updater(e){return Ce(e)&&hr.illusionUpdateProxyNode(e),e}},{key:"setter",value:function setter(e,t,i){var r=ve(e),n=i;return n=Es(n),r?(hr.illusionUpdateProxyNode(r),r.setValue(t,n)):e[t]=n}},{key:"prefix",value:function prefix(e,t,i){var r=ve(e);return r?(hr.illusionUpdateProxyNode(r),r.prefix(t,i)):e[t]+=i}},{key:"postfix",value:function postfix(e,t,i){var r=ve(e);if(r)return hr.illusionUpdateProxyNode(r),r.postfix(t,i);{var n=e[t];return e[t]+=i,n}}},{key:"remover",value:function remover(e,t){var i=ve(e);return i?(hr.illusionUpdateProxyNode(i),i.removeKey(t)):delete e[t]}}]);return q1}(As),_c,Ui,Dn,Z1=/*#__PURE__*/function(_As2){_inherits(Z1,_As2);var _super13=_createSuper(Z1);function Z1(){_classCallCheck(this,Z1);return _super13.apply(this,arguments)}_createClass(Z1,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(_c=e.tools&&e.tools.idGenerator,Ui=e.frameSection,Dn=e.proxyRuntime):(_c=void 0,Ui=void 0,Dn=void 0)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_c.generate();var i=Ui.illusionTakeCreatedObject(t,e);if(i)i.replaceIlluTarget(e);else if(e.constructor===Array)i=Hn(Dn,t,e);else if(e.constructor===Object)i=Wn(Dn,t,e);else{var r=e.constructor[ke];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=Dn.getAkkoObjectStruct(r);i=Ds(Dn,t,e,n)}return Ui.addCreatedObject(i),i}},{key:"updater",value:function updater(e){return Ce(e)&&Ui.illusionUpdateProxyNode(e),e}},{key:"setter",value:function setter(e,t,i){var r=ve(e),n=i;return n=Es(n),r?(Ui.illusionUpdateProxyNode(r),r.setValue(t,n)):e[t]=n}},{key:"prefix",value:function prefix(e,t,i){var r=ve(e);return r?(Ui.illusionUpdateProxyNode(r),r.prefix(t,i)):e[t]+=i}},{key:"postfix",value:function postfix(e,t,i){var r=ve(e);if(r)return Ui.illusionUpdateProxyNode(r),r.postfix(t,i);{var n=e[t];return e[t]+=i,n}}},{key:"remover",value:function remover(e,t){var i=ve(e);return i?(Ui.illusionUpdateProxyNode(i),i.removeKey(t)):delete e[t]}}]);return Z1}(As),$c,sa,Fn,oa=kt.SingleForward,J1=/*#__PURE__*/function(_As3){_inherits(J1,_As3);var _super14=_createSuper(J1);function J1(){_classCallCheck(this,J1);return _super14.apply(this,arguments)}_createClass(J1,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?($c=e.tools&&e.tools.idGenerator,sa=e.frameSection,Fn=e.proxyRuntime,oa=e.forwardMode):($c=void 0,sa=void 0,Fn=void 0,oa=kt.SingleForward)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:$c.generate();var i=sa==null?void 0:sa.realTakeCreatedObject(t,e);if(i)i.realTarget=dr(i,e);else if(e.constructor===Array)i=Hn(Fn,t,e);else if(e.constructor===Object)i=Wn(Fn,t,e);else{var r=e.constructor[ke];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=Fn.getAkkoObjectStruct(r);i=Ds(Fn,t,e,n)}return oa===kt.DoubleForward&&i.converge(),i}},{key:"wrapper",value:function wrapper(e){if(_typeof(e)!="object"||e===null)return e;var t=e[xt];return t?(oa===kt.DoubleForward&&t.converge(),t):e}}]);return J1}(As),Gc,qt,Bn,ew=/*#__PURE__*/function(_As4){_inherits(ew,_As4);var _super15=_createSuper(ew);function ew(){_classCallCheck(this,ew);return _super15.apply(this,arguments)}_createClass(ew,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(Gc=e.tools&&e.tools.idGenerator,qt=e.frameSection,Bn=e.proxyRuntime):(Gc=void 0,qt=void 0,Bn=void 0)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Gc.generate();var i=qt.realTakeCreatedObject(t,e);if(i)i.realTarget=dr(i,e);else if(e.constructor===Array)i=Hn(Bn,t,e),i.converge(),qt.realUpdateProxyNode(i);else if(e.constructor===Object)i=Wn(Bn,t,e),i.converge(),qt.realUpdateProxyNode(i);else{var r=e.constructor[ke];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=Bn.getAkkoObjectStruct(r);i=Ds(Bn,t,e,n),i.converge(),qt.realUpdateProxyNode(i)}return i}},{key:"wrapper",value:function wrapper(e){if(_typeof(e)!="object"||e===null)return e;var t=e[xt];return t?(t.illuTarget||(t.converge(),qt.realUpdateProxyNode(t)),t):e}},{key:"updater",value:function updater(e){return Ce(e)&&qt.realUpdateProxyNode(e),e}},{key:"setter",value:function setter(e,t,i){var r=ve(e),n=i;return n=Es(n),r?(qt.realUpdateProxyNode(r),r.setValue(t,n)):e[t]=n}},{key:"prefix",value:function prefix(e,t,i){var r=ve(e);return r?(qt.realUpdateProxyNode(r),r.prefix(t,i)):e[t]+=i}},{key:"postfix",value:function postfix(e,t,i){var r=ve(e);if(r)return qt.realUpdateProxyNode(r),r.postfix(t,i);{var n=e[t];return e[t]+=i,n}}},{key:"remover",value:function remover(e,t){var i=ve(e);return i?(qt.realUpdateProxyNode(i),i.removeKey(t)):delete e[t]}}]);return ew}(As),aa=Om;Y.addListener(function(e,t){t&&e.tools&&e.mode===Ze.Outside?aa=tw:aa=Om});function tw(e){return fp(e.identifier)===ar}function Om(){return!0}var Kc,jn;function la(e,t){if(aa(e))return!0;var i=Bi(e.target());if(i){var r=i.properties[t];if(r&&r.isTransient)return!0}return!1}var iw=/*#__PURE__*/function(_As5){_inherits(iw,_As5);var _super16=_createSuper(iw);function iw(){_classCallCheck(this,iw);return _super16.apply(this,arguments)}_createClass(iw,[{key:"onContextUpdate",value:function onContextUpdate(e,t){t?(Kc=e.tools&&e.tools.idGenerator,jn=e.proxyRuntime):(Kc=void 0,jn=void 0)}},{key:"creator",value:function creator(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Kc.generate();var i;if(e.constructor===Array)i=Hn(jn,t,e);else if(e.constructor===Object)i=Wn(jn,t,e);else{var r=e.constructor[ke];if(_typeof(r)!="object"||r===null)throw new Error("can't find __reflection");var n=jn.getAkkoObjectStruct(r);i=Ds(jn,t,e,n)}return i}},{key:"getter",value:function getter(e,t){var i=ve(e);if(i){var r=i.getValue(t);return i.touchKey(t),r}else return e[t]}},{key:"unwrapper",value:function unwrapper(e){return Ce(e)?(e.touchKey(),e.target()):e}},{key:"setter",value:function setter(e,t,i){var r=ve(e),n=i;if(r&&la(r,t))return n=Es(n),r?r.setValue(t,n):e[t]=n;throw new Error("Magix is frozen, you can't modify anything")}},{key:"prefix",value:function prefix(e,t,i){var r=ve(e);if(r&&la(r,t)){var n=r.prefix(t,i);return r.touchKey(t),n}else throw new Error("Magix is frozen, you can't modify anything")}},{key:"postfix",value:function postfix(e,t,i){var r=ve(e);if(r&&la(r,t)){var n=r.postfix(t,i);return r.touchKey(t),n}else throw new Error("Magix is frozen, you can't modify anything")}},{key:"remover",value:function remover(e,t){var i=ve(e);if(i&&la(i,t))return i.removeKey(t);throw new Error("Magix is frozen, you can't modify anything")}}]);return iw}(As),Ze;(function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"})(Ze||(Ze={}));var zn=/*#__PURE__*/function(){function zn(){var _this45=this;_classCallCheck(this,zn);this.illusion=zn.bind(new q1),this.illusionRebuild=zn.bind(new Z1),this.real=zn.bind(new J1),this.realAck=zn.bind(new ew),this.outside=zn.bind(new iw),this.currentCoreFunctions=this.illusion,Y.addListener(function(e,t){return _this45.currentCoreFunctions.onContextUpdate(e,t)})}_createClass(zn,[{key:"switchCoreFunctions",value:function switchCoreFunctions(e){switch(e){case 0:{this.currentCoreFunctions=this.illusion;break}case 1:{this.currentCoreFunctions=this.illusionRebuild;break}case 2:{this.currentCoreFunctions=this.real;break}case 3:{this.currentCoreFunctions=this.realAck;break}case 4:{this.currentCoreFunctions=this.outside;break}}return this.currentCoreFunctions}}],[{key:"bind",value:function bind(e){return Object.freeze({creator:e.creator.bind(e),updater:e.updater.bind(e),wrapper:e.wrapper.bind(e),unwrapper:e.unwrapper.bind(e),jsxUnwrapper:e.jsxUnwrapper.bind(e),getter:e.getter.bind(e),setter:e.setter.bind(e),caller:e.caller.bind(e),remover:e.remover.bind(e),prefix:e.prefix.bind(e),postfix:e.postfix.bind(e),onContextUpdate:e.onContextUpdate.bind(e)})}}]);return zn}();function rw(){return new nw}var nw=/*#__PURE__*/function(){function nw(){_classCallCheck(this,nw);this.counterSet={},this.elementSet={}}_createClass(nw,[{key:"hasElement",value:function hasElement(e){var t=this.elementSet[e.identifier];return t?t===e:!1}},{key:"createSubSet",value:function createSubSet(){return new sw(this)}},{key:"release",value:function release(e){for(var t in this.elementSet){var i=this.elementSet[t];e&&e(i),delete this.counterSet[t],delete this.elementSet[t]}}},{key:"add",value:function add(e){var t=e.identifier;return t in this.counterSet?this.counterSet[t]+=1:(this.elementSet[t]=e,this.counterSet[t]=1)}},{key:"remove",value:function remove(e){var t=this.counterSet[e];return t===void 0?t=0:(t-=1,t===0&&(delete this.counterSet[e],delete this.elementSet[e])),t}}]);return nw}(),sw=/*#__PURE__*/function(){function sw(e){_classCallCheck(this,sw);this.uniteSet=e,this.elementSet={}}_createClass(sw,[{key:"add",value:function add(e){var t=e.identifier;t in this.elementSet||(this.elementSet[t]=e,this.uniteSet.add(e))}},{key:"release",value:function release(e){for(var t in this.elementSet){var i=this.elementSet[t],r=this.uniteSet.remove(t);e&&r===0&&e(i),delete this.elementSet[t]}}}]);return sw}();function Xc(e){var t=e.realTarget,i=e.illuTarget;if(!t||!i)return!1;switch(e.kind){case It.Array:{var r=e,n=t,s=i;if(n.length!==s.length)return!1;for(var o=r.equalsCount;o<n.length;++o){if(Yc(n[o],s[o]))return r.equalsCount=o,!1}return r.equalsCount=n.length,!0}case It.FlatObject:case It.HangUpObject:{for(var _r15 in t){if(!(_r15 in i)||Yc(i[_r15],t[_r15]))return!1}for(var _r16 in i){if(!(_r16 in t))return!1}return!0}case It.AkkoObject:{var _r17=e.struct;var _iterator74=_createForOfIteratorHelper(_r17.serializableValueProperties),_step74;try{for(_iterator74.s();!(_step74=_iterator74.n()).done;){var _n13=_step74.value;if(_n13 in t!=_n13 in i||Yc(t[_n13],i[_n13]))return!1}}catch(err){_iterator74.e(err)}finally{_iterator74.f()}return!0}default:return!1;}}function Yc(e,t){return e===t?!1:Number.isNaN(e)?!Number.isNaN(t):ge(e)&&ge(t)?!e.isEqualsTo(t):!0}function ow(e){return new aw(e)}var aw=/*#__PURE__*/function(){function aw(e){_classCallCheck(this,aw);this.logger=e,this.updatedProxyNodes=rw(),this.noConvergentRealNodes={},this.noConvergentIllusionNodes={}}_createClass(aw,[{key:"createFrameSection",value:function createFrameSection(e){return new lw(this,this.updatedProxyNodes.createSubSet(),e)}},{key:"syncTwoBranches",value:function syncTwoBranches(){this.updatedProxyNodes.release(function(e){Xc(e)||e.converge()});for(var e in this.noConvergentIllusionNodes){var t=this.noConvergentIllusionNodes[e],i=this.noConvergentRealNodes[e];t!==i&&t.converge(),delete this.noConvergentIllusionNodes[e]}for(var _e4 in this.noConvergentRealNodes){this.noConvergentRealNodes[_e4].converge(),delete this.noConvergentRealNodes[_e4]}}},{key:"isUpdatedProxyNode",value:function isUpdatedProxyNode(e){return this.updatedProxyNodes.hasElement(e)}},{key:"isNoConvergentIllusionProxyNode",value:function isNoConvergentIllusionProxyNode(e){return e in this.noConvergentIllusionNodes}},{key:"isNoConvergentRealProxyNode",value:function isNoConvergentRealProxyNode(e){return e in this.noConvergentRealNodes}},{key:"addNoConvergentIllusionProxyNode",value:function addNoConvergentIllusionProxyNode(e){this.logger.warn("found no convergent illusion object: ".concat(e.identifier)),this.noConvergentIllusionNodes[e.identifier]=e}},{key:"addNoConvergentRealProxyNode",value:function addNoConvergentRealProxyNode(e){this.logger.warn("found no convergent real object: ".concat(e.identifier)),this.noConvergentRealNodes[e.identifier]=e}}]);return aw}(),lw=/*#__PURE__*/function(){function lw(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,lw);this.createdProxyNodes={},this.branch=e,this.illuUpdatedProxyNodes=t,this.realUpdatedProxyNodes={},this.legacyCreatedProxyNodes=i}_createClass(lw,[{key:"takeCreatedProxyNodes",value:function takeCreatedProxyNodes(){try{return this.createdProxyNodes}finally{this.createdProxyNodes={}}}},{key:"illusionUpdateProxyNode",value:function illusionUpdateProxyNode(e){this.branch.isNoConvergentIllusionProxyNode(e.identifier)||this.illuUpdatedProxyNodes.add(e)}},{key:"realUpdateProxyNode",value:function realUpdateProxyNode(e){!this.branch.isNoConvergentRealProxyNode(e.identifier)&&!this.branch.isUpdatedProxyNode(e)&&(this.realUpdatedProxyNodes[e.identifier]=e)}},{key:"addCreatedObject",value:function addCreatedObject(e){e.identifier in this.createdProxyNodes||(this.createdProxyNodes[e.identifier]=e),this.illuUpdatedProxyNodes.add(e)}},{key:"illusionTakeCreatedObject",value:function illusionTakeCreatedObject(e,t){return this.takeCreatedObject(e,t,this.legacyCreatedProxyNodes)}},{key:"realTakeCreatedObject",value:function realTakeCreatedObject(e,t){var i=this.takeCreatedObject(e,t,this.createdProxyNodes);return i&&!this.branch.isUpdatedProxyNode(i)&&(this.realUpdatedProxyNodes[e]=i),i}},{key:"takeCreatedObject",value:function takeCreatedObject(e,t,i){var r=i[e];return r&&(delete i[e],(ki(r)&&t.constructor!==Array||wi(r)&&t.constructor!==Object||pt(r)&&t.constructor!==r.struct.classReflection.clazz)&&(r.dispose(),r=void 0)),r}},{key:"completeRebuild",value:function completeRebuild(){for(var e in this.legacyCreatedProxyNodes){this.legacyCreatedProxyNodes[e].dispose(),delete this.legacyCreatedProxyNodes[e]}}},{key:"completeACK",value:function completeACK(){var _this46=this;for(var e in this.realUpdatedProxyNodes){var t=this.realUpdatedProxyNodes[e];Xc(t)||this.branch.addNoConvergentRealProxyNode(t),delete this.realUpdatedProxyNodes[e]}this.illuUpdatedProxyNodes.release(function(e){e.realTarget&&!Xc(e)&&_this46.branch.addNoConvergentIllusionProxyNode(e)});for(var _e5 in this.createdProxyNodes){this.createdProxyNodes[_e5].dispose(),delete this.createdProxyNodes[_e5]}}}]);return lw}();function Je(e){return e instanceof Os}function Rm(e){var t=e.__proxy;return t.didDispose?lr.Rejected:t.realTarget?lr.Committed:lr.Uncommitted}var Os=/*#__PURE__*/function(){function Os(e){_classCallCheck(this,Os);Object.defineProperty(this,"__proxy",{value:e,writable:!1,enumerable:!1,configurable:!0})}_createClass(Os,[{key:"toJSON",value:function toJSON(){return this.__proxy.toJSON()}}]);return Os}();function ca(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!0;Object.defineProperty(e,t,{enumerable:i,configurable:!0,get:function get(){var r=this.__proxy,n=r.proxyRuntime.pullValue(r.displayerTarget()[t]);return r.assertAccessible(),r.touchKey(t),n}})}function Nm(e,t){delete e[t]}var Vi;(function(e){e[e.ReadValue=0]="ReadValue",e[e.ReadByGetter=1]="ReadByGetter",e[e.CanNotReadGetter=2]="CanNotReadGetter",e[e.CanNotReadPrivateValue=3]="CanNotReadPrivateValue",e[e.CanNotReadPrivateGetter=4]="CanNotReadPrivateGetter"})(Vi||(Vi={}));var Un;(function(e){e[e.NoEffects=0]="NoEffects",e[e.Modifiable=1]="Modifiable",e[e.Private=2]="Private",e[e.EventReceiver=3]="EventReceiver"})(Un||(Un={}));var cw=/*#__PURE__*/function(){function cw(e){_classCallCheck(this,cw);this.valuePropertiesSet={},this.classReflection=e;var t=[],i=[],r=[],n={};for(var s in e.properties){var o=e.properties[s],a=o.mode===Cn.Value,c=o.decorators.some(function(d){return d===_r}),h=o.decorators.some(function(d){return d===Is});a&&(n[s]=!0,h?t.push(s):i.push(s)),o.isPublic&&(a||c)&&r.push(s)}this.transientValueProperties=Object.freeze(t),this.serializableValueProperties=Object.freeze(i),this.copyableProperties=Object.freeze(r),this.displayerNodeClass=this.createAkkoDisplayerNodeClass(e),this.valuePropertiesSet=Object.freeze(n),this.propertyKinds=this.createPropertyReadableKinds(e),this.methodKinds=this.createMethodCallableKinds(e)}_createClass(cw,[{key:"isValueProperty",value:function isValueProperty(e){return e in this.valuePropertiesSet}},{key:"getPropertyReadableKind",value:function getPropertyReadableKind(e){return this.propertyKinds[e]}},{key:"getMethodCallableKind",value:function getMethodCallableKind(e){return this.methodKinds[e]}},{key:"getValueOutsideFromProxyNode",value:function getValueOutsideFromProxyNode(e,t){switch(this.propertyKinds[t]){case 0:case 1:return e.proxyRuntime.pullValue(this.getValueFromProxyNode(e,t));case 2:throw new Error("can't read property ".concat(JSON.stringify(t)," unless it has @noEffects"));case 3:case 4:throw new Error("can't read private property ".concat(JSON.stringify(t)));default:return;}}},{key:"getValueFromProxyNode",value:function getValueFromProxyNode(e,t){switch(e.assertAccessible(),this.propertyKinds[t]){case 0:case 3:{var i=e.displayerTarget()[t];return e.touchKey(t),i}case 1:{var _i23=e.proxyRuntime.runtime,r=_i23.observerId,n=e.proxyRuntime.noEffectsIdGenerator,s={authorId:r,mode:Ze.Outside,timestamp:Date.now(),identifierGenerator:n};return _i23.runWithMagix(s,function(){return e.target()[t]})}default:return;}}},{key:"createAkkoDisplayerNodeClass",value:function createAkkoDisplayerNodeClass(e){var t=/*#__PURE__*/function(_Os){_inherits(t,_Os);var _super17=_createSuper(t);function t(){_classCallCheck(this,t);return _super17.apply(this,arguments)}return t}(Os);var _loop7=function _loop7(i){var r=function r(){var n=this.__proxy,s=n.struct;return n.assertAccessible(),s.getValueOutsideFromProxyNode(n,i)};Object.defineProperty(t.prototype,i,{enumerable:!1,configurable:!1,get:r})};for(var i in e.properties){_loop7(i)}var _loop8=function _loop8(_i24){t.prototype[_i24]=function(){for(var _len12=arguments.length,r=new Array(_len12),_key12=0;_key12<_len12;_key12++){r[_key12]=arguments[_key12]}return this.__proxy.callOutside(_i24,r)}};for(var _i24 in e.methods){_loop8(_i24)}return t}},{key:"createPropertyReadableKinds",value:function createPropertyReadableKinds(e){var t={};for(var i in e.properties){var r=e.properties[i];r.isPublic?r.mode===Cn.Value?t[i]=0:r.decorators.some(function(n){return n===_r})?t[i]=1:t[i]=2:r.mode===Cn.Value?t[i]=3:t[i]=4}return Object.freeze(t)}},{key:"createMethodCallableKinds",value:function createMethodCallableKinds(e){var t={};for(var i in e.methods){var r=e.methods[i];r.isPublic?r.decorators.some(function(n){return Tc(n)&&Ac(n.payload)})?t[i]=3:r.decorators.some(function(n){return n===_r})?t[i]=0:t[i]=1:t[i]=2}return Object.freeze(t)}}]);return cw}();function dr(e,t){return Object.defineProperty(t,xt,{enumerable:!1,writable:!1,configurable:!0,value:e}),t}function hw(e,t,i){var r=[];for(var n in t){var s=t[n],o=s.isIndex?parseInt(n,10):n,a=s.kind,c=void 0;switch(a){case j.Inserted:{c=e.proxyRuntime.pullValue(s.value);break}case j.Updated:{c=e.proxyRuntime.pullValue(s.value);break}case j.Removed:break;}r.push({key:o,value:c,kind:a})}i(r)}var Vn=/*#__PURE__*/function(_Os2){_inherits(Vn,_Os2);var _super18=_createSuper(Vn);function Vn(){_classCallCheck(this,Vn);return _super18.apply(this,arguments)}_createClass(Vn,null,[{key:"createClass",value:function createClass(_ref19){var e=_ref19.classReflection,t=_ref19.getter,i=_ref19.invoker;var r=/*#__PURE__*/function(_Vn){_inherits(r,_Vn);var _super19=_createSuper(r);function r(s,o){var _this47;_classCallCheck(this,r);_this47=_super19.call(this,o);Object.defineProperty(_assertThisInitialized(_this47),"__Holder",{value:s,writable:!1,enumerable:!1,configurable:!0});return _this47}return r}(Vn);var _loop9=function _loop9(n){Object.defineProperty(r.prototype,n,{enumerable:!1,configurable:!1,get:function get(){return t(n)},set:function set(){throw new Error("cannot set property ".concat(n," which has only a getter"))}})};for(var n in e.properties){_loop9(n)}var _loop10=function _loop10(_n14){r.prototype[_n14]=function(){for(var _len13=arguments.length,s=new Array(_len13),_key13=0;_key13<_len13;_key13++){s[_key13]=arguments[_key13]}return i(_n14,s)}};for(var _n14 in e.methods){_loop10(_n14)}return r}},{key:"updateProxy",value:function updateProxy(e,t){Object.defineProperty(e,xt,{value:t,writable:!1,enumerable:!1,configurable:!0})}},{key:"getHolder",value:function getHolder(e){return e.__Holder}}]);return Vn}(Os),dw=/*#__PURE__*/function(){function dw(e,t){var _this48=this;_classCallCheck(this,dw);this.updatedListeners=[],this.disposedListeners=[],this.dispatchDisposed=function(){var _iterator75=_createForOfIteratorHelper(_this48.disposedListeners),_step75;try{for(_iterator75.s();!(_step75=_iterator75.n()).done;){var i=_step75.value;try{i()}catch(r){console.error(r)}}}catch(err){_iterator75.e(err)}finally{_iterator75.f()}},this.runtime=e,this.onClean=t}_createClass(dw,[{key:"listenUpdated",value:function listenUpdated(e){this.updatedListeners.some(function(t){return t.id===e.id})||this.updatedListeners.push(Object.freeze(Ts({},e)))}},{key:"unlistenUpdated",value:function unlistenUpdated(e){var t=this.updatedListeners.findIndex(function(i){return i.id===e});t!==-1&&(this.updatedListeners.splice(t,1),this.fireRemoveListener())}},{key:"listenDisposed",value:function listenDisposed(e){this.disposedListeners.indexOf(e)===-1&&(this.disposedListeners.push(e),this.disposedListeners.length===1&&this.runtime.listenDisposed(this.dispatchDisposed))}},{key:"unlistenDisposed",value:function unlistenDisposed(e){var t=this.disposedListeners.indexOf(e);t!==-1&&(this.disposedListeners.splice(t,1),this.fireRemoveListener(),this.disposedListeners.length===0&&this.runtime.unlistenDisposed(this.dispatchDisposed))}},{key:"dispatchUpdated",value:function dispatchUpdated(e){var _iterator76=_createForOfIteratorHelper(this.updatedListeners),_step76;try{for(_iterator76.s();!(_step76=_iterator76.n()).done;){var t=_step76.value.listener;try{t(e)}catch(i){console.error(i)}}}catch(err){_iterator76.e(err)}finally{_iterator76.f()}}},{key:"fireRemoveListener",value:function fireRemoveListener(){this.updatedListeners.length===0&&this.disposedListeners.length===0&&(this.runtime.unlistenDisposed(this.dispatchDisposed),this.onClean())}}]);return dw}();function ha(e,t){var i=ma(e),r=e.__proxy;i==null||i.listenUpdated({id:t,listener:function listener(n){return hw(r,n,t)}})}function da(e,t){var i;(i=ma(e))==null||i.unlistenUpdated(t)}function ua(e,t){var i;(i=ma(e))==null||i.listenDisposed(t)}function pa(e,t){var i;(i=ma(e))==null||i.unlistenDisposed(t)}function ma(e){if(!Je(e))throw new Error("it isn't akko wrapped object");var t;return e instanceof Vn?t=Vn.getHolder(e).getListeners():t=e.__proxy.getListeners(),t}var Rs=!1,Qc=kt.SingleForward;Y.addListener(function(e,t){if(t){var i=e.proxyRuntime.runtime;Rs=i.isForcesOnIllusionLine(e.mode),Qc=e.forwardMode}else Rs=!1,Qc=kt.SingleForward});function Ce(e){return e instanceof Ns}function qc(e){return _typeof(e)!="object"||e===null?e:e instanceof Ns?e.target():e}var Ns=/*#__PURE__*/function(){function Ns(e,t,i){_classCallCheck(this,Ns);this._didDispose=!1,this.listeners=null,this.proxyRuntime=e,this.identifier=t,Rs?this.illuTarget=dr(this,i):this.realTarget=dr(this,i)}_createClass(Ns,[{key:"didDispose",get:function get(){return this._didDispose}},{key:"assertAccessible",value:function assertAccessible(){if(this._didDispose)throw new Error("akko wrapped object isn't accessible")}},{key:"reportChanged",value:function reportChanged(e){var t;(t=this.listeners)==null||t.dispatchUpdated(e)}},{key:"getValue",value:function getValue(e){return this.target()[e]}},{key:"touchKey",value:function touchKey(e){var t=this.proxyRuntime.observerAdapter;t&&(this.observer||(this.observer=t.create(this.identifier,this.getDebugName())),e===void 0?this.observer.reportObservedIteration():this.observer.reportObservedKey(e))}},{key:"getListeners",value:function getListeners(){var _this49=this;return!this.listeners&&!this._didDispose&&(this.listeners=new dw(this.proxyRuntime,function(){_this49.listeners=null})),this.listeners}},{key:"cleanListeners",value:function cleanListeners(){this.listeners=null}},{key:"dispose",value:function dispose(){this._didDispose=!0,he().unbindDelegate(this),this._displayer&&(this.releaseDisplayer(this._displayer),delete this._displayer,delete this.observer),this.listeners&&(this.listeners=null)}},{key:"target",value:function target(){return Rs?this.illuTarget:this.realTarget}},{key:"displayerTarget",value:function displayerTarget(){return this.illuTarget||this.realTarget}},{key:"displayer",get:function get(){return this._displayer||(this._displayer=this.createDisplayer()),this._displayer}},{key:"toString",value:function toString(){return this.target().toString()}},{key:"toLocaleString",value:function toLocaleString(){return this.target().toLocaleString()}},{key:"sideTarget",value:function sideTarget(){if(Qc===kt.DoubleForward&&!Rs)return this.illuTarget}}]);return Ns}(),xt="__proxy",It;(function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.HangUpObject=3]="HangUpObject"})(It||(It={}));function Ls(e){if(Y.currentNode){if(Ce(e))return e.identifier;{var t=e[xt];if(!Ce(t))throw new Error("identifier not found");return t.identifier}}else{if(Je(e))return e.__proxy.identifier;throw _typeof(e)!="object"?new Error("can not find identifier of ".concat(_typeof(e))):e===null?new Error("can not find identifier of null"):new Error("identifier not found")}}function pt(e){return e instanceof Zc}var Zc=/*#__PURE__*/function(_Ns){_inherits(Zc,_Ns);var _super20=_createSuper(Zc);function Zc(e,t,i,r){var _this50;_classCallCheck(this,Zc);_this50=_super20.call(this,e,t,i);_this50.struct=r;return _this50}_createClass(Zc,[{key:"getDebugName",value:function getDebugName(){return this.struct.classReflection.name}},{key:"createDisplayer",value:function createDisplayer(){var e=this.struct.displayerNodeClass;return new e(this)}},{key:"kind",get:function get(){return It.AkkoObject}},{key:"clazz",get:function get(){return this.struct.classReflection.clazz}},{key:"updateDisplayer",value:function updateDisplayer(e){}},{key:"reportChanged",value:function reportChanged(e){_get(_getPrototypeOf(Zc.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var i in e){var _e$i=e[i],r=_e$i.kind,n=_e$i.value;t.reportChanged(i,n,r)}}},{key:"converge",value:function converge(){var e=this.realTarget;if(e){var t={};var _iterator77=_createForOfIteratorHelper(this.struct.serializableValueProperties),_step77;try{for(_iterator77.s();!(_step77=_iterator77.n()).done;){var i=_step77.value;i in e&&(t[i]=e[i])}}catch(err){_iterator77.e(err)}finally{_iterator77.f()}Object.setPrototypeOf(t,this.struct.classReflection.clazz.prototype),this.replaceIlluTarget(t)}}},{key:"replaceIlluTarget",value:function replaceIlluTarget(e){var t=this.illuTarget||this.realTarget,i=dr(this,e);this.illuTarget=i;var r=he();var _iterator78=_createForOfIteratorHelper(this.struct.serializableValueProperties),_step78;try{for(_iterator78.s();!(_step78=_iterator78.n()).done;){var n=_step78.value;var s=(n in t),o=(n in i);o&&!s?r.addProperty(this,n,i[n]):!o&&s?r.removeProperty(this,n):o&&s&&i[n]!==t[n]&&r.setProperty(this,n,i[n])}}catch(err){_iterator78.e(err)}finally{_iterator78.f()}}},{key:"getMethod",value:function getMethod(e){return this.target()[e]}},{key:"touchKey",value:function touchKey(e){switch(this.struct.getPropertyReadableKind(e)){case Vi.ReadValue:case Vi.CanNotReadPrivateValue:{_get(_getPrototypeOf(Zc.prototype),"touchKey",this).call(this,e);break}}}},{key:"callOutside",value:function callOutside(e,t){this.assertAccessible();var i;switch(this.struct.getMethodCallableKind(e)){case Un.NoEffects:{var r=this.proxyRuntime.cache;r?i=r.valueWithArgs(this,this.identifier,e,t,this.callNoEffectsMethod):i=this.callNoEffectsMethod(e,t);break}case Un.Modifiable:{if(this.struct.classReflection.isRootClass)i=this.proxyRuntime.rootObject.onInvokedTriggerMethod(e,t);else throw new Error("can only call modifiable methods of trigger object");break}case Un.EventReceiver:throw new Error("can't invoke event receiver. you should call dispatch()");case Un.Private:throw new Error("can't invoke private method");default:{var _3;(_3=void 0)[e].apply(_3,_toConsumableArray(t));break}}return this.proxyRuntime.pullValue(i)}},{key:"callNoEffectsMethod",value:function callNoEffectsMethod(e,t){var _this51=this;var i=this.proxyRuntime.runtime,r=i.observerId,n=this.proxyRuntime.noEffectsIdGenerator,s={authorId:r,mode:Ze.Outside,timestamp:Date.now(),identifierGenerator:n};return i.runWithMagix(s,function(){var o=_this51.target(),a=o[e],c=_this51.proxyRuntime.pushValues(n,t,!1);return a.apply(o,c)})}},{key:"setValue",value:function setValue(e,t){var i=this.target();if(this.struct.isValueProperty(e)){var r=i[e],n=(e in i);i[e]=t,n?r!==t&&he().setProperty(this,e,t):he().addProperty(this,e,t);var s=this.sideTarget();return s&&(s[e]=t),t}else return i[e]=t}},{key:"postfix",value:function postfix(e,t){var i=this.target();if(this.struct.isValueProperty(e)){var r=i[e],n=(e in i),s=i[e]+=t;n?r!==s&&he().setProperty(this,e,s):he().addProperty(this,e,s);var o=this.sideTarget();return o&&(o[e]=s),s}else return i[e]+=t}},{key:"prefix",value:function prefix(e,t){var i=this.target(),r=i[e];if(this.struct.isValueProperty(e)){var n=(e in i),s=i[e]+=t;n?r!==s&&he().setProperty(this,e,s):he().addProperty(this,e,s);var o=this.sideTarget();o&&(o[e]=s)}else i[e]+=t;return r}},{key:"removeKey",value:function removeKey(e){if(this.struct.isValueProperty(e)){var t=this.target(),i=(e in t);if(i){delete t[e],he().removeProperty(this,e);var r=this.sideTarget();r&&delete r[e]}return i}else return!1}},{key:"toJSON",value:function toJSON(){var e={};var _iterator79=_createForOfIteratorHelper(this.struct.copyableProperties),_step79;try{for(_iterator79.s();!(_step79=_iterator79.n()).done;){var t=_step79.value;e[t]=this[t]}}catch(err){_iterator79.e(err)}finally{_iterator79.f()}return e}},{key:"releaseDisplayer",value:function releaseDisplayer(e){}}]);return Zc}(Ns),Lm=/*#__PURE__*/function(_Ns2){_inherits(Lm,_Ns2);var _super21=_createSuper(Lm);function Lm(){_classCallCheck(this,Lm);return _super21.apply(this,arguments)}_createClass(Lm,[{key:"getDebugName",value:function getDebugName(){return"Object"}},{key:"createDisplayer",value:function createDisplayer(){var e=new Os(this);for(var t in this.displayerTarget()){ca(e,t)}return e}},{key:"updateDisplayer",value:function updateDisplayer(e){var t=this._displayer;if(t)for(var i in e){switch(e[i].kind){case j.Inserted:{ca(t,i);break}case j.Removed:{Nm(t,i);break}}}}},{key:"reportChanged",value:function reportChanged(e){_get(_getPrototypeOf(Lm.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var i in e){var _e$i2=e[i],r=_e$i2.kind,n=_e$i2.value;t.reportChanged(i,n,r)}}},{key:"clazz",get:function get(){return Object}},{key:"converge",value:function converge(){this.realTarget&&this.replaceIlluTarget(Ts({},this.realTarget))}},{key:"replaceIlluTarget",value:function replaceIlluTarget(e){var t=this.illuTarget||this.realTarget,i=dr(this,e);this.illuTarget=i;var r=he();for(var n in i){var s=i[n];n in t?t[n]!==s&&r.setProperty(this,n,s):r.addProperty(this,n,s)}for(var _n15 in t){_n15 in i||r.removeProperty(this,_n15)}}},{key:"getMethod",value:function getMethod(e){return this.target()[e]}},{key:"setValue",value:function setValue(e,t){var i=this.target(),r=this.sideTarget(),n=i[e],s=(e in i);return i[e]=t,s?n!==t&&he().setProperty(this,e,t):he().addProperty(this,e,t),r&&(r[e]=t),t}},{key:"prefix",value:function prefix(e,t){var i=this.target(),r=this.sideTarget(),n=i[e],s=(e in i),o=i[e]+=t;return s?n!==o&&he().setProperty(this,e,o):he().addProperty(this,e,o),r&&(r[e]=o),o}},{key:"postfix",value:function postfix(e,t){var i=this.target(),r=this.sideTarget(),n=i[e],s=(e in i),o=i[e]+=t;return s?n!==o&&he().setProperty(this,e,o):he().addProperty(this,e,o),r&&(r[e]=o),n}},{key:"removeKey",value:function removeKey(e){var t=this.target(),i=(e in t);if(i){delete t[e];var r=this.sideTarget();he().removeProperty(this,e),r&&delete r[e]}return i}},{key:"toJSON",value:function toJSON(){var e=this.displayerTarget(),t={};for(var i in e){t[i]=e[i]}return t}},{key:"releaseDisplayer",value:function releaseDisplayer(e){}}]);return Lm}(Ns);function wi(e){return e instanceof Dm}var Dm=/*#__PURE__*/function(_Lm){_inherits(Dm,_Lm);var _super22=_createSuper(Dm);function Dm(){_classCallCheck(this,Dm);return _super22.apply(this,arguments)}_createClass(Dm,[{key:"kind",get:function get(){return It.FlatObject}},{key:"covertToAkkoObjectProxyNode",value:function covertToAkkoObjectProxyNode(e){var t=this,i=this.realTarget,r=this.illuTarget;return t.struct=this.proxyRuntime.getAkkoObjectStruct(e),t._displayer=void 0,Object.setPrototypeOf(t,Zc.prototype),Object.setPrototypeOf(i,e.clazz.prototype),r&&Object.setPrototypeOf(r,e.clazz.prototype),t}}]);return Dm}(Lm),Fm=/*#__PURE__*/function(){function Fm(e){_classCallCheck(this,Fm);this.index=0,this.proxy=e,this.length=e.proxyRuntime.pullValue(e.displayerTarget().length),e.assertAccessible(),e.touchKey("length")}_createClass(Fm,[{key:Symbol.iterator,value:function value(){return new Fm(this.proxy)}},{key:"next",value:function next(){if(this.index>=this.length)return{value:void 0,done:!0};{var e=this.proxy.displayerTarget()[this.index],t=this.proxy.proxyRuntime.pullValue(e);return this.proxy.assertAccessible(),this.proxy.touchKey(this.index),this.index+=1,{value:t,done:!1}}}}]);return Fm}(),Ne=/*#__PURE__*/function(_Os3){_inherits(Ne,_Os3);var _super23=_createSuper(Ne);function Ne(e){var _this52;_classCallCheck(this,Ne);_this52=_super23.call(this,e);var t=e.displayerTarget();for(var i=0;i<t.length;++i){ca(_assertThisInitialized(_this52),i)}return _this52}_createClass(Ne,[{key:"concat",value:function concat(){var t=Ne.unwrapToPureArray(this);for(var _len14=arguments.length,e=new Array(_len14),_key14=0;_key14<_len14;_key14++){e[_key14]=arguments[_key14]}for(var i=0;i<e.length;++i){e[i]=Ne.unwrapToPureArray(e[i])}return Array.prototype.concat(t,e)}},{key:"every",value:function every(e,t){var _this53=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this53)};return Array.prototype.every.call(this.__proxy.displayerTarget(),r)}},{key:"filter",value:function filter(e,t){var _this54=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this54)};return Array.prototype.filter.call(this.__proxy.displayerTarget(),r)}},{key:"find",value:function find(e,t){var _this55=this;var i=this.__proxy.proxyRuntime,r=function r(s,o){return e.call(t,i.pullValue(s),o,_this55)},n=Array.prototype.find.call(this.__proxy.displayerTarget(),r);return i.pullValue(n)}},{key:"findIndex",value:function findIndex(e,t){var _this56=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this56)};return Array.prototype.findIndex.call(this.__proxy.displayerTarget(),r)}},{key:"forEach",value:function forEach(e,t){var _this57=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){e.call(t,i.pullValue(n),s,_this57)};Array.prototype.forEach.call(this.__proxy.displayerTarget(),r)}},{key:"indexOf",value:function indexOf(e,t){var i=e;return Je(i)&&(i=i.__proxy),Array.prototype.indexOf.call(this.__proxy.displayerTarget(),i,t)}},{key:"lastIndexOf",value:function lastIndexOf(e,t){var i=e;return Je(i)&&(i=i.__proxy),Array.prototype.lastIndexOf.call(this.__proxy.displayerTarget(),i,t)}},{key:"join",value:function join(e){return Array.prototype.join.call(this.__proxy.displayerTarget(),e)}},{key:"map",value:function map(e,t){var _this58=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this58)};return Array.prototype.map.call(this.__proxy.displayerTarget(),r)}},{key:"reduce",value:function reduce(e,t){var _this59=this;var i=this.__proxy.proxyRuntime,r=t,n=function n(s,o,a){var c=s;return r!==c&&(c=i.pullValue(c)),r=e(c,i.pullValue(o),a,_this59),r};return Array.prototype.reduce.call(this.__proxy.displayerTarget(),n,t)}},{key:"reduceRight",value:function reduceRight(e,t){var _this60=this;var i=this.__proxy.proxyRuntime,r=t,n=function n(s,o,a){var c=s;return r!==c&&(c=i.pullValue(c)),r=e(c,i.pullValue(o),a,_this60),r};return Array.prototype.reduceRight.call(this.__proxy.displayerTarget(),n,t)}},{key:"slice",value:function slice(e,t){var i=this.__proxy.proxyRuntime,r=Array.prototype.slice.call(this.__proxy.displayerTarget(),e,t);for(var n=0;n<r.length;++n){r[n]=i.pullValue(r[n])}return r}},{key:"some",value:function some(e,t){var _this61=this;var i=this.__proxy.proxyRuntime,r=function r(n,s){return e.call(t,i.pullValue(n),s,_this61)};return Array.prototype.some.call(this.__proxy.displayerTarget(),r)}},{key:"toString",value:function toString(){return Array.prototype.toString.apply(this.__proxy.displayerTarget())}},{key:"copyWithin",value:function copyWithin(){Ne.throwImmutableError()}},{key:"fill",value:function fill(){Ne.throwImmutableError()}},{key:"pop",value:function pop(){Ne.throwImmutableError()}},{key:"push",value:function push(){Ne.throwImmutableError()}},{key:"reverse",value:function reverse(){Ne.throwImmutableError()}},{key:"shift",value:function shift(){Ne.throwImmutableError()}},{key:"splice",value:function splice(){Ne.throwImmutableError()}},{key:"unshift",value:function unshift(){Ne.throwImmutableError()}},{key:"sort",value:function sort(){Ne.throwImmutableError()}},{key:"entries",value:function entries(){Ne.throwBanMethodError()}},{key:"keys",value:function keys(){Ne.throwBanMethodError()}},{key:"values",value:function values(){Ne.throwBanMethodError()}}],[{key:"refreshLength",value:function refreshLength(e,t){var i=t;for(;(i in e);){Nm(e,i),i+=1}if(i===t)for(i=t-1;i>=0&&!(i in e);){ca(e,i),i-=1}}},{key:"unwrapToPureArray",value:function unwrapToPureArray(e){if(e instanceof Ne){var _e$__proxy$displayerT=e.__proxy.displayerTarget(),t=_e$__proxy$displayerT.length,i=new Array(t);for(var r=0;r<t;++r){i[r]=e[r]}return i}else return e}},{key:"throwImmutableError",value:function throwImmutableError(){throw new Error("it is immutable")}},{key:"throwBanMethodError",value:function throwBanMethodError(){throw new Error("ban method")}}]);return Ne}(Os);Object.defineProperty(Ne.prototype,"length",{enumerable:!1,configurable:!0,get:function get(){var e=this.__proxy,t=e.proxyRuntime.pullValue(e.displayerTarget().length);return e.touchKey("length"),t}});typeof Symbol!="undefined"&&typeof Symbol.iterator!="undefined"&&Object.defineProperty(Ne.prototype,Symbol.iterator,{enumerable:!1,configurable:!0,writable:!1,value:function value(){return new Fm(this.__proxy)}});function ki(e){return e instanceof eh}var Jc=/*#__PURE__*/function(_Ns3){_inherits(Jc,_Ns3);var _super24=_createSuper(Jc);function Jc(){var _this62;_classCallCheck(this,Jc);_this62=_super24.apply(this,arguments);_this62.equalsCount=0;return _this62}_createClass(Jc,[{key:"getDebugName",value:function getDebugName(){return"Array"}},{key:"createDisplayer",value:function createDisplayer(){return new Ne(this)}},{key:"kind",get:function get(){return It.Array}},{key:"clazz",get:function get(){return Array}},{key:"updateDisplayer",value:function updateDisplayer(e){var t=this._displayer,i=e.length;t&&i&&Ne.refreshLength(t,i.value)}},{key:"reportChanged",value:function reportChanged(e){_get(_getPrototypeOf(Jc.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t){var i=e.length;i&&t.reportChanged("length",i.value,i.kind);for(var r in e){var _e$r=e[r],n=_e$r.kind,s=_e$r.value,o=_e$r.isIndex;o&&t.reportChanged(parseInt(r,10),s,n)}}}},{key:"converge",value:function converge(){this.realTarget&&(this.replaceIlluTarget(_toConsumableArray(this.realTarget)),this.equalsCount=this.realTarget.length)}},{key:"replaceIlluTarget",value:function replaceIlluTarget(e){var t=this.illuTarget||this.realTarget,i=dr(this,e);this.illuTarget=i;var r=Math.min(t.length,i.length),n=he();for(var s=0;s<r;++s){t[s]!==i[s]&&n.setProperty(this,s,i[s])}this.refreshLength(t.length,i),this.equalsCount=0}},{key:"getMethod",value:function getMethod(e){return Jc.arrayValidMethods[e]}},{key:"getValue",value:function getValue(e){return typeof e=="number"?this.target()[e]:e==="length"?this.target().length:void 0}},{key:"setValue",value:function setValue(e,t){var i=this.target(),r=i.length;if(typeof e=="number"){if(e>=0){var n=e in i&&i[e]!==t,s=i[e]=t;n&&he().setProperty(this,e,t);var o=this.sideTarget();return this.refreshLength(r,i),o&&(o[e]=t),e<this.equalsCount&&(this.equalsCount=e),s}else return t;}else return i[e]}},{key:"removeKey",value:function removeKey(e){return!1}},{key:"prefix",value:function prefix(e,t){if(typeof e=="number"){var i=this.target(),r=this.sideTarget(),n=(e in i),s=i.length,o=i[e],a=i[e]+=t;return n&&a!==o&&he().setProperty(this,e,a),this.refreshLength(s,i),r&&(r[e]=a),e<this.equalsCount&&(this.equalsCount=e),a}else return}},{key:"postfix",value:function postfix(e,t){if(typeof e=="number"){var i=this.target(),r=this.sideTarget(),n=(e in i),s=i.length,o=i[e],a=i[e]+=t;return n&&a!==o&&he().setProperty(this,e,a),this.refreshLength(s,i),r&&(r[e]=a),e<this.equalsCount&&(this.equalsCount=e),o}else return}},{key:"toJSON",value:function toJSON(){var e=this.displayerTarget(),t=[];for(var i=0;i<e.length;++i){t[i]=e[i]}return t}},{key:"releaseDisplayer",value:function releaseDisplayer(e){}},{key:"refreshLength",value:function refreshLength(e,t){if(e!==t.length){var i=this.sideTarget(),r=he();if(e>t.length){i&&i.splice(t.length);for(var n=t.length;n<e;++n){r.removeProperty(this,n)}}else for(var _n16=e;_n16<t.length;++_n16){i&&(i[_n16]=t[_n16]),r.addProperty(this,_n16,t[_n16])}r.setProperty(this,"length",t.length)}}}],[{key:"createArrayValidMethods",value:function createArrayValidMethods(){var e,t,i;Y.addListener(function(s,o){o&&s.tools?(e=s.tools.idGenerator,t=s.coreFunctions.updater,i=s.coreFunctions.creator):(e=void 0,t=void 0,i=void 0)});var r=function r(s,o){return s===o?s[xt]:i(o,e.generate())},n={};var _iterator80=_createForOfIteratorHelper(km),_step80;try{var _loop11=function _loop11(){var _step80$value=_step80.value,s=_step80$value.methodName,o=_step80$value.returnArray,a=_step80$value.lengthChanged,c=_step80$value.elementChanged,h=_step80$value.touchLength,d=_step80$value.cleanEqualsCount,u=_step80$value.pickTouchedSegment;var p=Array.prototype[s],f=a||c;n[s]=function(){for(var _len15=arguments.length,m=new Array(_len15),_key15=0;_key15<_len15;_key15++){m[_key15]=arguments[_key15]}var g=this,y=g.length,b=g[xt],S=p.apply(g,m);if(f&&!aa(b))throw new Error("Magix is frozen, you can't call Array.".concat(s,"()"));var w=u&&u(g,m);if(a&&b.refreshLength(y,g),w){var P=Math.min(g.length,w.beginIndex+w.length),A=b.sideTarget(),E=he();for(var R=w.beginIndex;R<P;++R){if(c){var N=g[R];A&&(A[R]=N),E.setProperty(b,R,N)}b.touchKey(R)}}return h&&b.touchKey(),d&&(b.equalsCount=0),f&&t(b),o?r(g,S):S}};for(_iterator80.s();!(_step80=_iterator80.n()).done;){_loop11()}}catch(err){_iterator80.e(err)}finally{_iterator80.f()}return Object.freeze(n)}}]);return Jc}(Ns),eh=Jc;eh.arrayValidMethods=Jc.createArrayValidMethods();function th(e){return e instanceof Bm}var Bm=/*#__PURE__*/function(_Lm2){_inherits(Bm,_Lm2);var _super25=_createSuper(Bm);function Bm(){_classCallCheck(this,Bm);return _super25.apply(this,arguments)}_createClass(Bm,[{key:"version",get:function get(){return this._version}},{key:"objectFormatId",get:function get(){return this._objectFormatId}},{key:"setHangMetadata",value:function setHangMetadata(e){if(this._version||this._objectFormatId)throw new Error("did set version");this._version=e.version,this._objectFormatId=e.objectFormatId}},{key:"kind",get:function get(){return It.HangUpObject}}]);return Bm}(Lm),jm;(function(e){e[e.ExportsPropertyMode=0]="ExportsPropertyMode",e[e.SerializablePropertyMode=1]="SerializablePropertyMode"})(jm||(jm={}));function zm(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=arguments.length>2?arguments[2]:undefined;return new uw(t,i).copyValue(e)}var uw=/*#__PURE__*/function(){function uw(e,t){_classCallCheck(this,uw);this.mode=e,this.creator=t,this.copedObjectMap={}}_createClass(uw,[{key:"copyValue",value:function copyValue(e){return Je(e)?this.copyProxyNode(e.__proxy):Ce(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function copyProxyNode(e){var t=e.identifier,i=this.copedObjectMap[t];if(!i){var r=e.displayerTarget();if(wi(e)){var n={};this.copedObjectMap[t]=i=n;for(var s in r){n[s]=this.copyInsideValue(e.proxyRuntime,r[s])}}else if(pt(e)){var _n17=e.struct,_s9=this.createAkkoObject(_n17.classReflection.clazz);this.copedObjectMap[t]=i=_s9;var _iterator81=_createForOfIteratorHelper(this.getPropertiesToCopy(e)),_step81;try{for(_iterator81.s();!(_step81=_iterator81.n()).done;){var o=_step81.value;_s9[o]=this.copyInsideValue(e.proxyRuntime,_n17.getValueFromProxyNode(e,o))}}catch(err){_iterator81.e(err)}finally{_iterator81.f()}}else if(ki(e)){var _n18=r.length,_s10=[];this.copedObjectMap[t]=i=_s10;for(var _o11=0;_o11<_n18;++_o11){_s10[_o11]=this.copyInsideValue(e.proxyRuntime,r[_o11])}}}return i}},{key:"getPropertiesToCopy",value:function getPropertiesToCopy(e){switch(this.mode){case 0:return e.struct.copyableProperties;case 1:return e.struct.serializableValueProperties;default:throw new Error("invalid mode ".concat(this.mode));}}},{key:"createAkkoObject",value:function createAkkoObject(e){return this.creator?this.creator(e):{}}},{key:"copyInsideValue",value:function copyInsideValue(e,t){return _typeof(t)!="object"||t===null?t:Ce(t)?this.copyProxyNode(t):ge(t)?t.readonly?t:t.slice():e.escapeObjectFilter(t)?t:void 0}}]);return uw}(),Ut;Y.addListener(function(e,t){t&&e.tools?Ut=e.coreFunctions:Ut=null});function pw(e){return new mw().copyValue(e)}var mw=/*#__PURE__*/function(){function mw(){_classCallCheck(this,mw);this.copedObjectMap={}}_createClass(mw,[{key:"copyValue",value:function copyValue(e){return Ce(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function copyProxyNode(e){var t=e.identifier,i=this.copedObjectMap[t];if(!i)if(wi(e)||th(e)){var r=Ut.creator({});this.copedObjectMap[t]=i=r;for(var n in Ut.unwrapper(e)){var s=this.copyValue(Ut.getter(e,n));Ut.setter(i,n,s)}}else if(pt(e)){var _r18=e.struct,_n19={};Object.setPrototypeOf(_n19,_r18.classReflection.clazz.prototype);var _s11=Ut.creator(_n19);this.copedObjectMap[t]=i=_s11;var _iterator82=_createForOfIteratorHelper(_r18.serializableValueProperties),_step82;try{for(_iterator82.s();!(_step82=_iterator82.n()).done;){var o=_step82.value;var a=this.copyValue(Ut.getter(e,o));Ut.setter(_s11,o,a)}}catch(err){_iterator82.e(err)}finally{_iterator82.f()}}else if(ki(e)){var _r19=Ut.getter(e,"length"),_n20=Ut.creator([]);this.copedObjectMap[t]=i=_n20;for(var _s12=0;_s12<_r19;++_s12){var _o12=this.copyValue(Ut.getter(e,_s12));Ut.setter(_n20,_s12,_o12)}}else throw new Error("invalid proxy node");return i}}]);return mw}(),fw=/*#__PURE__*/function(){function fw(e,t){var _this63=this;_classCallCheck(this,fw);this.listeners=new gw,this.didDispose=!1,this.getProperty=function(i){var r,n=_this63._akkoProxyNode.proxyRuntime;switch(_this63.struct.getPropertyReadableKind(i)){case Vi.ReadValue:{r=n.pullValue(_this63._akkoProxyNode.displayerTarget()[i]),_this63.touchKey(i);break}case Vi.ReadByGetter:{var s=n.cache;s?r=s.valueWithKey(_this63,_this63._akkoProxyNode.identifier,i,_this63.readByGetter):r=_this63.readByGetter(i),_this63.touchKey(xt);break}case Vi.CanNotReadGetter:throw new Error("can't read property ".concat(JSON.stringify(i)," unless it has @noEffects"));case Vi.CanNotReadPrivateValue:case Vi.CanNotReadPrivateGetter:throw new Error("can't read private property ".concat(JSON.stringify(i)));}return r},this.readByGetter=function(i){var r=_this63._akkoProxyNode.proxyRuntime,n=r.runtime,s=n.observerId,o=r.noEffectsIdGenerator,a={authorId:s,mode:Ze.Outside,timestamp:Date.now(),identifierGenerator:o},c=n.runWithMagix(a,function(){return _this63._akkoProxyNode.target()[i]});return r.pullValue(c)},this.invokeMethod=function(i,r){var n=_this63._akkoProxyNode.callOutside(i,r);return _this63.touchKey(xt),n},this.onAkkoProxyNodeUpdated=function(i){if(_this63.observer){for(var r in i){var _i$r=i[r],n=_i$r.kind,s=_i$r.value;_this63.observer.reportChanged(r,s,n)}_this63.listeners.dispatchUpdated(i)}},this.struct=e.struct,this.observerAdapter=t,this._akkoProxyNode=e,this.displayer=this.createDisplayer(e),this.valueProperties=Object.freeze([].concat(_toConsumableArray(this.struct.transientValueProperties),_toConsumableArray(this.struct.serializableValueProperties))),this.listenUpdated(e)}_createClass(fw,[{key:"dispose",value:function dispose(){this.didDispose||(this.unlistenUpdate(this._akkoProxyNode),this.listeners.dispatchDisposed(),this.didDispose=!0)}},{key:"getListeners",value:function getListeners(){return this.listeners}},{key:"akkoProxyNode",get:function get(){return this._akkoProxyNode},set:function set(e){var _this64=this;this._akkoProxyNode!==e&&(this.unlistenUpdate(this._akkoProxyNode),this.observerAdapter?this.observerAdapter.observeUpdate(function(){_this64.compareAndReportUpdated(_this64._akkoProxyNode,e),_this64._akkoProxyNode=e,Vn.updateProxy(_this64.displayer,e)}):(this.compareAndReportUpdated(this._akkoProxyNode,e),this._akkoProxyNode=e,Vn.updateProxy(this.displayer,e)),this.listenUpdated(this.akkoProxyNode))}},{key:"compareAndReportUpdated",value:function compareAndReportUpdated(e,t){var i=this.compareAndGetUpdatedObject(e,t);if(this.observer){for(var r in i){var _i$r2=i[r],n=_i$r2.value,s=_i$r2.kind;this.observer.reportChanged(r,n,s)}this.observer.reportChanged(xt,t,j.Updated)}this.listeners.dispatchUpdated(i)}},{key:"compareAndGetUpdatedObject",value:function compareAndGetUpdatedObject(e,t){var i=e.displayerTarget(),r=t.displayerTarget(),n={};var _iterator83=_createForOfIteratorHelper(this.valueProperties),_step83;try{for(_iterator83.s();!(_step83=_iterator83.n()).done;){var s=_step83.value;var o=(s in i),a=(s in r),c=typeof s=="number",h=null;o&&!a?h={isIndex:c,kind:j.Removed,value:void 0}:!o&&a?h={isIndex:c,kind:j.Inserted,value:r[s]}:i[s]!==r[s]&&(h={isIndex:c,kind:j.Updated,value:r[s]}),h&&(n[s]=h)}}catch(err){_iterator83.e(err)}finally{_iterator83.f()}return n}},{key:"createDisplayer",value:function createDisplayer(e){var t=Vn.createClass({classReflection:e.struct.classReflection,getter:this.getProperty,invoker:this.invokeMethod});return new t(this,e)}},{key:"listenUpdated",value:function listenUpdated(e){var t;(t=e.getListeners())==null||t.listenUpdated({id:this.onAkkoProxyNodeUpdated,listener:this.onAkkoProxyNodeUpdated})}},{key:"unlistenUpdate",value:function unlistenUpdate(e){var t;(t=e.getListeners())==null||t.unlistenUpdated(this.onAkkoProxyNodeUpdated)}},{key:"touchKey",value:function touchKey(e){var t=this.observerAdapter;if(t){if(!this.observer){var i=this._akkoProxyNode.identifier;this.observer=t.create(i,"AkkoDisplayerHolder")}this.observer.reportObservedKey(e)}}}]);return fw}(),gw=/*#__PURE__*/function(){function gw(){_classCallCheck(this,gw);this.updatedListeners=[],this.disposedListeners=[]}_createClass(gw,[{key:"listenUpdated",value:function listenUpdated(e){this.updatedListeners.some(function(t){return t.id===e.id})||this.updatedListeners.push(Object.freeze(Ts({},e)))}},{key:"unlistenUpdated",value:function unlistenUpdated(e){var t=this.updatedListeners.findIndex(function(i){return i.id===e});t!==-1&&this.updatedListeners.splice(t,1)}},{key:"listenDisposed",value:function listenDisposed(e){this.disposedListeners.indexOf(e)===-1&&this.disposedListeners.push(e)}},{key:"unlistenDisposed",value:function unlistenDisposed(e){var t=this.disposedListeners.indexOf(e);t!==-1&&this.disposedListeners.splice(t,1)}},{key:"dispatchUpdated",value:function dispatchUpdated(e){var _iterator84=_createForOfIteratorHelper(this.updatedListeners),_step84;try{for(_iterator84.s();!(_step84=_iterator84.n()).done;){var t=_step84.value.listener;try{t(e)}catch(i){console.error(i)}}}catch(err){_iterator84.e(err)}finally{_iterator84.f()}}},{key:"dispatchDisposed",value:function dispatchDisposed(){var _iterator85=_createForOfIteratorHelper(this.disposedListeners),_step85;try{for(_iterator85.s();!(_step85=_iterator85.n()).done;){var e=_step85.value;try{e()}catch(t){console.error(t)}}}catch(err){_iterator85.e(err)}finally{_iterator85.f()}}}]);return gw}(),li=null;Y.addListener(function(e,t){t?li=e.coreFunctions:li=null});var yw=/*#__PURE__*/function(){function yw(){_classCallCheck(this,yw)}_createClass(yw,[{key:"isValidObject",value:function isValidObject(e){return pt(e)}},{key:"isDisplayerObject",value:function isDisplayerObject(e){return Je(e)}},{key:"identifier",value:function identifier(e){return e.identifier}},{key:"kind",value:function kind(e){if(pt(e))return Re.AkkoObject;if(wi(e))return Re.FlatObject;if(ki(e))return Re.Array;if(Je(e))return Re.Displayer;throw new Error("unrecognized proxy node")}},{key:"forEach",value:function forEach(e,t){if(wi(e)){var i=e.target();for(var r in i){t(i[r],r)}}else if(ki(e)){var _i25=e.target();for(var _r20=0;_r20<_i25.length;++_r20){t(_i25[_r20],_r20)}}else if(pt(e)){var _i26=e.target(),_r21=e.struct;var _iterator86=_createForOfIteratorHelper(_r21.serializableValueProperties),_step86;try{for(_iterator86.s();!(_step86=_iterator86.n()).done;){var n=_step86.value;t(_i26[n],n)}}catch(err){_iterator86.e(err)}finally{_iterator86.f()}}}},{key:"createObject",value:function createObject(e,t){return li.creator(t,e)}},{key:"wrapDisplayer",value:function wrapDisplayer(e,t){return t.displayer}},{key:"unwrapDisplayer",value:function unwrapDisplayer(e,t){return t.__proxy}},{key:"getClassReflection",value:function getClassReflection(e){var t=e;if(Je(t)&&(t=t.__proxy),!!pt(t))return t.struct.classReflection}},{key:"override",value:function override(e,t,i){if(wi(e)){for(var r in li.unwrapper(e)){r in t||li.remover(e,r)}for(var _r22 in t){li.setter(e,_r22,t[_r22])}}else if(ki(e)){var _r23=t,n=li.getter(e,"length");_r23.length>n&&li.caller(e,"splice",[n]);for(var s=0;s<_r23.length;++s){li.setter(e,s,_r23[s])}}else if(pt(e)){var _r24=e.proxyRuntime.getAkkoObjectStruct(i);var _iterator87=_createForOfIteratorHelper(_r24.transientValueProperties),_step87;try{for(_iterator87.s();!(_step87=_iterator87.n()).done;){var _n21=_step87.value;li.remover(e,_n21)}}catch(err){_iterator87.e(err)}finally{_iterator87.f()}var _iterator88=_createForOfIteratorHelper(_r24.serializableValueProperties),_step88;try{for(_iterator88.s();!(_step88=_iterator88.n()).done;){var _n22=_step88.value;li.setter(e,_n22,t[_n22])}}catch(err){_iterator88.e(err)}finally{_iterator88.f()}}}},{key:"displayerPhase",value:function displayerPhase(e){if(Je(e))return Rm(e);throw new Error("it isn't akko wrapped object")}},{key:"copyDisplayer",value:function copyDisplayer(e){return zm(e)}}]);return yw}();function Wn(e,t,i){return new Dm(e,t,i)}function Ds(e,t,i,r){return new Zc(e,t,i,r)}function Hn(e,t,i){return new eh(e,t,i)}function bw(e,t,i){return new Bm(e,t,i)}var fa;Y.addListener(function(e,t){t?fa=e.coreFunctions.creator:fa=void 0});var vw=/*#__PURE__*/function(){function vw(e,t){_classCallCheck(this,vw);this.decorateObjectEnums=Object.freeze([Z.Object]),this.proxyRuntime=e,this.covertIdToClass=t}_createClass(vw,[{key:"createObject",value:function createObject(e,t){if(t===Z.HangUpObject)return bw(this.proxyRuntime,e,{});{var i=t===Z.Array?[]:{};return fa?fa(i,e):Pm(this.proxyRuntime,i,e)}}},{key:"findIdentifier",value:function findIdentifier(e){var t=e.identifier;if(t===void 0)throw Ce(e)?new Error("can't find identifier of proxy node"):new Error("object should be proxy node");return t}},{key:"findHangUpMetadata",value:function findHangUpMetadata(e){if(!th(e))throw new Error("it's not hang up object");return e}},{key:"checkObjectEnum",value:function checkObjectEnum(e){switch(e.kind){case It.Array:return Z.Array;case It.AkkoObject:case It.FlatObject:return Z.Object;case It.HangUpObject:return Z.HangUpObject;default:throw new Error("unrecognized object");}}},{key:"keys",value:function keys(e){return Object.keys(e.target())}},{key:"length",value:function length(e){if(ki(e))return e.target().length}},{key:"hasKey",value:function hasKey(e,t){return t in e.target()}},{key:"getValue",value:function getValue(e,t){return e.target()[t]}},{key:"setValue",value:function setValue(e,t,i){e.setValue(t,i)}},{key:"completeHangUpObject",value:function completeHangUpObject(e,t){th(e)&&e.setHangMetadata(t)}},{key:"decorateObject",value:function decorateObject(e,t,i,r,n){if(r&&t===ue.AssertedObject){var s=this.covertIdToClass(r.id);if(!s)throw new ht("can't find class by object format id ".concat(r.id));var o=s[ke];wi(e)&&e.covertToAkkoObjectProxyNode(o)}}}]);return vw}();function Sw(e,t){return new vw(t,e.covertObjectFormatIdToClass)}function ww(e,t){var i=Bi(e.rootClass),r=new bi({format:e.format,objectAdapter:t,assertObjectFormat:function assertObjectFormat(n){if(pt(n))return n.struct.classReflection.objectFormat}});return Mc(r,i)}var kw=/*#__PURE__*/function(){function kw(e,t){_classCallCheck(this,kw);this.assertObjectFormat=function(i){if(pt(i))return i.struct.classReflection.objectFormat},this.proxyRuntime=e,this.objectAdapter=Sw(t,e),this.frameSerialization=ww(t,this.objectAdapter)}_createClass(kw,[{key:"serializeSnapshotFrame",value:function serializeSnapshotFrame(e){return this.frameSerialization.serializeSnapshotFrame(e)}},{key:"serializeActionFrame",value:function serializeActionFrame(e,t){return this.frameSerialization.serializeActionFrame(e,t)}},{key:"deserializeSnapshotFrame",value:function deserializeSnapshotFrame(e,t,i){return this.frameSerialization.deserializeSnapshotFrame(e,t,i)}},{key:"deserializeActionFrame",value:function deserializeActionFrame(e,t,i,r){var _this65=this;return r?this.proxyRuntime.runtime.runWithSerialization(r,function(){return _this65.frameSerialization.deserializeActionFrame(e,t,i)}):this.frameSerialization.deserializeActionFrame(e,t,i)}},{key:"createSerialization",value:function createSerialization(e){return new bi({format:e,objectAdapter:this.objectAdapter,assertObjectFormat:this.assertObjectFormat})}}]);return kw}(),Um=/*#__PURE__*/function(){function Um(e,t,i){_classCallCheck(this,Um);this.runtime=e,this.rootObject=t,this.observerAdapter=i,this._pendingUpdatedRootObject=!1,this.didPenddingRootObject=!1}_createClass(Um,[{key:"initialize",value:function initialize(){this.holder=new fw(this.rootObject,this.observerAdapter)}},{key:"initializeWithOriginRootObject",value:function initializeWithOriginRootObject(e){this.holder=e.holder,this._pendingUpdatedRootObject?this.didPenddingRootObject=!0:this.holder.akkoProxyNode=this.rootObject}},{key:"pendingUpdatedRootObject",get:function get(){return this._pendingUpdatedRootObject},set:function set(e){this._pendingUpdatedRootObject!==e&&(this._pendingUpdatedRootObject=e,!e&&this.didPenddingRootObject&&(this.didPenddingRootObject=!1,this.holder.akkoProxyNode=this.rootObject))}},{key:"observerId",get:function get(){return this.runtime.observerId}},{key:"displayer",get:function get(){return this.holder.displayer}},{key:"target",get:function get(){return this.rootObject.target()}},{key:"getRootMethod",value:function getRootMethod(e){return this.rootObject.getMethod(e)}},{key:"snapshotRootObject",value:function snapshotRootObject(){return this.rootObject}}]);return Um}(),Cw=/*#__PURE__*/function(){function Cw(e){_classCallCheck(this,Cw);this.params=Object.freeze(Ts({},e)),this.objectOperator=new yw}_createClass(Cw,[{key:"createProxyRuntime",value:function createProxyRuntime(e,t){return new Y1(this.objectOperator,e,t,{escapeObjectFilter:this.params.escapeObjectFilter,jsxFactory:this.params.jsxFactory,observerAdapter:this.params.observerAdapter})}}]);return Cw}();function Vm(e){if(!Je(e))throw new Error("it isn't akko wrapped object");return lr.Rejected!==Rm(e)}function Vt(e,t){return Je(e)?e.__proxy.displayerTarget()instanceof t:Ce(e)?e.displayerTarget()instanceof t:e instanceof t}var xw=-1,Iw=-2,Wm=-3;function Hm(e){var t=ih(e);if(t===Object)return xw;if(t===Array)return Iw;if(t===void 0)return Wm;{var i=t[ke];return i?i.id:Wm}}function ih(e){switch(_typeof(e)){case"function":return e;case"object":{if(e!==null)return Pw(e);break}}}function Pw(e){var t=e.__proxy;switch(Mw(t)){case Re.FlatObject:return Object;case Re.Array:return Array;case Re.AkkoObject:return Tw(t).clazz;}return e.constructor}function Mw(e){if(pt(e))return Re.AkkoObject;if(wi(e))return Re.FlatObject;if(ki(e))return Re.AkkoObject;if(Je(e))return Re.Displayer;throw new Error("unrecognized proxy node")}function Tw(e){var t=e;if(Je(t)&&(t=t.__proxy),!!pt(t))return t.struct.classReflection}function _m(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new Cw(e)}function se(e){return Y.currentNode?pw(e):zm(e)}var Zm=x(require("query-string"));var rf=x(require("query-string"));var uf=x(require("query-string"));var hh=x(require("query-string"));var yf=x(require("query-string"));var Ew=Object.defineProperty,Aw=Object.defineProperties,Ow=Object.getOwnPropertyDescriptors,$m=Object.getOwnPropertySymbols,Rw=Object.prototype.hasOwnProperty,Nw=Object.prototype.propertyIsEnumerable,Gm=function Gm(e,t,i){return t in e?Ew(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Wt=function Wt(e,t){for(var i in t||(t={})){Rw.call(t,i)&&Gm(e,i,t[i])}if($m){var _iterator89=_createForOfIteratorHelper($m(t)),_step89;try{for(_iterator89.s();!(_step89=_iterator89.n()).done;){var i=_step89.value;Nw.call(t,i)&&Gm(e,i,t[i])}}catch(err){_iterator89.e(err)}finally{_iterator89.f()}}return e},Fs=function Fs(e,t){return Aw(e,Ow(t))},BT=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},Km=/*#__PURE__*/function(){function Km(){_classCallCheck(this,Km)}_createClass(Km,[{key:"create",value:function create(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new Ym(e)}}]);return Km}(),Xm=/*#__PURE__*/function(){function Xm(e){_classCallCheck(this,Xm);this.callbacks=Object.freeze(this.wrapCallbacks(e))}_createClass(Xm,[{key:"wrapCallbacks",value:function wrapCallbacks(e){var t={};var _iterator90=_createForOfIteratorHelper(Xm.callbackKeys),_step90;try{var _loop12=function _loop12(){var i=_step90.value;var r=e[i];r?t[i]=r:t[i]=function(){throw new Error("can't call. ".concat(i," not register"))}};for(_iterator90.s();!(_step90=_iterator90.n()).done;){_loop12()}}catch(err){_iterator90.e(err)}finally{_iterator90.f()}return Object.freeze(t)}},{key:"convertIdToUrl",value:function convertIdToUrl(e){return this.callbacks.convertIdToUrl(e)}}]);return Xm}(),Ym=Xm;Ym.callbackKeys=Object.freeze(["convertIdToUrl"]);var ur=/*#__PURE__*/function(){function ur(){_classCallCheck(this,ur);this.paddingResolves=[]}_createClass(ur,[{key:"hasValue",get:function get(){return!this.paddingResolves}},{key:"getValueRightNow",value:function getValueRightNow(){return this.value}},{key:"getValue",value:function getValue(){var _this66=this;return this.hasValue?this.error?Promise.reject(this.error):Promise.resolve(this.value):new Promise(function(e,t){return _this66.paddingResolves.push({resolve:e,reject:t})})}},{key:"catchError",value:function catchError(e){if(!this.hasValue){var _iterator91=_createForOfIteratorHelper(this.paddingResolves),_step91;try{for(_iterator91.s();!(_step91=_iterator91.n()).done;){var t=_step91.value.reject;t(e)}}catch(err){_iterator91.e(err)}finally{_iterator91.f()}this.value=void 0,this.error=e,this.paddingResolves=null}return this}},{key:"setValue",value:function setValue(e){if(this.hasValue)throw new Error("did set value");this.value=e,this.error=void 0;var _iterator92=_createForOfIteratorHelper(this.paddingResolves),_step92;try{for(_iterator92.s();!(_step92=_iterator92.n()).done;){var t=_step92.value.resolve;t(e)}}catch(err){_iterator92.e(err)}finally{_iterator92.f()}return this.paddingResolves=null,this}}]);return ur}(),rh=/*#__PURE__*/function(_Error5){_inherits(rh,_Error5);var _super26=_createSuper(rh);function rh(e){var _this67;_classCallCheck(this,rh);_this67=_super26.call(this,rh.createMessage(e));_this67.name=e.title,_this67.title=e.title,_this67.messages=e.messages?Object.freeze(_toConsumableArray(e.messages)):rh.emptyArray,_this67.statusCode=e.statusCode,_this67.errorCode=e.errorCode;return _this67}_createClass(rh,null,[{key:"createMessage",value:function createMessage(e){var t=e.title;return e.messages&&e.messages.length>0&&(t+=": "+e.messages.join("; ")),t}}]);return rh}(/*#__PURE__*/_wrapNativeSuper(Error)),Qm=rh;Qm.emptyArray=Object.freeze([]);var qm=/*#__PURE__*/function(){function qm(e,t,i,r){var _this68=this;_classCallCheck(this,qm);this.keyFetcherValue=new ur,this.akkoVersionValue=t,e.getValue().then(function(n){return _this68.keyFetcherValue.setValue(n.getFetcher(i).fetch(r))})["catch"](function(n){return _this68.keyFetcherValue.catchError(n)})}_createClass(qm,[{key:"akkoVersion",get:function get(){return this.akkoVersionValue.getValue()}},{key:"fetchJSON",value:function(){var _fetchJSON=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee5(e,t){var i,r;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this.keyFetcherValue.getValue();case 2:_context5.t0=_context5.sent;_context5.next=5;return(0,_context5.t0)(e,t);case 5:i=_context5.sent;if(!this.isSuccessStatus(i,t)){_context5.next=13;break}_context5.next=9;return i.text();case 9:r=_context5.sent;return _context5.abrupt("return",r===""?void 0:JSON.parse(r));case 13:_context5.next=15;return this.createError(i);case 15:throw _context5.sent;case 16:case"end":return _context5.stop();}}},_callee5,this)}));function fetchJSON(_x7,_x8){return _fetchJSON.apply(this,arguments)}return fetchJSON}()},{key:"fetchBuffer",value:function(){var _fetchBuffer=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee6(e,t){var i;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return this.keyFetcherValue.getValue();case 2:_context6.t0=_context6.sent;_context6.next=5;return(0,_context6.t0)(e,t);case 5:i=_context6.sent;if(!(i.status===404)){_context6.next=8;break}return _context6.abrupt("return",null);case 8:if(!this.isSuccessStatus(i,t)){_context6.next=23;break}if(!i.arrayBuffer){_context6.next=17;break}_context6.t2=ri;_context6.next=13;return i.arrayBuffer();case 13:_context6.t3=_context6.sent;_context6.t1=(0,_context6.t2)(_context6.t3);_context6.next=22;break;case 17:_context6.t4=ri;_context6.next=20;return i.buffer();case 20:_context6.t5=_context6.sent;_context6.t1=(0,_context6.t4)(_context6.t5);case 22:return _context6.abrupt("return",_context6.t1);case 23:_context6.next=25;return this.createError(i);case 25:throw _context6.sent;case 26:case"end":return _context6.stop();}}},_callee6,this)}));function fetchBuffer(_x9,_x10){return _fetchBuffer.apply(this,arguments)}return fetchBuffer}()},{key:"createError",value:function(){var _createError=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee7(e){var t,i,_i$error,r,n,s;return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:t=e.headers.get("content-type");if(!(!t||/application\/json/i.test(t))){_context7.next=17;break}_context7.prev=2;_context7.next=5;return e.json();case 5:i=_context7.sent;_context7.next=11;break;case 8:_context7.prev=8;_context7.t0=_context7["catch"](2);return _context7.abrupt("return",new Error("response with status "+e.status+" and parse error JSON failed: "+_context7.t0.message));case 11:if(!(_typeof(i.error)!="object"||i.error===null)){_context7.next=13;break}return _context7.abrupt("return",new Error("response with status "+e.status+" without error object"));case 13:_i$error=i.error,r=_i$error.code,n=_i$error.title,s=_i$error.messages;return _context7.abrupt("return",new Qm({statusCode:e.status,errorCode:r,title:n,messages:s}));case 17:_context7.t1=Error;_context7.t2="response with status "+e.status+" with text ";_context7.next=21;return e.text();case 21:_context7.t3=_context7.sent;_context7.t4=_context7.t2+_context7.t3;return _context7.abrupt("return",new _context7.t1(_context7.t4));case 24:case"end":return _context7.stop();}}},_callee7,null,[[2,8]])}));function createError(_x11){return _createError.apply(this,arguments)}return createError}()},{key:"isSuccessStatus",value:function isSuccessStatus(e,t){var i=e.status;switch(t&&t.method||"get"){case"get":return i===200||i===206;case"delete":return i===204;default:return i===201;}}}]);return qm}(),Jm=/*#__PURE__*/function(){function Jm(e,t){_classCallCheck(this,Jm);this.configmap=e,this.onIngoreFetchError=t,this.fetchers={},this.supportRegions=this.collectRegions(e)}_createClass(Jm,[{key:"collectRegions",value:function collectRegions(e){var t={};for(var i in e){for(var r in e[i].hosts){t[r]=!0}}return t}},{key:"getFetcher",value:function getFetcher(e){var t=this.fetchers[e];if(!t){if(!this.supportRegions[e])throw new Error("invalid region ".concat(JSON.stringify(e)));t=this.fetchers[e]=new Oi({fetcher:fetch.bind(window),region:e,configmap:this.configmap,onIngoreFetchError:this.onIngoreFetchError,retryCount:2,retryLoopsCount:0})}return t}}]);return Jm}();function ef(e){if(_typeof(e)=="object"&&e!==null){for(var t in e){ef(e[t])}Object.freeze(e)}return e}function nh(e){if(_typeof(e)!="object"||e===null)return e;if(e instanceof Array){var t=[];for(var i=0;i<e.length;++i){t[i]=nh(e[i])}return t}else{var _t6={};for(var _i27 in e){_t6[_i27]=nh(e[_i27])}return _t6}}var Lw=/*#__PURE__*/function(){function Lw(){_classCallCheck(this,Lw);this.node=null}_createClass(Lw,[{key:"getAkkoAppConfigs",value:function(){var _getAkkoAppConfigs=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee8(e,t,i){var _this69=this;var r;return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(!this.node||this.node.appIdentifier!==e){r=new ur;this.node=Object.freeze({appIdentifier:e,configsValue:r}),this.fetchAkkoAppConfigs(e,t,i).then(function(n){return r.setValue(ef(n))})["catch"](function(n){r.catchError(n),setTimeout(function(){return _this69.node=null},0)})}_context8.t0=nh;_context8.next=4;return this.node.configsValue.getValue();case 4:_context8.t1=_context8.sent;return _context8.abrupt("return",(0,_context8.t0)(_context8.t1));case 6:case"end":return _context8.stop();}}},_callee8,this)}));function getAkkoAppConfigs(_x12,_x13,_x14){return _getAkkoAppConfigs.apply(this,arguments)}return getAkkoAppConfigs}()},{key:"fetchAkkoAppConfigs",value:function(){var _fetchAkkoAppConfigs=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee9(e,t,i){var r,n,s,o,a,c;return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:r={api:{hosts:{"*":t}}},n=new Jm(r,i),s=new ur().setValue(n),o=new ur,a=new qm(s,o,"*","api"),c=(0,Zm.stringify)({app:e});_context9.next=3;return a.fetchJSON("https://shunt-api/v5/configs/regions?".concat(c));case 3:return _context9.abrupt("return",_context9.sent);case 4:case"end":return _context9.stop();}}},_callee9)}));function fetchAkkoAppConfigs(_x15,_x16,_x17){return _fetchAkkoAppConfigs.apply(this,arguments)}return fetchAkkoAppConfigs}()}]);return Lw}(),Dw=new Lw;function Fw(e,t,i){return Dw.getAkkoAppConfigs(e,t,i)}var tf;(function(e){e[e.Ready=0]="Ready",e[e.Setuping=1]="Setuping",e[e.Fail=2]="Fail"})(tf||(tf={}));var Bw=/*#__PURE__*/function(){function Bw(e){var _this70=this;_classCallCheck(this,Bw);this.fetcherPhase=1,this.getAkkoFetcher=/*#__PURE__*/function(){var _ref20=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee10(t){return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_this70.fetcherPhase===2&&_this70.setupFetcher();_context10.next=3;return _this70.fetchersHubValue.getValue();case 3:return _context10.abrupt("return",_context10.sent.getFetcher(t));case 4:case"end":return _context10.stop();}}},_callee10)}));return function(_x18){return _ref20.apply(this,arguments)}}(),this.onIngoreFetchError=function(t){console.warn("fetch failed but ignore: ".concat(t.message))},this.params=Object.freeze(Fs(Wt({},e),{shuntApiHosts:Object.freeze(_toConsumableArray(e.shuntApiHosts))})),this.akkoVersionValue=new ur,this.setupFetcher()}_createClass(Bw,[{key:"create",value:function create(e){return new jw(this.fetchersHubValue,this.akkoVersionValue,this.getAkkoFetcher,e)}},{key:"setupFetcher",value:function(){var _setupFetcher=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee11(){var _this$params,e,t,i,r,n;return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_this$params=this.params,e=_this$params.appIdentifier,t=_this$params.shuntApiHosts,i=_this$params.onInterruptConfigs,r=_this$params.onAkkoSetupFailed;_context11.prev=1;this.fetchersHubValue=new ur,this.fetcherPhase=1;_context11.next=5;return Fw(e,t,this.onIngoreFetchError);case 5:n=_context11.sent;i&&(n=i(n)),this.akkoVersionValue.setValue(n.akkoVersion),this.fetchersHubValue.setValue(new Jm(n.configmap,this.onIngoreFetchError)),this.fetcherPhase=0;_context11.next=12;break;case 9:_context11.prev=9;_context11.t0=_context11["catch"](1);this.fetchersHubValue.catchError(new Error("akko setup failed: ".concat(_context11.t0.message))),this.fetcherPhase=2,r&&r(_context11.t0);case 12:case"end":return _context11.stop();}}},_callee11,this,[[1,9]])}));function setupFetcher(){return _setupFetcher.apply(this,arguments)}return setupFetcher}()}]);return Bw}(),jw=/*#__PURE__*/function(){function jw(e,t,i,r){_classCallCheck(this,jw);this.fetchersHubValue=e,this.akkoVersionValue=t,this.getAkkoFetcher=i,this.region=r}_createClass(jw,[{key:"fetch",value:function(){var _fetch=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee12(e){return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:return _context12.abrupt("return",new qm(this.fetchersHubValue,this.akkoVersionValue,this.region,e));case 1:case"end":return _context12.stop();}}},_callee12,this)}));function fetch(_x19){return _fetch.apply(this,arguments)}return fetch}()},{key:"origin",value:function(){var _origin=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee13(e,t){return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.next=2;return this.getAkkoFetcher(this.region);case 2:return _context13.abrupt("return",_context13.sent.origin(e,t));case 3:case"end":return _context13.stop();}}},_callee13,this)}));function origin(_x20,_x21){return _origin.apply(this,arguments)}return origin}()},{key:"reportSuccess",value:function reportSuccess(e,t){this.getAkkoFetcher(this.region).then(function(i){i.reportSuccess(e,t)})}},{key:"reportFail",value:function reportFail(e,t){this.getAkkoFetcher(this.region).then(function(i){i.reportFail(e,t)})}},{key:"akkoVersion",get:function get(){return this.akkoVersionValue.getValue()}}]);return jw}(),zw=/*#__PURE__*/function(){function zw(e,t){var _this71=this;_classCallCheck(this,zw);this.netState=e,this.onNetStateUpdate=t,this.paddingResolver=[],this._didDispose=!1,this.onOnline=function(){_this71._isOnline=!0,_this71.onNetStateUpdate&&_this71.onNetStateUpdate(!0),_this71.handleAllPaddingResolver(!0)},this.onOffline=function(){_this71._isOnline=!1,_this71.onNetStateUpdate&&_this71.onNetStateUpdate(!1)},e.addListener(this.listener={onOnline:this.onOnline,onOffline:this.onOffline}),this._isOnline=e.isOnline}_createClass(zw,[{key:"isOnline",get:function get(){return this._isOnline}},{key:"didDispose",get:function get(){return this._didDispose}},{key:"dispose",value:function dispose(){try{this.handleAllPaddingResolver(!1),this.netState.removeListener(this.listener)}finally{this._didDispose=!0}}},{key:"makeSureOnline",value:function makeSureOnline(){var _this72=this;return this._didDispose?Promise.resolve(!1):this._isOnline?Promise.resolve(!0):new Promise(function(e){_this72.paddingResolver.push(e)})}},{key:"handleAllPaddingResolver",value:function handleAllPaddingResolver(e){var _iterator93=_createForOfIteratorHelper(this.paddingResolver.splice(0,this.paddingResolver.length)),_step93;try{for(_iterator93.s();!(_step93=_iterator93.n()).done;){var t=_step93.value;t(e)}}catch(err){_iterator93.e(err)}finally{_iterator93.f()}}}]);return zw}();function Uw(){return typeof WebSocket!="undefined"?WebSocket:global.WebSocket}var Vw=Uw();function Ww(e,t){var i={room:t.uuid,token:e,combinable:!0,sessionToken:t.sessionToken,akkoVersion:t.akkoVersion,clientVersion:t.clientVersion,markWritable:t.markWritable,access:t.access};for(var r in i){i[r]===void 0&&delete i[r]}return(0,rf.stringify)(i)}var Hw=/*#__PURE__*/function(){function Hw(e,_ref21){var _this73=this;var t=_ref21.logger,i=_ref21.timeout,r=_ref21.roomToken,n=_ref21.webSocketQuery,s=_ref21.callbacks;_classCallCheck(this,Hw);this.disconnectedCallbacks=[],this.actionFramesInterrupter=[],this.snapshotFrameInterrupter=null,this._connectingDuration=-1,this.onReceiveSnapshotFrame=function(c){_this73.snapshotFrameInterrupter=c},this.onReceiveActionFrame=function(c){_this73.actionFramesInterrupter?_this73.actionFramesInterrupter.push(c):_this73.callbacks.onReceivedActionFrame(c)},this.onReceiveScopeSlices=function(c){_this73.callbacks.onReceivedScopeSlices(ym(c))},this.onHangUp=function(){_this73.socket.disconnect(),_this73.callbacks.onKickWithReason(ji.GatewayAdjust)},this.onDisconnect=function(_ref22){var c=_ref22.reason,h=_ref22.message;var d=_this73.isConnected();_this73._sessionBuild=void 0;var u=c===wt.WebSocketError||c===wt.CommunicationError;if(_this73.disconnectedCallback(h,u),d)switch(c){case wt.WebSocketError:case wt.CommunicationError:{_this73.callbacks.onDisconnectedWithSocketError(new Error(h));break}case wt.Normal:{_this73.callbacks.onKickWithReason(h);break}case wt.RemoteError:{_this73.callbacks.onDisconnectedByServer(new Error(h));break}}};var o="".concat(e,"?").concat(Ww(r,n)),a=new Vw(o);this.logger=t,this.timeout=i,this.uuid=n.uuid,this.libraryDescriptionSerialization=new um,this.socket=Jo.createSocket(a,t,{onDisconnect:this.onDisconnect}),this.socket.on("snapshot",this.onReceiveSnapshotFrame),this.socket.on("action",this.onReceiveActionFrame),this.socket.on("allocate-scope",this.onReceiveScopeSlices),this.socket.on("hang-up",this.onHangUp),this.callbacks=Object.freeze(Wt({},s))}_createClass(Hw,[{key:"connectingDuration",get:function get(){return this._connectingDuration}},{key:"setAccessUpdaterSerialization",value:function setAccessUpdaterSerialization(e){this.accessUpdaterSerialization=e}},{key:"bindPingPongNode",value:function bindPingPongNode(e){e.bindSocket(this.socket)}},{key:"sessionBuild",get:function get(){if(!this._sessionBuild)throw new Error("not connected");return this._sessionBuild}},{key:"sendActionFrame",value:function sendActionFrame(e){this.socket.emit("action",e)}},{key:"isConnected",value:function isConnected(){return!!this._sessionBuild}},{key:"connect",value:function connect(){var _this74=this;return new Promise(function(e,t){var i=function i(){var a=_this74.disconnectedCallbacks.indexOf(n);a!==-1&&_this74.disconnectedCallbacks.splice(a,1),r!==null&&(clearTimeout(r),r=null),_this74.socket.off("session-build",s)},r=setTimeout(function(){i(),t(new Error("receive session-build event timeout"))},_this74.timeout),n=function n(a,c){i(),c?e(a):t(new Error("connect failed: ".concat(a)))};_this74.disconnectedCallbacks.push(n);var s=function s(a){i();var c=_this74.snapshotFrameInterrupter,h=_this74.actionFramesInterrupter;_this74._sessionBuild=pm(a),_this74.snapshotFrameInterrupter=null,_this74.actionFramesInterrupter=null,e({snapshot:c,actionFrames:h})},o=function o(a){var c=_this74.libraryDescriptionSerialization.deserialize(a);_this74.callbacks.onReceivedLibraryDescription(c),_this74.socket.off("library-description",o)};_this74.socket.on("session-build",s),_this74.socket.on("library-description",o),_this74.socket.waitToConnected().then(function(_ref23){var a=_ref23.duration;return _this74._connectingDuration=a})["catch"](function(a){_this74.logger.warn(a.message),n(a.message,!0)})})}},{key:"disconnect",value:function disconnect(){return this.disconnectedCallback("disconnect",!1),this.socket.disconnect()}},{key:"disconnectWithError",value:function disconnectWithError(e){return this.disconnectedCallback(e.message,!1),this.socket.disconnectWithErrorDescription({message:e.message})}},{key:"updateToWritable",value:function(){var _updateToWritable=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee14(e,t){var i,r;return regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:i={kind:zi.Writable,userPayload:e,connectedPayload:t};this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(i));_context14.next=4;return this.interruptEvent("allocate-user",[ut.WritableAccessForbidden,ut.StuffedOfWritableUsers,ut.WrongWritablePhase]);case 4:r=_context14.sent;if(!(r.errorCode!==void 0)){_context14.next=12;break}_context14.t0=r.errorCode;_context14.next=_context14.t0===ut.WritableAccessForbidden?9:_context14.t0===ut.StuffedOfWritableUsers?10:_context14.t0===ut.WrongWritablePhase?11:12;break;case 9:throw new Error("can't update to writable. you don't have permission");case 10:throw new Error("room is stuffed of writable users");case 11:throw new Error("it's wrong writable phase");case 12:return _context14.abrupt("return",r.target!==void 0?dm(r.target):null);case 13:case"end":return _context14.stop();}}},_callee14,this)}));function updateToWritable(_x22,_x23){return _updateToWritable.apply(this,arguments)}return updateToWritable}()},{key:"updateToReadonly",value:function(){var _updateToReadonly=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee15(e){var t,i;return regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:t={kind:zi.Readonly,payload:e};this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(t));_context15.next=4;return this.interruptEvent("release-user",[ut.NoUserToRelease,ut.WrongWritablePhase]);case 4:i=_context15.sent;if(!(i.errorCode!==void 0)){_context15.next=11;break}_context15.t0=i.errorCode;_context15.next=_context15.t0===ut.NoUserToRelease?9:_context15.t0===ut.WrongWritablePhase?10:11;break;case 9:throw new Error("room don't have user to release");case 10:throw new Error("it's wrong writable phase");case 11:return _context15.abrupt("return",i.target!==void 0);case 12:case"end":return _context15.stop();}}},_callee15,this)}));function updateToReadonly(_x24){return _updateToReadonly.apply(this,arguments)}return updateToReadonly}()},{key:"disconnectedCallback",value:function disconnectedCallback(e,t){var _iterator94=_createForOfIteratorHelper(this.disconnectedCallbacks.splice(0)),_step94;try{for(_iterator94.s();!(_step94=_iterator94.n()).done;){var i=_step94.value;i(e,t)}}catch(err){_iterator94.e(err)}finally{_iterator94.f()}}},{key:"interruptEvent",value:function interruptEvent(e,t){var _this75=this;return new Promise(function(i){var r=function r(){var a=_this75.disconnectedCallbacks.indexOf(n);a!==-1&&_this75.disconnectedCallbacks.splice(a,1),_this75.socket.off(e,s),_this75.socket.off("error",o)},n=function n(){r(),i({})};_this75.disconnectedCallbacks.push(n);var s=function s(a){r(),i({target:a})},o=function o(a){t.indexOf(a)!==-1&&(r(),i({errorCode:a}))};_this75.socket.on(e,s),_this75.socket.on("error",o)})}}]);return Hw}(),_w=/*#__PURE__*/function(){function _w(){_classCallCheck(this,_w);this.switchOn=!0}_createClass(_w,[{key:"wrapCallbacks",value:function wrapCallbacks(e){var _this76=this;var t={};var _loop13=function _loop13(i){var r=e[i];typeof r=="function"?t[i]=function(){for(var _len16=arguments.length,n=new Array(_len16),_key16=0;_key16<_len16;_key16++){n[_key16]=arguments[_key16]}if(_this76.switchOn)return r.apply(t,n)}:t[i]=r};for(var i in e){_loop13(i)}return Object.freeze(t)}}]);return _w}(),nf=Object.freeze([1e3,1e3,1e3,3e3,3e3,5e3,5e3]);function $w(e){return new Promise(function(t){return setTimeout(t,e)})}var Gw=/*#__PURE__*/function(){function Gw(e,t,i){var _this77=this;_classCallCheck(this,Gw);this._didDispose=!1,this.connectionTask=null,this.operator=null,this.connectionNode=null,this.onNetStateUpdate=function(r){_this77._didDispose||(r?_this77.connectionTask&&_this77.startConnectionTask():_this77.operator&&(_this77.operator.cancel(),_this77.operator=null))},this.logger=e,this.fetcher=t,this.netStatePaddingNode=i&&new zw(i,this.onNetStateUpdate)}_createClass(Gw,[{key:"dispose",value:function dispose(){this._didDispose||(this._didDispose=!0,this.operator&&this.operator.cancel(),this.connectionTask=null,this.operator=null,this.netStatePaddingNode&&this.netStatePaddingNode.dispose())}},{key:"connect",value:function(){var _connect2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee16(e){var _this78=this;var t;return regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:if(!this._didDispose){_context16.next=2;break}throw new Error("did dispose");case 2:if(!this.connectionTask){_context16.next=4;break}throw new Error("is connecting");case 4:this.connectionNode&&(this.connectionNode.filter.switchOn=!1,this.connectionNode=null);_context16.t0=this.netStatePaddingNode;if(!_context16.t0){_context16.next=10;break}_context16.next=9;return this.netStatePaddingNode.makeSureOnline();case 9:_context16.t0=!_context16.sent;case 10:if(!_context16.t0){_context16.next=12;break}throw new Error("offline");case 12:t=new Promise(function(i,r){var n=new _w;_this78.connectionTask={resolve:i,reject:r,filter:n,params:Fs(Wt({},e),{callbacks:n.wrapCallbacks(e.callbacks)})}});this.startConnectionTask();_context16.prev=14;_context16.next=17;return t;case 17:return _context16.abrupt("return",_context16.sent);case 18:_context16.prev=18;this.connectionTask=null;return _context16.finish(18);case 21:case"end":return _context16.stop();}}},_callee16,this,[[14,,18,21]])}));function connect(_x25){return _connect2.apply(this,arguments)}return connect}()},{key:"startConnectionTask",value:function startConnectionTask(){var _this79=this;var e=new Kw(this.logger,this.fetcher),_this$connectionTask=this.connectionTask,t=_this$connectionTask.params,i=_this$connectionTask.filter,r=_this$connectionTask.resolve,n=_this$connectionTask.reject;this.operator=e,this.operator.connect(t).then(function(s){s&&e===_this79.operator&&(r(s),_this79.operator=null,_this79.connectionNode={filter:i,connection:s.connection})})["catch"](function(s){e===_this79.operator&&(n(s),_this79.operator=null)})}}]);return Gw}(),Kw=/*#__PURE__*/function(){function Kw(e,t){_classCallCheck(this,Kw);this.logger=e,this.fetcher=t,this.connection=null,this.isCancel=!1}_createClass(Kw,[{key:"connect",value:function(){var _connect3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee17(e){var t,i,r,n,s,o,a;return regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:t="";i=0;case 2:if(!(i<nf.length+1)){_context17.next=33;break}_context17.next=5;return this.fetcher.origin("wss","realtime");case 5:r=_context17.sent;n=Date.now();this.connection=new Hw(r,e);s=Date.now();_context17.next=11;return this.connection.connect();case 11:o=_context17.sent;if(!this.isCancel){_context17.next=19;break}this.fetcher.reportSuccess("realtime",Date.now()-n);_context17.t0=o&&this.connection;if(!_context17.t0){_context17.next=18;break}_context17.next=18;return this.connection.disconnectWithError(new Error("cancel connect"));case 18:return _context17.abrupt("return",null);case 19:if(!(_typeof(o)=="object")){_context17.next=21;break}return _context17.abrupt("return",(this.fetcher.reportSuccess("realtime",Date.now()-n),{connection:this.connection,snapshot:o.snapshot,actionFrames:o.actionFrames,retryCount:i}));case 21:this.fetcher.reportFail("realtime",Date.now()-n),t=o,this.connection=null;a=nf[i];_context17.t1=a!==void 0&&s+a-Date.now()>0;if(!_context17.t1){_context17.next=28;break}_context17.next=27;return $w(a);case 27:_context17.t1=this.isCancel;case 28:if(!_context17.t1){_context17.next=30;break}return _context17.abrupt("return",null);case 30:++i;_context17.next=2;break;case 33:throw new Error("connect fail after multiple retries: "+t);case 34:case"end":return _context17.stop();}}},_callee17,this)}));function connect(_x26){return _connect3.apply(this,arguments)}return connect}()},{key:"cancel",value:function cancel(){var _this80=this;this.connection&&(this.connection.disconnectWithError(new Error("cancel connect"))["catch"](function(e){return _this80.logger.error(e)}),this.connection=null),this.isCancel=!0}}]);return Kw}();function sh(e){var t=qo(e);if(!t)throw new Error("can't find library from ".concat(e.name,". it's not root class"));return t}var sf=function sf(){};function Xw(_x27){return _Xw.apply(this,arguments)}function _Xw(){_Xw=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee108(e){var t,i;return regeneratorRuntime.wrap(function _callee108$(_context112){while(1){switch(_context112.prev=_context112.next){case 0:t=new Yw(e);_context112.next=3;return t.connect();case 3:i=_context112.sent;return _context112.abrupt("return",{session:t,snapshot:i.snapshot,actionFrames:i.actionFrames,connection:i.connection,retryCount:i.retryCount});case 5:case"end":return _context112.stop();}}},_callee108)}));return _Xw.apply(this,arguments)}var Yw=/*#__PURE__*/function(){function Yw(e){var _this81=this;_classCallCheck(this,Yw);this.connectingResult=null,this._connection=null,this._libraryNode=null,this.onDisconnectedByServer=function(t){_this81._connection=null,_this81._libraryNode=null,_this81.callbacks.onDisconnectedByServer&&_this81.callbacks.onDisconnectedByServer(t)},this.onKickWithReason=function(t){_this81._connection=null,_this81._libraryNode=null,!_this81.reconnectionOptions.disableReconnect&&(t===ji.GatewayAdjust||t===ji.RoomZombie)?_this81.startReconnect(new Error("room became zombie")):_this81.callbacks.onKickWithReason&&_this81.callbacks.onKickWithReason(t)},this.onDisconnectedWithSocketError=/*#__PURE__*/function(){var _ref24=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee18(t){return regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:_this81._connection=null;_this81._libraryNode=null;if(!_this81.reconnectionOptions.disableReconnect){_context18.next=6;break}_this81.callbacks.onDisconnectedWithSocketError&&_this81.callbacks.onDisconnectedWithSocketError(t);_context18.next=8;break;case 6:_context18.next=8;return _this81.startReconnect(t);case 8:case"end":return _context18.stop();}}},_callee18)}));return function(_x28){return _ref24.apply(this,arguments)}}(),this.logger=e.logger,this.uuid=e.uuid,this.roomToken=e.roomToken,this.timeout=e.timeout,this.markWritable=e.markWritable,this.clientVersion=e.clientVersion,this.reconnectionOptions=e.reconnectionOptions,this.access=e.access,this.objectOperator=e.objectOperator,this.libraryNodeFetcher=e.libraryNodeFetcher,this.connectionBuilder=new Gw(e.logger,e.fetcher,e.netState),this.callbacks=Object.freeze(Wt({},e.callbacks))}_createClass(Yw,[{key:"session",get:function get(){return this.sessionBuild.session}},{key:"slice",get:function get(){return this.sessionBuild.slice}},{key:"connection",get:function get(){return this._connection}},{key:"libraryNode",get:function get(){return this._libraryNode}},{key:"dispose",value:function dispose(){this.connectionBuilder.dispose()}},{key:"connect",value:function(){var _connect4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee19(){var e,t,i,_i$connection$session,r,n;return regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:if(!this.connectingResult){_context19.next=2;break}throw new Error("WebSocketSession is connecting");case 2:e=new ur,t=this.connectingResult=new ur;_context19.prev=3;_context19.next=6;return this.connectionBuilder.connect({logger:this.logger,roomToken:this.roomToken,timeout:this.timeout,webSocketQuery:{uuid:this.uuid,akkoVersion:Oe,clientVersion:this.clientVersion,markWritable:this.markWritable,access:this.access,sessionToken:this.sessionBuild&&this.sessionBuild.sessionToken},callbacks:{onReceivedLibraryDescription:this.createLibraryDescriptionReceiver(e),onReceivedActionFrame:this.callbacks.onReceivedActionFrame||sf,onReceivedScopeSlices:this.callbacks.onReceivedScopeSlices||sf,onDisconnectedByServer:this.onDisconnectedByServer,onKickWithReason:this.onKickWithReason,onDisconnectedWithSocketError:this.onDisconnectedWithSocketError}});case 6:i=_context19.sent;if(this.sessionBuild){_i$connection$session=i.connection.sessionBuild,r=_i$connection$session.session,n=_i$connection$session.slice;this.callbacks.onSessionUpdate&&this.sessionBuild.session!==r&&this.callbacks.onSessionUpdate(r),this.callbacks.onSliceUpdate&&this.sessionBuild.slice!==n&&this.callbacks.onSliceUpdate(n)}this._connection=i.connection;_context19.next=11;return e.getValue();case 11:this._libraryNode=_context19.sent;this.sessionBuild=i.connection.sessionBuild;this._connection.setAccessUpdaterSerialization(new Zo(this.objectOperator,sh(this._libraryNode.libraryClass)));this.connectingResult=null;t.setValue(i);return _context19.abrupt("return",i);case 19:_context19.prev=19;_context19.t0=_context19["catch"](3);throw e.catchError(_context19.t0),t.catchError(_context19.t0),_context19.t0;case 22:case"end":return _context19.stop();}}},_callee19,this,[[3,19]])}));function connect(){return _connect4.apply(this,arguments)}return connect}()},{key:"reconnectWithError",value:function reconnectWithError(e){this._connection&&(this._connection.disconnect(),this._connection=null,this._libraryNode=null),this.startReconnect(e)}},{key:"createLibraryDescriptionReceiver",value:function createLibraryDescriptionReceiver(e){var _this82=this;return/*#__PURE__*/function(){var _ref25=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee20(t){return regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_context20.prev=0;_context20.t0=e;_context20.next=4;return _this82.libraryNodeFetcher(t);case 4:_context20.t1=_context20.sent;_context20.t0.setValue.call(_context20.t0,_context20.t1);_context20.next=11;break;case 8:_context20.prev=8;_context20.t2=_context20["catch"](0);e.catchError(_context20.t2);case 11:case"end":return _context20.stop();}}},_callee20,null,[[0,8]])}));return function(_x29){return _ref25.apply(this,arguments)}}()}},{key:"startReconnect",value:function(){var _startReconnect=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee21(e){var _this$callbacks,t,i,r;return regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:if(!this.connectingResult){_context21.next=5;break}_context21.next=3;return this.connectingResult.getValue();case 3:_context21.next=0;break;case 5:_context21.prev=5;_this$callbacks=this.callbacks,t=_this$callbacks.onBeginReconnect,i=_this$callbacks.onReconnected;t&&Promise.resolve().then(function(){return t(e)});_context21.next=10;return this.connect();case 10:r=_context21.sent;i&&Promise.resolve().then(function(){return i(r)});_context21.next=17;break;case 14:_context21.prev=14;_context21.t0=_context21["catch"](5);this.callbacks.onDisconnectedWithSocketError&&this.callbacks.onDisconnectedWithSocketError(_context21.t0);case 17:case"end":return _context21.stop();}}},_callee21,this,[[5,14]])}));function startReconnect(_x30){return _startReconnect.apply(this,arguments)}return startReconnect}()}]);return Yw}(),Qw=Object.freeze({disableReconnect:!1});function qw(e){return e===!1?{disableReconnect:!0}:Wt(Wt({},Qw),e)}var of;(function(e){e[e.Success=0]="Success",e[e.Break=1]="Break"})(of||(of={}));var pr=/*#__PURE__*/function(){function pr(e){var _this83=this;_classCallCheck(this,pr);this.idle=Do({timeout:800,checkingTimeMod:2,maxPaddingDuration:1600,maxInvokingDuration:100}),this.nextId=0,this.socket=null,this.pingProgress=null,this.promiseSleep=null,this.deltaTime=void 0,this.latestAdjustedTimestamp=0,this.isFirstAdjustedTime=!0,this.onPong=function(t){var _fm=fm(t),i=_fm.id,r=_fm.timestamp;if(_this83.pingProgress){var _this83$pingProgress=_this83.pingProgress,n=_this83$pingProgress.id,s=_this83$pingProgress.padding,o=_this83$pingProgress.timer,a=_this83$pingProgress.timestamp;if(n===i){clearTimeout(o);var c={remoteTimestamp:r,shouldBreak:!1,sendAt:a,receivedAt:Date.now()};var _iterator95=_createForOfIteratorHelper(s),_step95;try{for(_iterator95.s();!(_step95=_iterator95.n()).done;){var h=_step95.value.resolve;h(c)}}catch(err){_iterator95.e(err)}finally{_iterator95.f()}_this83.pingProgress=null}}},this.onPingFailed=e}_createClass(pr,[{key:"calibrationTimestamp",get:function get(){if(this.deltaTime===void 0)return Date.now();{var e=Math.max(this.latestAdjustedTimestamp,Date.now()+this.deltaTime);return this.latestAdjustedTimestamp=e,e}}},{key:"bindSocket",value:function bindSocket(e){this.socket&&this.unbindSocket(),this.socket=e,this.socket.on("pong",this.onPong),this.handleStartPingLoop()["catch"](this.onPingFailed)}},{key:"unbindSocket",value:function unbindSocket(){if(this.socket&&(this.socket.off("pong",this.onPong),this.socket=null),this.promiseSleep&&(clearTimeout(this.promiseSleep.sleepTimer),this.promiseSleep.resolve(1),this.promiseSleep=null),this.pingProgress){var e={shouldBreak:!0,remoteTimestamp:0,sendAt:0,receivedAt:0};var _iterator96=_createForOfIteratorHelper(this.pingProgress.padding),_step96;try{for(_iterator96.s();!(_step96=_iterator96.n()).done;){var t=_step96.value.resolve;t(e)}}catch(err){_iterator96.e(err)}finally{_iterator96.f()}this.pingProgress=null}}},{key:"handleStartPingLoop",value:function(){var _handleStartPingLoop=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee23(){var _this84=this;var _loop14,_ret;return regeneratorRuntime.wrap(function _callee23$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:_loop14=/*#__PURE__*/regeneratorRuntime.mark(function _loop14(){var e,t,i;return regeneratorRuntime.wrap(function _loop14$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:e=0;t=0;_context23.next=4;return _this84.doProgress(_this84.onPingFailed,/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee22(){var _yield$_this84$startP,r,n,s,o,a;return regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:_context22.next=2;return _this84.startPing();case 2:_yield$_this84$startP=_context22.sent;r=_yield$_this84$startP.shouldBreak;n=_yield$_this84$startP.remoteTimestamp;s=_yield$_this84$startP.sendAt;o=_yield$_this84$startP.receivedAt;if(!r){_context22.next=9;break}return _context22.abrupt("return",1);case 9:a=o-s;return _context22.abrupt("return",(e+=n+a/2-o,t+=1,_this84.isFirstAdjustedTime&&_this84.updateDeltaTime(Math.floor(e/t)),0));case 11:case"end":return _context22.stop();}}},_callee22)})));case 4:i=_context23.sent;_context23.t0=i===1;if(_context23.t0){_context23.next=12;break}_this84.isFirstAdjustedTime?_this84.isFirstAdjustedTime=!1:t>=(pr.processTimeIntervalList.length+1)/2&&_this84.updateDeltaTime(Math.floor(e/t));_context23.next=10;return _this84.sleep(_this84.withFloatRate(pr.processInterval));case 10:i=_context23.sent;_context23.t0=i===1;case 12:if(!_context23.t0){_context23.next=14;break}return _context23.abrupt("return","break");case 14:case"end":return _context23.stop();}}},_loop14)});case 1:if(!this.socket){_context24.next=8;break}return _context24.delegateYield(_loop14(),"t0",3);case 3:_ret=_context24.t0;if(!(_ret==="break")){_context24.next=6;break}return _context24.abrupt("break",8);case 6:_context24.next=1;break;case 8:case"end":return _context24.stop();}}},_callee23,this)}));function handleStartPingLoop(){return _handleStartPingLoop.apply(this,arguments)}return handleStartPingLoop}()},{key:"updateDeltaTime",value:function updateDeltaTime(e){this.deltaTime=e}},{key:"doProgress",value:function(){var _doProgress=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee24(e,t){var i,_iterator97,_step97,r;return regeneratorRuntime.wrap(function _callee24$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:i=0;_context25.prev=1;_context25.next=4;return t();case 4:i=_context25.sent;_context25.next=10;break;case 7:_context25.prev=7;_context25.t0=_context25["catch"](1);e(_context25.t0);case 10:if(!(i===0)){_context25.next=43;break}_iterator97=_createForOfIteratorHelper(pr.processTimeIntervalList);_context25.prev=12;_iterator97.s();case 14:if((_step97=_iterator97.n()).done){_context25.next=35;break}r=_step97.value;_context25.prev=16;_context25.next=19;return this.sleep(this.withFloatRate(r));case 19:i=_context25.sent;_context25.t1=i===1;if(_context25.t1){_context25.next=26;break}_context25.next=24;return t();case 24:i=_context25.sent;_context25.t1=i===1;case 26:if(!_context25.t1){_context25.next=28;break}return _context25.abrupt("break",35);case 28:_context25.next=33;break;case 30:_context25.prev=30;_context25.t2=_context25["catch"](16);e(_context25.t2);case 33:_context25.next=14;break;case 35:_context25.next=40;break;case 37:_context25.prev=37;_context25.t3=_context25["catch"](12);_iterator97.e(_context25.t3);case 40:_context25.prev=40;_iterator97.f();return _context25.finish(40);case 43:return _context25.abrupt("return",i);case 44:case"end":return _context25.stop();}}},_callee24,this,[[1,7],[12,37,40,43],[16,30]])}));function doProgress(_x31,_x32){return _doProgress.apply(this,arguments)}return doProgress}()},{key:"startPing",value:function(){var _startPing=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee25(){var _this85=this;var e,t,i,r;return regeneratorRuntime.wrap(function _callee25$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:if(!this.pingProgress){_context26.next=4;break}e=this.pingProgress.id,t=this.pingProgress.padding;_context26.next=14;break;case 4:i=Date.now(),r=setTimeout(function(){return _this85.onPongTimeout(e)},pr.pongTimeout);e=this.getNextId(),t=[],this.pingProgress={id:e,timer:r,timestamp:i,padding:t};_context26.prev=6;_context26.next=9;return this.idle.invokeOnIdle(function(){_this85.socket&&_this85.socket.emit("ping",mm({id:e,timestamp:i}))});case 9:_context26.next=14;break;case 11:_context26.prev=11;_context26.t0=_context26["catch"](6);throw this.pingProgress&&(clearTimeout(r),this.pingProgress=null),_context26.t0;case 14:_context26.next=16;return new Promise(function(i,r){t.push({resolve:i,reject:r})});case 16:return _context26.abrupt("return",_context26.sent);case 17:case"end":return _context26.stop();}}},_callee25,this,[[6,11]])}));function startPing(){return _startPing.apply(this,arguments)}return startPing}()},{key:"onPongTimeout",value:function onPongTimeout(e){if(this.pingProgress){var _this$pingProgress=this.pingProgress,t=_this$pingProgress.id,i=_this$pingProgress.padding;if(t===e){var r=new Error("pong timeout");var _iterator98=_createForOfIteratorHelper(i),_step98;try{for(_iterator98.s();!(_step98=_iterator98.n()).done;){var n=_step98.value.reject;n(r)}}catch(err){_iterator98.e(err)}finally{_iterator98.f()}this.pingProgress=null}}}},{key:"getNextId",value:function getNextId(){this.nextId>pr.maxId&&(this.nextId=0);var e=this.nextId;return this.nextId+=1,e}},{key:"withFloatRate",value:function withFloatRate(e){var t=1-pr.timeFloatRate+2*pr.timeFloatRate*Math.random();return Math.floor(t*e)}},{key:"sleep",value:function sleep(e){var _this86=this;if(this.promiseSleep)throw new Error("did call sleep");return new Promise(function(t){var i=setTimeout(function(){_this86.promiseSleep=null,t(0)},e);_this86.promiseSleep={resolve:t,sleepTimer:i}})}}]);return pr}(),_n=pr;_n.maxId=Math.pow(2,32)-1,_n.pongTimeout=6*1e3,_n.timeFloatRate=.35,_n.processInterval=5*60*1e3,_n.processTimeIntervalList=Object.freeze([5*1e3,7*1e3,12*1e3,15*1e3]);var af=/*#__PURE__*/function(){function af(e){var _this87=this;_classCallCheck(this,af);this.invoker=e,this.animationFrameId=null,this.shouldInvokeNextFrame=!1,this.blockInvoke=!1,this.fireTick=function(){if(_this87.shouldInvokeNextFrame)try{_this87.invoker()}catch(t){console.error(t)}_this87.shouldInvokeNextFrame=!1,_this87.blockInvoke=!1,_this87.animationFrameId=null}}_createClass(af,[{key:"invoke",value:function invoke(){if(this.blockInvoke)this.shouldInvokeNextFrame=!0;else{try{this.invoker()}catch(e){console.error(e)}this.animationFrameId===null&&(this.animationFrameId=window.requestAnimationFrame(this.fireTick)),this.blockInvoke=!0}}}]);return af}(),pe;(function(e){e.Playing="playing",e.Pausing="pausing",e.PausingAndWaiting="pausingAndWaiting",e.Waiting="waiting",e.Ended="ended"})(pe||(pe={}));var oh;(function(e){e[e.AutoBlockNewFrames=0]="AutoBlockNewFrames",e[e.DoNotBlockNewFrames=1]="DoNotBlockNewFrames"})(oh||(oh={}));var Zw=/*#__PURE__*/function(){function Zw(){_classCallCheck(this,Zw);this.blockMode=1,this.queue=[],this.blockIndex=this.queue.length}_createClass(Zw,[{key:"hasFrames",get:function get(){return this.queue.length>0}},{key:"hasAccessibleFrames",get:function get(){return this.blockIndex>0}},{key:"hasBlockedFrames",get:function get(){return this.queue.length>this.blockIndex}},{key:"accessibleLength",get:function get(){return this.blockIndex}},{key:"rearFrame",get:function get(){return this.frameAt(0)}},{key:"latestFrameIncludesBlocked",get:function get(){var e;return(e=this.queue[this.queue.length-1])==null?void 0:e.proto}},{key:"blockedFrame",get:function get(){var e;return(e=this.queue[this.blockIndex])==null?void 0:e.proto}},{key:"blockedReceivedAt",get:function get(){var e=this.queue[this.blockIndex];return e?e.receivedAt:-1}},{key:"timeInterval",get:function get(){if(this.blockIndex>0){var e=this.queue[this.blockIndex-1],t=this.queue[0];return e.proto.timestamp-t.proto.timestamp}else return 0}},{key:"timeIntervalBefore",value:function timeIntervalBefore(e){var t;var i=0,r=(t=this.queue[0])==null?void 0:t.proto.timestamp;if(r!==void 0){var n=-1;for(var s=this.blockIndex-1;s>=0;--s){var o=this.queue[s];if(o.proto.timestamp<=e){n=o.proto.timestamp;break}}n!==-1&&(i=n-r)}return i}},{key:"frameAt",value:function frameAt(e){if(e<this.blockIndex)return this.queue[e].proto}},{key:"push",value:function push(e){var t=Date.now();this.blockMode===1&&(this.blockIndex+=e.length);var _iterator99=_createForOfIteratorHelper(e),_step99;try{for(_iterator99.s();!(_step99=_iterator99.n()).done;){var i=_step99.value;this.queue.push({proto:i,receivedAt:t})}}catch(err){_iterator99.e(err)}finally{_iterator99.f()}}},{key:"shift",value:function shift(){var e;if(this.frameAt(0))return this.blockIndex-=1,(e=this.queue.shift())==null?void 0:e.proto}},{key:"unblockOneFrame",value:function unblockOneFrame(){this.blockIndex<this.queue.length&&(this.blockIndex+=1)}}]);return Zw}(),Jw=12e3,$n;(function(e){e.Realtime="realtime",e.Reconstruction="reconstruction"})($n||($n={}));var lf=/*#__PURE__*/function(){function lf(e){var _this88=this;_classCallCheck(this,lf);this.framesQueue=new Zw,this.isPlaying=!1,this._didCompletePushFrames=!1,this.didCompletePlaying=!1,this.handleTickEvent=function(){try{_this88.onTick()}finally{_this88.shouldTickNextFrame()&&_this88.tickLimiter.invoke(),_this88.phaseNode.touch()}},this.currentPhase=function(){return _this88.didCompletePlaying?pe.Ended:_this88._didCompletePushFrames||_this88.framesQueue.hasAccessibleFrames?_this88.isPlaying?pe.Playing:pe.Pausing:_this88.isPlaying?pe.Waiting:pe.PausingAndWaiting},this.onPhaseChanged=function(n,s){s===pe.Playing&&n!==pe.Playing?_this88.onPlayingStop():s!==pe.Playing&&n===pe.Playing&&_this88.onPlayingContinue(),_this88.callbacks.onPhaseChanged&&_this88.callbacks.onPhaseChanged(n)},this.logger=e.logger,this.mode=e.mode,this.callbacks=Object.freeze(Wt({},e.callbacks));var t=e.enableAnimationFrame,_e$frameInterval=e.frameInterval,i=_e$frameInterval===void 0?17:_e$frameInterval,_e$remainLowTimeInter=e.remainLowTimeInterval,r=_e$remainLowTimeInter===void 0?Jw:_e$remainLowTimeInter;if(t){var n=new af(this.handleTickEvent);this.tickLimiter=new ct(i,function(){return n.invoke()})}else this.tickLimiter=new ct(i,this.handleTickEvent);this.remainLowTimeInterval=r,this.phaseNode=new On({getCurrentPhase:this.currentPhase,onPhaseChanged:this.onPhaseChanged})}_createClass(lf,[{key:"didCompletePushFrames",get:function get(){return this._didCompletePushFrames}},{key:"completePlaying",value:function completePlaying(){this.didCompletePlaying=!0,this.phaseNode.touch(),this.tickLimiter.cancel()}},{key:"frameInterval",get:function get(){return this.tickLimiter.limitDuration},set:function set(e){this.tickLimiter.limitDuration=e}},{key:"phase",get:function get(){return this.phaseNode.phase}},{key:"shouldTickNextFrame",value:function shouldTickNextFrame(){return this.didCompletePlaying?!1:this.willTickEveryFrames?!0:!!(this.isPlaying&&this.framesQueue.hasFrames)}},{key:"pushFrames",value:function pushFrames(e){this.framesQueue.push(e),e.length>0&&this.isPlaying&&this.tickLimiter.invoke(),this.phaseNode.touch()}},{key:"play",value:function play(){!this.isPlaying&&this.phaseNode.phase!==pe.Ended&&(this.isPlaying=!0,this.framesQueue.hasAccessibleFrames&&this.tickLimiter.invoke(),this.phaseNode.touch())}},{key:"pause",value:function pause(){this.isPlaying&&(this.isPlaying=!1,this.tickLimiter.cancel(),this.phaseNode.touch())}},{key:"completePushFrames",value:function completePushFrames(){this._didCompletePushFrames=!0,this.framesQueue.hasAccessibleFrames||(this.didCompletePlaying=!0,this.tickLimiter.cancel()),this.phaseNode.touch()}}]);return lf}(),ah=/*#__PURE__*/function(){function ah(e,t){_classCallCheck(this,ah);this.lastTimestamp=0,this.targetValue=e,this._momentValue=e,this.halfLifeInterval=t}_createClass(ah,[{key:"value",get:function get(){return this.targetValue},set:function set(e){this.targetValue!==e&&(this.targetValue!==this._momentValue&&this.refreshMomentValue(),this.targetValue=e)}},{key:"momentValue",get:function get(){return this.targetValue!==this._momentValue&&this.refreshMomentValue(),this._momentValue}},{key:"refreshMomentValue",value:function refreshMomentValue(){var e=Date.now(),t=e-this.lastTimestamp,i;if(t>this.halfLifeInterval*ah.convergenceTimes)i=this.targetValue;else{var r=Math.pow(.5,t/this.halfLifeInterval);i=this._momentValue*r+this.targetValue*(1-r),Math.abs(i-this.targetValue)<ah.minNumber&&(i=this.targetValue)}this._momentValue=i,this.lastTimestamp=e}}]);return ah}(),ga=ah;ga.convergenceTimes=6,ga.minNumber=.01;var cf=1200,hf=Object.freeze([Object.freeze({duration:1200,rate:1}),Object.freeze({duration:1e3,rate:.75}),Object.freeze({duration:3e3,rate:.5}),Object.freeze({duration:5e3,rate:.25})]);function e0(e){var t=e;var _iterator100=_createForOfIteratorHelper(hf),_step100;try{for(_iterator100.s();!(_step100=_iterator100.n()).done;){var i=_step100.value;if(t<=i.duration)return i.rate;t-=i.duration}}catch(err){_iterator100.e(err)}finally{_iterator100.f()}throw new Error("durationTime is too large:"+t)}var t0=function(){var e=0;var _iterator101=_createForOfIteratorHelper(hf),_step101;try{for(_iterator101.s();!(_step101=_iterator101.n()).done;){var t=_step101.value.duration;e+=t}}catch(err){_iterator101.e(err)}finally{_iterator101.f()}return e}(),i0=/*#__PURE__*/function(_lf){_inherits(i0,_lf);var _super27=_createSuper(i0);function i0(e){var _this89;_classCallCheck(this,i0);_this89=_super27.call(this,e);_this89.latestTimestamp=null,_this89.syncDelta=null,_this89.framesQueue.blockMode=oh.AutoBlockNewFrames,_this89.frameDelayGradient=new ga(e.frameDelay||0,cf);return _this89}_createClass(i0,[{key:"frameDelay",get:function get(){return this.frameDelayGradient.value},set:function set(e){this.frameDelayGradient.value=e}},{key:"isPlaybackSpeedModifiable",get:function get(){return!1}},{key:"playbackSpeed",get:function get(){return 1},set:function set(e){}},{key:"willTickEveryFrames",get:function get(){return!1}},{key:"syncBlockTimestamp",value:function syncBlockTimestamp(e){var t=e-Date.now();this.syncDelta?this.syncDelta.value=t:this.syncDelta=new ga(t,cf)}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){this.syncDelta=null}},{key:"onPlayingContinue",value:function onPlayingContinue(){}},{key:"onPlayingStop",value:function onPlayingStop(){}},{key:"onTick",value:function onTick(){var e=Date.now(),t=[];if(this.unblockFramesIfNeed(e),this.fillOverIntervalFrames(e,t),this.fillShouldPlayFrames(e,t),this.playFrames(t),this.callbacks.onBufferRemainLow&&this.latestTimestamp&&!this.didCompletePushFrames){var i=0;if(this.framesQueue.hasAccessibleFrames){var r=this.framesQueue.latestFrameIncludesBlocked.timestamp;i=r-this.latestTimestamp.ack}i<this.remainLowTimeInterval&&this.callbacks.onBufferRemainLow()}}},{key:"unblockFramesIfNeed",value:function unblockFramesIfNeed(e){if(this.syncDelta){var t=e+this.syncDelta.momentValue;for(;this.framesQueue.hasBlockedFrames&&this.framesQueue.blockedFrame.timestamp<=t;){this.framesQueue.unblockOneFrame()}}else for(;this.framesQueue.hasBlockedFrames;){var _t7=this.framesQueue.blockedReceivedAt+this.frameDelayGradient.momentValue;if(e>=_t7)this.framesQueue.unblockOneFrame();else break}}},{key:"fillOverIntervalFrames",value:function fillOverIntervalFrames(e,t){for(;this.framesQueue.timeInterval>t0;){t.push(this.framesQueue.shift())}t.length>0&&this.updateLatestTimestamp(e,t[t.length-1])}},{key:"fillShouldPlayFrames",value:function fillShouldPlayFrames(e,t){var i=this.framesQueue.timeIntervalBefore(e),r=e0(i);for(;this.framesQueue.hasAccessibleFrames;){var n=this.framesQueue.rearFrame,s=!1;if(!this.latestTimestamp)s=!0;else{var o=n.timestamp-this.latestTimestamp.ack,a=this.latestTimestamp.device+o*r;s=e+this.frameInterval>=a}if(s)t.push(this.framesQueue.shift()),this.updateLatestTimestamp(e,n);else break}}},{key:"playFrames",value:function playFrames(e){if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(t){this.logger.error(t)}}},{key:"updateLatestTimestamp",value:function updateLatestTimestamp(e,_ref27){var t=_ref27.timestamp;this.latestTimestamp?(this.latestTimestamp.ack=t,this.latestTimestamp.device=e):this.latestTimestamp={ack:t,device:e}}}]);return i0}(lf),r0=/*#__PURE__*/function(_lf2){_inherits(r0,_lf2);var _super28=_createSuper(r0);function r0(e){var _this90;_classCallCheck(this,r0);_this90=_super28.call(this,e);_this90.frameDelay=0,_this90._playbackSpeed=1,_this90.endFrameTimestamp=e.endFrameTimestamp,_this90.anchor={deviceTimestamp:Date.now(),playerTimestamp:e.initFrameTimestamp};return _this90}_createClass(r0,[{key:"syncBlockTimestamp",value:function syncBlockTimestamp(e){}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){}},{key:"play",value:function play(){_get(_getPrototypeOf(r0.prototype),"play",this).call(this);var e=this.callbacks.onBufferRemainLow;e&&this.isBufferRemainLow&&Promise.resolve().then(e)["catch"](function(t){return console.error(t)})}},{key:"isPlaybackSpeedModifiable",get:function get(){return!0}},{key:"playbackSpeed",get:function get(){return this._playbackSpeed},set:function set(e){if(e<0)throw new Error("invalid playback speed ".concat(e,". it shouldn't be nagative number"));if(Number.isNaN(e)||e===1/0)throw new Error("invalid playback speed. it can not be ".concat(e));this._playbackSpeed!==e&&(this.phase===pe.Playing&&this.refreshAnchor(this._playbackSpeed),this._playbackSpeed=e)}},{key:"willTickEveryFrames",get:function get(){return!0}},{key:"onPlayingContinue",value:function onPlayingContinue(){this.refreshAnchor(0)}},{key:"onPlayingStop",value:function onPlayingStop(){this.refreshAnchor(this._playbackSpeed)}},{key:"onTick",value:function onTick(){var e=[],t=this.playbackSpeed*(Date.now()-this.anchor.deviceTimestamp+this.frameInterval),i=this.anchor.playerTimestamp+t;for(;this.framesQueue.hasAccessibleFrames&&this.framesQueue.rearFrame.timestamp<=i;){e.push(this.framesQueue.shift())}if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(r){this.logger.error(r)}if(this.callbacks.onTick)if(e.length>0){var r=e[e.length-1],n=Math.max(this.anchor.playerTimestamp,r.timestamp);this.callbacks.onTick(n,!1)}else this.callbacks.onTick(i,!0);this.callbacks.onBufferRemainLow&&!this.didCompletePushFrames&&this.isBufferRemainLow&&this.callbacks.onBufferRemainLow(),this.didCompletePushFrames&&e.length===0&&this.endFrameTimestamp!==void 0&&i>=this.endFrameTimestamp&&this.completePlaying()}},{key:"refreshAnchor",value:function refreshAnchor(e){var t=Date.now(),i=e*(t-this.anchor.deviceTimestamp);this.anchor={deviceTimestamp:t,playerTimestamp:this.anchor.playerTimestamp+i}}},{key:"isBufferRemainLow",get:function get(){return this.framesQueue.timeInterval<this.remainLowTimeInterval}}]);return r0}(lf),n0=/*#__PURE__*/function(){function n0(){_classCallCheck(this,n0)}_createClass(n0,[{key:"create",value:function create(e){switch(e.mode){case $n.Realtime:return new i0(e);case $n.Reconstruction:return new r0(e);default:throw new Error("invalid mode ".concat(e.mode));}}}]);return n0}(),df=new n0,s0=/*#__PURE__*/function(){function s0(e){_classCallCheck(this,s0);this.latestReceivedFrameId=-1,this.didAssertedCount=0,this.latestReceivedFrameId=e}_createClass(s0,[{key:"assertReceivedFrameId",value:function assertReceivedFrameId(e){var t=this.latestReceivedFrameId+1;if(e!==t)throw new Error("Magix want frameId ".concat(t,", instead of ").concat(e," (did asserted ").concat(this.didAssertedCount," frames)"));this.latestReceivedFrameId=e,this.didAssertedCount+=1}}]);return s0}(),o0=/*#__PURE__*/function(){function o0(e){var _this91=this;_classCallCheck(this,o0);this.latestTimestamp=null,this.receivedActionFramePicker=function(i){_this91.frameIdAsserter.assertReceivedFrameId(i.frameId),_this91.playerBuffer.pushFrames([i])},this.onPlayActionFrames=function(i){_this91.onFrameReceivedInterval&&i.length>0&&_this91.onFrameReceivedInterval(_this91.getFrameReceivedInterval(i));var r=[];var _iterator102=_createForOfIteratorHelper(i),_step102;try{for(_iterator102.s();!(_step102=_iterator102.n()).done;){var n=_step102.value;r.push(n.frameBuffer)}}catch(err){_iterator102.e(err)}finally{_iterator102.f()}try{_this91.image.appendActionFrames(r)}catch(n){if(_this91.onClientCrashWithError)_this91.onClientCrashWithError(n);else throw n}};var t;this.connection=e.connection,this.image=e.imageFactory.createWithSnapshot({logger:e.logger,observerId:re,library:e.library,snapshotFrame:e.snapshot,pendingReportChanged:e.pendingReportChanged,actionFrames:_toConsumableArray(e.initializeActionFrames),originalImage:(t=e.originalMagixSession)==null?void 0:t.image,includesFrameHash:!1,ignoreHashChecking:!0,roomUUID:e.connection.uuid,toolsExtra:e.toolsExtra,callbacks:{onModified:e.callbacks.onModified,onPhaseChanged:e.callbacks.onImagePhaseChanged,onGeneratedActionFrame:e.callbacks.onGeneratedActionFrame,onCatchErrorWhenAppendFrame:e.callbacks.onCatchErrorWhenAppendFrame,onReceivedRttReport:e.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:e.callbacks.onIllusionQueueLengthChanged,onEventFire:e.callbacks.onEventFire,onEventFireACK:e.callbacks.onEventFireACK,onClientCrashWithError:e.callbacks.onClientCrashWithError}}),this.frameIdAsserter=new s0(this.image.frameId),this.playerBuffer=df.create({logger:e.logger,mode:$n.Realtime,frameDelay:e.timeDelay,enableAnimationFrame:e.enableAnimationFrame,initFrameTimestamp:this.image.timestamp,callbacks:{onPlayActionFrames:this.onPlayActionFrames}}),this.onFrameReceivedInterval=e.callbacks.onFrameReceivedInterval,this.onClientCrashWithError=e.callbacks.onClientCrashWithError,this.playerBuffer.play()}_createClass(o0,[{key:"imagePhase",get:function get(){return this.image.phase}},{key:"timestamp",get:function get(){return this.image.timestamp}},{key:"trigger",get:function get(){return this.image.trigger}},{key:"pendingReportChanged",get:function get(){return this.image.pendingReportChanged},set:function set(e){this.image.pendingReportChanged=e}},{key:"receivedScopeSlices",value:function receivedScopeSlices(e){this.image.appendScopeSlices(e)}},{key:"dispatch",value:function dispatch(e,t){this.image.dispatch(e,t)}},{key:"updateTimeDelay",value:function updateTimeDelay(e){this.playerBuffer.frameDelay=e}},{key:"syncBlockTimestamp",value:function syncBlockTimestamp(e){this.playerBuffer.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){this.playerBuffer.stopBlockTimestamp()}},{key:"setModifiable",value:function setModifiable(e){this.image.modifiable=e}},{key:"setAllocatedUser",value:function setAllocatedUser(e){return this.image.setAllocatedUser(e)}},{key:"removeAllocatedUser",value:function removeAllocatedUser(){return this.image.removeAllocatedUser()}},{key:"destroy",value:function destroy(){this.image.destroy()}},{key:"getFrameReceivedInterval",value:function getFrameReceivedInterval(e){var t=Date.now(),i=0,r=0;var _iterator103=_createForOfIteratorHelper(e),_step103;try{for(_iterator103.s();!(_step103=_iterator103.n()).done;){var s=_step103.value;if(this.latestTimestamp){var o=t-this.latestTimestamp.recevied,a=s.timestamp-this.latestTimestamp.arbitrated;this.latestTimestamp.recevied=t,this.latestTimestamp.arbitrated=s.timestamp,i+=Math.abs(o-a),r+=1}else this.latestTimestamp={recevied:t,arbitrated:s.timestamp}}}catch(err){_iterator103.e(err)}finally{_iterator103.f()}var n=0;return r>0&&(n=i/r),n}}]);return o0}(),a0=/*#__PURE__*/function(){function a0(e,t,i){_classCallCheck(this,a0);this.userPayload=e,this.onSelfUserIdUpdate=t,this.onConvertToWritable=i,this._selfUserId=void 0,this.invokerBlock=Promise.resolve(),this.isConnectedSessionWritable=!1,this.connectedSession=null}_createClass(a0,[{key:"selfUserId",get:function get(){return this._selfUserId}},{key:"setConnectedMagixSession",value:function setConnectedMagixSession(e){this.connectedSession!==e&&(!this.connectedSession&&e&&this.paddingAndWaitSession&&(this.paddingAndWaitSession(e),this.paddingAndWaitSession=void 0),this.connectedSession=e,this.isConnectedSessionWritable=!1)}},{key:"setWritable",value:function setWritable(e,t){return this.invokerBlock=this.convertTo(this.invokerBlock,e,t)}},{key:"convertTo",value:function(){var _convertTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee26(e,t,i){var r,n;return regeneratorRuntime.wrap(function _callee26$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:_context27.next=2;return e;case 2:if(!(this.isConnectedSessionWritable===t)){_context27.next=4;break}return _context27.abrupt("return");case 4:this.updateObserverId(void 0);r=null;case 6:_context27.next=8;return this.waitAndGetConnectedSession();case 8:n=_context27.sent;if(!(this.isConnectedSessionWritable===t)){_context27.next=11;break}return _context27.abrupt("break",31);case 11:if(!t){_context27.next=21;break}_context27.next=14;return n.connection.updateToWritable(this.userPayload,i);case 14:r=_context27.sent;if(r){_context27.next=17;break}return _context27.abrupt("continue",29);case 17:_context27.next=19;return n.setAllocatedUser(r);case 19:_context27.next=27;break;case 21:_context27.next=23;return n.connection.updateToReadonly(i);case 23:if(_context27.sent){_context27.next=25;break}return _context27.abrupt("continue",29);case 25:_context27.next=27;return n.removeAllocatedUser();case 27:this.isConnectedSessionWritable=t;return _context27.abrupt("break",31);case 29:_context27.next=6;break;case 31:r&&this.updateObserverId(r.userId),this.onConvertToWritable&&this.onConvertToWritable(!!r);case 32:case"end":return _context27.stop();}}},_callee26,this)}));function convertTo(_x33,_x34,_x35){return _convertTo.apply(this,arguments)}return convertTo}()},{key:"waitAndGetConnectedSession",value:function waitAndGetConnectedSession(){var _this92=this;return this.connectedSession?Promise.resolve(this.connectedSession):new Promise(function(e){return _this92.paddingAndWaitSession=e})}},{key:"updateObserverId",value:function updateObserverId(e){this._selfUserId!==e&&(this._selfUserId=e,this.onSelfUserIdUpdate&&this.onSelfUserIdUpdate(e))}}]);return a0}(),l0="NETLESSROOM_".length,pf;(function(e){e[e.Admin=0]="Admin",e[e.Writer=1]="Writer",e[e.Reader=2]="Reader"})(pf||(pf={}));function c0(e){if(/^NETLESSROOM_.+/.test(e)){var t=e.substring(l0),i=(0,uf.parse)(h0(t)),r=parseFloat("".concat(i.role));if(Number.isNaN(r)||!Number.isSafeInteger(r))throw new Error("invalid room token with wrong role: ".concat(JSON.stringify(e)));switch(r){case 0:case 1:return"writable";case 2:return"readonly";default:throw new Error("find unrecognized role from roomToken: ".concat(r));}}else{if(/^WHITE.+/.test(e))return"writable";throw new Error("invalid room token: ".concat(JSON.stringify(e)))}}function h0(e){return atob(e.replace(/_/g,"/").replace(/-/g,"+"))}var d0=/*#__PURE__*/function(){function d0(e,t){var _this93=this;_classCallCheck(this,d0);this.queue=[],this._isWorking=!0,this.onDelayFire=function(){_this93.queue.splice(0),_this93.onTimeout()},this.timeout=e,this.delayer=new Ai(this.onDelayFire),this.onTimeout=t}_createClass(d0,[{key:"isWorking",get:function get(){return this._isWorking},set:function set(e){this._isWorking!==e&&(this._isWorking=e,e?this.activeFirstNode():this.delayer.cancel())}},{key:"fireSend",value:function fireSend(e){var t=e.frameId,i=Date.now();this.queue.push({frameId:t,sendAt:i}),this._isWorking&&this.queue.length===1&&this.delayer.refreshAndInvokeAfterInterval(this.timeout)}},{key:"fireACK",value:function fireACK(e){var t=e.originalFrameId,i=this.queue.findIndex(function(r){return r.frameId===t});i!==-1&&(this.queue.splice(i,1),this._isWorking&&this.activeFirstNode())}},{key:"activeFirstNode",value:function activeFirstNode(){if(this.queue.length===0)this.delayer.cancel();else{var e=this.queue[0].sendAt,t=e+this.timeout-Date.now();t>0?this.delayer.refreshAndInvokeAfterInterval(t):(this.delayer.cancel(),this.onDelayFire())}}}]);return d0}(),lh=/*#__PURE__*/function(){function lh(e){var _this94=this;_classCallCheck(this,lh);this.idle=Do({timeout:250,checkingTimeMod:7,maxPaddingDuration:800,maxInvokingDuration:5}),this.actionFramePickersList=[],this._phase=L.Ready,this._modifiable=!0,this._timeDelay=0,this.switchWritable=!1,this.switchWritableTaskId=0,this.isReconnecting=!1,this.beginReconnectAt=0,this.onReceivedActionFrame=function(t){var i=new zt(t);try{if(_this94.magixSession){if(_this94.actionFramePickersList.length>0){var _iterator104=_createForOfIteratorHelper(_this94.cleanActionFramesBufferList()),_step104;try{for(_iterator104.s();!(_step104=_iterator104.n()).done;){var r=_step104.value;_this94.magixSession.receivedActionFramePicker(r)}}catch(err){_iterator104.e(err)}finally{_iterator104.f()}}_this94.magixSession.receivedActionFramePicker(i)}else _this94.actionFramePickersList.push(i)}catch(r){_this94.logger.error("found error when receive action frame: "+r.message),_this94.socketSession.reconnectWithError(r)}finally{_this94.ackTimeout.fireACK(i)}},this.onReceivedScopeSlices=function(t){try{_this94.magixSession&&_this94.magixSession.receivedScopeSlices(t)}catch(i){_this94.logger.error("found error when receive scope slices: "+i.message),_this94.socketSession.reconnectWithError(i)}},this.onBeginReconnect=function(t){var i=_this94._phase===L.Connecting;_this94.beginReconnectAt=Date.now(),_this94.refreshACKTimeoutIsWorking(),i||(_this94.callbacks.onReconnectWithError?_this94.callbacks.onReconnectWithError(t):_this94.logger.error(t)),_this94.switchWritableTaskId+=1,_this94.magixSession.destroy(),_this94.pingPongNode.unbindSocket(),i||_this94.changePhase(L.Reconnecting),_this94.isReconnecting=!0,_this94.authorState.setConnectedMagixSession(null)},this.onReconnected=/*#__PURE__*/function(){var _ref29=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee27(_ref28){var t,i,r,n,s,o;return regeneratorRuntime.wrap(function _callee27$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:t=_ref28.connection,i=_ref28.snapshot,r=_ref28.actionFrames,n=_ref28.retryCount;_this94.buildMagixSession({connection:t,snapshot:i,actionFrames:r,pendingReportChanged:!0});s=_this94._phase===L.Connecting,o=_this94.switchWritableTaskId;_context28.t0=_this94.switchWritable;if(!_context28.t0){_context28.next=7;break}_context28.next=7;return _this94.authorState.setWritable(!0,_this94.settingWritablePayload);case 7:o===_this94.switchWritableTaskId&&(_this94.magixSession.pendingReportChanged=!1,s||(_this94.changePhase(L.Connected),_this94.onModified()),_this94.isReconnecting=!1,_this94.reconnectionResultReceiver&&(_this94.reconnectionResultReceiver(null),_this94.reconnectionResultReceiver=null),_this94.callbacks.onReconnected&&!s&&_this94.callbacks.onReconnected({retryCount:n,buildWebSocketDuration:t.connectingDuration,buildMagixDuration:Date.now()-_this94.beginReconnectAt}));_this94.beginReconnectAt=0;_this94.refreshACKTimeoutIsWorking();case 10:case"end":return _context28.stop();}}},_callee27)}));return function(_x36){return _ref29.apply(this,arguments)}}(),this.onGeneratedActionFrame=function(t){var i;_this94.idle.invokeOnIdle(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee28(){return regeneratorRuntime.wrap(function _callee28$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:i=t.get();case 1:case"end":return _context29.stop();}}},_callee28)})))["catch"](function(r){var n,s;return(s=(n=_this94.callbacks).onReceivedWarning)==null?void 0:s.call(n,r.message)}),_this94.idle.invokeOnIdle(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee29(){return regeneratorRuntime.wrap(function _callee29$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:i&&(_this94.socketSession.connection.sendActionFrame(i),_this94.ackTimeout.fireSend(new zt(i)));case 1:case"end":return _context30.stop();}}},_callee29)})))["catch"](function(r){var n,s;return(s=(n=_this94.callbacks).onReceivedWarning)==null?void 0:s.call(n,r.message)})},this.onSelfUserIdUpdate=function(t){_this94.callbacks.onSelfUserIdUpdate&&_this94._phase!==L.Ready&&_this94._phase!==L.Connecting&&_this94.callbacks.onSelfUserIdUpdate(t)},this.onModified=function(){_this94.callbacks.onModified&&_this94._phase!==L.Ready&&_this94._phase!==L.Connecting&&(_this94.animationFrameTicker?_this94.animationFrameTicker.invoke():_this94.callbacks.onModified())},this.onACKTimeout=function(){_this94.onClientCrashWithError(new Error("receive ACK frame timeout"))},this.onClientCrashWithError=function(t){_this94._phase===L.Connected&&_this94.socketSession.reconnectWithError(t)},this.onFrameReceivedInterval=function(t){_this94.callbacks.onFrameReceivedInterval&&(_this94.callbacks.onFrameReceivedInterval(t),_this94.receivedIntervalResetter.refreshAndInvokeAfterInterval(lh.receivedIntervalResetterCleanInterval))},this.onDisconnectWithError=function(t){if(_this94.magixSession.destroy(),_this94.pingPongNode.unbindSocket(),_this94.phase!==L.Disconnected){var i=_this94._phase;_this94.socketSession.dispose(),_this94.isReconnecting=!1,_this94.changePhase(L.Disconnected),_this94.reconnectionResultReceiver&&(_this94.reconnectionResultReceiver(t),_this94.reconnectionResultReceiver=null),i===L.Connecting?_this94.errorWhenConnecting=t:_this94.callbacks.onDisconnectWithError&&_this94.callbacks.onDisconnectWithError(t)}},this.onKickedWithReason=function(t){if(_this94.magixSession.destroy(),_this94.pingPongNode.unbindSocket(),_this94.phase!==L.Disconnected){var i=_this94._phase,r=new Error("kicked by server when connecting: ".concat(t));_this94.socketSession.dispose(),_this94.isReconnecting=!1,_this94.changePhase(L.Disconnected),_this94.reconnectionResultReceiver&&(_this94.reconnectionResultReceiver(r),_this94.reconnectionResultReceiver=null),i===L.Connecting&&(_this94.errorWhenConnecting=r),_this94.callbacks.onKickedWithReason&&_this94.callbacks.onKickedWithReason(t)}},this.logger=e.logger,this.imageFactory=e.imageFactory,this.libraryNodeFetcher=e.libraryNodeFetcher,this.fetcherFactory=e.fetcherFactory,this.enableAnimationFrame=e.enableAnimationFrame,this.reconnectionOptions=e.reconnectionOptions,this.toolsExtra=e.toolsExtra,this.netState=e.netState,this.clientVersion=e.clientVersion,this.callbacks=Ms(e.callbacks),this.callbacks.onModified&&e.enableAnimationFrame&&(this.animationFrameTicker=new af(this.callbacks.onModified)),this.pingPongNode=new _n(this.logger.warn),this.authorState=new a0(e.userPayload,this.onSelfUserIdUpdate,this.onModified),this.ackTimeout=new d0(lh.ackTimeout,this.onACKTimeout),this.receivedIntervalResetter=new Ai(function(){_this94.callbacks.onFrameReceivedInterval&&_this94.callbacks.onFrameReceivedInterval(0)})}_createClass(lh,[{key:"modifiable",get:function get(){return this._modifiable}},{key:"phase",get:function get(){return this._phase}},{key:"calibrationTimestamp",get:function get(){return this.pingPongNode.calibrationTimestamp}},{key:"timeDelay",get:function get(){return this._timeDelay},set:function set(e){this._timeDelay=e,this.magixSession&&this.magixSession.updateTimeDelay(e)}},{key:"session",get:function get(){return this.socketSession&&this.socketSession.session}},{key:"slice",get:function get(){return this.socketSession&&this.socketSession.slice}},{key:"changePhase",value:function changePhase(e){if(this._phase!==e){switch(this._phase=e,e){case L.Disconnecting:case L.Disconnected:{this.refreshACKTimeoutIsWorking();break}}this.callbacks.onPhaseChanged&&this.callbacks.onPhaseChanged(e)}}},{key:"selfUserId",get:function get(){return this.authorState.selfUserId}},{key:"isWritable",get:function get(){return this.authorState.selfUserId!==void 0}},{key:"imagePhase",get:function get(){if(!this.magixSession)throw new Error("image phase not exist when Magix's phase is ".concat(this.phase));return this.magixSession.imagePhase}},{key:"trigger",get:function get(){if(!this.magixSession)throw new Error("trigger object not exist when Magix's phase is ".concat(this.phase));return this.magixSession.trigger}},{key:"syncBlockTimestamp",value:function syncBlockTimestamp(e){var t;(t=this.magixSession)==null||t.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){var e;(e=this.magixSession)==null||e.stopBlockTimestamp()}},{key:"setWritable",value:function(){var _setWritable=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee30(e,t){return regeneratorRuntime.wrap(function _callee30$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:if(!(this._phase===L.Connected||this._phase===L.Reconnecting)){_context31.next=10;break}this.switchWritable=e,this.settingWritablePayload=e?t:void 0,this.refreshACKTimeoutIsWorking();_context31.prev=2;_context31.next=5;return this.authorState.setWritable(e,t);case 5:_context31.prev=5;this.refreshACKTimeoutIsWorking();return _context31.finish(5);case 8:_context31.next=11;break;case 10:throw new Error("can't only set writable when connected or reconnecting");case 11:case"end":return _context31.stop();}}},_callee30,this,[[2,,5,8]])}));function setWritable(_x37,_x38){return _setWritable.apply(this,arguments)}return setWritable}()},{key:"connect",value:function(){var _connect5=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee31(e){var _this95=this;var t,_yield$Xw,i,r,n,s,o,a;return regeneratorRuntime.wrap(function _callee31$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:t=Date.now();if(!(this.phase!==L.Ready)){_context32.next=3;break}throw new Error("can't connect when Magix's phase is ".concat(this.phase));case 3:this.changePhase(L.Connecting);_context32.prev=4;_context32.next=7;return Xw({logger:this.logger,fetcher:this.fetcherFactory.create(e.region),uuid:e.uuid,roomToken:e.roomToken,timeout:45*1e3,markWritable:e.isWritable,clientVersion:this.clientVersion,access:c0(e.roomToken),netState:this.netState,reconnectionOptions:this.reconnectionOptions,objectOperator:this.imageFactory.proxyManager.objectOperator,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:{onReceivedActionFrame:this.onReceivedActionFrame,onReceivedScopeSlices:this.onReceivedScopeSlices,onBeginReconnect:this.onBeginReconnect,onReconnected:this.onReconnected,onSliceUpdate:this.callbacks.onSliceChanged,onSessionUpdate:this.callbacks.onSessionChanged,onDisconnectedByServer:this.onDisconnectWithError,onDisconnectedWithSocketError:this.onDisconnectWithError,onKickWithReason:this.onKickedWithReason}});case 7:_yield$Xw=_context32.sent;i=_yield$Xw.session;r=_yield$Xw.connection;n=_yield$Xw.snapshot;s=_yield$Xw.actionFrames;o=_yield$Xw.retryCount;this.socketSession=i;this.settingWritablePayload=e.connectedPayload;this.buildMagixSession({connection:r,snapshot:n,actionFrames:s,pendingReportChanged:!1});_context32.t0=e.isWritable;if(!_context32.t0){_context32.next=21;break}_context32.next=20;return this.authorState.setWritable(!0,e.connectedPayload);case 20:this.switchWritable=!0;case 21:if(!this.isReconnecting){_context32.next=29;break}_context32.next=24;return new Promise(function(c){_this95.reconnectionResultReceiver=c});case 24:a=_context32.sent;if(!a){_context32.next=27;break}throw a;case 27:_context32.next=31;break;case 29:if(!(this._phase!==L.Connecting)){_context32.next=31;break}throw this.errorWhenConnecting?this.errorWhenConnecting:new Error("magix connect fail with invalid phase ".concat(this._phase));case 31:return _context32.abrupt("return",(this.changePhase(L.Connected),{libraryNode:i.libraryNode,statistics:{retryCount:o,buildWebSocketDuration:i.connection.connectingDuration,buildMagixDuration:Date.now()-t}}));case 34:_context32.prev=34;_context32.t1=_context32["catch"](4);throw this.cleanActionFramesBufferList(),this.changePhase(L.Disconnected),this.pingPongNode.unbindSocket(),_context32.t1;case 37:case"end":return _context32.stop();}}},_callee31,this,[[4,34]])}));function connect(_x39){return _connect5.apply(this,arguments)}return connect}()},{key:"reconnectWithError",value:function reconnectWithError(e){if(this._phase!==L.Reconnecting){if(this._phase!==L.Connected)throw new Error("can't reconnect when magix's phase is ".concat(this._phase));this.socketSession.reconnectWithError(e)}}},{key:"buildMagixSession",value:function buildMagixSession(_ref32){var _this96=this;var e=_ref32.connection,t=_ref32.snapshot,i=_ref32.actionFrames,r=_ref32.pendingReportChanged;this.magixSession&&this.magixSession.destroy();var n=this.magixSession=new o0({logger:this.logger,library:sh(this.socketSession.libraryNode.libraryClass),connection:e,pendingReportChanged:r,snapshot:t,initializeActionFrames:i,imageFactory:this.imageFactory,enableAnimationFrame:this.enableAnimationFrame,originalMagixSession:this.magixSession,timeDelay:this._timeDelay,toolsExtra:this.toolsExtra,callbacks:{onImagePhaseChanged:function onImagePhaseChanged(s){return _this96.onImagePhaseChanged(n,s)},onGeneratedActionFrame:this.onGeneratedActionFrame,onModified:this.onModified,onEventFire:this.wrapeEventFireCallback(this.callbacks.onEventFire),onEventFireACK:this.wrapeEventFireCallback(this.callbacks.onEventFireACK),onClientCrashWithError:this.onClientCrashWithError,onFrameReceivedInterval:this.onFrameReceivedInterval,onReceivedRttReport:this.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:this.callbacks.onIllusionQueueLengthChanged,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame||function(s,o){return _this96.logger.error(o)}}});e.bindPingPongNode(this.pingPongNode),this.magixSession.setModifiable(this._modifiable),this.authorState.setConnectedMagixSession(this.magixSession)}},{key:"disconnect",value:function(){var _disconnect=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee32(){return regeneratorRuntime.wrap(function _callee32$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:if(!(this.isReconnecting=!1,this.phase===L.Reconnecting)){_context33.next=4;break}this.socketSession.dispose(),this.pingPongNode.unbindSocket(),this.changePhase(L.Disconnected);_context33.next=15;break;case 4:if(!(this.phase===L.Connected)){_context33.next=14;break}this.pingPongNode.unbindSocket(),this.changePhase(L.Disconnecting);_context33.prev=6;_context33.next=9;return this.socketSession.connection.disconnect();case 9:_context33.prev=9;this.changePhase(L.Disconnected);return _context33.finish(9);case 12:_context33.next=15;break;case 14:throw new Error("can't disconnect when Magix's phase is ".concat(this.phase));case 15:case"end":return _context33.stop();}}},_callee32,this,[[6,,9,12]])}));function disconnect(){return _disconnect.apply(this,arguments)}return disconnect}()},{key:"dispatch",value:function dispatch(e,t){if(this.phase!==L.Connected)throw new Error("can't dispatch event when Magix's phase is ".concat(this.phase));this.magixSession.dispatch(e,t)}},{key:"refreshACKTimeoutIsWorking",value:function refreshACKTimeoutIsWorking(){this.beginReconnectAt===0&&this.switchWritable&&this.isWritable&&this._phase===L.Connected?this.ackTimeout.isWorking=!0:this.ackTimeout.isWorking=!1}},{key:"onImagePhaseChanged",value:function onImagePhaseChanged(e,t){this.callbacks.onImagePhaseChanged&&this.magixSession===e&&this.callbacks.onImagePhaseChanged(t)}},{key:"wrapeEventFireCallback",value:function wrapeEventFireCallback(e){if(e)return function(t){return e(_o(t,vi.Dispatched))}}},{key:"cleanActionFramesBufferList",value:function cleanActionFramesBufferList(){return this.actionFramePickersList.splice(0,this.actionFramePickersList.length)}}]);return lh}(),ch=lh;ch.receivedIntervalResetterCleanInterval=700,ch.ackTimeout=7e3;var u0=/*#__PURE__*/function(){function u0(e,t,i,r,n,s){_classCallCheck(this,u0);this.fetcherFactory=e,this.imageFactory=t,this.reconnectionOptions=i,this.netState=r,this.clientVersion=n,this.magixConfiguration=Object.freeze(Wt({},s))}_createClass(u0,[{key:"createMagix",value:function createMagix(e,t){return new ch({logger:t.logger,fetcherFactory:this.fetcherFactory,libraryNodeFetcher:t.libraryNodeFetcher,imageFactory:this.imageFactory,toolsExtra:e,enableAnimationFrame:this.magixConfiguration.enableAnimationFrame,reconnectionOptions:this.reconnectionOptions,netState:this.netState,userPayload:t.userPayload,clientVersion:this.clientVersion,callbacks:t.callbacks||{}})}}]);return u0}(),L;(function(e){e.Ready="ready",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnecting="disconnecting",e.Disconnected="disconnected"})(L||(L={}));function mf(_x40){return _mf.apply(this,arguments)}function _mf(){_mf=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee109(e){var t,i,_r226;return regeneratorRuntime.wrap(function _callee109$(_context113){while(1){switch(_context113.prev=_context113.next){case 0:t=3;_r226=0;case 2:if(!(_r226<t)){_context113.next=15;break}_context113.prev=3;_context113.next=6;return e();case 6:return _context113.abrupt("return",_context113.sent);case 9:_context113.prev=9;_context113.t0=_context113["catch"](3);i=_context113.t0;case 12:++_r226;_context113.next=2;break;case 15:throw i;case 16:case"end":return _context113.stop();}}},_callee109,null,[[3,9]])}));return _mf.apply(this,arguments)}var ff=/*#__PURE__*/function(){function ff(e){var _this97=this;_classCallCheck(this,ff);this.isDownloading=!1,this.didDestroy=!1,this.onPlayActionFrames=function(t){var i=[];var _iterator105=_createForOfIteratorHelper(t),_step105;try{for(_iterator105.s();!(_step105=_iterator105.n()).done;){var _step105$value=_step105.value,r=_step105$value.sequenceInitializer,n=_step105$value.framePicker;r&&(i.length>0&&(_this97.image.appendActionFrames(i),i=[]),_this97.image=_this97.createImage(r,_this97.image),_this97._libIdentifier=r.libIdentifier,_this97._libraryNode=r.libraryNode,_this97.playingSliceIndex+=1,_this97.callbacks.onSliceChanged&&_this97.callbacks.onSliceChanged()),n&&i.push(n.frameBuffer)}}catch(err){_iterator105.e(err)}finally{_iterator105.f()}i.length>0&&_this97.image.appendActionFrames(i)},this.onBufferRemainLow=function(){_this97.isDownloading||_this97.loadActionFrames()},this.onPlayerBufferPhaseChanged=function(t){_this97.callbacks.onPhaseChanged&&_this97.callbacks.onPhaseChanged(t)},this.logger=e.logger,this.imageFactory=e.imageFactory,this.sliceChunk=e.sliceChunk,this.sequenceFetcher=e.sequenceFetcher,this.toolsExtra=e.toolsExtra,this.fetchingSliceIndex=e.beginSliceIndex,this.playingSliceIndex=e.beginSliceIndex,this.callbacks=e.callbacks,this.isFirstSlice=!0,this.image=this.createImage(e.sequenceInitializer,e.originalReconstructorLine&&e.originalReconstructorLine.image),this.latestFetchingFrameId=this.image.frameId,this.latestPlayingFrameId=this.image.frameId,this.beginTimestamp=e.initFrameTimestamp===void 0?this.image.timestamp:e.initFrameTimestamp,this._libIdentifier=e.sequenceInitializer.libIdentifier,this._libraryNode=e.sequenceInitializer.libraryNode,this.playerBuffer=df.create({logger:e.logger,mode:$n.Reconstruction,enableAnimationFrame:e.enableAnimationFrame,initFrameTimestamp:this.beginTimestamp,endFrameTimestamp:this.sliceChunk.beginTimestamp+this.sliceChunk.duration,callbacks:{onBufferRemainLow:this.onBufferRemainLow,onPlayActionFrames:this.onPlayActionFrames,onPhaseChanged:this.onPlayerBufferPhaseChanged,onTick:e.callbacks.onTick}}),this.playerBuffer.playbackSpeed=e.playbackSpeed}_createClass(ff,[{key:"trigger",get:function get(){return this.image.trigger}},{key:"libIdentifier",get:function get(){return this._libIdentifier}},{key:"libraryNode",get:function get(){return this._libraryNode}},{key:"playbackSpeed",get:function get(){return this.playerBuffer.playbackSpeed},set:function set(e){this.playerBuffer.playbackSpeed=e}},{key:"createImage",value:function createImage(_ref33,n){var e=_ref33.snapshot,t=_ref33.actionFrames,i=_ref33.akkoSerVersion,r=_ref33.libraryNode;var s=this.imageFactory.createWithSnapshot({logger:this.logger,observerId:re,library:sh(r.libraryClass),snapshotFrame:e,actionFrames:t,originalImage:n,toolsExtra:this.toolsExtra,roomUUID:this.sliceChunk.roomUUID,includesFrameHash:!1,ignoreHashChecking:!0,pendingReportChanged:!1,snapshotDeserializerVersion:i,actionDeserializerVersion:i,callbacks:{onModified:this.callbacks.onModified,onEventFire:this.callbacks.onEventFire,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}});return s.modifiable=!1,s}},{key:"slice",get:function get(){return this.sliceChunk.sliceAt(this.playingSliceIndex)}},{key:"sliceIndex",get:function get(){return this.playingSliceIndex}},{key:"play",value:function play(){this.playerBuffer.play()}},{key:"pause",value:function pause(){this.playerBuffer.pause()}},{key:"setup",value:function setup(){var e=this.sliceChunk.beginTimestamp+this.sliceChunk.duration;this.beginTimestamp<e?this.loadActionFrames():this.playerBuffer.completePushFrames()}},{key:"destroy",value:function destroy(){this.didDestroy||(this.playerBuffer.pause(),this.image.destroy(),this.didDestroy=!0)}},{key:"phase",get:function get(){return this.playerBuffer.phase}},{key:"isRemainFramesToFetch",value:function isRemainFramesToFetch(){return this.fetchingSliceIndex<this.sliceChunk.slicesCount}},{key:"loadActionFrames",value:function loadActionFrames(){var _this98=this;this.fillActionFramesIntoBuffer()["catch"](function(e){return _this98.logger.error(e)})}},{key:"fillActionFramesIntoBuffer",value:function(){var _fillActionFramesIntoBuffer=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee33(){var e,t,i,r;return regeneratorRuntime.wrap(function _callee33$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:if(!this.isRemainFramesToFetch()){_context34.next=18;break}_context34.prev=1;this.isDownloading=!0;_context34.next=5;return this.fetchFrames();case 5:e=_context34.sent;t=this.sliceChunk.beginTimestamp+this.sliceChunk.duration;i=this.removeTimestampOverFrames(e,t);r=e[e.length-1];r&&(this.latestPlayingFrameId=r.frameId),this.shouldPushEndSpaceHolderFrame(e,i,t)&&e.push({frameId:this.latestPlayingFrameId+1,timestamp:t}),e.length>0&&this.playerBuffer.pushFrames(e),this.isRemainFramesToFetch()||this.playerBuffer.completePushFrames();_context34.next=15;break;case 12:_context34.prev=12;_context34.t0=_context34["catch"](1);this.callbacks.onCatchErrorWhenFetchBuffer&&this.callbacks.onCatchErrorWhenFetchBuffer(_context34.t0);case 15:_context34.prev=15;this.isDownloading=!1;return _context34.finish(15);case 18:case"end":return _context34.stop();}}},_callee33,this,[[1,12,15,18]])}));function fillActionFramesIntoBuffer(){return _fillActionFramesIntoBuffer.apply(this,arguments)}return fillActionFramesIntoBuffer}()},{key:"shouldPushEndSpaceHolderFrame",value:function shouldPushEndSpaceHolderFrame(e,t,i){var r=e[e.length-1];return(t||!this.isRemainFramesToFetch())&&(!r||r.timestamp<i)}},{key:"fetchFrames",value:function(){var _fetchFrames=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee34(){var _this99=this;var e,t,i,r,_yield$Promise$all,_yield$Promise$all2,n,s,o,_iterator106,_step106,a;return regeneratorRuntime.wrap(function _callee34$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:if(!(e=this.sliceChunk.sliceAt(this.fetchingSliceIndex),!e)){_context35.next=2;break}return _context35.abrupt("return",[]);case 2:if(!(t=e.framesCount-this.latestFetchingFrameId,t>0)){_context35.next=4;break}return _context35.abrupt("break",7);case 4:this.latestFetchingFrameId=0,this.latestPlayingFrameId=0,this.fetchingSliceIndex+=1,this.isFirstSlice=!1;case 5:_context35.next=0;break;case 7:i=Math.min(t,ff.fetchFramesCountOnce);r=this.latestFetchingFrameId===0&&!this.isFirstSlice;_context35.next=11;return Promise.all([mf(function(){return _this99.sequenceFetcher.fetchFramePickers(e,_this99.latestFetchingFrameId,i)}),r?mf(function(){return _this99.sequenceFetcher.initializeWithFrameId(e,_this99.latestFetchingFrameId)}):Promise.resolve(void 0)]);case 11:_yield$Promise$all=_context35.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);n=_yield$Promise$all2[0];s=_yield$Promise$all2[1];o=[];_iterator106=_createForOfIteratorHelper(n);try{for(_iterator106.s();!(_step106=_iterator106.n()).done;){a=_step106.value;this.latestFetchingFrameId=a.frameId,o.push({frameId:a.frameId,timestamp:a.timestamp,framePicker:a})}}catch(err){_iterator106.e(err)}finally{_iterator106.f()}return _context35.abrupt("return",(s&&(o[0].sequenceInitializer=s),o));case 19:case"end":return _context35.stop();}}},_callee34,this)}));function fetchFrames(){return _fetchFrames.apply(this,arguments)}return fetchFrames}()},{key:"removeTimestampOverFrames",value:function removeTimestampOverFrames(e,t){var i=e.findIndex(function(r){return r.timestamp>t});return i!==-1?(e.splice(i,e.length-i),!0):!1}}]);return ff}(),dh=ff;dh.fetchFramesCountOnce=600;var p0=/*#__PURE__*/function(){function p0(e){_classCallCheck(this,p0);this.sliceChunk=e.sliceChunk,this.imageFactory=e.imageFactory,this.sequenceFetcher=e.sequenceFetcher,this.toolsExtra=e.toolsExtra,this.enableAnimationFrame=e.enableAnimationFrame}_createClass(p0,[{key:"createWithFrameId",value:function(){var _createWithFrameId=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee35(e,t,i,r,n){var _this$sliceChunk$getF,s,o,a,c;return regeneratorRuntime.wrap(function _callee35$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:_this$sliceChunk$getF=this.sliceChunk.getFrameDescriptionWithFrameId(t);s=_this$sliceChunk$getF.sliceIndex;o=_this$sliceChunk$getF.frameId;a=this.sliceChunk.sliceAt(s);_context36.next=6;return this.sequenceFetcher.initializeWithFrameId(a,o);case 6:c=_context36.sent;return _context36.abrupt("return",new dh({logger:e,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:n,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp,sequenceInitializer:c,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:i,callbacks:r}));case 8:case"end":return _context36.stop();}}},_callee35,this)}));function createWithFrameId(_x41,_x42,_x43,_x44,_x45){return _createWithFrameId.apply(this,arguments)}return createWithFrameId}()},{key:"createWithProgressTime",value:function(){var _createWithProgressTime=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee36(e,t,i,r,n){var _this$sliceChunk$getF2,s,o,a,c,h;return regeneratorRuntime.wrap(function _callee36$(_context37){while(1){switch(_context37.prev=_context37.next){case 0:_this$sliceChunk$getF2=this.sliceChunk.getFrameDescriptionWithTimestamp(t);s=_this$sliceChunk$getF2.sliceIndex;o=_this$sliceChunk$getF2.timestamp;a=this.sliceChunk.sliceAt(s);c=o+a.beginTimestamp;_context37.next=7;return this.sequenceFetcher.initializeWithTimestamp(a,c);case 7:h=_context37.sent;return _context37.abrupt("return",new dh({logger:e,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:n,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp+t,sequenceInitializer:h,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:i,callbacks:r}));case 9:case"end":return _context37.stop();}}},_callee36,this)}));function createWithProgressTime(_x46,_x47,_x48,_x49,_x50){return _createWithProgressTime.apply(this,arguments)}return createWithProgressTime}()}]);return p0}(),gf;(function(e){e[e.FrameId=0]="FrameId",e[e.ProgressTime=1]="ProgressTime"})(gf||(gf={}));var m0=/*#__PURE__*/function(){function m0(e){_classCallCheck(this,m0);this.isRunningLoop=!1,this.task=null,this.id=0,this.callbacks=Object.freeze(Wt({},e))}_createClass(m0,[{key:"currentTaskId",get:function get(){return this.id}},{key:"isSeeking",get:function get(){return this.isRunningLoop}},{key:"stopSeeking",value:function stopSeeking(){this.task&&(this.task.complete(Ht.Stopped),this.task=null),this.id+=1}},{key:"seekToFrameId",value:function seekToFrameId(e){var _this100=this;return new Promise(function(t){!_this100.task||_this100.task.mode!==0||_this100.task.value!==e?(_this100.setNewTask(0,e,t),_this100.startTaskLoop()["catch"](function(i){return console.error(i)})):t(Ht.SuccessButUnnecessary)})}},{key:"seekToProgressTime",value:function seekToProgressTime(e){var _this101=this;return new Promise(function(t){!_this101.task||_this101.task.mode!==1||_this101.task.value!==e?(_this101.setNewTask(1,e,t),_this101.startTaskLoop()["catch"](function(i){return console.error(i)})):t(Ht.SuccessButUnnecessary)})}},{key:"setNewTask",value:function setNewTask(e,t,i){var r=this.id+=1;this.task&&this.task.complete(Ht.Override),this.task={id:r,mode:e,value:t,complete:i}}},{key:"startTaskLoop",value:function(){var _startTaskLoop=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee37(){var e,_this$task,t,i,r,n;return regeneratorRuntime.wrap(function _callee37$(_context38){while(1){switch(_context38.prev=_context38.next){case 0:if(this.isRunningLoop){_context38.next=23;break}_context38.prev=1;this.isRunningLoop=!0,this.callbacks.updateIsSeeking();case 3:if(!this.task){_context38.next=20;break}_this$task=this.task,t=_this$task.id,i=_this$task.mode,r=_this$task.value,n=void 0;_context38.t0=i;_context38.next=_context38.t0===0?8:_context38.t0===1?12:16;break;case 8:_context38.next=10;return this.callbacks.startSeekingToFrameId(t,r);case 10:n=_context38.sent;return _context38.abrupt("break",17);case 12:_context38.next=14;return this.callbacks.startSeekingToProgressTime(t,r);case 14:n=_context38.sent;return _context38.abrupt("break",17);case 16:throw new Error("invalid mode ".concat(i));case 17:this.id===t?((e=this.task)==null||e.complete(Ht.Success),this.task=null,this.callbacks.afterSeeking(n)):this.callbacks.cancelSeeking(n);case 18:_context38.next=3;break;case 20:_context38.prev=20;this.isRunningLoop=!1,this.callbacks.updateIsSeeking();return _context38.finish(20);case 23:case"end":return _context38.stop();}}},_callee37,this,[[1,,20,23]])}));function startTaskLoop(){return _startTaskLoop.apply(this,arguments)}return startTaskLoop}()}]);return m0}(),f0=/*#__PURE__*/function(){function f0(e){var _this102=this;_classCallCheck(this,f0);this._progressTime=0,this._playbackSpeed=1,this.isPlaying=!1,this.isMaskPhaseUpdating=!1,this.didStop=!1,this.currentLine=void 0,this.startSeekingToFrameId=/*#__PURE__*/function(){var _ref34=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee38(t,i){var r,n;return regeneratorRuntime.wrap(function _callee38$(_context39){while(1){switch(_context39.prev=_context39.next){case 0:r=i;r=Math.max(r,0),r=Math.min(r,_this102.framesCount);n=function n(s){return _this102.lineFactory.createWithFrameId(_this102.logger,r,_this102.playbackSpeed,s,_this102.currentLine)};_context39.next=5;return _this102.startSeekingTask(t,n);case 5:return _context39.abrupt("return",_context39.sent);case 6:case"end":return _context39.stop();}}},_callee38)}));return function(_x51,_x52){return _ref34.apply(this,arguments)}}(),this.startSeekingToProgressTime=/*#__PURE__*/function(){var _ref35=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee39(t,i){var r,n;return regeneratorRuntime.wrap(function _callee39$(_context40){while(1){switch(_context40.prev=_context40.next){case 0:r=i;r=Math.max(r,0),r=Math.min(r,_this102.duration),Number.isSafeInteger(r)||(r=Math.floor(r));n=function n(s){return _this102.lineFactory.createWithProgressTime(_this102.logger,r,_this102.playbackSpeed,s,_this102.currentLine)};_context40.next=5;return _this102.startSeekingTask(t,n);case 5:return _context40.abrupt("return",_context40.sent);case 6:case"end":return _context40.stop();}}},_callee39)}));return function(_x53,_x54){return _ref35.apply(this,arguments)}}(),this.afterSeeking=function(t){try{_this102.isMaskPhaseUpdating=!0,t.setup()}finally{_this102.isMaskPhaseUpdating=!1}_this102.changeCurrentLine(t)},this.cancelSeeking=function(t){t.destroy()},this.onLineSliceChanged=function(){var t,i;_this102.currentLine&&(_this102.sliceStateUpdater.refreshReconstructorLine(_this102.currentLine),_this102.callbacks.onModified&&_this102.callbacks.onModified(),_this102.onTick(_this102.currentLine.beginTimestamp),(i=(t=_this102.callbacks).onTriggerBuilt)==null||i.call(t))},this.currentIsPlayable=function(){if(_this102.didStop||!_this102.currentLine||_this102.seekingNode.isSeeking)return!1;switch(_this102.currentLine.phase){case pe.Playing:case pe.Pausing:return!0;case pe.PausingAndWaiting:case pe.Waiting:case pe.Ended:return!1;default:return!1;}},this.currentPhase=function(){if(_this102.didStop)return de.Stopped;if(!_this102.currentLine)return de.WaitingFirstFrame;if(_this102.seekingNode.isSeeking)return de.Seeking;switch(_this102.currentLine.phase){case pe.Playing:return de.Playing;case pe.Pausing:case pe.PausingAndWaiting:return de.Pause;case pe.Waiting:return de.Buffering;case pe.Ended:return de.Ended;default:throw new Error("invalid phase ".concat(_this102.currentLine.phase));}},this.touchPhaseChanged=function(){_this102.isMaskPhaseUpdating||(_this102.phaseNode.touch(),_this102.isPlayableNode.touch())},this.onTick=function(t){var i=Math.min(t-_this102.beginTimestamp,_this102.sliceChunk.duration);_this102._progressTime=i,_this102.callbacks.onProgressTimeChanged&&_this102.callbacks.onProgressTimeChanged(i)},this.onCatchError=function(t){_this102.didStop||(_this102.stop(),_this102.callbacks.onStoppedWithError&&_this102.callbacks.onStoppedWithError(t))},this.onEventFire=function(t){_this102.callbacks.onEventFire&&_this102.callbacks.onEventFire(_o(t,vi.Dispatched))},this.logger=e.logger,this.sliceChunk=e.sliceChunk,this.sequenceFetcher=e.sequenceFetcher,this.callbacks=Ms(e.callbacks),this.sliceStateUpdater=e.sliceStateUpdater,this.sliceStateUpdater.onSliceChanged=this.callbacks.onSliceChanged,this.sliceStateUpdater.onLibraryNodeChanged=this.callbacks.onLibraryNodeChanged,this.seekingNode=new m0({startSeekingToFrameId:this.startSeekingToFrameId,startSeekingToProgressTime:this.startSeekingToProgressTime,afterSeeking:this.afterSeeking,cancelSeeking:this.cancelSeeking,updateIsSeeking:this.touchPhaseChanged}),this.isPlayableNode=new On({phase:!1,onPhaseChanged:e.callbacks.onIsPlayableChanged,getCurrentPhase:this.currentIsPlayable}),this.phaseNode=new On({phase:de.WaitingFirstFrame,onPhaseChanged:e.callbacks.onPhaseChanged,getCurrentPhase:this.currentPhase}),this.lineFactory=new p0({sliceChunk:e.sliceChunk,imageFactory:e.imageFactory,sequenceFetcher:e.sequenceFetcher,toolsExtra:e.toolsExtra,enableAnimationFrame:e.enableAnimationFrame})}_createClass(f0,[{key:"trigger",get:function get(){if(!this.currentLine)throw new Error("trigger object not exist when Reconstructor's phase is ".concat(this.phase));return this.currentLine.trigger}},{key:"isPlayable",get:function get(){return this.isPlayableNode.phase}},{key:"phase",get:function get(){return this.phaseNode.phase}},{key:"progressTime",get:function get(){return this._progressTime}},{key:"slice",get:function get(){return this.sliceStateUpdater.slice}},{key:"sliceIndex",get:function get(){return this.sliceStateUpdater.sliceIndex}},{key:"libIdentifier",get:function get(){return this.sliceStateUpdater.libIdentifier}},{key:"libraryNode",get:function get(){return this.sliceStateUpdater.libraryNode}},{key:"roomUUID",get:function get(){return this.sliceChunk.roomUUID}},{key:"duration",get:function get(){return this.sliceChunk.duration}},{key:"framesCount",get:function get(){return this.sliceChunk.framesCount}},{key:"beginTimestamp",get:function get(){return this.sliceChunk.beginTimestamp}},{key:"playbackSpeed",get:function get(){return this.currentLine?this.currentLine.playbackSpeed:this._playbackSpeed},set:function set(e){this._playbackSpeed=e,this.currentLine&&(this.currentLine.playbackSpeed=e)}},{key:"play",value:function play(){var _this103=this;if(this.assertNotStop(),this.phaseNode.phase!==de.Ended){var e=this.isPlaying;this.isPlaying=!0,!e&&!this.seekingNode.isSeeking&&(this.currentLine?this.currentLine.play():this.seekToProgressTime(0)["catch"](function(t){return _this103.logger.error(t)})),this.touchPhaseChanged()}}},{key:"pause",value:function pause(){this.assertNotStop(),this.isPlaying&&!this.seekingNode.isSeeking&&this.currentLine&&this.currentLine.pause(),this.isPlaying=!1,this.touchPhaseChanged()}},{key:"stop",value:function stop(){this.assertNotStop(),this.seekingNode.stopSeeking(),this.currentLine&&(this.currentLine.destroy(),this.currentLine=void 0),this.didStop=!0,this.touchPhaseChanged()}},{key:"seekToFrameId",value:function seekToFrameId(e){return this.assertNotStop(),this.seekingNode.seekToFrameId(e)}},{key:"seekToProgressTime",value:function seekToProgressTime(e){return this.assertNotStop(),this.seekingNode.seekToProgressTime(e)}},{key:"startSeekingTask",value:function(){var _startSeekingTask=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee40(e,t){var i;return regeneratorRuntime.wrap(function _callee40$(_context41){while(1){switch(_context41.prev=_context41.next){case 0:_context41.prev=0;i=Wt({},this.wrapCallbacksWithTaskChecking(e,{onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame,onCatchErrorWhenFetchBuffer:this.onCatchError,onModified:this.callbacks.onModified,onSliceChanged:this.onLineSliceChanged,onEventFire:this.onEventFire,onTick:this.onTick,onPhaseChanged:this.touchPhaseChanged}));_context41.next=4;return t(i);case 4:return _context41.abrupt("return",_context41.sent);case 7:_context41.prev=7;_context41.t0=_context41["catch"](0);throw this.onCatchError(_context41.t0),_context41.t0;case 10:case"end":return _context41.stop();}}},_callee40,this,[[0,7]])}));function startSeekingTask(_x55,_x56){return _startSeekingTask.apply(this,arguments)}return startSeekingTask}()},{key:"changeCurrentLine",value:function changeCurrentLine(e){var t,i;this.currentLine&&this.currentLine.destroy(),this.currentLine=e,this.sliceStateUpdater.refreshReconstructorLine(e),this.isPlaying&&e.play(),this.callbacks.onModified&&this.callbacks.onModified(),this.onTick(e.beginTimestamp),(i=(t=this.callbacks).onTriggerBuilt)==null||i.call(t)}},{key:"wrapCallbacksWithTaskChecking",value:function wrapCallbacksWithTaskChecking(e,t){var _this104=this;var i={};var _loop15=function _loop15(_r25){var n=t[_r25];n&&(i[_r25]=function(){if(e===_this104.seekingNode.currentTaskId)return n.apply(void 0,arguments)})};for(var _r25 in t){_loop15(_r25)}return i}},{key:"assertNotStop",value:function assertNotStop(){if(this.didStop)throw new Error("Reconstructor did stop")}}]);return f0}(),Gr=8;function bf(e,t,i){var r=Math.min(e,i),n=Math.max(e,i),s=t;return t<r?s=r:t>n&&(s=n),s}var g0=/*#__PURE__*/function(){function g0(e){var _this105=this;_classCallCheck(this,g0);this.fetchLibraryNode=/*#__PURE__*/function(){var _ref36=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee41(t,i){var _r26;return regeneratorRuntime.wrap(function _callee41$(_context42){while(1){switch(_context42.prev=_context42.next){case 0:if(!(_this105.previousLibraryNode&&_this105.previousLibraryNode.libIdentifier===i)){_context42.next=2;break}return _context42.abrupt("return",_this105.previousLibraryNode.libraryNode);case 2:_context42.next=4;return _this105.libraryNodeFetcher({appIdentifier:t.appIdentifier,appVersion:t.appVersion,appHash:t.appHash,libIdentifier:i});case 4:_r26=_context42.sent;return _context42.abrupt("return",(_this105.previousLibraryNode=Object.freeze({libIdentifier:i,libraryNode:_r26}),_r26));case 6:case"end":return _context42.stop();}}},_callee41)}));return function(_x57,_x58){return _ref36.apply(this,arguments)}}(),this.logger=e.logger,this.fetcher=e.fetcher,this.roomToken=e.roomToken,this.libraryNodeFetcher=e.libraryNodeFetcher}_createClass(g0,[{key:"initializeWithTimestamp",value:function(){var _initializeWithTimestamp=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee42(e,t){var i,_yield$Promise$all3,_yield$Promise$all4,r,n;return regeneratorRuntime.wrap(function _callee42$(_context43){while(1){switch(_context43.prev=_context43.next){case 0:i=e.libIdentifier;_context43.next=3;return Promise.all([this.sequenceImageInitializerWithTimestamp(e,t),this.fetchLibraryNode(e,i)]);case 3:_yield$Promise$all3=_context43.sent;_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,2);r=_yield$Promise$all4[0];n=_yield$Promise$all4[1];return _context43.abrupt("return",Fs(Wt({},r),{libraryNode:n,libIdentifier:i}));case 8:case"end":return _context43.stop();}}},_callee42,this)}));function initializeWithTimestamp(_x59,_x60){return _initializeWithTimestamp.apply(this,arguments)}return initializeWithTimestamp}()},{key:"initializeWithFrameId",value:function(){var _initializeWithFrameId=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee43(e,t){var i,_yield$Promise$all5,_yield$Promise$all6,r,n;return regeneratorRuntime.wrap(function _callee43$(_context44){while(1){switch(_context44.prev=_context44.next){case 0:i=e.libIdentifier;_context44.next=3;return Promise.all([this.sequenceImageInitializerWithFrameId(e,t),this.fetchLibraryNode(e,i)]);case 3:_yield$Promise$all5=_context44.sent;_yield$Promise$all6=_slicedToArray(_yield$Promise$all5,2);r=_yield$Promise$all6[0];n=_yield$Promise$all6[1];return _context44.abrupt("return",Fs(Wt({},r),{libraryNode:n,libIdentifier:i}));case 8:case"end":return _context44.stop();}}},_callee43,this)}));function initializeWithFrameId(_x61,_x62){return _initializeWithFrameId.apply(this,arguments)}return initializeWithFrameId}()},{key:"sequenceImageInitializerWithTimestamp",value:function(){var _sequenceImageInitializerWithTimestamp=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee44(e,t){var i,r,n,s,o,a,c,u,h,d;return regeneratorRuntime.wrap(function _callee44$(_context45){while(1){switch(_context45.prev=_context45.next){case 0:i=bf(e.beginTimestamp,t,e.beginTimestamp+e.duration);_context45.next=3;return this.fetcher.fetch("persistence");case 3:r=_context45.sent;n=(0,yf.stringify)({timestamp:i});s="https://persistence/pv/rooms/".concat(e.roomUUID,"/slices/").concat(e.uuid,"/snapshots?").concat(n);_context45.next=8;return r.fetchJSON(s,{method:"get",headers:{"content-type":"application/json",token:this.roomToken}});case 8:o=_context45.sent;o||(this.logger.warn("cannot find snapshot that timestamp=".concat(i," and slice=").concat(e.uuid)),o={frameId:0,timestamp:e.beginTimestamp});_context45.next=12;return this.fetchFrameRouterPicker(e,o.frameId);case 12:a=_context45.sent;c=0;for(u=0;u<a.framesCount&&a.timestampAt(u)<=t;u++){c+=1}_context45.next=17;return this.fetchSnapshot(e,o.frameId);case 17:h=_context45.sent;if(!(c===0)){_context45.next=22;break}_context45.t0=[];_context45.next=25;break;case 22:_context45.next=24;return this.fetchFramePickers(e,o.frameId,c);case 24:_context45.t0=_context45.sent;case 25:d=_context45.t0;return _context45.abrupt("return",{snapshot:h.frameBuffer,actionFrames:d.map(function(u){return u.frameBuffer}),akkoSerVersion:oi(e.akkoVersion)});case 27:case"end":return _context45.stop();}}},_callee44,this)}));function sequenceImageInitializerWithTimestamp(_x63,_x64){return _sequenceImageInitializerWithTimestamp.apply(this,arguments)}return sequenceImageInitializerWithTimestamp}()},{key:"sequenceImageInitializerWithFrameId",value:function(){var _sequenceImageInitializerWithFrameId=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee45(e,t){var i,r,n,s;return regeneratorRuntime.wrap(function _callee45$(_context46){while(1){switch(_context46.prev=_context46.next){case 0:i=bf(0,t,e.framesCount-1);_context46.next=3;return this.fetchSnapshot(e,i);case 3:r=_context46.sent;n=i-r.frameId;if(!(n===0)){_context46.next=7;break}return _context46.abrupt("return",{snapshot:r.frameBuffer,actionFrames:[],akkoSerVersion:oi(e.akkoVersion)});case 7:_context46.next=9;return this.fetchFramePickers(e,r.frameId,n);case 9:s=_context46.sent;return _context46.abrupt("return",{snapshot:r.frameBuffer,actionFrames:s.map(function(o){return o.frameBuffer}),akkoSerVersion:oi(e.akkoVersion)});case 11:case"end":return _context46.stop();}}},_callee45,this)}));function sequenceImageInitializerWithFrameId(_x65,_x66){return _sequenceImageInitializerWithFrameId.apply(this,arguments)}return sequenceImageInitializerWithFrameId}()},{key:"fetchFramePickers",value:function(){var _fetchFramePickers=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee46(e,t,i){var _yield$this$getAssets,r,n,s,o,a,c,h,d,u,p;return regeneratorRuntime.wrap(function _callee46$(_context47){while(1){switch(_context47.prev=_context47.next){case 0:_context47.next=2;return this.getAssetsFetcherAndURL(e,"framesRouter");case 2:_yield$this$getAssets=_context47.sent;r=_yield$this$getAssets.fetcher;n=_yield$this$getAssets.url;_context47.next=7;return ya.pick(r,n,t,i);case 7:s=_context47.sent;_context47.next=10;return this.fetchBody(e,"framesBody",s.offset,s.length);case 10:o=_context47.sent;a=[];c=0;case 13:if(!(c<s.framesCount)){_context47.next=22;break}h=s.offsetAt(c)-s.offset,d=s.lengthAt(c);if(!(o.byteLength<h+d)){_context47.next=17;break}return _context47.abrupt("break",22);case 17:u=o.slice(h,d),p=new zt(u);a.push(p);case 19:++c;_context47.next=13;break;case 22:return _context47.abrupt("return",a);case 23:case"end":return _context47.stop();}}},_callee46,this)}));function fetchFramePickers(_x67,_x68,_x69){return _fetchFramePickers.apply(this,arguments)}return fetchFramePickers}()},{key:"fetchSnapshot",value:function(){var _fetchSnapshot=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee47(e,t){var _yield$this$getAssets2,i,r,n,s,o,a,c;return regeneratorRuntime.wrap(function _callee47$(_context48){while(1){switch(_context48.prev=_context48.next){case 0:_context48.next=2;return this.getAssetsFetcherAndURL(e,"snapshotsRouter");case 2:_yield$this$getAssets2=_context48.sent;i=_yield$this$getAssets2.fetcher;r=_yield$this$getAssets2.url;n=Math.floor(t/e.snapshotIdInterval);_context48.next=8;return ya.pick(i,r,n,1);case 8:s=_context48.sent;if(!(s.framesCount===0)){_context48.next=11;break}throw new Error("can't find snapshot with frameId ".concat(t));case 11:o=s.offsetAt(0);a=s.lengthAt(0);_context48.next=15;return this.fetchBody(e,"snapshotsBody",o,a);case 15:c=_context48.sent;return _context48.abrupt("return",new zt(c));case 17:case"end":return _context48.stop();}}},_callee47,this)}));function fetchSnapshot(_x70,_x71){return _fetchSnapshot.apply(this,arguments)}return fetchSnapshot}()},{key:"fetchFrameRouterPicker",value:function(){var _fetchFrameRouterPicker=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee48(e,t){var _yield$this$getAssets3,i,r,n;return regeneratorRuntime.wrap(function _callee48$(_context49){while(1){switch(_context49.prev=_context49.next){case 0:_context49.next=2;return this.getAssetsFetcherAndURL(e,"framesRouter");case 2:_yield$this$getAssets3=_context49.sent;i=_yield$this$getAssets3.fetcher;r=_yield$this$getAssets3.url;n=Math.min(e.framesCount-t,e.snapshotIdInterval-1);return _context49.abrupt("return",ya.pick(i,r,t,n));case 7:case"end":return _context49.stop();}}},_callee48,this)}));function fetchFrameRouterPicker(_x72,_x73){return _fetchFrameRouterPicker.apply(this,arguments)}return fetchFrameRouterPicker}()},{key:"fetchBody",value:function(){var _fetchBody=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee49(e,t,i,r){var _yield$this$getAssets4,n,s,o;return regeneratorRuntime.wrap(function _callee49$(_context50){while(1){switch(_context50.prev=_context50.next){case 0:_context50.next=2;return this.getAssetsFetcherAndURL(e,t);case 2:_yield$this$getAssets4=_context50.sent;n=_yield$this$getAssets4.fetcher;s=_yield$this$getAssets4.url;_context50.next=7;return n.fetchBuffer(s,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(i,"-").concat(i+r)}});case 7:o=_context50.sent;if(o){_context50.next=10;break}throw new Error("can't find \"".concat(s,"\""));case 10:return _context50.abrupt("return",o);case 11:case"end":return _context50.stop();}}},_callee49,this)}));function fetchBody(_x74,_x75,_x76,_x77){return _fetchBody.apply(this,arguments)}return fetchBody}()},{key:"getAssetsFetcherAndURL",value:function(){var _getAssetsFetcherAndURL=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee50(_ref37,r){var e,t,i,n,s,o,a;return regeneratorRuntime.wrap(function _callee50$(_context51){while(1){switch(_context51.prev=_context51.next){case 0:e=_ref37.uuid,t=_ref37.roomUUID,i=_ref37.token;_context51.t0=r;_context51.next=_context51.t0==="framesBody"?4:_context51.t0==="framesRouter"?6:_context51.t0==="snapshotsBody"?8:_context51.t0==="snapshotsRouter"?10:12;break;case 4:n="frames.body";return _context51.abrupt("break",12);case 6:n="frames.router";return _context51.abrupt("break",12);case 8:n="snapshots.body";return _context51.abrupt("break",12);case 10:n="snapshots.router";return _context51.abrupt("break",12);case 12:i?(s="assets-auth",o=i[r]):s="assets";a="https://".concat(s,"/").concat(t,"/").concat(e,"/").concat(n);o&&(a+="?auth_key="+o);_context51.next=17;return this.fetcher.fetch(s);case 17:_context51.t1=_context51.sent;_context51.t2=a;return _context51.abrupt("return",{fetcher:_context51.t1,url:_context51.t2});case 20:case"end":return _context51.stop();}}},_callee50,this)}));function getAssetsFetcherAndURL(_x78,_x79){return _getAssetsFetcherAndURL.apply(this,arguments)}return getAssetsFetcherAndURL}()}]);return g0}(),ya=/*#__PURE__*/function(){function ya(e,t){_classCallCheck(this,ya);this.buffer=e,this.framesCount=t,this.framesCount>0?this.offset=this.offsetAt(0):this.offset=Number.NaN}_createClass(ya,[{key:"length",get:function get(){if(this._length===void 0){this._length=0;for(var e=0;e<this.framesCount;++e){this._length+=this.lengthAt(e)}}return this._length}},{key:"timestampAt",value:function timestampAt(e){var t=3*Gr,i=e*t+0*Gr;return this.buffer.getUint64(i)}},{key:"offsetAt",value:function offsetAt(e){var t=3*Gr,i=e*t+1*Gr;return this.buffer.getUint64(i)}},{key:"lengthAt",value:function lengthAt(e){var t=3*Gr,i=e*t+2*Gr;return this.buffer.getUint64(i)}}],[{key:"pick",value:function(){var _pick=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee51(e,t,i,r){var n,s,o,a,c;return regeneratorRuntime.wrap(function _callee51$(_context52){while(1){switch(_context52.prev=_context52.next){case 0:n=3*Gr;s=i*n;o=(i+r)*n-1;_context52.next=5;return e.fetchBuffer(t,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(s,"-").concat(o)}});case 5:a=_context52.sent;a||(a=vt(0));c=Math.floor(a.byteLength/n);return _context52.abrupt("return",new ya(a,c));case 9:case"end":return _context52.stop();}}},_callee51)}));function pick(_x80,_x81,_x82,_x83){return _pick.apply(this,arguments)}return pick}()}]);return ya}(),y0=/*#__PURE__*/function(){function y0(e){_classCallCheck(this,y0);this.slices=Object.freeze(_toConsumableArray(e.slices).sort(function(t,i){return t.beginTimestamp-i.beginTimestamp})),this.beginAt=e.beginAt,this.endAt=e.endAt,this.roomUUID=this.getRoomUUID(),this.framesCount=this.getFramesCount()}_createClass(y0,[{key:"getRoomUUID",value:function getRoomUUID(){var e=this.slices[0].roomUUID;for(var t=1;t<this.slices.length;++t){if(e!==this.slices[t].roomUUID)throw new Error("all slices should have the same roomUUID")}return e}},{key:"getFramesCount",value:function getFramesCount(){var e=0;var _iterator107=_createForOfIteratorHelper(this.slices),_step107;try{for(_iterator107.s();!(_step107=_iterator107.n()).done;){var t=_step107.value;e+=t.framesCount}}catch(err){_iterator107.e(err)}finally{_iterator107.f()}return e}},{key:"beginTimestamp",get:function get(){return this.beginAt}},{key:"duration",get:function get(){return this.endAt-this.beginAt}},{key:"slicesCount",get:function get(){return this.slices.length}},{key:"sliceAt",value:function sliceAt(e){return this.slices[e]}},{key:"getFrameDescriptionWithFrameId",value:function getFrameDescriptionWithFrameId(e){var t=e,i=0;for(var _r27=0;_r27<this.slices.length;++_r27){var n=this.slices[_r27];if(i=_r27,t<n.framesCount)break;t-=n.framesCount}return{frameId:t,sliceIndex:i}}},{key:"getFrameDescriptionWithTimestamp",value:function getFrameDescriptionWithTimestamp(e){var t=e+this.beginAt,i=0;for(var n=0;n<this.slices.length;++n){var s=this.slices[n];if(i=n,t<s.beginTimestamp+s.duration)break}var r=Math.max(0,t-this.slices[i].beginTimestamp);return{sliceIndex:i,timestamp:r}}}]);return y0}(),b0=/*#__PURE__*/function(){function b0(e){var _this106=this;_classCallCheck(this,b0);this._libraryNodeFetcher=e,this.libraryNodeFetcher=function(t){return _this106._libraryNode&&_this106._libIdentifier===t.libIdentifier?Promise.resolve(_this106._libraryNode):_this106._libraryNodeFetcher(t)}}_createClass(b0,[{key:"sliceIndex",get:function get(){return this._sliceIndex}},{key:"slice",get:function get(){return this._slice}},{key:"libIdentifier",get:function get(){return this._libIdentifier}},{key:"libraryNode",get:function get(){return this._libraryNode}},{key:"refreshReconstructorLine",value:function refreshReconstructorLine(e){(e.libIdentifier!==this._libIdentifier||e.libraryNode!==this._libraryNode)&&(this._libIdentifier=e.libIdentifier,this._libraryNode=e.libraryNode,this.onLibraryNodeChanged&&this.onLibraryNodeChanged(this._libIdentifier,this._libraryNode)),e.sliceIndex!==this._sliceIndex&&(this._sliceIndex=e.sliceIndex,this._slice=e.slice,this.onSliceChanged&&this.onSliceChanged(this._slice,this._sliceIndex))}}]);return b0}(),vf=/*#__PURE__*/function(){function vf(e,t,i,r){_classCallCheck(this,vf);this.fetcherFactory=e,this.imageFactory=t,this.clientVersion=i,this.enableAnimationFrame=r}_createClass(vf,[{key:"createReconstructor",value:function(){var _createReconstructor=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee52(e,t){var i,r,n,s;return regeneratorRuntime.wrap(function _callee52$(_context53){while(1){switch(_context53.prev=_context53.next){case 0:i=t.rangeQuery;r=new b0(t.libraryNodeFetcher);n=new g0({logger:t.logger,roomToken:t.roomToken,fetcher:this.fetcherFactory.create(i.region),libraryNodeFetcher:r.libraryNodeFetcher});_context53.next=5;return this.fetchSliceChunk(i);case 5:s=_context53.sent;if(s){_context53.next=8;break}throw new Error("couldn't find any matching slices");case 8:return _context53.abrupt("return",new f0({logger:t.logger,sliceChunk:s,imageFactory:this.imageFactory,sequenceFetcher:n,sliceStateUpdater:r,toolsExtra:e,enableAnimationFrame:this.enableAnimationFrame,callbacks:t.callbacks||{}}));case 9:case"end":return _context53.stop();}}},_callee52,this)}));function createReconstructor(_x84,_x85){return _createReconstructor.apply(this,arguments)}return createReconstructor}()},{key:"searchSlices",value:function(){var _searchSlices=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee53(e){var t,i,_r28;return regeneratorRuntime.wrap(function _callee53$(_context54){while(1){switch(_context54.prev=_context54.next){case 0:_context54.next=2;return this.fetchSliceChunk(e);case 2:t=_context54.sent;i=[];if(t)for(_r28=0;_r28<t.slicesCount;++_r28){i.push(t.sliceAt(_r28))}return _context54.abrupt("return",i);case 6:case"end":return _context54.stop();}}},_callee53,this)}));function searchSlices(_x86){return _searchSlices.apply(this,arguments)}return searchSlices}()},{key:"fetchSliceChunk",value:function(){var _fetchSliceChunk=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee54(e){var _this107=this;var t,i,_r29,n,s,_r30,_n23,_s13,o,_r31,_n24,_iterator108,_step108,_s14;return regeneratorRuntime.wrap(function _callee54$(_context55){while(1){switch(_context55.prev=_context55.next){case 0:_context55.next=2;return this.fetcherFactory.create(e.region).fetch("persistence");case 2:t=_context55.sent;if(!(e.slice!==void 0)){_context55.next=14;break}_r29={clientVersion:this.clientVersion};n="https://persistence/pv/rooms/".concat(e.room,"/slices/").concat(e.slice,"?").concat((0,hh.stringify)(_r29));_context55.next=8;return t.fetchJSON(n,{headers:{"content-type":"application/json",token:e.roomToken}});case 8:s=_context55.sent;if(!(e.room!==void 0&&e.room!==s.roomUUID)){_context55.next=11;break}throw new Error("slice ".concat(s.uuid," is not belongs to room ").concat(e.room));case 11:i=[s];_context55.next=22;break;case 14:if(!(e.room!==void 0)){_context55.next=21;break}_r30=e.beginTimestamp,_n23=e.beginTimestamp!==void 0&&e.duration!==void 0?e.beginTimestamp+e.duration:void 0,_s13={beginAt:_r30,endAt:_n23,clientVersion:this.clientVersion},o="https://persistence/pv/rooms/".concat(e.room,"/slices?").concat((0,hh.stringify)(_s13));_context55.next=18;return t.fetchJSON(o,{headers:{"content-type":"application/json",token:e.roomToken}});case 18:i=_context55.sent;_context55.next=22;break;case 21:throw new Error("expect either room or slice");case 22:if(!(i=i.map(function(r){return _this107.fillSliceLibIdentifier(r)}),i.length>0)){_context55.next=31;break}_r31=e.beginTimestamp;_r31===void 0&&(_r31=Math.min.apply(Math,_toConsumableArray(i.map(function(s){return s.beginTimestamp}))));e.duration?_n24=_r31+e.duration:_n24=Math.max.apply(Math,_toConsumableArray(i.map(function(s){return s.beginTimestamp+s.duration})));_iterator108=_createForOfIteratorHelper(i);try{for(_iterator108.s();!(_step108=_iterator108.n()).done;){_s14=_step108.value;Object.freeze(_s14)}}catch(err){_iterator108.e(err)}finally{_iterator108.f()}return _context55.abrupt("return",(i=i.filter(function(s){var o=s.beginTimestamp;return s.beginTimestamp+s.duration>=_r31&&o<=_n24}),new y0({beginAt:_r31,endAt:_n24,slices:i})));case 31:return _context55.abrupt("return",null);case 32:case"end":return _context55.stop();}}},_callee54,this)}));function fetchSliceChunk(_x87){return _fetchSliceChunk.apply(this,arguments)}return fetchSliceChunk}()},{key:"fillSliceLibIdentifier",value:function fillSliceLibIdentifier(e){var t,_e$libIdentifier$repl=e.libIdentifier.replace(/\.\w+$/im,"").split("-"),_e$libIdentifier$repl2=_slicedToArray(_e$libIdentifier$repl,2),i=_e$libIdentifier$repl2[0],r=_e$libIdentifier$repl2[1];if(i&&r)try{if(St.compare(St.parse(r),St.parse("2.7.0"))<0)switch(i){case"2.0.0":{t="2.0.0-2.7.9.0f385eb562396be49fb451e80c1d85fa";break}case"2.1.0":{t="2.1.0-2.8.0.fb7b9e324522d815ee4e40990d061a0b";break}}}catch(n){console.warn(n)}return t?Fs(Wt({},e),{libIdentifier:t}):e}}]);return vf}(),de;(function(e){e.WaitingFirstFrame="waitingFirstFrame",e.Playing="playing",e.Pause="pause",e.Stopped="stopped",e.Ended="ended",e.Buffering="buffering",e.Seeking="seeking"})(de||(de={}));var Ht;(function(e){e[e.Success=0]="Success",e[e.SuccessButUnnecessary=1]="SuccessButUnnecessary",e[e.Override=2]="Override",e[e.Stopped=3]="Stopped"})(Ht||(Ht={}));var uh=/*#__PURE__*/function(){function uh(e){_classCallCheck(this,uh);var t=e.onAkkoSetupFailed,i=_m({escapeObjectFilter:e.escapeObjectFilter,jsxFactory:e.jsxFactory,observerAdapter:e.observerAdapter});if(this.imageFactory=new ea(i),this.convertIdToUrl=e.convertIdToUrl,e.shuntApiHosts){var _r32=new Bw({appIdentifier:e.appIdentifier,shuntApiHosts:e.shuntApiHosts,onInterruptConfigs:e.configsInterrupter,onAkkoSetupFailed:function onAkkoSetupFailed(a){console.error("akko setup failed: ".concat(a.stack||a.message)),t&&t(a)}}),n=!!e.enableAnimationFrame,s={enableAnimationFrame:n},o=qw(e.reconnectionOptions);this.magixFactory=new u0(_r32,this.imageFactory,o,e.netStateAdapter,e.clientVersion,s),this.playerFactory=new vf(_r32,this.imageFactory,e.clientVersion,n)}}_createClass(uh,[{key:"createMagix",value:function createMagix(e){if(!this.magixFactory)throw new Error("expect shuntApiHosts");var t=new Km().create({convertIdToUrl:this.convertIdToUrl}),i=Object.freeze({resource:t});return this.magixFactory.createMagix(i,e)}},{key:"createReconstructor",value:function createReconstructor(e){if(!this.playerFactory)throw new Error("expect shuntApiHosts");var t=new Km().create({convertIdToUrl:this.convertIdToUrl}),i=Object.freeze({resource:t});return this.playerFactory.createReconstructor(i,e)}},{key:"searchSlices",value:function(){var _searchSlices2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee55(e){return regeneratorRuntime.wrap(function _callee55$(_context56){while(1){switch(_context56.prev=_context56.next){case 0:if(this.playerFactory){_context56.next=2;break}throw new Error("expect shuntApiHosts");case 2:_context56.next=4;return this.playerFactory.searchSlices(e);case 4:return _context56.abrupt("return",_context56.sent);case 5:case"end":return _context56.stop();}}},_callee55,this)}));function searchSlices(_x88){return _searchSlices2.apply(this,arguments)}return searchSlices}()}]);return uh}();var zh={};No(zh,{AnimationMode:function AnimationMode(){return Q},Boundless:function Boundless(){return qs},BoundlessEventKind:function BoundlessEventKind(){return v},CNode:function CNode(){return gr},CameraTransformation:function CameraTransformation(){return di},CanvasPaitingMode:function CanvasPaitingMode(){return Jr},CanvasRenderMode:function CanvasRenderMode(){return Ks},CanvasRenderState:function CanvasRenderState(){return jh},ComponentKind:function ComponentKind(){return Ci},DeviceType:function DeviceType(){return Se},LayoutKind:function LayoutKind(){return en},LayoutRenderMode:function LayoutRenderMode(){return Zs},RectangleAdapterMode:function RectangleAdapterMode(){return hi},RectangleTesting:function RectangleTesting(){return br},RenderLayoutMode:function RenderLayoutMode(){return Kr},creatHTMLRenderEngine:function creatHTMLRenderEngine(){return Hf},createCanvasRenderEngine:function createCanvasRenderEngine(){return Wf},createComponentDefinition:function createComponentDefinition(){return Bh},distance:function distance(){return Pg},isCanvasRenderEngine:function isCanvasRenderEngine(){return ak},isHTMLRenderEngine:function isHTMLRenderEngine(){return pk},midpoint:function midpoint(){return Xn},unitVector:function unitVector(){return Ig}});var xf=x(require("spark-md5")),v0=Object.defineProperty,S0=Object.defineProperties,w0=Object.getOwnPropertyDescriptors,Sf=Object.getOwnPropertySymbols,k0=Object.prototype.hasOwnProperty,C0=Object.prototype.propertyIsEnumerable,wf=function wf(e,t,i){return t in e?v0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Bs=function Bs(e,t){for(var i in t||(t={})){k0.call(t,i)&&wf(e,i,t[i])}if(Sf){var _iterator109=_createForOfIteratorHelper(Sf(t)),_step109;try{for(_iterator109.s();!(_step109=_iterator109.n()).done;){var i=_step109.value;C0.call(t,i)&&wf(e,i,t[i])}}catch(err){_iterator109.e(err)}finally{_iterator109.f()}}return e},x0=function x0(e,t){return S0(e,w0(t))},js=Object.freeze({debug:0,info:1,warn:2,error:3}),Gn=/*#__PURE__*/function(){function Gn(){var _ref38=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},e=_ref38.prefix,t=_ref38.levelMask;_classCallCheck(this,Gn);this.prefix=e,this.levelMaskIndex=js[t||"info"]}_createClass(Gn,[{key:"log",value:function log(e,t,i){js[t]>=this.levelMaskIndex&&(this.prefix?console[t](this.prefix,i):console[t](i))}},{key:"commit",value:function commit(){}},{key:"isSupportedEvents",value:function isSupportedEvents(e){return!0}}]);return Gn}();function kf(e){var t={};for(var i in e){var _r33=e[i];_r33!==void 0&&(t[i]=_r33)}return t}function mh(e){if(_typeof(e)!="object"||e===null)return e;if(e instanceof Array){var t=[];var _iterator110=_createForOfIteratorHelper(e),_step110;try{for(_iterator110.s();!(_step110=_iterator110.n()).done;){var i=_step110.value;t.push(mh(i))}}catch(err){_iterator110.e(err)}finally{_iterator110.f()}return Object.freeze(t)}else{var _t8={};for(var _i28 in e){_t8[_i28]=mh(e[_i28])}return Object.freeze(_t8)}}function zs(e,t,i){if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));var r=i?{context:kf(i)}:{};return Cf(e,t,r)}function Cf(e,t,i){var r={debug:ba(e,"debug",t,i),info:ba(e,"info",t,i),warn:ba(e,"warn",t,i),error:ba(e,"error",t,i),withContext:function withContext(n){return Cf(e,t,{context:Bs(Bs({},i.context),n)})}};return Object.defineProperty(r,"context",{enumerable:!1,set:function set(n){return i.context=n},get:function get(){return i.context}}),Object.freeze(r)}function ba(e,t,i,r){return function(){for(var _len17=arguments.length,n=new Array(_len17),_key17=0;_key17<_len17;_key17++){n[_key17]=arguments[_key17]}for(var a=0;a<n.length;++a){n[a]=P0(n[a])}var s=I0(r),o=n.join(" ");e.log(i,t,o,s)}}function I0(e){var t;if(e.context){t||(t={});for(var i in e.context){t[i]=e.context[i]}}return Object.freeze(t)}function P0(e){if(e instanceof Error){var t="Error: "+e.message+"\n";return typeof e.stack=="string"?t+e.stack.replace(t,""):t}else try{return"".concat(e)}catch(t){return"[".concat(_typeof(e)," ").concat(JSON.stringify(t.message),"]")}}function va(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));var r=Object.freeze(kf(i));return Object.freeze({commit:function commit(n){e.commit(t,Bs(Bs({},r),n))}})}var M0=function M0(e){if((typeof process==="undefined"?"undefined":_typeof(process))=="object"&&process+""=="[object process]")return Buffer.from(e).toString("base64");{var t=32768,i="",_r34,n=0,s=e.length;for(;n<s;){_r34=e.subarray(n,Math.min(n+t,s)),i+=String.fromCharCode.apply(null,_r34),n+=t}return btoa(i)}},If=/*#__PURE__*/function(){function If(e,t){_classCallCheck(this,If);this.argusEvents=mh(e),this.vid=t}_createClass(If,[{key:"encode",value:function encode(e,t){var i=x0(Bs({},t),{vid:this.vid,lts:Date.now(),clientIP:"__#CLIENT_IP#__"}),_this$argusEvents$e=this.argusEvents[e],r=_this$argusEvents$e.eventID,n=_this$argusEvents$e.proto,s=n.verify(i);if(s)throw new Error(s);var o=n.create(i),a=n.encode(o).finish(),c=M0(a),h="whiteBoard",d=Math.floor(Date.now()/1e3),u=xf["default"].hash("payload=".concat(c,"&src=").concat(h,"&ts=").concat(d));return{id:r,src:h,payload:c,qos:this.vid===1?101:1,ts:d,sign:u}}}]);return If}(),Pf=/*#__PURE__*/function(){function Pf(){_classCallCheck(this,Pf);this.queue=[]}_createClass(Pf,[{key:"append",value:function append(e){this.queue.push(e)}},{key:"next",get:function get(){return this.queue[0]}},{key:"done",value:function done(){this.queue.shift()}},{key:"length",get:function get(){return this.queue.length}}]);return Pf}(),fh=3,T0=1e3,E0=/*#__PURE__*/function(){var _ref39=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee56(e,t){var _loop16,i,_ret2;return regeneratorRuntime.wrap(function _callee56$(_context58){while(1){switch(_context58.prev=_context58.next){case 0:_loop16=/*#__PURE__*/regeneratorRuntime.mark(function _loop16(i){return regeneratorRuntime.wrap(function _loop16$(_context57){while(1){switch(_context57.prev=_context57.next){case 0:_context57.prev=0;_context57.next=3;return e(t);case 3:return _context57.abrupt("return","break");case 6:_context57.prev=6;_context57.t0=_context57["catch"](0);if(!(i===fh)){_context57.next=10;break}throw new Error("report log failed (with ".concat(fh," times failed), error: ").concat(_context57.t0));case 10:_context57.next=12;return new Promise(function(n){setTimeout(n,i*T0)});case 12:case"end":return _context57.stop();}}},_loop16,null,[[0,6]])});i=1;case 2:if(!(i<=fh)){_context58.next=10;break}return _context58.delegateYield(_loop16(i),"t0",4);case 4:_ret2=_context58.t0;if(!(_ret2==="break")){_context58.next=7;break}return _context58.abrupt("break",10);case 7:i++;_context58.next=2;break;case 10:case"end":return _context58.stop();}}},_callee56)}));return function E0(_x89,_x90){return _ref39.apply(this,arguments)}}(),Mf=/*#__PURE__*/function(){function Mf(e,t,i,r){_classCallCheck(this,Mf);this.logQueue=e,this.resourceURL=t,this.request=i,this.warnLog=r}_createClass(Mf,[{key:"report",value:function(){var _report=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee57(e){var _this108=this;var t;return regeneratorRuntime.wrap(function _callee57$(_context59){while(1){switch(_context59.prev=_context59.next){case 0:if(!(this.logQueue.append(e),this.logQueue.length===1)){_context59.next=19;break}case 1:t=this.logQueue.next;if(!t){_context59.next=16;break}_context59.prev=3;_context59.next=6;return E0(function(i){return _this108.request(i,_this108.resourceURL)},t);case 6:_context59.next=11;break;case 8:_context59.prev=8;_context59.t0=_context59["catch"](3);this.warnLog(_context59.t0);case 11:_context59.prev=11;this.logQueue.done();return _context59.finish(11);case 14:_context59.next=17;break;case 16:return _context59.abrupt("break",19);case 17:_context59.next=1;break;case 19:case"end":return _context59.stop();}}},_callee57,this,[[3,8,11,14]])}));function report(_x91){return _report.apply(this,arguments)}return report}()}]);return Mf}();var mr=x(require("react")),$s=x(require("react")),Ta=x(require("react")),Qr=x(require("react")),qr=x(require("react")),Hi=x(require("react")),$f=x(require("@juggle/resize-observer")),Oh=x(require("react")),cg=x(require("react")),ug=x(require("react")),Ra=x(require("react-dom")),Zr=x(require("react")),Na=x(require("react")),wg=x(require("uuid")),A0=Object.defineProperty,O0=Object.defineProperties,R0=Object.getOwnPropertyDescriptors,Tf=Object.getOwnPropertySymbols,N0=Object.prototype.hasOwnProperty,L0=Object.prototype.propertyIsEnumerable,Ef=function Ef(e,t,i){return t in e?A0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},B=function B(e,t){for(var i in t||(t={})){N0.call(t,i)&&Ef(e,i,t[i])}if(Tf){var _iterator111=_createForOfIteratorHelper(Tf(t)),_step111;try{for(_iterator111.s();!(_step111=_iterator111.n()).done;){var i=_step111.value;L0.call(t,i)&&Ef(e,i,t[i])}}catch(err){_iterator111.e(err)}finally{_iterator111.f()}}return e},Le=function Le(e,t){return O0(e,R0(t))},fE=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},v;(function(e){e.MouseDown="MouseDown",e.MouseMove="MouseMove",e.MouseUp="MouseUp",e.MouseLeave="MouseLeave",e.MouseWheel="MouseWheel",e.TouchStart="TouchStart",e.TouchMove="TouchMove",e.TouchEnd="TouchEnd",e.TouchCancel="TouchCancel",e.SortedTouchStart="SortedTouchStart",e.SortedTouchMove="SortedTouchMove",e.SortedTouchEnd="SortedTouchEnd",e.SortedTouchCancel="SortedTouchCancel",e.KeyDown="KeyDown",e.KeyUp="KeyUp"})(v||(v={}));var Kr;(function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"})(Kr||(Kr={}));var gh=/*#__PURE__*/function(){function gh(e){_classCallCheck(this,gh);this.definitions={},this.id="".concat(gh.nextId),this.orderIndex=e,gh.nextId+=1}_createClass(gh,[{key:"addDefinition",value:function addDefinition(e){this.definitions[e.id]=e}}]);return gh}(),Us=gh;Us.nextId=0;var Af;(function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.Safari=2]="Safari",e[e.IE=3]="IE",e[e.Other=4]="Other",e[e.Unkown=5]="Unkown"})(Af||(Af={}));var D0=/*#__PURE__*/function(){function D0(){_classCallCheck(this,D0);this.kind=5}_createClass(D0,[{key:"getContext",value:function getContext(e){var t=e.getContext("2d");switch(t.imageSmoothingEnabled=!1,this.kind){case 0:{t.mozImageSmoothingEnabled=!1;break}case 1:{t.oImageSmoothingEnabled=!1;break}case 2:{t.webkitImageSmoothingEnabled=!1;break}case 3:{t.msImageSmoothingEnabled=!1;break}case 5:{t.mozImageSmoothingEnabled!==void 0?(t.mozImageSmoothingEnabled=!1,this.kind=0):t.oImageSmoothingEnabled!==void 0?(t.oImageSmoothingEnabled=!1,this.kind=1):t.webkitImageSmoothingEnabled!==void 0?(t.webkitImageSmoothingEnabled=!1,this.kind=2):t.msImageSmoothingEnabled!==void 0&&(t.msImageSmoothingEnabled=!1,this.kind=3);break}}return t}}]);return D0}(),F0=new D0;function Vs(e){return F0.getContext(e)}var B0=/*#__PURE__*/function(){function B0(){_classCallCheck(this,B0);this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}_createClass(B0,[{key:"recordPaintFloat",value:function recordPaintFloat(){this.paintFloatCount+=1}},{key:"recordGenerateCache",value:function recordGenerateCache(){this.generateCacheCount+=1}},{key:"recordPaintCache",value:function recordPaintCache(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.paintCacheCount+=e}},{key:"recordFuseCache",value:function recordFuseCache(){this.fuseCacheCount+=1}},{key:"recordFuse",value:function recordFuse(e){this.fuseCount+=e}},{key:"recordSplit",value:function recordSplit(){this.splitCount+=1}},{key:"clear",value:function clear(){this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}},{key:"print",value:function print(){console.log("\n========="),console.log("paintFloatCount",this.paintFloatCount),console.log("generateCacheCount",this.generateCacheCount),console.log("paintCacheCount",this.paintCacheCount),console.log("fuseCacheCount",this.fuseCacheCount),console.log("fuseCount",this.fuseCount),console.log("splitCount",this.splitCount),this.clear()}}]);return B0}(),Of=Object.freeze({forEach:function forEach(){return!1}});function j0(e,t){return new wa(Sa.Fusion,e,t)}function z0(e,t){return new wa(Sa.Rejection,e,t)}var Sa;(function(e){e[e.Fusion=0]="Fusion",e[e.Rejection=1]="Rejection"})(Sa||(Sa={}));var wa=/*#__PURE__*/function(){function wa(e,t,i){var _this109=this;_classCallCheck(this,wa);this.cells={},this.forEach=function(r){if(_this109.mode===0)for(var n in _this109.cells){var _this109$cells$n=_this109.cells[n],s=_this109$cells$n.row,o=_this109$cells$n.column;if(r(s,o))return!0}return _this109.range.forEach(function(n,s){var o=wa.key(n,s);return!!(!_this109.cells[o]&&r(n,s))})},this.mode=e,this.range=t;var _iterator112=_createForOfIteratorHelper(i),_step112;try{for(_iterator112.s();!(_step112=_iterator112.n()).done;){var _r35=_step112.value;var n=wa.key(_r35.row,_r35.column);this.cells[n]=_r35}}catch(err){_iterator112.e(err)}finally{_iterator112.f()}}_createClass(wa,null,[{key:"key",value:function key(e,t){return"".concat(e,":").concat(t)}}]);return wa}(),De=/*#__PURE__*/function(){function De(e,t,i,r){var _this110=this;_classCallCheck(this,De);this.row0=e,this.row1=t,this.column0=i,this.column1=r,this.forEach=function(n){var s=_this110.row0,o=_this110.row1,a=_this110.column0,c=_this110.column1;for(var h=s;h<o;++h){for(var d=a;d<c;++d){if(n(h,d))return!0}}return!1}}_createClass(De,[{key:"toString",value:function toString(){return"[row0=".concat(this.row0," row1=").concat(this.row1," column0=").concat(this.column0," column1=").concat(this.column1,"]")}},{key:"excludeForEach",value:function excludeForEach(e){var t=this.row0,i=this.row1,r=this.column0,n=this.column1,s=t,o=this.clamp(t,e.row0,i),a=this.clamp(t,e.row1,i),c=i,h=r,d=this.clamp(r,e.column0,n),u=this.clamp(r,e.column1,n),p=n;return{forEach:function forEach(f){for(var m=s;m<o;++m){for(var g=r;g<n;++g){if(f(m,g))return!0}}for(var _m2=a;_m2<c;++_m2){for(var _g2=r;_g2<n;++_g2){if(f(_m2,_g2))return!0}}for(var _m3=o;_m3<a;++_m3){for(var _g3=h;_g3<d;++_g3){if(f(_m3,_g3))return!0}}for(var _m4=o;_m4<a;++_m4){for(var _g4=u;_g4<p;++_g4){if(f(_m4,_g4))return!0}}return!1}}}},{key:"clamp",value:function clamp(e,t,i){var r=t;return r<e?r=e:r>i&&(r=i),r}},{key:"rowsCount",get:function get(){return this.row1-this.row0}},{key:"columnsCount",get:function get(){return this.column1-this.column0}},{key:"includes",value:function includes(e,t){return this.row0<=e&&e<this.row1&&this.column0<=t&&t<this.column1}},{key:"includesRange",value:function includesRange(_ref40){var e=_ref40.row0,t=_ref40.row1,i=_ref40.column0,r=_ref40.column1;return this.row0<=e&&t<=this.row1&&this.column0<=i&&r<=this.column1}},{key:"merge",value:function merge(e,t,i){var r=new De(Math.floor(this.row0/e),Math.ceil(this.row1/e),Math.floor(this.column0/t),Math.ceil(this.column1/t)),n=r.row0,s=r.row1,o=r.column0,a=r.column1;for(var c=n;c<s;++c){for(var h=o;h<a;++h){var d=!1,u=c*e,p=(c+1)*e,f=h*t,m=(h+1)*t;u<this.row0&&(u=this.row0,d=!0),p>this.row1&&(p=this.row1,d=!0),f<this.column0&&(f=this.column0,d=!0),m>this.column1&&(m=this.column1,d=!0);var g=new De(u,p,f,m);g.rowsCount>0&&g.columnsCount>0&&i(c,h,g,d)}}return r}},{key:"fork",value:function fork(e,t,i){var r=this.row0,n=this.row1,s=this.column0,o=this.column1;for(var a=r;a<n;++a){for(var c=s;c<o;++c){i(a,c,new De(a*e,(a+1)*e,c*t,(c+1)*t))}}return new De(this.row0*e,this.row1*e,this.column0*t,this.column1*t)}}],[{key:"rectToRange",value:function rectToRange(e,t){var i=e.originX,r=e.originY,n=e.width,s=e.height,o=t.width,a=t.height,c=Math.floor(r/a),h=Math.floor(i/o),d=Math.floor((r+s)/a)+1,u=Math.floor((i+n)/o)+1;return new De(c,d,h,u)}},{key:"cellToRect",value:function cellToRect(e,t,_ref41){var i=_ref41.width,r=_ref41.height;var n=t*i,s=e*r;return{originX:n,originY:s,width:i,height:r}}},{key:"calcIntersection",value:function calcIntersection(e,t){var i=Math.max(e.row0,t.row0),r=Math.min(e.row1,t.row1),n=Math.max(e.column0,t.column0),s=Math.min(e.column1,t.column1);return i<r&&n<s?new De(i,r,n,s):null}},{key:"calcDiff",value:function calcDiff(e,t){var i=this.calcIntersection(e,t);return{addedRange:e.excludeForEach(t),removedRange:t.excludeForEach(e),keepRange:i?{forEach:i.forEach}:Of}}},{key:"isEquals",value:function isEquals(e,t){return e.row0===t.row0&&e.row1===t.row1&&e.column0===t.column0&&e.column1===t.column1}}]);return De}(),Xr=/*#__PURE__*/function(){function Xr(){_classCallCheck(this,Xr);this.nodes={}}_createClass(Xr,[{key:"get",value:function get(e,t){var i;var r=Xr.key(e,t);return(i=this.nodes[r])==null?void 0:i.element}},{key:"set",value:function set(e,t,i){var r=Xr.key(e,t);return this.nodes[r]=Object.freeze({element:i,row:e,column:t,key:r}),i}},{key:"delete",value:function _delete(e,t){var i=Xr.key(e,t),r=this.nodes[i];if(r)return delete this.nodes[i],r.element}},{key:"fill",value:function fill(e){var t=e.nodes;for(var i in t){this.nodes[i]=t[i]}}},{key:"clear",value:function clear(e){if(e)for(var t in this.nodes){e(this.nodes[t].element)}this.nodes={}}},{key:"forEach",value:function forEach(e){for(var t in this.nodes){var i=this.nodes[t];e(i.element,i.row,i.column)}}}],[{key:"key",value:function key(e,t){return"".concat(e,":").concat(t)}}]);return Xr}();function ci(e,t){if(_typeof(e)!=_typeof(t))return!1;if(_typeof(e)!="object"||e===null)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){for(var i in e){if(i in t){if(!ci(e[i],t[i]))return!1}else return!1}for(var _i29 in t){if(!(_i29 in e))return!1}return!0}else if(e.constructor===Array){var _i30=e,_r36=t;if(_i30.length===_r36.length){for(var n=0;n<_i30.length;++n){if(!ci(e[n],t[n]))return!1}}else return!1;return!0}else return!0}function mt(e){for(var t in e){return!0}return!1}var ka=/*#__PURE__*/function(){function ka(e){_classCallCheck(this,ka);this.rate=e.rate,this.bucketUnitSize=Object.freeze(B({},e.bucketUnitSize)),this.favorBucketsCount=e.favorBucketsCount,this.tree=e.tree,this.visions=e.visions,this.bucketFactory=e.bucketFactory,this.visibleNodes=this.initVisibleNodes(this.visions),this.onLeafNodeVisible=e.onLeafNodeVisible,this.onLeafNodeInvisible=e.onLeafNodeInvisible,this.visionCover=this.calcVisionCover(e.visionRectangle),this._projectiveSize=this.calcProjectiveSize(this.visionCover,e.scale),this.buckets=new Xr,this.searchAndFillVisibleNodes(this.visionCover.range,this._projectiveSize,this.visionCover.unitSize)}_createClass(ka,[{key:"projectiveSize",get:function get(){return this._projectiveSize}},{key:"unitSize",get:function get(){return this.visionCover.unitSize}},{key:"range",get:function get(){return this.visionCover.range}},{key:"forEachBuckets",value:function forEachBuckets(e){this.buckets.forEach(e)}},{key:"bucket",value:function bucket(e,t){return this.buckets.get(e,t)}},{key:"update",value:function update(e){var _this111=this;this.refreshVisibleNodes(e.diff);var _this$updateVision=this.updateVision(e),t=_this$updateVision.addedRange,i=_this$updateVision.keepRange,r=_this$updateVision.updatedProjectiveSize,n=B({},e.updateSet),s=!!e.dirtyCells,o=[];return i.forEach(function(a,c){var h=_this111.buckets.get(a,c),_this111$appendDiff=_this111.appendDiff(a,c,h,e,s),d=_this111$appendDiff.movedLeaves,u=_this111$appendDiff.touchedLeaves;u&&o.push({row:a,column:c,touchedLeaves:u}),Object.assign(n,d)}),t.forEach(function(a,c){var h;var d=_this111.buckets.get(a,c).collectLeaves();(h=e.dirtyCells)==null||h.collect(a,c),Object.assign(n,d)}),i.forEach(function(a,c){var h=_this111.buckets.get(a,c);h.handleUpdatedLeaves(n),h.fuseChunksWithNeighbours(),h.increaseChunksLife(),r&&h.updateProjectiveSize(r,e.refresh)}),e.shouldUpdateAll&&this.forEachBuckets(function(a){return a.notifyGlobalUpdate()}),this.callbackLeavesVisible(e),o}},{key:"initVisibleNodes",value:function initVisibleNodes(e){var t={};return e.forEach(function(i){t[i.id]=i}),t}},{key:"refreshVisibleNodes",value:function refreshVisibleNodes(_ref42){var e=_ref42.addedSet,t=_ref42.removedSet;for(var i in e){this.visibleNodes[i]=e[i]}for(var _i31 in t){delete this.visibleNodes[_i31]}}},{key:"updateVision",value:function updateVision(e){var t=Of,i=this.visionCover.range,r=null;if(e.visionRectangle){var n=this.calcVisionCover(e.visionRectangle,this.visionCover.exponent),s=this.calcProjectiveSize(n,e.scale);if(!ka.isVisionCoversEquals(n,this.visionCover)){var o=this.forkOrMegeAndGetRangeDiff(n,s);this.searchAndFillVisibleNodes(o.addedRange,s,n.unitSize),this.visionCover=n,t=o.addedRange,i=o.keepRange}ci(s,this._projectiveSize)||(this._projectiveSize=s,r=s)}return{addedRange:t,keepRange:i,updatedProjectiveSize:r}}},{key:"forkOrMegeAndGetRangeDiff",value:function forkOrMegeAndGetRangeDiff(e,t){var _this112=this;var i,r=e.exponent-this.visionCover.exponent;if(r>0){var n=Math.pow(this.rate,r),s=new Xr,o=[],a=this.visionCover.range.merge(n,n,function(c,h,d,u){if(e.range.includes(c,h))if(u)o.push({row:c,column:h});else{var p=_this112.bucketFactory.merge(_this112.buckets,{range:d,unitSize:e.unitSize,projectiveSize:t});s.set(c,h,p)}});if(i=De.calcDiff(e.range,a),o.length>0){var c=j0(i.addedRange,o),h=z0(i.keepRange,o);i=Le(B({},i),{addedRange:c,keepRange:h})}this.buckets.forEach(function(c){return c.dispose()}),this.buckets=s}else if(r<0){var _n25=Math.pow(this.rate,Math.abs(r)),_s15=new Xr,_o13=this.visionCover.range.fork(_n25,_n25,function(a,c,h){var d=De.calcIntersection(h,e.range),u=_this112.buckets.get(a,c);if(d&&u){var p=_this112.bucketFactory.fork(u,{range:d,unitSize:e.unitSize,projectiveSize:t});_s15.fill(p)}});i=De.calcDiff(e.range,_o13),this.buckets.forEach(function(a){return a.dispose()}),this.buckets=_s15}else i=De.calcDiff(e.range,this.visionCover.range),i.removedRange.forEach(function(n,s){var o;(o=_this112.buckets["delete"](n,s))==null||o.dispose()});return i}},{key:"searchAndFillVisibleNodes",value:function searchAndFillVisibleNodes(e,t,i){var _this113=this;var r=null;e.forEach(function(n,s){if(!r){r={};for(var c in _this113.visibleNodes){var h=_this113.rangeOfLeafNode(_this113.visibleNodes[c],i);h&&(r[c]=h)}}var o=De.cellToRect(n,s,i),a=_this113.bucketFactory.build(_this113.tree,o,t,function(c){var h=r[c.id];return!!(h&&h.includes(n,s))});_this113.buckets.set(n,s,a)})}},{key:"appendDiff",value:function appendDiff(e,t,i,r,n){var s=r.diff,o=r.moveSet,_s16=s,a=_s16.addedSet,c=this.visionCover.unitSize,h=[],d=[],u=[];for(var m in a){var g=this.rangeOfLeafNode(a[m],c);g&&!g.includes(e,t)&&h.push(m)}var p={};for(var _m5 in o){var _g5=o[_m5],y=this.rangeOfLeafNode(_g5,c);if(y){var b=i.has(_m5),S=y.includes(e,t);b&&S?p[_m5]=_g5:b&&!S?u.push(_g5):!b&&S&&d.push(_g5)}}var f=n?{}:null;if(h.length>0||d.length>0||u.length>0){if(f){var _iterator113=_createForOfIteratorHelper(h),_step113;try{for(_iterator113.s();!(_step113=_iterator113.n()).done;){var _m6=_step113.value;f[_m6]=!0}}catch(err){_iterator113.e(err)}finally{_iterator113.f()}var _iterator114=_createForOfIteratorHelper(d),_step114;try{for(_iterator114.s();!(_step114=_iterator114.n()).done;){var _m7=_step114.value;f[_m7.id]=!0}}catch(err){_iterator114.e(err)}finally{_iterator114.f()}var _iterator115=_createForOfIteratorHelper(u),_step115;try{for(_iterator115.s();!(_step115=_iterator115.n()).done;){var _m8=_step115.value;f[_m8.id]=!0}}catch(err){_iterator115.e(err)}finally{_iterator115.f()}}s=s.decorate({maskAdded:h,insertToAdded:d,insertToRemoved:u})}if(f){for(var _m9 in p){f[_m9]=!0}for(var _m10 in r.updateSet){f[_m10]=!0}for(var _m11 in r.diff.sortedSet){f[_m11]=!0}for(var _m12 in r.diff.removedSet){f[_m12]=!0}mt(f)||(f=null)}return i.appendDiff(s),{movedLeaves:p,touchedLeaves:f}}},{key:"isLeavesTouchBucket",value:function isLeavesTouchBucket(e,t){var i=!1;for(var _r37 in t){if(e.has(_r37)){i=!0;break}}return i}},{key:"callbackLeavesVisible",value:function callbackLeavesVisible(e){var _e$diff=e.diff,t=_e$diff.addedSet,i=_e$diff.removedSet;for(var _r38 in t){this.onLeafNodeVisible(t[_r38])}for(var _r39 in i){this.onLeafNodeInvisible(i[_r39])}}},{key:"calcVisionCover",value:function calcVisionCover(e,t){var i=e.width*e.height;i===0&&(i=1);var r=this.rate,n=this.favorBucketsCount,s=this.bucketUnitSize,o=s.width*s.height,a=Math.log(i/(n*o))/(2*Math.log(r));if(t===void 0)a=Math.ceil(a);else{var u=t+ka.ExponentBuffer,p=t-1-ka.ExponentBuffer;a>u||a<p?a=Math.ceil(a):a=t}var c=Math.pow(r,a),h=Object.freeze({width:s.width*c,height:s.height*c}),d=De.rectToRange(e,h);return Object.freeze({exponent:a,range:d,unitSize:h})}},{key:"calcProjectiveSize",value:function calcProjectiveSize(_ref43,i){var _ref43$unitSize=_ref43.unitSize,e=_ref43$unitSize.width,t=_ref43$unitSize.height;return Object.freeze({width:Math.ceil(e*i),height:Math.ceil(t*i)})}},{key:"rangeOfLeafNode",value:function rangeOfLeafNode(e,t){var i=this.visions.vision(e.id);return i?De.rectToRange(i.sceneRect,t):null}}],[{key:"isVisionCoversEquals",value:function isVisionCoversEquals(e,t){return e.exponent===t.exponent&&e.unitSize.width===t.unitSize.width&&e.unitSize.height===t.unitSize.height&&De.isEquals(e.range,t.range)}}]);return ka}(),Rf=ka;Rf.ExponentBuffer=.25;var U0=/*#__PURE__*/function(){function U0(e,t,i,r,n,s){var _this114=this;_classCallCheck(this,U0);this.touch=function(){_this114.onRepaint(_this114.leaf.value)},this.screen=e,this.visions=t,this.id=i.id,this.leaf=i,this.fixedSize=r,this.render=n,this.onRepaint=s}_createClass(U0,[{key:"refreshPayload",value:function refreshPayload(){this.render.updatePayload(this.leaf.value.payload)}},{key:"updateContext",value:function updateContext(e){this.render.updateContext(e)}},{key:"paint",value:function paint(e,t,i){var r=this.leaf.value,n=this.visions.vision(this.leaf.id),s=this.createPaintParams(e,n,r,t,i),o=n.screenRect.originX,a=n.screenRect.originY;if(i&&(o-=i.originX,a-=i.originY),e.translate(o,a),this.fixedSize){var c=n.scale;c!==1&&e.scale(c,c)}this.render.paint(s)}},{key:"createPaintParams",value:function createPaintParams(e,t,i,r,n){var s,o,a,c=t.screenRect,h=this.touch,d=this.createTailor(t,n);if(this.fixedSize){a=1,o={width:i.width,height:i.height};var f=t.scale,m=t.margin,g=c.width/f-o.width,y=c.height/f-o.height,b=g/(m.left+m.right),S=y/(m.top+m.bottom);s={left:m.left*b,right:m.right*b,top:m.top*S,bottom:m.bottom*S}}else a=t.scale,s=t.margin,o={width:c.width-s.left-s.right,height:c.height-s.top-s.bottom};var u={context:e,margin:s,scale:a,size:o,tailor:d,paintingMode:r,touch:h,screen:this.screen},p=this.createFakeScreenRect(o,d);return u.screenSize=p,u.screenRect=p,u}},{key:"createTailor",value:function createTailor(e,t){var i=e.tailor,r=i.left,n=i.top,s=i.right,o=i.bottom;if(t){var a=e.screenRect,c=a.originX,h=a.originY,d=c+a.width,u=h+a.height,p=c+r,f=h+n,m=d-s,g=u-o;p=Math.max(p,t.originX),f=Math.max(f,t.originY),m=Math.min(m,t.originX+t.width),g=Math.min(g,t.originY+t.width),r=p-c,n=f-h,s=d-m,o=u-g}if(this.fixedSize){var _a10=e.scale;r/=_a10,n/=_a10,s/=_a10,o/=_a10}return{left:r,top:n,right:s,bottom:o}}},{key:"createFakeScreenRect",value:function createFakeScreenRect(e,t){var i=t.left,r=t.top,n=e.width-t.right,s=e.height-t.bottom;return{originX:i,originY:r,width:n-i,height:s-r}}}]);return U0}(),Ws=/*#__PURE__*/function(){function Ws(e){_classCallCheck(this,Ws);this.nodes=null,this.id="".concat(Ws.nextId+=1),this.life=0,this.context=e}_createClass(Ws,[{key:"isFloat",get:function get(){var e;return this.life<Ws.fuseThreshold&&((e=this.nodes)==null?void 0:e.length)===1}},{key:"onFuse",value:function onFuse(e,t){}},{key:"onSplit",value:function onSplit(){}},{key:"onRemoved",value:function onRemoved(){}},{key:Symbol.iterator,value:function value(){return new V0(this.getNodes())}},{key:"previousChunk",get:function get(){var e,t;return((t=(e=this.getNodes()[0])==null?void 0:e.previousNode)==null?void 0:t.value)||null}},{key:"nextChunk",get:function get(){var e,t;var i=this.getNodes();return((t=(e=i[i.length-1])==null?void 0:e.nextNode)==null?void 0:t.value)||null}},{key:"isFuseable",get:function get(){return this.life>=Ws.fuseThreshold}},{key:"getSampleNode",value:function getSampleNode(){return this.nodes&&this.nodes.length>0?this.nodes[0]:null}},{key:"initWithNode",value:function initWithNode(e){if(this.nodes)throw new Error("it is not init chunk");return this.nodes=[e],e.value=this,this}},{key:"initWithShadowList",value:function initWithShadowList(e){if(this.nodes)throw new Error("it is not init chunk");this.nodes=[];var _iterator116=_createForOfIteratorHelper(e),_step116;try{for(_iterator116.s();!(_step116=_iterator116.n()).done;){var t=_step116.value;this.nodes.push(t),t.value=this}}catch(err){_iterator116.e(err)}finally{_iterator116.f()}return this}},{key:"increaseLife",value:function increaseLife(){var _this115=this;this.life<Ws.fuseThreshold&&this.watchIsFloatUpdate(function(){_this115.life+=1})}},{key:"cutOff",value:function cutOff(e,t){var _this116=this;return this.watchIsFloatUpdate(function(){var i=_this116.getNodes(),r=i.indexOf(e),n=i.indexOf(t);if(r===-1)throw new Error("cannot find begin node id=".concat(e.id," to cut off"));if(n===-1)throw new Error("cannot find end node id=".concat(e.id," to cut off"));var s=i.splice(n),o=_this116.createChunkWithNodes(s),a=i.splice(0,r+1);return{left:_this116.createChunkWithNodes(a),right:o,becomeBlank:i.length===0}})}},{key:"split",value:function split(e){var _this117=this;return this.watchIsFloatUpdate(function(){var t=_this117.getNodes(),i=t.indexOf(e),r=null,n=null;if(i===-1)throw new Error("cannot find node id=".concat(e.id," to split"));if(i<t.length-1){var s=t.splice(i+1);r=_this117.createChunkWithNodes(s)}if(i>0){var _s17=t.splice(0,i);n=_this117.createChunkWithNodes(_s17)}return _this117.onSplit(),{left:n,right:r}})}},{key:"createChunkWithNodes",value:function createChunkWithNodes(e){var t=this.context.create();t.nodes=e;var _iterator117=_createForOfIteratorHelper(e),_step117;try{for(_iterator117.s();!(_step117=_iterator117.n()).done;){var i=_step117.value;i.value=t}}catch(err){_iterator117.e(err)}finally{_iterator117.f()}return t.isFloat&&t.context.bind(t,e[0].related),t}},{key:"fuseNeighboursBeforeMe",value:function fuseNeighboursBeforeMe(){var e=this,t=[];for(;e&&(e=e.previousChunk,!!(e==null?void 0:e.isFuseable));){this.unshift(e),t.unshift(e)}return t}},{key:"fuseNeighboursAfterMe",value:function fuseNeighboursAfterMe(){var e=this,t=[];for(;e&&(e=e.nextChunk,!!(e==null?void 0:e.isFuseable));){this.push(e),t.push(e)}return t}},{key:"unshift",value:function unshift(e){var t=e.nodes;if(t){var _this$getNodes;(_this$getNodes=this.getNodes()).unshift.apply(_this$getNodes,_toConsumableArray(t));var _iterator118=_createForOfIteratorHelper(t),_step118;try{for(_iterator118.s();!(_step118=_iterator118.n()).done;){var i=_step118.value;i.value=this}}catch(err){_iterator118.e(err)}finally{_iterator118.f()}}}},{key:"push",value:function push(e){var t=e.nodes;if(t){var _this$getNodes2;(_this$getNodes2=this.getNodes()).push.apply(_this$getNodes2,_toConsumableArray(t));var _iterator119=_createForOfIteratorHelper(t),_step119;try{for(_iterator119.s();!(_step119=_iterator119.n()).done;){var i=_step119.value;i.value=this}}catch(err){_iterator119.e(err)}finally{_iterator119.f()}}}},{key:"resetLife",value:function resetLife(){this.life=0}},{key:"dispose",value:function dispose(){this.isFloat&&this.context.unbind(this,this.nodes[0].related),this.nodes=null,this.life=0,this.onRemoved()}},{key:"getNodes",value:function getNodes(){return this.nodes||(this.nodes=[]),this.nodes}},{key:"watchIsFloatUpdate",value:function watchIsFloatUpdate(e){var t=this.isFloat,i=this.nodes&&this.nodes[0].related,r=e(),n=this.isFloat;return!t&&n?this.context.bind(this,this.nodes[0].related):t&&!n&&this.context.unbind(this,i),r}}],[{key:"fuseEachNeighbours",value:function fuseEachNeighbours(e){var t=[],i={};for(var _r40 in e){if(!i[_r40]){(function(){i[_r40]=!0;var n=e[_r40];n.isFuseable&&n.watchIsFloatUpdate(function(){var s=n.fuseNeighboursBeforeMe(),o=n.fuseNeighboursAfterMe();(s.length>0||o.length>0)&&(n.life=0,n.onFuse(s,o));var _iterator120=_createForOfIteratorHelper(s),_step120;try{for(_iterator120.s();!(_step120=_iterator120.n()).done;){var a=_step120.value;i[a.id]=!0,t.push(a)}}catch(err){_iterator120.e(err)}finally{_iterator120.f()}var _iterator121=_createForOfIteratorHelper(o),_step121;try{for(_iterator121.s();!(_step121=_iterator121.n()).done;){var _a11=_step121.value;i[_a11.id]=!0,t.push(_a11)}}catch(err){_iterator121.e(err)}finally{_iterator121.f()}})})()}}return t}}]);return Ws}(),Ca=Ws;Ca.fuseThreshold=5,Ca.nextId=0;var V0=/*#__PURE__*/function(){function V0(e){_classCallCheck(this,V0);this.nodes=e,this.index=0}_createClass(V0,[{key:"next",value:function next(){var e;return this.index<this.nodes.length?(e={value:this.nodes[this.index],done:!1},this.index+=1):e={value:void 0,done:!0},e}}]);return V0}(),yh=/*#__PURE__*/function(){function yh(e){_classCallCheck(this,yh);this.addedSet={},this.sortedSet={},this.removedSet={},this.id="".concat(yh.nextId),this.releaser=e,yh.nextId+=1}_createClass(yh,[{key:"fetchDiff",value:function fetchDiff(){var e=new bh(this.addedSet,this.sortedSet,this.removedSet);return this.addedSet={},this.sortedSet={},this.removedSet={},e}},{key:"release",value:function release(){this.releaser(this.id)}},{key:"markAdded",value:function markAdded(e){this.addedSet[e.id]=e,delete this.sortedSet[e.id],delete this.removedSet[e.id]}},{key:"markSorted",value:function markSorted(e){this.addedSet[e.id]||(this.sortedSet[e.id]=e)}},{key:"markRemoved",value:function markRemoved(e){this.removedSet[e.id]=e,delete this.addedSet[e.id],delete this.sortedSet[e.id]}}]);return yh}(),Nf=yh;Nf.nextId=0;var bh=/*#__PURE__*/function(){function bh(e,t,i){_classCallCheck(this,bh);this.addedSet=e,this.sortedSet=t,this.removedSet=i}_createClass(bh,[{key:"isBlank",get:function get(){return!mt(this.addedSet)&&!mt(this.sortedSet)&&!mt(this.removedSet)}},{key:"decorate",value:function decorate(_ref44){var e=_ref44.insertToAdded,t=_ref44.insertToRemoved,i=_ref44.maskAdded;var r=null,n=null;if(e&&e.length>0){r=B({},this.addedSet);var _iterator122=_createForOfIteratorHelper(e),_step122;try{for(_iterator122.s();!(_step122=_iterator122.n()).done;){var s=_step122.value;r[s.id]=s}}catch(err){_iterator122.e(err)}finally{_iterator122.f()}}if(i&&i.length>0){r=r||B({},this.addedSet);var _iterator123=_createForOfIteratorHelper(i),_step123;try{for(_iterator123.s();!(_step123=_iterator123.n()).done;){var _s18=_step123.value;delete r[_s18]}}catch(err){_iterator123.e(err)}finally{_iterator123.f()}}if(t&&t.length>0){n=B({},this.removedSet);var _iterator124=_createForOfIteratorHelper(t),_step124;try{for(_iterator124.s();!(_step124=_iterator124.n()).done;){var _s19=_step124.value;n[_s19.id]=_s19}}catch(err){_iterator124.e(err)}finally{_iterator124.f()}}return r=r||this.addedSet,n=n||this.removedSet,new bh(r,this.sortedSet,n)}}],[{key:"createInsertDiff",value:function createInsertDiff(e){var t={};var _iterator125=_createForOfIteratorHelper(e),_step125;try{for(_iterator125.s();!(_step125=_iterator125.n()).done;){var i=_step125.value;t[i.id]=i}}catch(err){_iterator125.e(err)}finally{_iterator125.f()}return new bh(t,{},{})}}]);return bh}(),W0=/*#__PURE__*/function(){function W0(e){_classCallCheck(this,W0);var t={};var _iterator126=_createForOfIteratorHelper(e),_step126;try{for(_iterator126.s();!(_step126=_iterator126.n()).done;){var i=_step126.value;t[i.id]={leaf:i,nex:null}}}catch(err){_iterator126.e(err)}finally{_iterator126.f()}this.nodes=t,this.leaves=e}_createClass(W0,[{key:"sort",value:function sort(){this.leaves.splice(0);for(var e in this.nodes){var t=this.nodes[e],i=this.findNextNode(t);i&&(t.nex=i,delete this.nodes[i.leaf.id])}for(var _e6 in this.nodes){var _t9=this.nodes[_e6];for(;_t9;){this.leaves.push(_t9.leaf),_t9=_t9.nex}}return this.leaves}},{key:"findNextNode",value:function findNextNode(e){var t=e.leaf.nexLeaf();for(;t;){var i=this.nodes[t.id];if(i)return i;t=t.nexLeaf()}return null}}]);return W0}(),vh=/*#__PURE__*/function(){function vh(e,t){_classCallCheck(this,vh);this.par=null,this.pre=null,this.nex=null,this.tree=e,this.value=t,this.id=String(vh.nextId),vh.nextId+=1}_createClass(vh,[{key:"parent",get:function get(){return this.par}},{key:"assertBlank",value:function assertBlank(e){if(this.assertBelongsTo(e),this.par||this.pre||this.nex)throw new Error("node is not empty")}},{key:"assertAddedTo",value:function assertAddedTo(e){if(this.assertBelongsTo(e),this.isFreeNode())throw new Error("this node did not add to any tree")}},{key:"assertBelongsTo",value:function assertBelongsTo(e){if(this.tree!==e)throw new Error("this node is belongs to another tree")}},{key:"isFreeNode",value:function isFreeNode(){return this.par===null}},{key:"preLeaf",value:function preLeaf(){return this.pre?this.pre.lastLeaf():this.par?this.par.preLeaf():null}},{key:"nexLeaf",value:function nexLeaf(){return this.nex?this.nex.firstLeaf():this.par?this.par.nexLeaf():null}}]);return vh}(),Sh=vh;Sh.nextId=0;var Hs=/*#__PURE__*/function(_Sh){_inherits(Hs,_Sh);var _super29=_createSuper(Hs);function Hs(e,t){_classCallCheck(this,Hs);return _super29.call(this,e,t)}_createClass(Hs,[{key:"firstLeaf",value:function firstLeaf(){return this}},{key:"lastLeaf",value:function lastLeaf(){return this}}]);return Hs}(Sh),Lf=/*#__PURE__*/function(_Sh2){_inherits(Lf,_Sh2);var _super30=_createSuper(Lf);function Lf(e,t){var _i32;var _this118;_classCallCheck(this,Lf);_this118=_super30.call(this,e,t);_this118.fir=null,_this118.las=null,_this118.forEachLeaves=function(r){var n=_this118.fir;for(;n;){n instanceof Hs?r(n):n.forEachLeaves(r),n=n.nex}};var i=(_i32={},_defineProperty(_i32,Symbol.iterator,function(){return new _0(_assertThisInitialized(_this118))}),_defineProperty(_i32,"forEach",_this118.forEachLeaves),_i32);_this118.leaves=Object.freeze(i);return _this118}_createClass(Lf,[{key:Symbol.iterator,value:function value(){return new H0(this.fir)}},{key:"nodes",get:function get(){var e=[],t=this.fir;for(;t;){e.push(t),t=t.nex}return e}},{key:"assertBlank",value:function assertBlank(e){if(_get(_getPrototypeOf(Lf.prototype),"assertBlank",this).call(this,e),this.fir||this.las)throw new Error("node is not empty")}},{key:"firstLeaf",value:function firstLeaf(){var e=this.fir;for(;e;){var t=e.firstLeaf();if(t)return t;e=e.nex}return null}},{key:"lastLeaf",value:function lastLeaf(){var e=this.las;for(;e;){var t=e.lastLeaf();if(t)return t;e=e.pre}return null}},{key:"forEach",value:function forEach(e){var t=this.fir;for(;t;){e(t),t=t.nex}}},{key:"isFreeNode",value:function isFreeNode(){return _get(_getPrototypeOf(Lf.prototype),"isFreeNode",this).call(this)&&this!==this.tree.root}}]);return Lf}(Sh),H0=/*#__PURE__*/function(){function H0(e){_classCallCheck(this,H0);this.node=e}_createClass(H0,[{key:"next",value:function next(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]);return H0}(),_0=/*#__PURE__*/function(){function _0(e){_classCallCheck(this,_0);this.node=e.firstLeaf(),this.lastLeaf=e.lastLeaf()}_createClass(_0,[{key:"next",value:function next(){var e;return this.node?(e={value:this.node,done:!1},this.node===this.lastLeaf?this.node=null:this.node=this.node.nexLeaf()):e={value:void 0,done:!0},e}}]);return _0}(),$0=/*#__PURE__*/function(){function $0(e){_classCallCheck(this,$0);this.bufferMap={},this._root=new Lf(this),e&&e(this)}_createClass($0,[{key:"root",get:function get(){return this._root}},{key:"createDiffBuffer",value:function createDiffBuffer(){var _this119=this;var e=new Nf(function(t){return delete _this119.bufferMap[t]});return this.bufferMap[e.id]=e,e}},{key:"wrapLeaf",value:function wrapLeaf(e){return new Hs(this,e)}},{key:"wrapGroup",value:function wrapGroup(e){return new Lf(this,e)}},{key:Symbol.iterator,value:function value(){return this._root.leaves[Symbol.iterator]()}},{key:"forEach",value:function forEach(e){return this._root.leaves.forEach(e)}},{key:"append",value:function append(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._root;var i=e,r=t;i.assertBlank(this),r.assertAddedTo(this),this.appendTo(i,r),this.markAdded(i)}},{key:"addAfter",value:function addAfter(e,t){var i=e,r=t;if(i.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add after root");this.addAfterTo(i,r),this.markAdded(i)}},{key:"addBefore",value:function addBefore(e,t){var i=e,r=t;if(i.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add before root");this.addBeforeTo(i,r),this.markAdded(i)}},{key:"remove",value:function remove(e){var t=e;t.assertAddedTo(this),this.removeFrom(t),this.markRemoved(t)}},{key:"moveAppend",value:function moveAppend(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this._root;var i=e,r=t;i.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(i),this.appendTo(i,r),this.markSorted(i)}},{key:"moveAfter",value:function moveAfter(e,t){var i=e,r=t;i.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(i),this.addAfterTo(i,r),this.markSorted(i)}},{key:"moveBefore",value:function moveBefore(e,t){var i=e,r=t;i.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(i),this.addBeforeTo(i,r),this.markSorted(i)}},{key:"appendTo",value:function appendTo(e,t){e.par=t,t.las?(e.pre=t.las,t.las.nex=e,t.las=e):(t.fir=e,t.las=e)}},{key:"addAfterTo",value:function addAfterTo(e,t){var i=t.nex,r=t.par;if(!r)throw new Error("cannot add after root");e.pre=t,e.nex=i,e.par=r,t.nex=e,i&&(i.pre=e),r.las===t&&(r.las=e)}},{key:"addBeforeTo",value:function addBeforeTo(e,t){var i=t.pre,r=t.par;if(!r)throw new Error("cannot add before root");e.nex=t,e.pre=i,e.par=r,t.pre=e,i&&(i.nex=e),r.fir===t&&(r.fir=e)}},{key:"removeFrom",value:function removeFrom(e){var t=e.pre,i=e.nex,r=e.par;if(!r)throw new Error("cannot remove root");t&&(t.nex=i),i&&(i.pre=t),r.fir===e&&(r.fir=i),r.las===e&&(r.las=t),e.par=null,e.pre=null,e.nex=null}},{key:"sortLeaves",value:function sortLeaves(e){return e.length<=1?e:new W0(e).sort()}},{key:"sort",value:function sort(e,t){var i=e;i.assertAddedTo(this);var r=i.nodes,n=_toConsumableArray(r).sort(t);this.rebuildList(i,n),this.checkAndMarkSorted(r,n)}},{key:"rebuildList",value:function rebuildList(e,t){t.length>0&&(e.fir=t[0],e.las=t[t.length-1]);var i=null;for(var _r41=0;_r41<t.length;++_r41){var n=t[_r41];i&&(i.nex=n),n.pre=i,i=n}i&&(i.nex=null)}},{key:"checkAndMarkSorted",value:function checkAndMarkSorted(e,t){var i={},r={};for(var h=0;h<e.length;++h){var d=e[h];i[d.id]=h}var n=[],s=!1,o=null,a=0,c=-1;var _iterator127=_createForOfIteratorHelper(t),_step127;try{for(_iterator127.s();!(_step127=_iterator127.n()).done;){var _h9=_step127.value;var _d5=i[_h9.id];if(o){var _u4=!1,_p3=o.length,_f3=o[_p3-1];if(_d5<=_f3)_u4=!0;else switch(o.length){case 0:break;case 1:{s=_d5===_f3+1;break}default:{_d5===_f3+1!==s&&(_u4=!0);break}}_u4?(n.push(o),o.length>a&&(a=o.length,c=n.length-1),o=[_d5]):o.push(_d5)}else o=[_d5]}}catch(err){_iterator127.e(err)}finally{_iterator127.f()}if(o&&(n.push(o),o.length>a&&(a=o.length,c=n.length-1)),c!==-1){var _h7=n[c],_d4=_h7[0],u=_h7[_h7.length-1];for(var p=c-1;p>=0;p--){var f=n[p];if(f[f.length-1]<_d4)_d4=f[0];else{var _iterator128=_createForOfIteratorHelper(f),_step128;try{for(_iterator128.s();!(_step128=_iterator128.n()).done;){var m=_step128.value;var g=e[m];r[g.id]=g}}catch(err){_iterator128.e(err)}finally{_iterator128.f()}}}for(var _p2=c+1;_p2<n.length;_p2++){var _f2=n[_p2];if(_f2[0]>u)u=_f2[_f2.length-1];else{var _iterator129=_createForOfIteratorHelper(_f2),_step129;try{for(_iterator129.s();!(_step129=_iterator129.n()).done;){var _m13=_step129.value;var _g6=e[_m13];r[_g6.id]=_g6}}catch(err){_iterator129.e(err)}finally{_iterator129.f()}}}}for(var _h8 in r){this.markSorted(r[_h8])}}},{key:"markAdded",value:function markAdded(e){for(var t in this.bufferMap){var i=this.bufferMap[t];if(e instanceof Hs)i.markAdded(e);else{var _iterator130=_createForOfIteratorHelper(e.leaves),_step130;try{for(_iterator130.s();!(_step130=_iterator130.n()).done;){var _r42=_step130.value;i.markAdded(_r42)}}catch(err){_iterator130.e(err)}finally{_iterator130.f()}}}}},{key:"markSorted",value:function markSorted(e){for(var t in this.bufferMap){var i=this.bufferMap[t];if(e instanceof Hs)i.markSorted(e);else{var _iterator131=_createForOfIteratorHelper(e.leaves),_step131;try{for(_iterator131.s();!(_step131=_iterator131.n()).done;){var _r43=_step131.value;i.markSorted(_r43)}}catch(err){_iterator131.e(err)}finally{_iterator131.f()}}}}},{key:"markRemoved",value:function markRemoved(e){for(var t in this.bufferMap){var i=this.bufferMap[t];if(e instanceof Hs)i.markRemoved(e);else{var _iterator132=_createForOfIteratorHelper(e.leaves),_step132;try{for(_iterator132.s();!(_step132=_iterator132.n()).done;){var _r44=_step132.value;i.markRemoved(_r44)}}catch(err){_iterator132.e(err)}finally{_iterator132.f()}}}}}]);return $0}(),xa=/*#__PURE__*/function(){function xa(e){_classCallCheck(this,xa);this.pre=null,this.nex=null,this.id=e.id,this.related=e}_createClass(xa,[{key:"previousNode",get:function get(){return this.pre}},{key:"nextNode",get:function get(){return this.nex}}]);return xa}(),Yr=/*#__PURE__*/function(){function Yr(e){_classCallCheck(this,Yr);this.nodesSet={},this._length=0,this.fir=null,this.las=null,this.valueInitializer=e}_createClass(Yr,[{key:"length",get:function get(){return this._length}},{key:"firstNode",get:function get(){return this.fir}},{key:"node",value:function node(e){return this.nodesSet[e]||null}},{key:"findNode",value:function findNode(e){var t=this.fir;for(;t&&!e(t);){t=t.nex}return t}},{key:Symbol.iterator,value:function value(){return new G0(this.fir)}},{key:"forEach",value:function forEach(e){var t=this.fir;for(;t;){e(t),t=t.nex}}},{key:"appendDiff",value:function appendDiff(e){var t=[],i=[],r=[];for(var n in e.removedSet){var s=this.nodesSet[n];s&&(this.removeNode(s),delete this.nodesSet[n],t.push(s),this._length-=1)}for(var _n26 in e.sortedSet){var _s20=this.nodesSet[_n26];_s20&&!e.addedSet[_n26]&&(this.removeNode(_s20),r.push(_s20))}for(var _n27 in e.addedSet){if(!this.nodesSet[_n27]){var _s21=e.addedSet[_n27],o=new xa(_s21);o.value=this.valueInitializer(o),this.nodesSet[_n27]=o,i.push(o),this._length+=1}}for(var _i34=0,_i33=i;_i34<_i33.length;_i34++){var _n28=_i33[_i34];this.addNode(_n28)}for(var _i35=0,_r45=r;_i35<_r45.length;_i35++){var _n29=_r45[_i35];this.addNode(_n29)}return{removedNodes:t,addedNodes:i,sortedNodes:r}}},{key:"filter",value:function filter(e){var t=new Yr(this.valueInitializer);var _iterator133=_createForOfIteratorHelper(this),_step133;try{for(_iterator133.s();!(_step133=_iterator133.n()).done;){var i=_step133.value;if(e(i)){var _r46=i.related,n=i.value,s=new xa(_r46);s.value=n,t.appendNode(s)}}}catch(err){_iterator133.e(err)}finally{_iterator133.f()}return t}},{key:"removeNode",value:function removeNode(e){var t=e.pre,i=e.nex;t&&(t.nex=i),i&&(i.pre=t),this.fir===e&&(this.fir=i),this.las===e&&(this.las=t),e.pre=null,e.nex=null}},{key:"appendNode",value:function appendNode(e){this.las?(e.pre=this.las,this.las.nex=e,this.las=e):(this.fir=e,this.las=e),this.nodesSet[e.id]=e,this._length+=1}},{key:"addNode",value:function addNode(e){var t=this.findPreNode(e),i=this.findNexNode(e);t?(t.nex=e,e.pre=t):this.fir=e,i?(i.pre=e,e.nex=i):this.las=e}},{key:"findPreNode",value:function findPreNode(e){var t=e.related.preLeaf();for(;t;){var i=this.nodesSet[t.id];if(i)return i;t=t.preLeaf()}return null}},{key:"findNexNode",value:function findNexNode(e){var t=e.related.nexLeaf();for(;t;){var i=this.nodesSet[t.id];if(i)return i;t=t.nexLeaf()}return null}}],[{key:"create",value:function create(e){var t=new Yr(e.valueInitializer),i=e.initLeafFilter||Yr.alwaysTrue;var _iterator134=_createForOfIteratorHelper(e.tree),_step134;try{for(_iterator134.s();!(_step134=_iterator134.n()).done;){var _r47=_step134.value;if(i(_r47)){var n=new xa(_r47);n.value=t.valueInitializer(n),t.appendNode(n)}}}catch(err){_iterator134.e(err)}finally{_iterator134.f()}return t}},{key:"alwaysTrue",value:function alwaysTrue(){return!0}},{key:"merge",value:function merge(e){if(e.length>0){var t=new Yr(e[0].valueInitializer),i=t.nodesSet;var _iterator135=_createForOfIteratorHelper(e),_step135;try{for(_iterator135.s();!(_step135=_iterator135.n()).done;){var _r48=_step135.value;var _iterator136=_createForOfIteratorHelper(_r48),_step136;try{for(_iterator136.s();!(_step136=_iterator136.n()).done;){var _step136$value=_step136.value,n=_step136$value.id,s=_step136$value.related,o=_step136$value.value;if(!i[n]){var a=new xa(s);a.value=o,i[n]=a,t._length+=1,t.addNode(a)}}}catch(err){_iterator136.e(err)}finally{_iterator136.f()}}}catch(err){_iterator135.e(err)}finally{_iterator135.f()}return t}else return null}}]);return Yr}(),G0=/*#__PURE__*/function(){function G0(e){_classCallCheck(this,G0);this.node=e}_createClass(G0,[{key:"next",value:function next(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]);return G0}(),K0=/*#__PURE__*/function(){function K0(e){_classCallCheck(this,K0);this.visions=e}_createClass(K0,[{key:"build",value:function build(e,t,i,r){var n,s=this.canvasPool,o=this.chunkContext,a=Yr.create({tree:e,initLeafFilter:r!=null?r:function(){return!1},valueInitializer:function valueInitializer(){return null}});if(r&&a.length>0){var c=o.create().initWithShadowList(a);n=_defineProperty({},c.id,c),c.isFloat&&o.bind(c,c.getSampleNode().related)}return this.create({canvasPool:s,rectangle:t,chunks:n,projectiveSize:i,shadowList:a,chunkContext:o})}},{key:"merge",value:function merge(e,_ref45){var t=_ref45.range,i=_ref45.unitSize,r=_ref45.projectiveSize;var n=[];t.forEach(function(p,f){n.push(e.get(p,f).shadowList)});var s=this.canvasPool,o=this.chunkContext,a=Yr.merge(n),c={};if(a.length>0){var p=o.create().initWithShadowList(a);c[p.id]=p,p.isFloat&&o.bind(p,p.getSampleNode().related)}var h=t.row0*t.rowsCount,d=t.column0*t.columnsCount,u=De.cellToRect(h,d,i);return this.create({canvasPool:s,rectangle:u,shadowList:a,chunks:c,projectiveSize:r,chunkContext:o})}},{key:"fork",value:function fork(e,_ref46){var _this120=this;var t=_ref46.range,i=_ref46.unitSize,r=_ref46.projectiveSize;var n=this.canvasPool,s=this.chunkContext,o={},a=new Xr;return e.shadowList.forEach(function(c){var h=_this120.visions.vision(c.related.id);if(h){var d=De.rectToRange(h.sceneRect,i);o[c.id]=d}}),t.forEach(function(c,h){var d=e.shadowList.filter(function(p){var f;return!!((f=o[p.id])==null?void 0:f.includes(c,h))}),u={};if(d.length>0){var p=s.create().initWithShadowList(d);u[p.id]=p,s.bind(p,p.getSampleNode().related)}a.set(c,h,_this120.create({canvasPool:n,shadowList:d,chunks:u,projectiveSize:r,chunkContext:s,rectangle:De.cellToRect(c,h,i)}))}),a}}]);return K0}(),Df=/*#__PURE__*/function(){function Df(e){_classCallCheck(this,Df);this.id="".concat(Df.nextId+=1),this.chunkContext=e.chunkContext,this.rectangle=e.rectangle,this._projectiveSize=e.projectiveSize,this.shadowList=e.shadowList,this.chunks=e.chunks||{}}_createClass(Df,[{key:"onProjectiveSizeUpdate",value:function onProjectiveSizeUpdate(e,t){}},{key:"projectiveSize",get:function get(){return this._projectiveSize}},{key:"firstChunk",get:function get(){var e=this.shadowList.firstNode;return e?e.value:null}},{key:Symbol.iterator,value:function value(){return new X0(this.firstChunk)}},{key:"has",value:function has(e){return this.shadowList.node(e)!==null}},{key:"findChunk",value:function findChunk(e){var t=null,i=this.shadowList.node(e.id);return i&&(t=this.findChunkByNode(i)),t}},{key:"collectLeaves",value:function collectLeaves(){var e={};for(var t in this.chunks){var _iterator137=_createForOfIteratorHelper(this.chunks[t]),_step137;try{for(_iterator137.s();!(_step137=_iterator137.n()).done;){var i=_step137.value;e[i.id]=i.related}}catch(err){_iterator137.e(err)}finally{_iterator137.f()}}return e}},{key:"appendDiff",value:function appendDiff(e){var _this$shadowList$appe=this.shadowList.appendDiff(e),t=_this$shadowList$appe.removedNodes,i=_this$shadowList$appe.addedNodes,r=_this$shadowList$appe.sortedNodes;var _iterator138=_createForOfIteratorHelper(r),_step138;try{for(_iterator138.s();!(_step138=_iterator138.n()).done;){var n=_step138.value;this.removeNode(n)}}catch(err){_iterator138.e(err)}finally{_iterator138.f()}var _iterator139=_createForOfIteratorHelper(t),_step139;try{for(_iterator139.s();!(_step139=_iterator139.n()).done;){var _n31=_step139.value;this.removeNode(_n31)}}catch(err){_iterator139.e(err)}finally{_iterator139.f()}var _iterator140=_createForOfIteratorHelper(i),_step140;try{for(_iterator140.s();!(_step140=_iterator140.n()).done;){var _n32=_step140.value;this.addNode(_n32)}}catch(err){_iterator140.e(err)}finally{_iterator140.f()}var _iterator141=_createForOfIteratorHelper(r),_step141;try{for(_iterator141.s();!(_step141=_iterator141.n()).done;){var _n33=_step141.value;this.addNode(_n33)}}catch(err){_iterator141.e(err)}finally{_iterator141.f()}}},{key:"removeNode",value:function removeNode(e){var t=this.findChunkByNode(e);if(t){var i=this.chunkContext,_t$split=t.split(e),_r49=_t$split.left,n=_t$split.right;_r49&&(this.chunks[_r49.id]=_r49,_r49.isFloat&&i.bind(_r49,_r49.getSampleNode().related)),n&&(this.chunks[n.id]=n,n.isFloat&&i.bind(n,n.getSampleNode().related)),delete this.chunks[t.id],t.dispose()}}},{key:"addNode",value:function addNode(e){var t=this.chunkContext,i=this.previousNode(e),r=i==null?void 0:i.value,n=this.nextNode(e),s=n==null?void 0:n.value;if(r&&r===s){var a=r,_a$cutOff=a.cutOff(i,n),c=_a$cutOff.left,h=_a$cutOff.right,d=_a$cutOff.becomeBlank;this.chunks[c.id]=c,this.chunks[h.id]=h,c.isFloat&&t.bind(c,c.getSampleNode().related),h.isFloat&&t.bind(h,h.getSampleNode().related),d?(delete this.chunks[a.id],a.dispose()):a.resetLife()}var o=this.chunkContext.create().initWithNode(e);this.chunks[o.id]=o,t.bind(o,o.getSampleNode().related)}},{key:"previousNode",value:function previousNode(e){var t=e.previousNode;for(;t&&!t.value;){t=t.previousNode}return t}},{key:"nextNode",value:function nextNode(e){var t=e.nextNode;for(;t&&!t.value;){t=t.nextNode}return t}},{key:"findChunkByNode",value:function findChunkByNode(e){var t=e.value,i=null;if(t&&(i=this.chunks[t.id],i!==t))throw new Error("invalid node");return i}},{key:"handleUpdatedLeaves",value:function handleUpdatedLeaves(e){for(var t in e){var i=this.shadowList.node(t);if(i==null?void 0:i.value){var _r50=i.value,_r50$split=_r50.split(i),n=_r50$split.left,s=_r50$split.right,o=this.chunkContext;n&&(this.chunks[n.id]=n,n.isFloat&&o.bind(n,n.getSampleNode().related)),s&&(this.chunks[s.id]=s,s.isFloat&&o.bind(s,s.getSampleNode().related)),_r50.resetLife()}}}},{key:"fuseChunksWithNeighbours",value:function fuseChunksWithNeighbours(){var e=this.chunks,t=Ca.fuseEachNeighbours(e);var _iterator142=_createForOfIteratorHelper(t),_step142;try{for(_iterator142.s();!(_step142=_iterator142.n()).done;){var i=_step142.value;delete e[i.id],i.dispose()}}catch(err){_iterator142.e(err)}finally{_iterator142.f()}}},{key:"increaseChunksLife",value:function increaseChunksLife(){var e=this.chunks;for(var t in e){e[t].increaseLife()}}},{key:"updateProjectiveSize",value:function updateProjectiveSize(e,t){this._projectiveSize=e,this.onProjectiveSizeUpdate(e,t)}},{key:"dispose",value:function dispose(){var e={};var _iterator143=_createForOfIteratorHelper(this.shadowList),_step143;try{for(_iterator143.s();!(_step143=_iterator143.n()).done;){var _t10=_step143.value;var i=_t10.value;i&&(e[i.id]=i)}}catch(err){_iterator143.e(err)}finally{_iterator143.f()}for(var t in e){e[t].dispose()}}},{key:"notifyGlobalUpdate",value:function notifyGlobalUpdate(){}}]);return Df}(),Ff=Df;Ff.nextId=0;var X0=/*#__PURE__*/function(){function X0(e){_classCallCheck(this,X0);this.chunk=e}_createClass(X0,[{key:"next",value:function next(){var e;var t;return this.chunk?(t={value:this.chunk,done:!1},this.chunk=(e=this.chunk.nextChunk)!=null?e:null):t={value:void 0,done:!0},t}}]);return X0}(),Y0=/*#__PURE__*/function(){function Y0(e){_classCallCheck(this,Y0);this.nodes={},this.factory=e}_createClass(Y0,[{key:"create",value:function create(){return this.factory(this)}},{key:"forEachCandidateFloatNodes",value:function forEachCandidateFloatNodes(e){for(var t in this.nodes){e(this.nodes[t].leaf)}}},{key:"bind",value:function bind(e,t){var i=this.nodes[t.id];i||(i=this.nodes[t.id]={leaf:t,chunks:{}}),i.chunks[e.id]=e}},{key:"unbind",value:function unbind(e,t){var i=this.nodes[t.id];if(i){var _r51=i.chunks;delete _r51[e.id],mt(_r51)||delete this.nodes[t.id]}}}]);return Y0}(),Q0=/*#__PURE__*/function(){function Q0(){_classCallCheck(this,Q0);this.refManager=new q0,this.pool=[]}_createClass(Q0,[{key:"pull",value:function pull(){var e;if(this.pool.length===0){var t=document.createElement("canvas"),i=Vs(t);e={canvas:t,context:i,size:{width:0,height:0}}}else e=this.pool.pop();return e}},{key:"push",value:function push(e){this.pool.push(e)}},{key:"clear",value:function clear(){this.pool=[]}}]);return Q0}(),q0=/*#__PURE__*/function(){function q0(){_classCallCheck(this,q0);this.refs={},this._length=0}_createClass(q0,[{key:"has",value:function has(e){return e in this.refs}},{key:"set",value:function set(e,t){if(!this.has(e)){var i={id:e,value:t,prev:this.tail};this.tail?(this.tail.next=i,this.tail=i):this.head=this.tail=i,this.refs[e]=i,this._length+=1}}},{key:"delete",value:function _delete(e){if(this.has(e)){var _this$refs$e=this.refs[e],t=_this$refs$e.prev,i=_this$refs$e.next;t?t.next=i:this.head=i,i?i.prev=t:this.tail=t,delete this.refs[e],this._length-=1}}},{key:"shift",value:function shift(){var e=this.head;if(e)return this["delete"](e.id),e.value}},{key:"length",get:function get(){return this._length}}]);return q0}(),wh=/*#__PURE__*/function(){function wh(e){_classCallCheck(this,wh);this.canvasPool=e,this.id="".concat(wh.id+=1),this.value=null}_createClass(wh,[{key:"get",value:function get(){return this.value}},{key:"allocate",value:function allocate(e){if(this.value)throw new Error("can not call allocate on non empty canvasRef!");var t;if(this.canvasPool.refManager.length<wh.MaxRefsSize)t=this.canvasPool.pull();else{var o=this.canvasPool.refManager.shift();t=o.value,o.value=null}this.value=t,this.canvasPool.refManager.set(this.id,this);var _t11=t,i=_t11.canvas,r=_t11.context,_t$size=t.size=e,n=_t$size.width,s=_t$size.height;return i.width=n+1,i.height=s+1,r.resetTransform(),t}},{key:"clear",value:function clear(){this.canvasPool.refManager["delete"](this.id),this.value&&(this.canvasPool.push(this.value),this.value=null)}},{key:"isEmpty",value:function isEmpty(){return this.value==null}},{key:"isSizeEquals",value:function isSizeEquals(e){return!!this.value&&ci(this.value.size,e)}}]);return wh}(),Ia=wh;Ia.MaxRefsSize=256,Ia.id=0;var kh=/*#__PURE__*/function(_Ca){_inherits(kh,_Ca);var _super31=_createSuper(kh);function kh(e,t,i,r){var _this121;_classCallCheck(this,kh);_this121=_super31.call(this,i);_this121.ratio=1,_this121.cacheSize=kh.initCacheSize,_this121.didCacheSizeUpdated=!1,_this121.projectiveRect=kh.initProjectiveReact,_this121.painter=e,_this121.statistical=r,_this121.canvasPool=t,_this121.canvasRef=new Ia(t);return _this121}_createClass(kh,[{key:"onSplit",value:function onSplit(){var e;this.canvasRef.clear(),(e=this.statistical)==null||e.recordSplit()}},{key:"onRemoved",value:function onRemoved(){this.canvasRef.clear()}},{key:"updateProjectiveRect",value:function updateProjectiveRect(e){this.projectiveRect=e}},{key:"updateCacheInfo",value:function updateCacheInfo(e,t,i){this.ratio=e,ci(this.cacheSize,t)||(this.cacheSize=t,this.didCacheSizeUpdated=!0),i&&this.didCacheSizeUpdated&&(this.canvasRef.clear(),this.didCacheSizeUpdated=!1)}},{key:"onGlobalUpdate",value:function onGlobalUpdate(){this.canvasRef.clear()}},{key:"paint",value:function paint(e){var t,i;var r,n=this.canvasRef.get();if(n){r=n.canvas}else{var _this$canvasRef$alloc=this.canvasRef.allocate(this.cacheSize),s=_this$canvasRef$alloc.context,o=_this$canvasRef$alloc.canvas;s.scale(this.ratio,this.ratio),this.paintNodes(s,this,Jr.GenerateCache),(t=this.statistical)==null||t.recordGenerateCache(),r=o}if(this.canvasRef.isSizeEquals(this.cacheSize))e.drawImage(r,0,0);else{var _this$cacheSize=this.cacheSize,_s22=_this$cacheSize.width,_o14=_this$cacheSize.height;e.drawImage(r,0,0,_s22+1,_o14+1)}(i=this.statistical)==null||i.recordPaintCache()}},{key:"onFuse",value:function onFuse(e,t){var i;if(!this.canvasRef.isEmpty()||this.hasAnyCache(e)||this.hasAnyCache(t)){var _r52=[].concat(_toConsumableArray(e),[this],_toConsumableArray(t)),n=_r52[0],s=_r52.slice(1),o;n.canvasRef.isSizeEquals(this.cacheSize)?o=n.canvasRef:(o=this.mergeChunk(new Ia(this.canvasPool),n),this.canvasRef.clear());var _iterator144=_createForOfIteratorHelper(s),_step144;try{for(_iterator144.s();!(_step144=_iterator144.n()).done;){var a=_step144.value;o=this.mergeChunk(o,a)}}catch(err){_iterator144.e(err)}finally{_iterator144.f()}this.canvasRef=o}(i=this.statistical)==null||i.recordFuse(e.length+1+t.length)}},{key:"hasAnyCache",value:function hasAnyCache(e){var _iterator145=_createForOfIteratorHelper(e),_step145;try{for(_iterator145.s();!(_step145=_iterator145.n()).done;){var t=_step145.value;if(!t.canvasRef.isEmpty())return!0}}catch(err){_iterator145.e(err)}finally{_iterator145.f()}return!1}},{key:"mergeChunk",value:function mergeChunk(e,t){var _e$allocate,_e$get;var i,r;var n;if(e.isEmpty()?(_e$allocate=e.allocate(this.cacheSize),n=_e$allocate.context,_e$allocate):(_e$get=e.get(),n=_e$get.context,_e$get),t.canvasRef.isEmpty()){var s=this.paintNodes(n,t,Jr.GenerateCache);(i=this.statistical)==null||i.recordPaintCache(s)}else{n.resetTransform();var _t$canvasRef$get=t.canvasRef.get(),_s23=_t$canvasRef$get.canvas;if(t.canvasRef.isSizeEquals(this.cacheSize))n.drawImage(_s23,0,0);else{var _this$cacheSize2=this.cacheSize,o=_this$cacheSize2.width,a=_this$cacheSize2.height;n.drawImage(_s23,0,0,o+1,a+1)}(r=this.statistical)==null||r.recordFuseCache()}return e}},{key:"paintNodes",value:function paintNodes(e,t,i){var r;var n=0;var _iterator146=_createForOfIteratorHelper(t),_step146;try{for(_iterator146.s();!(_step146=_iterator146.n()).done;){var s=_step146.value;e.resetTransform(),e.scale(this.ratio,this.ratio),(r=this.painter(s.id))==null||r.paint(e,i,this.projectiveRect),n+=1}}catch(err){_iterator146.e(err)}finally{_iterator146.f()}return n}}]);return kh}(Ca),Ch=kh;Ch.initCacheSize=Object.freeze({width:1,height:1}),Ch.initProjectiveReact=Object.freeze({originX:0,originY:0,width:1,height:1});var Z0=/*#__PURE__*/function(_K){_inherits(Z0,_K);var _super32=_createSuper(Z0);function Z0(e,t,i,r){var _this122;_classCallCheck(this,Z0);_this122=_super32.call(this,t);_this122.canvasPool=i,_this122.chunkContext=new Y0(function(n){return new Ch(e,i,n,r)});return _this122}_createClass(Z0,[{key:"create",value:function create(e){return new J0(e)}}]);return Z0}(K0),J0=/*#__PURE__*/function(_Ff){_inherits(J0,_Ff);var _super33=_createSuper(J0);function J0(e){var _this123;_classCallCheck(this,J0);_this123=_super33.call(this,e);_this123.ratio=1,_this123.cacheSize=Object.freeze({width:e.projectiveSize.width,height:e.projectiveSize.height}),_this123.projectiveRect=Object.freeze(B({originX:0,originY:0},e.projectiveSize));return _this123}_createClass(J0,[{key:"updatePaintInfo",value:function updatePaintInfo(e,t,i,r){this.projectiveRect=Object.freeze(Le(B({},this.projectiveRect),{originX:e,originY:t})),this.ratio=i,this.cacheSize=Object.freeze({width:this.projectiveSize.width*i,height:this.projectiveSize.height*i}),this.updateCacheInfo(this.ratio,this.cacheSize,r),this.updateProjectiveRect(this.projectiveRect)}},{key:"onProjectiveSizeUpdate",value:function onProjectiveSizeUpdate(e,t){this.projectiveRect=Object.freeze(B(B({},this.projectiveRect),e)),this.cacheSize=Object.freeze({width:this.projectiveSize.width*this.ratio,height:this.projectiveSize.height*this.ratio}),this.updateCacheInfo(this.ratio,this.cacheSize,t),this.updateProjectiveRect(this.projectiveRect)}},{key:"updateCacheInfo",value:function updateCacheInfo(e,t,i){var _iterator147=_createForOfIteratorHelper(this),_step147;try{for(_iterator147.s();!(_step147=_iterator147.n()).done;){var _r53=_step147.value;_r53.updateCacheInfo(e,t,i)}}catch(err){_iterator147.e(err)}finally{_iterator147.f()}}},{key:"updateProjectiveRect",value:function updateProjectiveRect(e){var _iterator148=_createForOfIteratorHelper(this),_step148;try{for(_iterator148.s();!(_step148=_iterator148.n()).done;){var t=_step148.value;t.updateProjectiveRect(e)}}catch(err){_iterator148.e(err)}finally{_iterator148.f()}}},{key:"notifyGlobalUpdate",value:function notifyGlobalUpdate(){var _iterator149=_createForOfIteratorHelper(this),_step149;try{for(_iterator149.s();!(_step149=_iterator149.n()).done;){var e=_step149.value;e.onGlobalUpdate()}}catch(err){_iterator149.e(err)}finally{_iterator149.f()}}},{key:"paint",value:function paint(e,t,i){var r=i||this[Symbol.iterator](),n,s=null;for(;n=r.next(),!n.done;){var o=n.value;if(t(o)){s=o;break}o.paint(e)}return{iterator:r,floatChunk:s}}}]);return J0}(Ff),fr;(function(e){e[e.None=0]="None",e[e.CoverByTop=1]="CoverByTop",e[e.Repaint=2]="Repaint"})(fr||(fr={}));var _s;(function(e){e[e.None=0]="None",e[e.All=1]="All",e[e.Part=2]="Part"})(_s||(_s={}));var ek=/*#__PURE__*/function(){function ek(){_classCallCheck(this,ek);this.dirties=[]}_createClass(ek,[{key:"createDirty",value:function createDirty(){var _this124=this;var e=new xh(function(){var t=_this124.dirties.indexOf(e);t!==-1&&_this124.dirties.splice(t,1)});return this.dirties.push(e),e}},{key:"canBeMoreDirty",get:function get(){var e=!1;var _iterator150=_createForOfIteratorHelper(this.dirties),_step150;try{for(_iterator150.s();!(_step150=_iterator150.n()).done;){var t=_step150.value;if(t.canBeMoreDirty){e=!0;break}}}catch(err){_iterator150.e(err)}finally{_iterator150.f()}return e}},{key:"dirtyAll",value:function dirtyAll(){var _iterator151=_createForOfIteratorHelper(this.dirties),_step151;try{for(_iterator151.s();!(_step151=_iterator151.n()).done;){var e=_step151.value;e.dirtyAll()}}catch(err){_iterator151.e(err)}finally{_iterator151.f()}}},{key:"createDirtyCellsCollection",value:function createDirtyCellsCollection(){var _this125=this;return new Bf(null,function(e,t){var _iterator152=_createForOfIteratorHelper(_this125.dirties),_step152;try{for(_iterator152.s();!(_step152=_iterator152.n()).done;){var i=_step152.value;i.dirtyCells(e,t)}}catch(err){_iterator152.e(err)}finally{_iterator152.f()}})}}]);return ek}(),Bf=/*#__PURE__*/function(){function Bf(e,t){_classCallCheck(this,Bf);this.cells={},this.subCells={},this.parent=e,this.onCollectedCells=t}_createClass(Bf,[{key:"createSub",value:function createSub(){return new Bf(this,null)}},{key:"collect",value:function collect(e,t){var i=xh.key(e,t);i in this.cells||(this.cells[i]={row:e,column:t,level:0})}},{key:"complete",value:function complete(e){var t;var i=this.putLevelAndCollectMaxLevel(e);this.assignSubCells(),this.parent&&this.reportToParent(this.parent),(t=this.onCollectedCells)==null||t.call(this,i,this.cells)}},{key:"putLevelAndCollectMaxLevel",value:function putLevelAndCollectMaxLevel(e){var t=0;for(var i in this.cells){var _r54=this.cells[i].level;this.cells[i].level=Math.max(_r54,e),t=Math.max(t,e)}return t}},{key:"assignSubCells",value:function assignSubCells(){for(var e in this.subCells){if(e in this.cells){var t=this.cells[e].level;this.cells[e].level=Math.max(t,this.subCells[e].level)}else this.cells[e]=this.subCells[e]}}},{key:"reportToParent",value:function reportToParent(_ref47){var e=_ref47.subCells;for(var t in this.cells){var i=e[t],_r55=this.cells[t];i&&i.level>_r55.level&&(_r55=i),e[t]=_r55}}}]);return Bf}(),xh=/*#__PURE__*/function(){function xh(e){_classCallCheck(this,xh);this.phase=1,this.cells=null,this.release=e}_createClass(xh,[{key:"canBeMoreDirty",get:function get(){return this.phase!==1}},{key:"takeDirtyState",value:function takeDirtyState(){var e=new tk(this.phase,this.cells);return this.phase=0,this.cells=null,e}},{key:"dirtyAll",value:function dirtyAll(){this.phase=1,this.cells=null}},{key:"dirtyCells",value:function dirtyCells(e,t){this.phase!==1&&(e>=2&&(this.phase=2),this.cells?Object.assign(this.cells,t):this.cells=B({},t))}}],[{key:"key",value:function key(e,t){return"".concat(e,",").concat(t)}}]);return xh}(),tk=/*#__PURE__*/function(){function tk(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,tk);this.cells=null,this.phase=e,this.cells=t}_createClass(tk,[{key:"isDirty",value:function isDirty(e,t){switch(this.phase){case 2:if(this.cells){var i=xh.key(e,t),_r56=this.cells[i];return _r56?_r56.level>=2:!1}else return!1;case 1:return!0;default:return!1;}}},{key:"forEachDirtyBuckets",value:function forEachDirtyBuckets(e,t,i){switch(this.phase){case 1:{e.forEachBuckets(i);break}case 2:{if(this.cells)for(var _r57 in this.cells){var _this$cells$_r=this.cells[_r57],n=_this$cells$_r.row,s=_this$cells$_r.column,o=_this$cells$_r.level;if(o>=t){var a=e.bucket(n,s);a&&i(a,n,s)}}break}}}}]);return tk}(),jf=/*#__PURE__*/function(){function jf(e){var _this126=this;_classCallCheck(this,jf);this.paintableBucketsQueue=[],this.isFloatChunk=function(t){return t.id in _this126.chunkToFloatMap},this.grid=e.grid,this.cleanBucketsBackground=e.cleanBucketsBackground,this.dirtyState=e.dirtyState,this.floatLeafPainter=e.floatLeafPainter,this.paintBucket=e.bucketPainter,this.chunkToFloatMap=e.floatNodesInfo.chunkToFloatMap,this.pendingByFloats=e.floatNodesInfo.pendingByFloats}_createClass(jf,[{key:"collectBuckets",value:function collectBuckets(){var _this127=this;this.dirtyState.forEachDirtyBuckets(this.grid,fr.CoverByTop,function(e,t,i){_this127.startToPaintBucket({bucket:e,row:t,column:i},_this127.cleanBucketsBackground)})}},{key:"runLoopToPaintAll",value:function runLoopToPaintAll(){var e=!1;for(;this.paintableBucketsQueue.length>0;){this.startToPaintBucket(this.paintableBucketsQueue.pop(),e)}mt(this.pendingByFloats)&&this.printPendingFloatNodesWarn()}},{key:"printPendingFloatNodesWarn",value:function printPendingFloatNodesWarn(){console.warn("found pending float nodes were never paint");for(var e in this.pendingByFloats){var _this$pendingByFloats=this.pendingByFloats[e],t=_this$pendingByFloats.untouched,i=_this$pendingByFloats.pending,_r58=Object.keys(t).join(", "),n=Object.keys(i).join(", ");console.warn("float ".concat(e," is waiting ").concat(_r58," to touch, and is padding buckets ").concat(n))}}},{key:"startToPaintBucket",value:function startToPaintBucket(e,t){var i=e.bucket,r=e.row,n=e.column,s=e.iterator,_this$paintBucket=this.paintBucket(i,r,n,this.isFloatChunk,t,s),o=_this$paintBucket.iterator,a=_this$paintBucket.floatChunk;if(a){var c=this.pendingByFloatInfo(a);if(c){var h=c.untouched,d=c.pending,u=a.getSampleNode();delete h[i.id],d[i.id]={bucket:i,row:r,column:n,iterator:o},mt(h)||this.startToPaintFloatNode(u,d)}}}},{key:"pendingByFloatInfo",value:function pendingByFloatInfo(e){var t=this.chunkToFloatMap[e.id];return t?t.info:null}},{key:"startToPaintFloatNode",value:function startToPaintFloatNode(e,t){this.floatLeafPainter(e.related),delete this.pendingByFloats[e.id];for(var i in t){var _r59=t[i];this.paintableBucketsQueue.unshift(_r59)}}}],[{key:"paintBuckets",value:function paintBuckets(e){var t=new jf(e);t.collectBuckets(),t.runLoopToPaintAll()}}]);return jf}();function ik(e){return new rk(e).search()}var rk=/*#__PURE__*/function(){function rk(e){_classCallCheck(this,rk);this.chunkContext=e.chunkContext,this.grid=e.grid,this.visions=e.visions,this.dirtyCells=e.dirtyCells}_createClass(rk,[{key:"search",value:function search(){var _this128=this;var e={},t={},i={};return this.chunkContext.forEachCandidateFloatNodes(function(r){var n;var s=r,o=(n=_this128.dirtyCells)==null?void 0:n.createSub(),a=_this128.searchCoverBuckets(s,o);if(a){var c=a.buckets,h=a.range,d={},u=!0,p=!0,f=null;for(var m in c){var g=c[m].findChunk(s);if(g&&g.isFloat)f||(f={leaf:s,info:{untouched:c,pending:{}}}),g.nextChunk&&(p=!1),d[g.id]=f;else{u=!1;break}}u&&f&&(Object.assign(e,d),t[s.id]=f.info,p?i[s.id]={leaf:s,range:h,dirtyCells:o}:o==null||o.complete(fr.Repaint))}}),{chunkToFloatMap:e,pendingByFloats:t,topFloatNodes:i}}},{key:"searchCoverBuckets",value:function searchCoverBuckets(e,t){var _this129=this;var i=this.visions.vision(e.id);if(!i)return null;var r=De.rectToRange(i.sceneRect,this.grid.unitSize),n=De.calcIntersection(r,this.grid.range);if(!n)return null;var s={};return n.forEach(function(o,a){var c=_this129.grid.bucket(o,a);c&&(s[c.id]=c),t==null||t.collect(o,a)}),mt(s)?{range:n,buckets:s}:null}}]);return rk}(),Ih=/*#__PURE__*/function(){function Ih(e){var _this130=this;_classCallCheck(this,Ih);this.painters={},this.canvasPool=new Q0,this.floatCanvasSize=null,this.nextFloatNodesInfo=null,this.topFloatRangeSet={},this.onLeafNodeVisible=function(t){var i=t.value,r=_this130.getRenderConstructor(i.definition);if(r){var n=new r(i,_this130.context),s=new U0(_this130.screen,_this130.visions,t,_this130.fixedSize,n,_this130.onRepaint);_this130.painters[t.id]=s}},this.onLeafNodeInvisible=function(t){delete _this130.painters[t.id]},this.fixedSize=e.fixedSize,this.willPrintGrid=!!e.willPrintGrid,this.onRepaint=e.onRepaint,this.getRenderConstructor=e.getRenderConstructor,this.screen=e.screen,this.dirtyNotify=e.dirtyNotify,this.visions=e.visions,this.camera=this.screen.camera,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.context=e.context,this.statistical=e.statistical,this.visionRectangle=this.createVisionRectangle(this.camera,this.screenSize),this.bucketFactory=new Z0(function(t){return _this130.painters[t]},this.visions,this.canvasPool,this.statistical),this.grid=new Rf({tree:e.tree,visions:e.visions,bucketFactory:this.bucketFactory,visionRectangle:this.visionRectangle,scale:this.camera.scale,rate:e.rate,bucketUnitSize:e.bucketUnitSize,favorBucketsCount:e.favorBucketsCount,onLeafNodeVisible:this.onLeafNodeVisible,onLeafNodeInvisible:this.onLeafNodeInvisible});var _iterator153=_createForOfIteratorHelper(e.tree),_step153;try{for(_iterator153.s();!(_step153=_iterator153.n()).done;){var t=_step153.value;this.onLeafNodeVisible(t)}}catch(err){_iterator153.e(err)}finally{_iterator153.f()}}_createClass(Ih,[{key:"dispose",value:function dispose(){this.canvasPool.clear()}},{key:"update",value:function update(e){var t;var i=!1,r=!1,n;if(e.context){for(var a in this.painters){this.painters[a].updateContext(e.context)}this.context=e.context,i=!0}e.camera&&(this.camera=e.camera,r=!0),e.screenSize&&(this.screenSize=e.screenSize,r=!0);for(var _a12 in e.updateSet){(t=this.painters[_a12])==null||t.refreshPayload()}r&&(this.visionRectangle=n=this.createVisionRectangle(this.camera,this.screenSize));var s;i||r?this.dirtyNotify.dirtyAll():this.dirtyNotify.canBeMoreDirty&&(s=this.dirtyNotify.createDirtyCellsCollection());var o=this.grid.update({shouldUpdateAll:i,dirtyCells:s,visionRectangle:n,scale:this.camera.scale,diff:e.diff,updateSet:e.updateSet,moveSet:e.moveSet,refresh:e.refresh});e.floatCanvasSize&&(this.floatCanvasSize=e.floatCanvasSize),this.nextFloatNodesInfo=this.searchFloatNodes({dirtyCells:s,visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext}),s&&(this.dirtyTouchedBuckets(s,this.nextFloatNodesInfo,o),s.complete(fr.Repaint))}},{key:"dirtyTouchedBuckets",value:function dirtyTouchedBuckets(e,_ref48,i){var t=_ref48.topFloatNodes;if(t){var _r60=t.leaves;var _iterator154=_createForOfIteratorHelper(i),_step154;try{for(_iterator154.s();!(_step154=_iterator154.n()).done;){var _step154$value=_step154.value,n=_step154$value.row,s=_step154$value.column,o=_step154$value.touchedLeaves;Ih.isAllKeysBelongTo(o,_r60)||e.collect(n,s)}}catch(err){_iterator154.e(err)}finally{_iterator154.f()}}else{var _iterator155=_createForOfIteratorHelper(i),_step155;try{for(_iterator155.s();!(_step155=_iterator155.n()).done;){var _step155$value=_step155.value,_r61=_step155$value.row,_n34=_step155$value.column;e.collect(_r61,_n34)}}catch(err){_iterator155.e(err)}finally{_iterator155.f()}}}},{key:"createVisionRectangle",value:function createVisionRectangle(e,t){var i,r,n,s;return e.scale===0?(i=0,r=0,n=0,s=0):(n=t.width/e.scale,s=t.height/e.scale,i=e.centerX-n/2,r=e.centerY-s/2),Object.freeze({originX:i,originY:r,width:n,height:s})}},{key:"paintTopFloatAndGetOrigin",value:function paintTopFloatAndGetOrigin(e,t,i){var r;var _this$getPaintFloatNo=this.getPaintFloatNodesInfo(),n=_this$getPaintFloatNo.topFloatNodes,s=null;if(n){var o=n.zone,a=n.leaves;s={x:o.originX,y:o.originY},t.resetTransform(),t.clearRect(0,0,e.width,e.height);for(var c in a){var h=this.painters[c];h&&(t.resetTransform(),t.scale(i,i),t.translate(-s.x,-s.y),h.paint(t,Jr.Directly),(r=this.statistical)==null||r.recordPaintFloat())}}return s}},{key:"paintBackground",value:function paintBackground(_ref49){var _this131=this;var e=_ref49.context,t=_ref49.ratio,i=_ref49.refresh,r=_ref49.cleanBucketsBackground,n=_ref49.dirtyState;var s,o;var a=this.getPaintFloatNodesInfo(),c=(o=(s=a.topFloatNodes)==null?void 0:s.leaves)!=null?o:Ih.voidLeaves;jf.paintBuckets({grid:this.grid,floatNodesInfo:a,dirtyState:n,cleanBucketsBackground:r,floatLeafPainter:function floatLeafPainter(_ref50){var h=_ref50.id;var d;var u=_this131.painters[h];u&&!c[h]&&(e.resetTransform(),e.scale(t,t),u.paint(e,Jr.Directly),(d=_this131.statistical)==null||d.recordPaintFloat())},bucketPainter:function bucketPainter(h,d,u,p,f,m){var _this131$toScreenPoin=_this131.toScreenPoint(d,u,_this131.grid.unitSize),g=_this131$toScreenPoin.x,y=_this131$toScreenPoin.y;if(e.resetTransform(),e.translate(g*t,y*t),h.updatePaintInfo(g,y,t,i),f){var _h$projectiveSize=h.projectiveSize,b=_h$projectiveSize.width,S=_h$projectiveSize.height,w=b*t,P=S*t;e.clearRect(0,0,w,P)}return h.paint(e,p,m)}}),this.willPrintGrid&&(e.resetTransform(),e.scale(t,t),this.paintGrid(e))}},{key:"completePaint",value:function completePaint(){this.nextFloatNodesInfo=null}},{key:"getPaintFloatNodesInfo",value:function getPaintFloatNodesInfo(){var e;return(e=this.nextFloatNodesInfo)!=null?e:this.searchFloatNodes({visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext})}},{key:"paintGrid",value:function paintGrid(e){var _this132=this;var _this$grid=this.grid,t=_this$grid.range,i=_this$grid.unitSize;e.lineWidth=1,e.strokeStyle="rgba(0,0,0,0.5)",e.fillStyle="rgba(0,0,0,0.5)",t.forEach(function(r,n){var _this132$toScreenPoin=_this132.toScreenPoint(r,n,i),s=_this132$toScreenPoin.x,o=_this132$toScreenPoin.y,a=Math.ceil(i.width*_this132.camera.scale),c=Math.ceil(i.height*_this132.camera.scale);e.strokeRect(s,o,a,c),e.fillText("".concat(r,",").concat(n),s+2,o+14)})}},{key:"searchFloatNodes",value:function searchFloatNodes(e){var t=ik(e),i=null,r=null;if(this.floatCanvasSize){var _this$floatCanvasSize=this.floatCanvasSize,o=_this$floatCanvasSize.width,a=_this$floatCanvasSize.height,c=this.searchBorderRectange(t.topFloatNodes);c&&c.width<=o&&c.height<=a&&(i=c)}var n={},s=e.dirtyCells;if(i){var _o15={};for(var _a13 in t.topFloatNodes){var _c7=fr.CoverByTop,_t$topFloatNodes$_a=t.topFloatNodes[_a13],h=_t$topFloatNodes$_a.leaf,d=_t$topFloatNodes$_a.range,u=_t$topFloatNodes$_a.dirtyCells;_o15[_a13]=h,_a13 in this.topFloatRangeSet?delete this.topFloatRangeSet[_a13]:_c7=fr.Repaint,u==null||u.complete(_c7),n[_a13]=d}r={zone:i,leaves:_o15}}else for(var _o16 in t.topFloatNodes){var _a14=t.topFloatNodes[_o16].dirtyCells;_a14&&_a14.complete(fr.Repaint)}if(s)for(var _o17 in this.topFloatRangeSet){this.topFloatRangeSet[_o17].forEach(function(a,c){s.collect(a,c)})}return this.topFloatRangeSet=n,{topFloatNodes:r,chunkToFloatMap:t.chunkToFloatMap,pendingByFloats:t.pendingByFloats}}},{key:"searchBorderRectange",value:function searchBorderRectange(e){var t=null,i=0,r=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(var a in e){var c=this.visions.vision(a);if(c){var h=c.screenRect,d=h.originX,u=h.originX+h.width,p=h.originY,f=h.originY+h.height;r>d&&(r=d),n<u&&(n=u),s>p&&(s=p),o<f&&(o=f),i+=1}}if(i>0){var _a15=32,_c8=Math.floor(r/_a15)*_a15,_h10=Math.floor(s/_a15)*_a15,_d6=Math.ceil(n-_c8),_u5=Math.ceil(o-_h10);t={originX:_c8,originY:_h10,width:_d6,height:_u5}}return t}},{key:"toScreenPoint",value:function toScreenPoint(e,t,i){var r=t*i.width,n=e*i.height,s=(r-this.camera.centerX)*this.camera.scale+this.screenSize.width/2,o=(n-this.camera.centerY)*this.camera.scale+this.screenSize.height/2;return{x:s,y:o}}}],[{key:"isAllKeysBelongTo",value:function isAllKeysBelongTo(e,t){for(var i in e){if(!(i in t))return!1}return!0}}]);return Ih}(),zf=Ih;zf.voidLeaves={};var nk=/*#__PURE__*/function(){function nk(){_classCallCheck(this,nk);typeof performance=="undefined"?this.fetch=this.fetchByMilliseconds:this.fetch=this.fetchByMicroseconds}_createClass(nk,[{key:"fetchByMilliseconds",value:function fetchByMilliseconds(){return Date.now()*1e3}},{key:"fetchByMicroseconds",value:function fetchByMicroseconds(){return Math.floor(performance.now()*1e3)}}]);return nk}(),sk=new nk;function Uf(){return sk.fetch()}var Pa=/*#__PURE__*/function(){function Pa(e,t,i){_classCallCheck(this,Pa);this.canvas=null,this.canvasSizeSetter=null,this._ratio=1,this._visibility=!0,this.canvasIndex=1,this._size=Object.freeze(B({},e)),this.dirtyNotify=t,this.onSetupCanvas=i}_createClass(Pa,[{key:"size",get:function get(){return this._size},set:function set(e){(this._size.width!==e.width||this._size.height!==e.height)&&(this._size=Object.freeze(B({},e)),this.canvas&&this._visibility&&this.refreshSize())}},{key:"visibility",get:function get(){return this._visibility},set:function set(e){this._visibility!==e&&(this._visibility=e,this.canvas&&this._visibility&&this.refreshSize(),this.refreshVisibility())}},{key:"ratio",get:function get(){return this._ratio}},{key:"hasNextCanvasNode",get:function get(){return!!this.canvas}},{key:"nextCanvasNode",value:function nextCanvasNode(){var e=null;if(this.canvas){var _this$canvas=this.canvas,t=_this$canvas.node1,i=_this$canvas.node2;e=[t,i][this.canvasIndex-1]}return e}},{key:"updateToNextBuffering",value:function updateToNextBuffering(){if(this.canvas)switch(this.refreshVisibility(),this.canvasIndex){case 1:{this.canvasIndex=2;break}case 2:{this.canvasIndex=1;break}}}},{key:"setCanvas",value:function setCanvas(e){var t,i,r,n,s,o,a;var c=!1;if(e){var _e7=_slicedToArray(e,2),h=_e7[0],d=_e7[1];if(this.canvas){var _this$canvas2=this.canvas,u=_this$canvas2.node1,p=_this$canvas2.node2;(u.canvas!==h||p.canvas!==d)&&((t=u.dirty)==null||t.release(),(i=p.dirty)==null||i.release(),this.canvas=null)}this.canvas||(c=!0,this.canvas=Object.freeze({node1:Object.freeze({canvas:h,dirty:(r=this.dirtyNotify)==null?void 0:r.createDirty()}),node2:Object.freeze({canvas:d,dirty:(n=this.dirtyNotify)==null?void 0:n.createDirty()})}))}else this.canvas&&((s=this.canvas.node1.dirty)==null||s.release(),(o=this.canvas.node2.dirty)==null||o.release(),this.canvas=null);c&&(this._ratio=this.getRatioWithCanvasPair(this.canvas),this.refreshSize(),this.refreshVisibility(),(a=this.onSetupCanvas)==null||a.call(this))}},{key:"refreshSize",value:function refreshSize(){var e;if(this.canvas){var t=this.canvas.node1.canvas,i=this.canvas.node2.canvas;if(!(t.getContext("2d")&&i.getContext("2d")))throw new Error("cannot find 2d context from canvas");var _r62=Math.ceil(this._ratio*this._size.width),n=Math.ceil(this._ratio*this._size.height);Pa.setCanvasSize(t,_r62,n),Pa.setCanvasSize(i,_r62,n),(e=this.canvasSizeSetter)==null||e.call(this,{width:_r62/this._ratio,height:n/this.ratio})}}},{key:"refreshVisibility",value:function refreshVisibility(){if(this.canvas){var e=this.canvas.node1.canvas,t=this.canvas.node2.canvas;if(this._visibility)switch(this.canvasIndex){case 1:{e.style.visibility="visible",t.style.visibility="hidden";break}case 2:{e.style.visibility="hidden",t.style.visibility="visible";break}}else e.style.visibility="hidden",t.style.visibility="hidden"}}},{key:"getRatioWithCanvasPair",value:function getRatioWithCanvasPair(e){var t=e.node1.canvas,i=e.node2.canvas;return Math.max(this.getRatioWithContext(Vs(t)),this.getRatioWithContext(Vs(i)))}},{key:"getRatioWithContext",value:function getRatioWithContext(e){var t=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(1,(window.devicePixelRatio||1)/t)}},{key:"getRender",value:function getRender(){var e=this;var t=/*#__PURE__*/function(_$s$Component){_inherits(t,_$s$Component);var _super34=_createSuper(t);function t(r){var _this133;_classCallCheck(this,t);_this133=_super34.call(this,r);_this133.canvas1=null,_this133.canvas2=null,_this133.onSetCanvas1Ref=function(n){_this133.canvas1=n,_this133.refreshCanvas()},_this133.onSetCanvas2Ref=function(n){_this133.canvas2=n,_this133.refreshCanvas()},_this133.state=B({},e._size),e.canvasSizeSetter=function(n){return _this133.setState(n)};return _this133}_createClass(t,[{key:"componentWillUnmount",value:function componentWillUnmount(){e.canvasSizeSetter=null}},{key:"refreshCanvas",value:function refreshCanvas(){this.canvas1&&this.canvas2?e.setCanvas([this.canvas1,this.canvas2]):e.setCanvas(null)}},{key:"render",value:function render(){var _this$props=this.props,r=_this$props.className,n=_this$props.style,_this$state=this.state,s=_this$state.width,o=_this$state.height,a=Le(B({},n),{width:s,height:o});return[(0,$s.createElement)("canvas",{key:"canvas1",className:r,ref:this.onSetCanvas1Ref,style:a}),(0,$s.createElement)("canvas",{key:"canvas2",className:r,ref:this.onSetCanvas2Ref,style:a})]}}]);return t}($s.Component);return t}}],[{key:"setCanvasSize",value:function setCanvasSize(e,t,i){(e.width!==t||e.height!==i)&&(e.width=t,e.height=i)}}]);return Pa}(),Ma=/*#__PURE__*/function(){function Ma(e){var _this134=this;_classCallCheck(this,Ma);this.dirtyNotify=new ek,this.refresh=!0,this.onRepaint=function(i){_this134.screen.scene.reportComponentUpdate(i,$e.PropertiesUpdated)},this.renderMode=e.renderMode,this.engine=e.engine,this.screen=e.screen,this.onRenderDuration=e.onRenderDuration,this.statistical=e.willPrintStatistical?new B0:void 0,this.className=e.className,this.style=Object.freeze(Le(B({},e.style),{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:this.engine.orderIndex}));var t=new ok(function(){return _this134.paint()});this.floatCanvas=new Pa(this.createFloatSize(this.screen),void 0,t.createUnlockCall()),this.floatCanvas.visibility=!1,this.backgroundCanvas=new Pa({width:this.screen.width,height:this.screen.height},this.dirtyNotify,t.createUnlockCall()),this.painter=new zf({tree:e.tree,fixedSize:e.fixedSize,screen:e.screen,visions:e.visions,context:this.screen.context,statistical:this.statistical,dirtyNotify:this.dirtyNotify,getRenderConstructor:e.getRenderConstructor,onRepaint:this.onRepaint,rate:2,favorBucketsCount:12,bucketUnitSize:Object.freeze({width:256,height:256})})}_createClass(Ma,[{key:"willInterruptEvent",value:function willInterruptEvent(){return!1}},{key:"findComponentWithTarget",value:function findComponentWithTarget(){}},{key:"update",value:function update(e){var t,i;var r=Uf(),n;switch(e.screenSize&&(n=this.createFloatSize(e.screenSize),this.backgroundCanvas.size=e.screenSize,this.floatCanvas.size=n),this.renderMode){case Ks.HighQuality:{this.refresh=!0;break}case Ks.PerformanceWhileTransition:{this.refresh=!e.isTransition;break}}this.painter.update({context:e.context,camera:e.camera,screenSize:e.screenSize,floatCanvasSize:n,diff:e.diff,updateSet:e.updateSet,moveSet:e.moveSet,refresh:this.refresh}),this.backgroundCanvas.hasNextCanvasNode?(this.paint(),(t=this.statistical)==null||t.print(),this.onRenderDuration&&this.onRenderDuration(Uf()-r)):(i=this.statistical)==null||i.clear()}},{key:"paint",value:function paint(){var _this135=this;var e=null,t=!1,i=this.floatCanvas.nextCanvasNode(),r=this.backgroundCanvas.nextCanvasNode();if(i){var n=Vs(i.canvas);n.resetTransform(),e=this.painter.paintTopFloatAndGetOrigin(i.canvas,n,this.floatCanvas.ratio)}if(r){var _n35=r.dirty.takeDirtyState();if(_n35.phase!==_s.None){var s=Vs(r.canvas),o=_n35.phase===_s.Part;if(s.resetTransform(),_n35.phase===_s.All){var _r$canvas=r.canvas,a=_r$canvas.width,c=_r$canvas.height;s.clearRect(0,0,a,c)}this.painter.paintBackground({context:s,ratio:this.backgroundCanvas.ratio,refresh:this.refresh,dirtyState:_n35,cleanBucketsBackground:o}),t=!0}}this.painter.completePaint(),(!i||!r)&&console.warn("cannot find canvas"),(i||r)&&Promise.resolve().then(function(){return _this135.doAfterPaint(e,i,t)})["catch"](function(n){return console.error(n)})}},{key:"doAfterPaint",value:function doAfterPaint(e,t,i){if(e&&t){var _r63=e.x,n=e.y;this.floatCanvas.visibility=!0,t.canvas.style.transform="translate(".concat(_r63,"px, ").concat(n,"px)"),this.floatCanvas.updateToNextBuffering()}else this.floatCanvas.visibility=!1;i&&this.backgroundCanvas.updateToNextBuffering()}},{key:"dispose",value:function dispose(){this.painter.dispose()}},{key:"createFloatSize",value:function createFloatSize(e){var t=Ma.floatCanvasMaxSize,i=e.width*Ma.floatCanvasRate,r=e.height*Ma.floatCanvasRate;return i>t.width&&(i=t.width),r>t.height&&(r=t.height),i=Math.floor(i),r=Math.floor(r),{width:i,height:r}}},{key:"getRender",value:function getRender(){var e=this,t=this.backgroundCanvas.getRender(),i=this.floatCanvas.getRender();var r=/*#__PURE__*/function(_mr$Component){_inherits(r,_mr$Component);var _super35=_createSuper(r);function r(s){_classCallCheck(this,r);return _super35.call(this,s)}_createClass(r,[{key:"componentWillUnmount",value:function componentWillUnmount(){e.dispose()}},{key:"render",value:function render(){return(0,mr.createElement)(mr.Fragment,null,(0,mr.createElement)(t,{className:e.className,style:e.style}),(0,mr.createElement)(i,{className:e.className,style:e.style}))}}]);return r}(mr.Component);return r}}]);return Ma}(),Ph=Ma;Ph.floatCanvasRate=.25,Ph.floatCanvasMaxSize=Object.freeze({width:340,height:240});var ok=/*#__PURE__*/function(){function ok(e){_classCallCheck(this,ok);this.onUnlock=e,this.didUnLock=!1,this.unlockCount=0,this.lockCount=0}_createClass(ok,[{key:"createUnlockCall",value:function createUnlockCall(){var _this136=this;return this.lockCount+=1,function(){_this136.unlockCount+=1,!_this136.didUnLock&&_this136.unlockCount===_this136.lockCount&&(_this136.didUnLock=!0,_this136.onUnlock())}}}]);return ok}();function Wi(e,t){return e===void 0?t:e}function Gs(e,t){return typeof e=="number"?e:t}var Ks;(function(e){e[e.HighQuality=0]="HighQuality",e[e.PerformanceWhileTransition=1]="PerformanceWhileTransition"})(Ks||(Ks={}));var Vf=/*#__PURE__*/function(_Us){_inherits(Vf,_Us);var _super36=_createSuper(Vf);function Vf(e){var _this137;_classCallCheck(this,Vf);_this137=_super36.call(this,e.orderIndex);_this137.constructors={},_this137.getRenderConstructor=function(t){return _this137.constructors[t.id]},_this137.fixedSize=e.fixedSize,_this137.renderMode=Wi(e.renderMode,0);return _this137}_createClass(Vf,[{key:"bind",value:function bind(e,t){if(!(e instanceof Kn))throw new Error("it is not ComponentDefinition");if(this.constructors[e.id])throw new Error("define duplicated ComponentDefinition");this.constructors[e.id]=t,e.addEngine(this,{isVisible:t.isVisible}),this.addDefinition(e)}},{key:"createRenderLayout",value:function createRenderLayout(e){return new Ph({engine:this,screen:e.screen,tree:e.tree,visions:e.visions,fixedSize:this.fixedSize,renderMode:this.renderMode,getRenderConstructor:this.getRenderConstructor,onRenderDuration:e.onRenderDuration})}}]);return Vf}(Us);function Wf(e){return new Vf(e)}function ak(e){return e instanceof Vf}var lk=/*#__PURE__*/function(){function lk(e){var _this138=this;_classCallCheck(this,lk);this.setCNodeElement=function(t,i){var r=t.treeNode.id,n=_this138.shadowList.node(r);n&&(n.value=i)},this.engine=e.engine,this.renderComponent=e.renderComponent,this.screen=e.screen,this.fixedSize=e.fixedSize,this.className=e.className,this.style=e.style,this.visions=e.visions,this.leafFilter=e.leafFilter,this.mode=e.mode,this.camera=e.initCamera||this.screen.camera,this.context=this.screen.context,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.shadowList=Yr.create({tree:e.tree,valueInitializer:function valueInitializer(){return null},initLeafFilter:function initLeafFilter(t){return _this138.visions.includes(t.id)&&e.leafFilter(t)}})}_createClass(lk,[{key:"willInterruptEvent",value:function willInterruptEvent(e,t,i){var r=this.findComponentWithTarget(i);if(r){var n=this.engine.getDefinitionNode(r.definition);if(n)return n.willInterruptEvent(e,r,t)}return!1}},{key:"findComponentWithTarget",value:function findComponentWithTarget(e){var t=this.shadowList.findNode(function(i){var r=i.value;return!!(r&&(e===r||r.contains(e)))});if(t){var i=t.related;if(i.value)return i.value}}},{key:"update",value:function update(e){var t=this.shadowList.appendDiff(e.diff),i=!1;e.camera&&(this.camera=e.camera,i=!0),e.screenSize&&(this.screenSize=e.screenSize,i=!0),e.context&&(this.context=e.context,i=!0),(mt(e.updateSet)||mt(e.moveSet)||t.addedNodes.length>0||t.removedNodes.length>0||t.sortedNodes.length>0)&&(i=!0),this.setState&&i&&this.setState(this.getRenderLayoutState())}},{key:"getRender",value:function getRender(){var e=this,t=this.renderComponent;var i=/*#__PURE__*/function(_Ta$Component){_inherits(i,_Ta$Component);var _super37=_createSuper(i);function i(n){var _this139;_classCallCheck(this,i);_this139=_super37.call(this,n);_this139.state=e.getRenderLayoutState(),e.setState=function(s){return _this139.setState(s)};return _this139}_createClass(i,[{key:"componentWillUnmount",value:function componentWillUnmount(){e.setState=void 0}},{key:"render",value:function render(){var _this$state2=this.state,n=_this$state2.camera,s=_this$state2.screenSize,o=_this$state2.context;return(0,Ta.createElement)(t,{engine:e.engine,screen:e.screen,mode:e.mode,visions:e.visions,leafFilter:e.leafFilter,camera:n,screenSize:s,context:o,fixedSize:e.fixedSize,className:e.className,style:e.style,onCNodeRef:e.setCNodeElement})}}]);return i}(Ta.Component);return i}},{key:"getRenderLayoutState",value:function getRenderLayoutState(){return{camera:this.camera,screenSize:this.screenSize,context:this.context}}}]);return lk}(),ck=/*#__PURE__*/function(_qr$Component){_inherits(ck,_qr$Component);var _super38=_createSuper(ck);function ck(){var _this140;_classCallCheck(this,ck);_this140=_super38.apply(this,arguments);_this140.onRef=function(e){var _this140$props=_this140.props,t=_this140$props.onRef,i=_this140$props.context;t&&t(e);var r=i;r&&r.onRef(r.component,e)};return _this140}_createClass(ck,[{key:"render",value:function render(){var _this$props2=this.props,e=_this$props2.context,t=_this$props2.children,i=_this$props2.fixedMode,r=_this$props2.style,n=e;if(n){var s=n.vision,o=n.component,a=n.margin,_s$screenRect=s.screenRect,c=_s$screenRect.originX,h=_s$screenRect.originY,d="absolute";if(i){var m=n.screen.bounding;c+=m.left,h+=m.top,d="fixed"}var u="translate(".concat(c,"px,").concat(h,"px) scale(").concat(n.scale,",").concat(n.scale,")"),p=B({WebkitTransform:u,transform:u,WebkitTransformOrigin:"0px 0px 0px",transformOrigin:"0px 0px 0px",position:d,overflow:"visible",width:n.size.width+n.margin.left+n.margin.right,height:n.size.height+n.margin.top+n.margin.bottom,margin:0,paddingLeft:a.left,paddingRight:a.right,paddingTop:a.top,paddingBottom:a.bottom,zIndex:o.orderIndex},r),f=B({},this.props);return delete f.context,delete f.fixedMode,delete f.onRef,(0,qr.createElement)("div",Le(B({},f),{style:p,ref:this.onRef}),t)}else return(0,qr.createElement)(qr.Fragment,null,t)}}]);return ck}(qr.Component),gr=ck,hk=/*#__PURE__*/function(_Qr$Component){_inherits(hk,_Qr$Component);var _super39=_createSuper(hk);function hk(){_classCallCheck(this,hk);return _super39.apply(this,arguments)}_createClass(hk,[{key:"getPreviewURL",value:function getPreviewURL(e){var t=this.props.mode;if(t===Kr.Preview)return e.previewURL}},{key:"getPositionInfo",value:function getPositionInfo(e,t,i){var r=this.props.fixedSize,n,s,o;e.absoluteCoordinates?o=1:o=i,r?(s={left:t.margin.left/o,right:t.margin.right/o,top:t.margin.top/o,bottom:t.margin.bottom/o},n={width:e.width,height:e.height}):(s=t.margin,n={width:t.screenRect.width-s.left-s.right,height:t.screenRect.height-s.top-s.bottom});var a={x:t.screenRect.originX,y:t.screenRect.originY};return{margin:s,size:n,origin:a,cnodeScale:o}}},{key:"renderPreview",value:function renderPreview(e,t,i,r){var _this$props3=this.props,n=_this$props3.screen,s=_this$props3.onCNodeRef,_this$getPositionInfo=this.getPositionInfo(e,t,r),o=_this$getPositionInfo.margin,a=_this$getPositionInfo.size,c=_this$getPositionInfo.cnodeScale,h={vision:t,component:e,screen:n,onRef:s,margin:o,size:a,scale:c};return(0,Qr.createElement)(gr,{key:e.id,context:h},(0,Qr.createElement)("img",{src:i,alt:"",width:a.width,height:a.height}))}},{key:"renderLeafNode",value:function renderLeafNode(e,t,i,r){var n=e.definition,_this$props4=this.props,s=_this$props4.engine,o=_this$props4.context,a=_this$props4.screen,c=_this$props4.onCNodeRef,h=s.getDefinitionNode(n);if(h){var _this$getPositionInfo2=this.getPositionInfo(e,t,r),d=_this$getPositionInfo2.margin,u=_this$getPositionInfo2.size,p=_this$getPositionInfo2.origin,f=_this$getPositionInfo2.cnodeScale,m=h.render,g={vision:t,component:e,margin:d,size:u,scale:f,screen:a,onRef:c};return(0,Qr.createElement)(m,{key:e.id,id:e.id,cnode:g,screen:a,payload:e.payload,context:o,size:u,origin:p,margin:d,scale:i,layout:s.orderIndex})}else return null}},{key:"render",value:function render(){var _this141=this;var e=[],_this$props5=this.props,t=_this$props5.visions,i=_this$props5.leafFilter,r=_this$props5.style,n=_this$props5.className,s=_this$props5.engine,o=_this$props5.fixedSize;return t.forEach(function(a,c){if(i(a)){var h=a.value,d=_this141.getPreviewURL(h),u=o?c.scale:1;if(d)e.push(_this141.renderPreview(h,c,d,u));else{var p=o?1:c.scale,f=_this141.renderLeafNode(h,c,p,u);e.push(f)}}}),(0,Qr.createElement)("div",{className:n,style:Le(B({},r),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},e)}}]);return hk}(Qr.Component),dk=/*#__PURE__*/function(_Hi$Component){_inherits(dk,_Hi$Component);var _super40=_createSuper(dk);function dk(){_classCallCheck(this,dk);return _super40.apply(this,arguments)}_createClass(dk,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e){var _this$props6=this.props,t=_this$props6.origin,i=_this$props6.size,r=_this$props6.zIndex,n=_this$props6.margin,s=_this$props6.payload,o=_this$props6.context;return t.x!==e.origin.x||t.y!==e.origin.y||i.width!==e.size.width||i.height!==e.size.height||r!==e.zIndex||n.left!==e.margin.left||n.right!==e.margin.right||n.top!==e.margin.top||n.bottom!==e.margin.bottom||s!==e.payload||o!==e.context}},{key:"render",value:function render(){var _this$props7=this.props,e=_this$props7.render,t=_this$props7.screen,i=_this$props7.engine,r=_this$props7.component,n=_this$props7.context,s=_this$props7.origin,o=_this$props7.zIndex,a=_this$props7.size,c=_this$props7.margin,h=_this$props7.payload,d="translate(".concat(s.x,"px,").concat(s.y,"px)");return(0,Hi.createElement)("g",{style:{transform:d,zIndex:o,WebkitTransform:d}},(0,Hi.createElement)(e,{id:r.id,screen:t,payload:h,context:n,size:a,origin:s,margin:c,scale:1,layout:i.orderIndex}))}}]);return dk}(Hi.Component),uk=/*#__PURE__*/function(_Hi$Component2){_inherits(uk,_Hi$Component2);var _super41=_createSuper(uk);function uk(){_classCallCheck(this,uk);return _super41.apply(this,arguments)}_createClass(uk,[{key:"getPreviewURL",value:function getPreviewURL(e){var t=this.props.mode;if(t===Kr.Preview)return e.previewURL}},{key:"createViewBox",value:function createViewBox(){var _this$props8=this.props,e=_this$props8.screenSize,_this$props8$camera=_this$props8.camera,t=_this$props8$camera.scale,i=_this$props8$camera.centerX,r=_this$props8$camera.centerY,n=e.width/t,s=e.height/t;return Number.isNaN(n)&&(n=0),Number.isNaN(s)&&(s=0),"".concat(i-n/2," ").concat(r-s/2," ").concat(n," ").concat(s)}},{key:"render",value:function render(){var _this142=this;var e=[],_this$props9=this.props,t=_this$props9.visions,i=_this$props9.leafFilter,r=_this$props9.className,n=_this$props9.screen,s=_this$props9.engine,o=_this$props9.context,a=_this$props9.style;return t.forEach(function(c,h){if(i(c)){var d=c.value,u=s.getDefinitionNode(d.definition);if(u){var p=_this142.getPreviewURL(d),f={x:d.originX,y:d.originY},m={width:d.width,height:d.height};if(p)e.push((0,Hi.createElement)("image",{key:d.id,x:f.x,y:f.y,width:m.width,height:m.height,xlinkHref:p}));else{var g=h.margin,y=d.orderIndex;e.push((0,Hi.createElement)(dk,{key:d.id,screen:n,engine:s,render:u.render,context:o,component:d,margin:g,size:m,zIndex:y,origin:f,payload:d.payload}))}}}}),(0,Hi.createElement)("svg",{className:r,fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:this.createViewBox(),preserveAspectRatio:"xMidYMid",style:Le(B({},a),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},e)}}]);return uk}(Hi.Component),Mh=/*#__PURE__*/function(_Us2){_inherits(Mh,_Us2);var _super42=_createSuper(Mh);function Mh(e){var _this143;_classCallCheck(this,Mh);_this143=_super42.call(this,e.orderIndex);_this143.definitionNodes={},_this143.fixedSize=e.fixedSize,_this143.isSVG=e.isSVG,_this143.className=e.className,_this143.style=e.style&&Object.freeze(B({},e.style));return _this143}_createClass(Mh,[{key:"getDefinitionNode",value:function getDefinitionNode(e){return this.definitionNodes[e.id]}},{key:"bind",value:function bind(e){var _this144=this;return function(t){if(!(e instanceof Kn))throw new Error("it is not ComponentDefinition");if(_this144.definitionNodes[e.id])throw new Error("define duplicated ComponentDefinition");var i;if(typeof t.willInterruptEvent=="boolean"){var _r64=t.willInterruptEvent;i=function i(){return _r64}}else t.willInterruptEvent?i=t.willInterruptEvent.bind(t):i=function i(){return!1};return _this144.definitionNodes[e.id]=Object.freeze({willInterruptEvent:i,render:t}),e.addEngine(_this144,{isVisible:t.isVisible}),_this144.addDefinition(e),t}}},{key:"createRenderLayout",value:function createRenderLayout(e){var t;return this.isSVG?t=uk:t=hk,new lk({engine:this,screen:e.screen,mode:e.mode,initCamera:e.initCamera,tree:e.tree,visions:e.visions,leafFilter:e.leafFilter,renderComponent:t,fixedSize:this.fixedSize,className:this.className,style:this.style})}}]);return Mh}(Us);function Hf(e){return new Mh(e)}function pk(e){return e instanceof Mh}var _f=/*#__PURE__*/function(){function _f(){_classCallCheck(this,_f);this.nodes={}}_createClass(_f,[{key:"includes",value:function includes(e){return e in this.nodes}},{key:"leaf",value:function leaf(e){var t=this.nodes[e];return t?t.leaf:null}},{key:"vision",value:function vision(e){var t=this.nodes[e];return t?t.vision:null}},{key:"bindVision",value:function bindVision(e,t){var i=e.id,r=this.nodes[i];r?r.vision=t:this.nodes[i]={leaf:e,vision:t}}},{key:"unbindVision",value:function unbindVision(e){delete this.nodes[e]}},{key:"forEach",value:function forEach(e){for(var t in this.nodes){var _this$nodes$t=this.nodes[t],i=_this$nodes$t.leaf,_r65=_this$nodes$t.vision;e(i,_r65)}}},{key:"clean",value:function clean(){this.nodes={}}}]);return _f}(),Ea=0,mk=/*#__PURE__*/function(){function mk(e){var _this145=this;_classCallCheck(this,mk);this.binder=e,this.isLeftButtonPressed=!1,this.onMouseDown=function(t){if(t.button===Ea&&(_this145.checkMouseDidUp(t),_this145.isLeftButtonPressed=!0,!_this145.binder.willInterruptMouseOrTouchEvent(t,t.target))){var i=_this145.binder.eventPosition(t),_r66={kind:v.MouseDown,nativeEvent:t,isOnScreen:!0,pointOnScreen:i,pointOnScene:_this145.binder.toPointInScene(i.x,i.y)};_this145.binder.fireEvent(_r66)}},this.onMouseMove=function(t){if(t.button===Ea){_this145.checkMouseDidUp(t);var i=_this145.binder.eventPosition(t),_r67={kind:v.MouseMove,nativeEvent:t,isOnScreen:_this145.binder.isEventFiredOnElement(t.target,_this145.binder.divElement),pointOnScreen:i,pointOnScene:_this145.binder.toPointInScene(i.x,i.y)};_this145.binder.fireEvent(_r67)}},this.onMouseLeave=function(t){if(t.button===Ea&&(_this145.checkMouseDidUp(t),t.target===_this145.binder.divElement)){var i=_this145.binder.eventPosition(t),_r68={kind:v.MouseLeave,nativeEvent:t,isOnScreen:_this145.binder.isEventFiredOnElement(t.target,_this145.binder.divElement),pointOnScreen:i,pointOnScene:_this145.binder.toPointInScene(i.x,i.y)};_this145.binder.fireEvent(_r68)}},this.onMouseUp=function(t){t.button===Ea&&(_this145.isLeftButtonPressed=!1,_this145.fireMouseUpEvent(t))}}_createClass(mk,[{key:"checkMouseDidUp",value:function checkMouseDidUp(e){var t=e.which!==0;this.isLeftButtonPressed&&!t&&this.fireMouseUpEvent(e)}},{key:"fireMouseUpEvent",value:function fireMouseUpEvent(e){var t=this.binder.eventPosition(e),i={kind:v.MouseUp,nativeEvent:e,isOnScreen:this.binder.isEventFiredOnElement(e.target,this.binder.divElement),pointOnScreen:t,pointOnScene:this.binder.toPointInScene(t.x,t.y)};this.binder.fireEvent(i)}}]);return mk}(),Aa=/*#__PURE__*/function(){function Aa(e){var _this146=this;_classCallCheck(this,Aa);this.binder=e,this.latestScale=1,this.onMouseWheel=function(t){if(!_this146.binder.willInterruptMouseOrTouchEvent(t,t.target)){var i=_this146.binder.eventPosition(t),_r69=t.deltaX,n=t.deltaY,s=Math.sqrt(_r69*_r69+n*n),o=0,a=0;_this146.binder.getOS()==="Windows"&&(s=-s),_r69+n<0&&(s=-s),_this146.isMacTouchpadTwoFingerZoom(t)?s=-s*.5:_this146.isMacTouchpadTwoFingerScroll(t)?(o=-_r69,a=-n,s=0):s*=.035;var c={kind:v.MouseWheel,nativeEvent:t,isOnScreen:_this146.binder.isEventFiredOnElement(t.target,_this146.binder.divElement),offsetPoint:{x:o,y:a},scale:_this146.adjustScale(s),pointOnScreen:i,pointOnScene:_this146.binder.toPointInScene(i.x,i.y)};_this146.binder.fireEvent(c)}t.preventDefault()},this.onGestureStart=function(t){_this146.binder.willInterruptMouseOrTouchEvent(t,t.target)||(t.preventDefault(),_this146.latestScale=1)},this.onGestureChange=function(t){if(!_this146.binder.willInterruptMouseOrTouchEvent(t,t.target)){t.preventDefault();var i=(t.scale/_this146.latestScale-1)*Aa.safariScaleNumber,_r70={x:t.layerX,y:t.layerY},n={kind:v.MouseWheel,nativeEvent:t,isOnScreen:_this146.binder.isEventFiredOnElement(t.target,_this146.binder.divElement),offsetPoint:{x:0,y:0},scale:_this146.adjustScale(i),pointOnScreen:_r70,pointOnScene:_this146.binder.toPointInScene(_r70.x,_r70.y)};_this146.binder.fireEvent(n)}},this.onGestureEnd=function(t){_this146.binder.willInterruptMouseOrTouchEvent(t,t.target)||t.preventDefault()},this.isMacTouchpadTwoFingerZoom=function(t){return navigator.platform.indexOf("Mac")!==-1?t.ctrlKey:!1},this.isMacTouchpadTwoFingerScroll=function(t){return navigator.platform.indexOf("Mac")!==-1?t.wheelDelta%120!=0||t.movementX!==0||t.deltaX!==0:!1}}_createClass(Aa,[{key:"adjustScale",value:function adjustScale(e){return Math.max(e,Aa.minScaleStep)*Aa.scaleRate}}]);return Aa}(),Oa=Aa;Oa.safariScaleNumber=10,Oa.minScaleStep=-40,Oa.scaleRate=.02;var fk=/*#__PURE__*/function(){function fk(e){var _this147=this;_classCallCheck(this,fk);this.binder=e,this.onTouchStart=function(t){var i=t.target,r=!i||i&&!i.classList.contains("ppt-event-source");t.cancelable&&r&&t.preventDefault();var n=[];for(var s=0;s<t.changedTouches.length;++s){var o=t.changedTouches.item(s);if(!_this147.binder.willInterruptMouseOrTouchEvent(t,o.target)){var a="".concat(o.identifier),c=_this147.binder.eventPosition(o);n.push({identifier:a,pointOnScreen:c,pointOnScene:_this147.binder.toPointInScene(c.x,c.y)})}}if(n.length>0){var _s24={kind:v.TouchStart,nativeEvent:t,touches:n};_this147.binder.fireEvent(_s24)}},this.onTouchMove=function(t){t.cancelable&&t.preventDefault();var i=[];for(var _r71=0;_r71<t.changedTouches.length;++_r71){var n=t.changedTouches.item(_r71),s="".concat(n.identifier),o=_this147.binder.eventPosition(n);i.push({identifier:s,pointOnScreen:o,pointOnScene:_this147.binder.toPointInScene(o.x,o.y)})}if(i.length>0){var _r72={kind:v.TouchMove,nativeEvent:t,touches:i};_this147.binder.fireEvent(_r72)}},this.onTouchEnd=function(t){var i=t.target,r=!i||i&&!i.classList.contains("ppt-event-source");t.cancelable&&r&&t.preventDefault();var n=_this147.cleanAcceptedTouchesByTouchEvent(t);if(n.length>0){var s={kind:v.TouchEnd,nativeEvent:t,touches:n};_this147.binder.fireEvent(s)}},this.onTouchCancel=function(t){t.cancelable&&t.preventDefault();var i=_this147.cleanAcceptedTouchesByTouchEvent(t);if(i.length>0){var _r73={kind:v.TouchCancel,nativeEvent:t,touches:i};_this147.binder.fireEvent(_r73)}}}_createClass(fk,[{key:"cleanAcceptedTouchesByTouchEvent",value:function cleanAcceptedTouchesByTouchEvent(e){var t=[];for(var i=0;i<e.changedTouches.length;++i){var _r74=e.changedTouches.item(i),n="".concat(_r74.identifier),s=this.binder.eventPosition(_r74);t.push({identifier:n,pointOnScreen:s,pointOnScene:this.binder.toPointInScene(s.x,s.y)})}return t}}]);return fk}(),gk=function gk(e){var _this148=this;_classCallCheck(this,gk);this.binder=e,this.onKeyDown=function(t){if(!_this148.binder.willInterruptKeyboardEvent(t,t.target)){var i=t.key,_r75=t.altKey,n=t.ctrlKey,s=t.shiftKey,o={kind:v.KeyDown,nativeEvent:t,key:i,altKey:_r75,ctrlKey:n,shiftKey:s};_this148.binder.fireEvent(o)}},this.onKeyUp=function(t){var i=t.key,r=t.altKey,n=t.ctrlKey,s=t.shiftKey,o={kind:v.KeyUp,nativeEvent:t,key:i,altKey:r,ctrlKey:n,shiftKey:s};_this148.binder.fireEvent(o)}},yk=/*#__PURE__*/function(){function yk(e,t,i){_classCallCheck(this,yk);this.mouseEventHandler=new mk(this),this.touchEventHandler=new fk(this),this.wheelEventHandler=new Oa(this),this.keyboardEventHandler=new gk(this),this.divElement=t,this.eventParamMap=this.createEventParamMap(e),this.delegate=i,this.addListeners()}_createClass(yk,[{key:"createEventParamMap",value:function createEventParamMap(e){var t={};switch(e){case Se.Desktop:{t=Le(B({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body}});break}case Se.Touch:{t=Le(B({},t),{touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}});break}case Se.Surface:{t=Le(B({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body},touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}});break}}return Object.freeze(t)}},{key:"addListeners",value:function addListeners(){var e=!0;for(var t in this.eventParamMap){var _this$eventParamMap$t=this.eventParamMap[t],i=_this$eventParamMap$t.method,_r76=_this$eventParamMap$t.element;(_r76||this.divElement).addEventListener(t,i,e)}}},{key:"release",value:function release(){var e=!0;for(var t in this.eventParamMap){var _this$eventParamMap$t2=this.eventParamMap[t],i=_this$eventParamMap$t2.method,_r77=_this$eventParamMap$t2.element;(_r77||this.divElement).removeEventListener(t,i,e)}}},{key:"fireEvent",value:function fireEvent(e){this.delegate.fireEvent(e)}},{key:"getOS",value:function getOS(){var _window$navigator=window.navigator,e=_window$navigator.userAgent,t=_window$navigator.platform,i=["Macintosh","MacIntel","MacPPC","Mac68K"],r=["Win32","Win64","Windows","WinCE"],n=["iPhone","iPad","iPod"],s="";return i.indexOf(t)!==-1?s="Mac OS":n.indexOf(t)!==-1?s="iOS":r.indexOf(t)!==-1?s="Windows":/Android/.test(e)?s="Android":!s&&/Linux/.test(t)&&(s="Linux"),s}},{key:"toPointInScene",value:function toPointInScene(e,t){return this.delegate.toPointInScene(e,t)}},{key:"willInterruptMouseOrTouchEvent",value:function willInterruptMouseOrTouchEvent(e,t){return t?!this.isEventFiredOnElement(t,this.divElement)||this.delegate.willInterruptEvent(e,t):!1}},{key:"willInterruptKeyboardEvent",value:function willInterruptKeyboardEvent(e,t){return t?this.delegate.willInterruptEvent(e,t)?!0:t===document.body?!1:!this.isEventFiredOnElement(t,this.divElement):!1}},{key:"isEventFiredOnElement",value:function isEventFiredOnElement(e,t){var i=e;for(;i;){if(i===t)return!0;i=i.parentElement}return!1}},{key:"eventPosition",value:function eventPosition(e){var _this$divElement$getB=this.divElement.getBoundingClientRect(),t=_this$divElement$getB.left,i=_this$divElement$getB.top;return{x:Math.floor(e.clientX)-t,y:Math.floor(e.clientY)-i}}}]);return yk}(),Zt=/*#__PURE__*/function(){function Zt(){_classCallCheck(this,Zt);this.listeners=[]}_createClass(Zt,[{key:"dispatch",value:function dispatch(e){var _iterator156=_createForOfIteratorHelper(this.listeners),_step156;try{for(_iterator156.s();!(_step156=_iterator156.n()).done;){var t=_step156.value;try{t(e)}catch(i){console.error(i)}}}catch(err){_iterator156.e(err)}finally{_iterator156.f()}}},{key:"addListener",value:function addListener(e){this.listeners.indexOf(e)===-1&&this.listeners.push(e)}},{key:"removeListener",value:function removeListener(e){var t=this.listeners.indexOf(e);t!==-1&&this.listeners.splice(t,1)}},{key:"removeAllListeners",value:function removeAllListeners(){this.listeners.splice(0)}}]);return Zt}(),et;(function(e){e[e.Start=0]="Start",e[e.Update=1]="Update",e[e.End=2]="End",e[e.Other=3]="Other"})(et||(et={}));var bk=/*#__PURE__*/function(){function bk(e,t){_classCallCheck(this,bk);this._disable=!1,this.onCancelEvent=e,this.adapterNodes=Object.freeze(t.map(function(i){var r={},n={};return i.setEventDescriptionStateGetter&&i.setEventDescriptionStateGetter(function(s){var o=r[s];if(o)return{payload:o,isCanceled:!!n[s]}}),{adapter:i,payloads:r,canceledMap:n}}))}_createClass(bk,[{key:"disable",get:function get(){return this._disable},set:function set(e){this._disable!==e&&(this._disable=e,e&&this.cancel())}},{key:"cancel",value:function cancel(){var _iterator157=_createForOfIteratorHelper(this.adapterNodes),_step157;try{for(_iterator157.s();!(_step157=_iterator157.n()).done;){var _step157$value=_step157.value,e=_step157$value.adapter,t=_step157$value.payloads,i=_step157$value.canceledMap;var _r78={},n=!1;for(var s in t){s in i||(_r78[s]=t[s],i[s]=!0,n=!0)}if(n){var _s25=e.createCancelEvent(_r78);_s25&&this.onCancelEvent(_s25)}}}catch(err){_iterator157.e(err)}finally{_iterator157.f()}}},{key:"interruptEvent",value:function interruptEvent(e){var t=this.adapterNodes.find(function(i){return i.adapter.isEventAccessible(e)});if(t){var i=t.adapter,_r79=t.canceledMap,n=i.takeEventDescription(e),s;n?typeof n.length=="number"?s=n:s=[n]:s=[];var o=[];var _iterator158=_createForOfIteratorHelper(s),_step158;try{for(_iterator158.s();!(_step158=_iterator158.n()).done;){var a=_step158.value;if(a.phase===3)o.push(a);else{var c=this.handleAndCheckIgnoreEventDescription(t,a),h=_r79[a.identifier];!c&&!h&&o.push(a)}}}catch(err){_iterator158.e(err)}finally{_iterator158.f()}return!this._disable&&o.length>0?i.convertToEvent(e,o):null}else return e}},{key:"handleAndCheckIgnoreEventDescription",value:function handleAndCheckIgnoreEventDescription(_ref51,_ref52){var e=_ref51.payloads,t=_ref51.canceledMap;var i=_ref52.identifier,r=_ref52.phase,n=_ref52.payload;switch(r){case 0:return i in e?!0:(e[i]=n,this._disable&&(t[i]=!0),!1);case 1:return i in e?(e[i]=n,!1):!0;case 2:if(i in e){var s=!!t[i];return delete e[i],delete t[i],s}else return!0;default:return!0;}}}]);return bk}(),vk=/*#__PURE__*/function(){function vk(){_classCallCheck(this,vk);this.currentIdentifier=0}_createClass(vk,[{key:"setEventDescriptionStateGetter",value:function setEventDescriptionStateGetter(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===v.MouseDown||e.kind===v.MouseMove||e.kind===v.MouseUp||e.kind===v.MouseLeave}},{key:"convertToEvent",value:function convertToEvent(e,_ref53){var _ref54=_slicedToArray(_ref53,1),t=_ref54[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,isOnScreen:t.isOnScreen,pointOnScreen:t.pointOnScreen,pointOnScene:t.pointOnScene}}},{key:"createCancelEvent",value:function createCancelEvent(e){var t;for(var i in e){t=e[i]}return{kind:v.MouseUp,isOnScreen:t.isOnScreen,pointOnScreen:t.pointOnScreen,pointOnScene:t.pointOnScene}}},{key:"takeEventDescription",value:function takeEventDescription(e){e.kind===v.MouseDown&&(this.currentIdentifier+=1);var t="".concat(this.currentIdentifier);e.kind===v.MouseUp&&(this.currentIdentifier+=1);var i;switch(e.kind){case v.MouseDown:{i=et.Start;break}case v.MouseMove:case v.MouseLeave:{var n=this.getDescriptionState(t);if(n){if(n.isCanceled)return null;i=et.Update}else if(e.isOnScreen)i=et.Other;else return null;break}case v.MouseUp:{i=et.End;break}default:return null;}var r={isOnScreen:e.isOnScreen,pointOnScreen:e.pointOnScreen,pointOnScene:e.pointOnScene};return{identifier:t,phase:i,payload:r}}}]);return vk}(),Sk=/*#__PURE__*/function(){function Sk(){_classCallCheck(this,Sk)}_createClass(Sk,[{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===v.TouchStart||e.kind===v.TouchMove||e.kind===v.TouchEnd||e.kind===v.TouchCancel}},{key:"convertToEvent",value:function convertToEvent(e,t){var i=[];var _iterator159=_createForOfIteratorHelper(t),_step159;try{for(_iterator159.s();!(_step159=_iterator159.n()).done;){var _step159$value=_step159.value,_r80=_step159$value.identifier,n=_step159$value.payload;i.push(B({identifier:_r80},n))}}catch(err){_iterator159.e(err)}finally{_iterator159.f()}return{kind:e.kind,nativeEvent:e.nativeEvent,touches:i}}},{key:"createCancelEvent",value:function createCancelEvent(e){var t=[];for(var i in e){t.push(B({identifier:i},e[i]))}return{kind:v.TouchCancel,touches:t}}},{key:"takeEventDescription",value:function takeEventDescription(e){var t;switch(e.kind){case v.TouchStart:{t=et.Start;break}case v.TouchMove:{t=et.Update;break}case v.TouchEnd:case v.TouchCancel:{t=et.End;break}default:return null;}var i=[];var _iterator160=_createForOfIteratorHelper(e.touches),_step160;try{for(_iterator160.s();!(_step160=_iterator160.n()).done;){var _step160$value=_step160.value,_r81=_step160$value.identifier,n=_step160$value.pointOnScene,s=_step160$value.pointOnScreen;i.push({identifier:_r81,phase:t,payload:{pointOnScene:n,pointOnScreen:s}})}}catch(err){_iterator160.e(err)}finally{_iterator160.f()}return i}}]);return Sk}(),wk=/*#__PURE__*/function(){function wk(){_classCallCheck(this,wk)}_createClass(wk,[{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===v.SortedTouchStart||e.kind===v.SortedTouchMove||e.kind===v.SortedTouchEnd||e.kind===v.SortedTouchCancel}},{key:"convertToEvent",value:function convertToEvent(e,_ref55){var _ref56=_slicedToArray(_ref55,1),_ref56$=_ref56[0],t=_ref56$.identifier,i=_ref56$.payload;return{kind:e.kind,nativeEvent:e.nativeEvent,identifier:t,pointOnScene:i.pointOnScene,pointOnScreen:i.pointOnScreen}}},{key:"createCancelEvent",value:function createCancelEvent(e){var t;for(var n in e){t=n}var _e$t2=e[t],i=_e$t2.pointOnScene,r=_e$t2.pointOnScreen;return{kind:v.SortedTouchCancel,identifier:t,pointOnScene:i,pointOnScreen:r}}},{key:"takeEventDescription",value:function takeEventDescription(e){var t;switch(e.kind){case v.SortedTouchStart:{t=et.Start;break}case v.SortedTouchMove:{t=et.Update;break}case v.SortedTouchEnd:case v.SortedTouchCancel:{t=et.End;break}default:return null;}return[{identifier:e.identifier,phase:t,payload:{pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen}}]}}]);return wk}(),kk=/*#__PURE__*/function(){function kk(){_classCallCheck(this,kk)}_createClass(kk,[{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===v.KeyUp||e.kind===v.KeyDown}},{key:"convertToEvent",value:function convertToEvent(e,_ref57){var _ref58=_slicedToArray(_ref57,1),t=_ref58[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}}},{key:"createCancelEvent",value:function createCancelEvent(e){var t;for(var i in e){t=e[i]}return{kind:v.KeyUp,key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}}},{key:"takeEventDescription",value:function takeEventDescription(e){var t;var i;if((t=e.nativeEvent)==null?void 0:t.metaKey)i=et.Other;else switch(e.kind){case v.KeyDown:{i=et.Start;break}case v.KeyUp:{i=et.End;break}default:return null;}var r=e.key,n={key:e.key,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey};return{identifier:r,phase:i,payload:n}}}]);return kk}(),Ck=/*#__PURE__*/function(){function Ck(){_classCallCheck(this,Ck);this.currentIdentifier=0}_createClass(Ck,[{key:"setEventDescriptionStateGetter",value:function setEventDescriptionStateGetter(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function isEventAccessible(e){return e.kind===v.MouseWheel}},{key:"takeEventDescription",value:function takeEventDescription(e){var t="".concat(this.currentIdentifier);this.getDescriptionState(t),this.currentIdentifier+=1;var i={isOnScreen:e.isOnScreen,pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen,offsetPoint:e.offsetPoint,scale:e.scale};return{identifier:t,phase:et.Other,payload:i}}},{key:"convertToEvent",value:function convertToEvent(e,t){return e}},{key:"createCancelEvent",value:function createCancelEvent(e){return null}}]);return Ck}();function Gf(e){return new bk(e,[new vk,new Sk,new wk,new kk,new Ck])}var xk=/*#__PURE__*/function(){function xk(e,t){var _this149=this;_classCallCheck(this,xk);this.eventDispatcher=new Zt,this.binder=null,this.fireEvent=function(i){var r=_this149.continuityNode.interruptEvent(i);r&&_this149.eventDispatcher.dispatch(r)},this.screen=e,this.eventInterrupter=t,this.continuityNode=Gf(function(i){return _this149.eventDispatcher.dispatch(i)})}_createClass(xk,[{key:"bindDivElement",value:function bindDivElement(e){e!==(this.binder?this.binder.divElement:null)&&(this.binder&&this.binder.release(),e?this.binder=new yk(this.screen.deviceType,e,this):this.binder=null)}},{key:"disable",get:function get(){return this.continuityNode.disable},set:function set(e){this.continuityNode.disable=e}},{key:"cancelCurrentContinuityEvent",value:function cancelCurrentContinuityEvent(){this.continuityNode.cancel()}},{key:"toPointInScene",value:function toPointInScene(e,t){return this.screen.convertPointToScene(e,t)}},{key:"willInterruptEvent",value:function willInterruptEvent(e,t){return!this.disable&&this.eventInterrupter(e)?!0:t?this.screen.willInterruptEvent(e,t):!1}},{key:"addListener",value:function addListener(e){this.eventDispatcher.addListener(e)}},{key:"removeListener",value:function removeListener(e){this.eventDispatcher.removeListener(e)}}]);return xk}(),Ik=/*#__PURE__*/function(){function Ik(e){var _this150=this;_classCallCheck(this,Ik);this.invoker=e,this.timer=null,this.fireAt=-1,this.invokeWhenTimeout=function(){var t=Date.now();if(t>=_this150.fireAt)_this150.timer=null,_this150.fireAt=-1,_this150.invoker();else{var i=_this150.fireAt-t;_this150.timer=setTimeout(_this150.invokeWhenTimeout,i)}}}_createClass(Ik,[{key:"isRunning",get:function get(){return this.timer!==null}},{key:"refreshAndInvokeAfterInterval",value:function refreshAndInvokeAfterInterval(e){var t=Date.now();if(this.timer===null)this.timer=setTimeout(this.invokeWhenTimeout,e),this.fireAt=t+e;else{var i=t+e;i<=this.fireAt&&(clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)),this.fireAt=i}}},{key:"cancel",value:function cancel(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null)}}]);return Ik}(),Pk=300,Mk=/*#__PURE__*/function(){function Mk(e){var _this151=this;_classCallCheck(this,Mk);this.onPushedBoundlessEvent=e,this.operationBuffer=[],this.willBlockOperation=!1,this.flushingOperationBufferTimer=null,this.flushOperationBuffer=function(){if(_this151.operationBuffer){var _iterator161=_createForOfIteratorHelper(_this151.operationBuffer),_step161;try{for(_iterator161.s();!(_step161=_iterator161.n()).done;){var t=_step161.value;t()}}catch(err){_iterator161.e(err)}finally{_iterator161.f()}_this151.operationBuffer.splice(0,_this151.operationBuffer.length),_this151.willBlockOperation=!1}_this151.flushingOperationBufferTimer=null}}_createClass(Mk,[{key:"unknownIsMultiFingers",get:function get(){return this.willBlockOperation}},{key:"startOperation",value:function startOperation(){this.willBlockOperation=!0,this.flushingOperationBufferTimer=setTimeout(this.flushOperationBuffer,Pk)}},{key:"assertMultiFingers",value:function assertMultiFingers(){this.operationBuffer.splice(0,this.operationBuffer.length),this.willBlockOperation=!1,this.flushingOperationBufferTimer!==null&&(clearTimeout(this.flushingOperationBufferTimer),this.flushingOperationBufferTimer=null)}},{key:"assertSingleFinger",value:function assertSingleFinger(){this.flushingOperationBufferTimer!==null&&clearTimeout(this.flushingOperationBufferTimer),this.flushOperationBuffer()}},{key:"pushBoundlessEvent",value:function pushBoundlessEvent(e){var _this152=this;this.willBlockOperation?this.operationBuffer.push(function(){return _this152.onPushedBoundlessEvent(e)}):this.onPushedBoundlessEvent(e)}}]);return Mk}(),Tk=/*#__PURE__*/function(){function Tk(){_classCallCheck(this,Tk);this.pressedTouches={},this.emptyResolves=[],this.pressedTouchesCount=0}_createClass(Tk,[{key:"receiveTouchStartOrMoveEvent",value:function receiveTouchStartOrMoveEvent(_ref59){var e=_ref59.touches;var _iterator162=_createForOfIteratorHelper(e),_step162;try{for(_iterator162.s();!(_step162=_iterator162.n()).done;){var t=_step162.value;t.identifier in this.pressedTouches||(this.pressedTouchesCount+=1),this.pressedTouches[t.identifier]=t}}catch(err){_iterator162.e(err)}finally{_iterator162.f()}}},{key:"receiveTouchEndOrCancelEvent",value:function receiveTouchEndOrCancelEvent(_ref60){var e=_ref60.touches;var _iterator163=_createForOfIteratorHelper(e),_step163;try{for(_iterator163.s();!(_step163=_iterator163.n()).done;){var t=_step163.value;if(t.identifier in this.pressedTouches&&(this.pressedTouchesCount-=1,delete this.pressedTouches[t.identifier],this.pressedTouchesCount===0)){var _iterator164=_createForOfIteratorHelper(this.emptyResolves.splice(0)),_step164;try{for(_iterator164.s();!(_step164=_iterator164.n()).done;){var i=_step164.value;i()}}catch(err){_iterator164.e(err)}finally{_iterator164.f()}}}}catch(err){_iterator163.e(err)}finally{_iterator163.f()}}},{key:"waitUntilNoPressedTouches",value:function waitUntilNoPressedTouches(){var _this153=this;return this.pressedTouchesCount===0?Promise.resolve():new Promise(function(e){return _this153.emptyResolves.push(e)})}}]);return Tk}(),Ek=3,Kf;(function(e){e[e.None=0]="None",e[e.Event=1]="Event",e[e.Camera=2]="Camera",e[e.Cancel=3]="Cancel"})(Kf||(Kf={}));var Ak=/*#__PURE__*/function(){function Ak(e){_classCallCheck(this,Ak);this.pressedTouches=new Tk,this.state=0,this.pinchTouches=null,this.previousTouchesCount=0,this.firstPressedTouch=null,this.firstPressedTouchBeginX=0,this.firstPressedTouchBeginY=0,this.blocker=new Mk(e.onReceivedSortedTouchEvent),this.callbacks=Object.freeze(B({},e))}_createClass(Ak,[{key:"pushTouchEvent",value:function pushTouchEvent(e){switch(e.kind){case v.TouchStart:{this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchStartEvent(e);break}case v.TouchMove:{this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchMoveEvent(e);break}case v.TouchEnd:case v.TouchCancel:{this.pressedTouches.receiveTouchEndOrCancelEvent(e),this.pushTouchEndOrCancelEvent(e);break}}}},{key:"cancel",value:function cancel(){var _this154=this;this.state!==0&&this.state!==3&&(this.state=3,this.pressedTouches.waitUntilNoPressedTouches().then(function(){_this154.state=0})["catch"](function(e){return console.error(e)}))}},{key:"pushTouchStartEvent",value:function pushTouchStartEvent(e){var t=e.touches;switch(this.state){case 0:{this.blocker.startOperation(),t.length===1?(this.state=1,this.firstPressedTouchBeginX=t[0].pointOnScreen.x,this.firstPressedTouchBeginY=t[0].pointOnScreen.y,this.firstPressedTouch={identifier:t[0].identifier,x:this.firstPressedTouchBeginX,y:this.firstPressedTouchBeginY},this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,0))):(this.state=2,this.pinchTouches=t.map(function(i){return{identifier:i.identifier,x:i.pointOnScreen.x,y:i.pointOnScreen.y}}),this.handleTouchEvents(this.pinchTouches));break}case 1:{this.pinchTouches=[{identifier:this.firstPressedTouch.identifier,x:this.firstPressedTouch.x,y:this.firstPressedTouch.y}],this.blocker.unknownIsMultiFingers&&(this.blocker.assertMultiFingers(),this.firstPressedTouch=null),this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches),this.state=2;break}case 2:{this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches);break}}}},{key:"pushTouchMoveEvent",value:function pushTouchMoveEvent(e){var _this155=this;var t=e.touches;switch(this.refreshFirstPressedTouch(t),this.state){case 1:{var i=t.findIndex(function(r){return r.identifier===_this155.firstPressedTouch.identifier});this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,i));break}case 2:{var _iterator165=_createForOfIteratorHelper(this.pinchTouches),_step165;try{var _loop17=function _loop17(){var i=_step165.value;var r=t.find(function(n){return n.identifier===i.identifier});r&&(i.x=r.pointOnScreen.x,i.y=r.pointOnScreen.y)};for(_iterator165.s();!(_step165=_iterator165.n()).done;){_loop17()}}catch(err){_iterator165.e(err)}finally{_iterator165.f()}this.handleTouchEvents(this.pinchTouches);break}}}},{key:"pushTouchEndOrCancelEvent",value:function pushTouchEndOrCancelEvent(e){var _this156=this;var t=e.touches;if(this.firstPressedTouch&&this.state!==3){var i=t.findIndex(function(r){return r.identifier===_this156.firstPressedTouch.identifier});i!==-1&&(this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,i)),this.firstPressedTouch=null)}switch(this.state){case 1:{this.blocker.assertSingleFinger(),this.completeOperation();break}case 2:{this.blocker.assertMultiFingers();var _iterator166=_createForOfIteratorHelper(t),_step166;try{var _loop18=function _loop18(){var i=_step166.value;var r=_this156.pinchTouches.findIndex(function(n){return n.identifier===i.identifier});r!==-1&&_this156.pinchTouches.splice(r,1)};for(_iterator166.s();!(_step166=_iterator166.n()).done;){_loop18()}}catch(err){_iterator166.e(err)}finally{_iterator166.f()}this.firstPressedTouch&&this.pinchTouches.length===1?(this.state=1,this.handleTouchEvents([]),this.pinchTouches=null):this.pinchTouches.length===0?(this.handleTouchEvents(this.pinchTouches),this.pinchTouches=null,this.completeOperation()):this.handleTouchEvents(this.pinchTouches);break}}}},{key:"handleTouchEvents",value:function handleTouchEvents(e){try{this.previousTouchesCount===0&&e.length>0&&this.callbacks.onBeginTransformCamera(e),this.previousTouchesCount>0&&e.length===0?this.callbacks.onAfterTransformCamera():this.callbacks.onTransformCamera(e)}finally{this.previousTouchesCount=e.length}}},{key:"pushToPinchTouches",value:function pushToPinchTouches(e){var _this157=this;if(this.pinchTouches){var _iterator167=_createForOfIteratorHelper(e),_step167;try{var _loop19=function _loop19(){var t=_step167.value;_this157.pinchTouches.some(function(i){return i.identifier===t.identifier})||_this157.pinchTouches.push({x:t.pointOnScreen.x,y:t.pointOnScreen.y,identifier:t.identifier})};for(_iterator167.s();!(_step167=_iterator167.n()).done;){_loop19()}}catch(err){_iterator167.e(err)}finally{_iterator167.f()}}}},{key:"refreshFirstPressedTouch",value:function refreshFirstPressedTouch(e){if(this.firstPressedTouch){var _iterator168=_createForOfIteratorHelper(e),_step168;try{for(_iterator168.s();!(_step168=_iterator168.n()).done;){var _t12=_step168.value;if(_t12.identifier===this.firstPressedTouch.identifier){this.firstPressedTouch.x=_t12.pointOnScreen.x,this.firstPressedTouch.y=_t12.pointOnScreen.y;break}}}catch(err){_iterator168.e(err)}finally{_iterator168.f()}if(this.blocker.unknownIsMultiFingers){var t=this.firstPressedTouch.x-this.firstPressedTouchBeginX,i=this.firstPressedTouch.y-this.firstPressedTouchBeginY,_r82=Ek;t*t+i*i>=_r82*_r82&&this.blocker.assertSingleFinger()}}}},{key:"completeOperation",value:function completeOperation(){this.state=0,this.blocker.unknownIsMultiFingers&&this.blocker.assertMultiFingers(),this.callbacks.onCompleteGroupOfEvents()}},{key:"covertToSortedTouchEvent",value:function covertToSortedTouchEvent(e,t){var _e$touches$t=e.touches[t],i=_e$touches$t.identifier,r=_e$touches$t.pointOnScreen,n=_e$touches$t.pointOnScene,s;switch(e.kind){case v.TouchStart:{s=v.SortedTouchStart;break}case v.TouchMove:{s=v.SortedTouchMove;break}case v.TouchEnd:{s=v.SortedTouchEnd;break}case v.TouchCancel:{s=v.SortedTouchCancel;break}default:throw new Error("unexpected kind ".concat(e.kind));}return{identifier:i,nativeEvent:e.nativeEvent,kind:s,pointOnScreen:r,pointOnScene:n}}}]);return Ak}();function Ok(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.damping===t.damping&&e.width===t.width&&e.height===t.height&&e.minScale===t.minScale&&e.maxScale===t.maxScale}function Xf(e,t,i,r){if(t===1/0||r===1/0)return{center:0,scale:1/0};var n=t/r;return Number.isNaN(n)&&(n=1),{center:i-e,scale:n}}var Yf=/*#__PURE__*/function(){function Yf(e){_classCallCheck(this,Yf);this.originBorder=e,this.currentBorder=e,this._transform=Object.freeze({deltaX:0,deltaY:0,scale:1})}_createClass(Yf,[{key:"transform",get:function get(){return this._transform}},{key:"adaptOriginBorder",get:function get(){return this._adaptOriginBorder}},{key:"setCurrentBorder",value:function setCurrentBorder(e){this.currentBorder=e;var _Xf=Xf(this.originBorder.centerX,this.originBorder.width,this.currentBorder.centerX,this.currentBorder.width),t=_Xf.center,i=_Xf.scale,_Xf2=Xf(this.originBorder.centerY,this.originBorder.height,this.currentBorder.centerY,this.currentBorder.height),r=_Xf2.center,n=_Xf2.scale,s=Math.min(i,n);s===1/0&&(s=1),this._transform=Object.freeze({deltaX:t,deltaY:r,scale:s}),this._adaptOriginBorder=Object.freeze({damping:e.damping,centerX:e.centerX-t,centerY:e.centerY-r,width:e.width*s,height:e.height*s,maxScale:e.maxScale/s,minScale:e.minScale/s})}}]);return Yf}(),Th=/*#__PURE__*/function(){function Th(){_classCallCheck(this,Th);this.eccentricityRate=1,this.centroidXOffset=0,this.centroidYOffset=0,this.beginCentroidX=0,this.beginCentroidY=0,this.centroidX=0,this.centroidY=0,this._scale=1,this.isHanding=!1,this.previousTouchesCount=0}_createClass(Th,[{key:"beginCentroid",get:function get(){return this.isHanding?{x:this.beginCentroidX,y:this.beginCentroidY}:Th.zeroPoint}},{key:"centroid",get:function get(){return this.isHanding?{x:this.centroidX,y:this.centroidY}:Th.zeroPoint}},{key:"scale",get:function get(){return this.isHanding?this._scale:1}},{key:"handleTouches",value:function handleTouches(e){var t=this.findTouchesExpression(e);this.isHanding?(this.previousTouchesCount!==e.length&&(this.centroidXOffset=this.centroidX-t.centroidX,this.centroidYOffset=this.centroidY-t.centroidY,this.eccentricityRate=this._scale/t.eccentricity,this.previousTouchesCount=e.length),this.centroidX=t.centroidX+this.centroidXOffset,this.centroidY=t.centroidY+this.centroidYOffset,this._scale=t.eccentricity*this.eccentricityRate):(this.centroidXOffset=0,this.centroidYOffset=0,this.eccentricityRate=1/t.eccentricity,this.beginCentroidX=t.centroidX,this.beginCentroidY=t.centroidY,this.centroidX=t.centroidX,this.centroidY=t.centroidY,this._scale=1,this.previousTouchesCount=e.length,this.isHanding=!0)}},{key:"findTouchesExpression",value:function findTouchesExpression(e){var t=0,i=0;var _iterator169=_createForOfIteratorHelper(e),_step169;try{for(_iterator169.s();!(_step169=_iterator169.n()).done;){var _step169$value=_step169.value,o=_step169$value.x,a=_step169$value.y;t+=o,i+=a}}catch(err){_iterator169.e(err)}finally{_iterator169.f()}var r=t/e.length,n=i/e.length,s=0;var _iterator170=_createForOfIteratorHelper(e),_step170;try{for(_iterator170.s();!(_step170=_iterator170.n()).done;){var _step170$value=_step170.value,_o18=_step170$value.x,_a16=_step170$value.y;var c=_o18-r,h=_a16-n;s+=Math.sqrt(c*c+h*h)}}catch(err){_iterator170.e(err)}finally{_iterator170.f()}return s===0&&(s=1),{eccentricity:s,centroidX:r,centroidY:n}}}]);return Th}(),Qf=Th;Qf.zeroPoint=Object.freeze({x:0,y:0});var Rk=/*#__PURE__*/function(){function Rk(e){_classCallCheck(this,Rk);this.border={centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},this.scaleStart=0,this.scaleEnd=Number.POSITIVE_INFINITY,this.screenSize=e}_createClass(Rk,[{key:"findClosestValidCamera",value:function findClosestValidCamera(e){var t=this.findClosestValidScale(e.scale),i=e.centerX,r=e.centerY;if(this.pinPoint&&e.scale!==t){var n=i-this.pinPoint.x,s=r-this.pinPoint.y,o=t/e.scale;i=this.pinPoint.x+n/o,r=this.pinPoint.y+s/o}return i=this.findClosestValidCenter(i,t,this.screenSize.width,this.border.centerX,this.border.width),r=this.findClosestValidCenter(r,t,this.screenSize.height,this.border.centerY,this.border.height),{centerX:i,centerY:r,scale:t}}},{key:"findClosestValidScale",value:function findClosestValidScale(e){var t=e;return this.scaleStart>t?t=this.scaleStart:this.scaleEnd<t&&(t=this.scaleEnd),t}},{key:"findClosestValidCenter",value:function findClosestValidCenter(e,t,i,r,n){var s=i/n,o=e;if(t<=s)o=r;else{var a=i/t/2,c=n/2,h=r-c+a,d=r+c-a;o<h?o=h:o>d&&(o=d)}return o}}]);return Rk}();function qf(e,t){return{x:e.x-t.width/2,y:e.y-t.height/2}}function Zf(e,t,i){var r=e.x-t.width/2,n=e.y-t.height/2;return{x:i.centerX+r/i.scale,y:i.centerY+n/i.scale}}function Nk(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.scale===t.scale}var Lk=/*#__PURE__*/function(){function Lk(e){_classCallCheck(this,Lk);this.pincher=null,this.damping=0,this.camera=null,this.lastValidCamera=null,this.domain=new Rk(e)}_createClass(Lk,[{key:"isHandingPinch",get:function get(){return!!this.pincher}},{key:"screenSize",get:function get(){return this.domain.screenSize},set:function set(e){this.domain.screenSize=e}},{key:"setCameraBorder",value:function setCameraBorder(e){this.damping=e.damping,this.domain.scaleStart=e.minScale,this.domain.scaleEnd=e.maxScale,this.domain.border.centerX=e.centerX,this.domain.border.centerY=e.centerY,this.domain.border.width=e.width,this.domain.border.height=e.height}},{key:"beginWithCamera",value:function beginWithCamera(e){this.pincher=new Qf,this.camera=e}},{key:"handleTouchesAndGetCameraMoving",value:function handleTouchesAndGetCameraMoving(e){this.pincher.handleTouches(e);var t=this.pincher.centroid,i=this.currentTargetCamera();return this.transformToCombinedCamera(i,t)}},{key:"transformToCombinedCamera",value:function transformToCombinedCamera(e,t){var i=this.domain.screenSize,r=Zf(t,i,e);this.domain.pinPoint=r;var n=this.domain.findClosestValidCamera(e);this.lastValidCamera=n;var s;if(this.damping===0)s=e;else if(this.damping===1)s=n;else if(Nk(e,n))s=e;else{var o=Zf(t,i,n);s=this.viewCamera(r,o,e,n,this.damping)}return{valid:n,view:s}}},{key:"completeAndGetValidCamera",value:function completeAndGetValidCamera(){var e=this.lastValidCamera;return this.pincher=null,this.camera=null,this.lastValidCamera=null,e}},{key:"currentTargetCamera",value:function currentTargetCamera(){var e=this.camera,t=this.pincher,i=this.domain.screenSize,r=e.scale*t.scale,n=qf(t.beginCentroid,i),s=qf(t.centroid,i),o=n.x/e.scale-s.x/r,a=n.y/e.scale-s.y/r;return{centerX:e.centerX+o,centerY:e.centerY+a,scale:r}}},{key:"viewCamera",value:function viewCamera(e,t,i,r,n){var s=Pg(i.centerX,i.centerY,e.x,e.y),o=Xn(i.scale,r.scale,n),a=s*i.scale/o,c=Xn(e.x,t.x,n),h=Xn(e.y,t.y,n),d=Ig(Xn(i.centerX,r.centerX,n)-c,Xn(i.centerY,r.centerY,n)-h),u=a*d.x,p=a*d.y;return{centerX:c+u,centerY:h+p,scale:o}}}]);return Lk}(),Dk=/*#__PURE__*/function(){function Dk(e){_classCallCheck(this,Dk);this._isActive=!1,this._key=void 0,this.previousPressEvent=null,this.cameraman=e.cameraman,this.activeDispatch=e.activeDispatch}_createClass(Dk,[{key:"active",get:function get(){return this._isActive},set:function set(e){this._isActive=e}},{key:"key",get:function get(){return this._key},set:function set(e){this._key=e}},{key:"willInterruptEvent",value:function willInterruptEvent(e){return this.active&&!!e&&(e.kind===v.SortedTouchMove||e.kind===v.MouseMove)}},{key:"moveCameraByEvent",value:function moveCameraByEvent(e){if(e&&this.previousPressEvent&&this.isMouseOrSortedTouch(this.previousPressEvent)&&this.isMouseOrSortedTouch(e)){var t=e.pointOnScreen.x-this.previousPressEvent.pointOnScreen.x,i=e.pointOnScreen.y-this.previousPressEvent.pointOnScreen.y,_this$cameraman$scree=this.cameraman.screen.camera,_r83=_this$cameraman$scree.centerX,n=_this$cameraman$scree.centerY,s=_this$cameraman$scree.scale;this.cameraman.transformCamera({centerX:_r83-t/s,centerY:n-i/s,scale:s,animationMode:Q.Immediately,operatorId:this.cameraman.operatorId,boundCamera:!0})}}},{key:"handlePreviousEvent",value:function handlePreviousEvent(e){this.needUpdatePrevious(e)?this.previousPressEvent=e:this.needReleasePrevious(e)&&(this.previousPressEvent=null)}},{key:"isKeyEvent",value:function isKeyEvent(e){return!!e.nativeEvent&&e.nativeEvent instanceof KeyboardEvent&&e.nativeEvent.key===this.key}},{key:"handleKeyEvent",value:function handleKeyEvent(e){var t=this.active;e.kind===v.KeyDown&&t!==!0?this.active=!0:e.kind===v.KeyUp&&t!==!1&&(this.active=!1),t!==this.active&&this.activeDispatch(this.active)}},{key:"isMouseOrSortedTouch",value:function isMouseOrSortedTouch(e){var t=e.kind;return t===v.MouseDown||t===v.MouseUp||t===v.MouseLeave||t===v.MouseMove||t===v.SortedTouchStart||t===v.SortedTouchMove||t===v.SortedTouchEnd||t===v.SortedTouchCancel}},{key:"needUpdatePrevious",value:function needUpdatePrevious(e){return!!(e&&(!!this.previousPressEvent&&(e.kind===v.MouseMove||e.kind===v.SortedTouchMove)||e.kind===v.MouseDown||e.kind===v.SortedTouchStart))}},{key:"needReleasePrevious",value:function needReleasePrevious(e){return!!e&&(e.kind===v.MouseUp||e.kind===v.SortedTouchEnd||e.kind===v.SortedTouchCancel)}}]);return Dk}(),Jf=/*#__PURE__*/function(){function Jf(e,t,i){var _this158=this;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,Jf);this.disableCameraTransform=!1,this.boundlessEventDispatcher=new Zt,this.transformationEventDispatcher=new Zt,this.handToolActiveEventDispatcher=new Zt,this.transformer=null,this.border=Object.freeze({damping:.75,centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY,minScale:0,maxScale:Number.POSITIVE_INFINITY}),this.moveToCamera=null,this.didRelease=!1,this.isPaddingCameraOperations=!1,this.paddingCameraOperation=null,this.onBoundlessEvent=function(n){switch(_this158.screen.deviceType){case Se.Surface:{_this158.handleBoundlessEventWhenItIsSurface(n);break}case Se.Desktop:{_this158.handleBoundlessEventWhenItIsDesktop(n);break}case Se.Touch:_this158.handleBoundlessEventWhenItIsTouch(n);}},this.onScreenUpdatedListener=function(_ref61){var n=_ref61.camera,s=_ref61.width,o=_ref61.height;var a=_this158.cameraView.screenSize;if(a.width!==s||a.height!==o){_this158.cameraView.screenSize=Object.freeze({width:s,height:o});var _this158$cameraView$t=_this158.cameraView.transformToCombinedCamera(_this158.screen.camera,{x:s/2,y:o/2}),c=_this158$cameraView$t.valid;(n.centerX!==c.centerX||n.centerY!==c.centerY||n.scale!==c.scale)&&_this158.screen.transformCamera(Le(B({},c),{animationMode:Q.Immediately}))}},this.dispatchBoundlessEvent=function(n){var s=_this158.continuityNode.interruptEvent(n);_this158.handTool.willInterruptEvent(s)?_this158.handTool.moveCameraByEvent(s):s&&_this158.boundlessEventDispatcher.dispatch(s),_this158.handTool.handlePreviousEvent(s)},this.onAfterMouseWheel=function(){_this158.transformationEventDispatcher.dispatch(di.End),_this158.screen.setTransition(!1,_this158.operatorId)},this.onBeginTransformCamera=function(n){_this158.disableCameraTransform||(_this158.isPaddingCameraOperations=!0,_this158.transformationEventDispatcher.dispatch(di.Begin),_this158.cameraView.beginWithCamera(_this158.screen.camera),_this158.transformer=new Yf(_this158.border),_this158.onTransformCamera(n))},this.onTransformCamera=function(n){if(_this158.disableCameraTransform)return;var s=_this158.cameraView.handleTouchesAndGetCameraMoving(n),o=Le(B({},_this158.cameraAppendBorderTransform(s.view)),{animationMode:Q.Immediately,operatorId:_this158.operatorId});_this158.moveToCamera=s.view,_this158.screen.setCameraTransfrom(o,!0)},this.onAfterTransformCamera=function(){if(_this158.disableCameraTransform)return;var n=_this158.cameraView.completeAndGetValidCamera();_this158.isPaddingCameraOperations=!1,_this158.moveToCamera=_this158.cameraAppendBorderTransform(n),_this158.cameraView.setCameraBorder(_this158.border),_this158.paddingCameraOperation&&(_this158.paddingCameraOperation(),_this158.paddingCameraOperation=null),_this158.transformer=null,_this158.transformationEventDispatcher.dispatch(di.End)},this.onCompleteGroupOfEvents=function(){if(_this158.moveToCamera){var n=_this158.screen.camera;if(_this158.moveToCamera.centerX!==n.centerX||_this158.moveToCamera.centerY!==n.centerY||_this158.moveToCamera.scale!==n.scale){var s=Le(B({},_this158.moveToCamera),{animationMode:Q.Continuous,operatorId:_this158.operatorId});_this158.screen.setCameraTransfrom(s,!1)}else _this158.screen.setTransition(!1,_this158.operatorId);_this158.moveToCamera=null}},this.onContinuityNodeCancel=function(n){_this158.boundlessEventDispatcher.dispatch(n),_this158.sorter&&_this158.sorter.cancel()},this.screen=e,this.operatorId=i,this.eventProxy=t,this.afterWheelDelayer=new Ik(this.onAfterMouseWheel),this.continuityNode=Gf(this.onContinuityNodeCancel),this.cameraView=new Lk({width:e.width,height:e.height}),this.handTool=new Dk({cameraman:this,activeDispatch:function activeDispatch(n){return _this158.handToolActiveEventDispatcher.dispatch(n)}}),this.setCameraBorder(r),(e.deviceType===Se.Touch||e.deviceType===Se.Surface)&&(this.sorter=new Ak({onBeginTransformCamera:this.onBeginTransformCamera,onTransformCamera:this.onTransformCamera,onAfterTransformCamera:this.onAfterTransformCamera,onCompleteGroupOfEvents:this.onCompleteGroupOfEvents,onReceivedSortedTouchEvent:this.dispatchBoundlessEvent})),t.addListener(this.onBoundlessEvent),e.addScreenUpdatedListener(this.onScreenUpdatedListener)}_createClass(Jf,[{key:"handToolActive",get:function get(){return this.handTool.active},set:function set(e){this.handTool.active=e}},{key:"handToolKey",get:function get(){return this.handTool.key},set:function set(e){this.handTool.key=e}},{key:"cameraBorder",get:function get(){return this.border}},{key:"cancelCurrentContinuityEvent",value:function cancelCurrentContinuityEvent(){this.continuityNode.cancel()}},{key:"setCameraBorder",value:function setCameraBorder(e){var t=this.border,i=this.border=Object.freeze(B(B({},this.border),e));if(!Ok(t,i)){var _r84;this.transformer?(_r84=this.transformer,_r84.setCurrentBorder(i),i=_r84.adaptOriginBorder):(_r84=new Yf(t),_r84.setCurrentBorder(i)),this.cameraView.setCameraBorder(i);var n=this.moveToCamera||this.screen.camera,_r85=_r84,s=_r85.transform;(s.deltaX!==0||s.deltaY!==0||s.scale!==1)&&this.screen.transformCamera({animationMode:Q.Immediately,centerX:n.centerX+s.deltaX,centerY:n.centerY+s.deltaY,scale:n.scale*s.scale})}return this.border}},{key:"disableBoundlessEvent",get:function get(){return this.continuityNode.disable},set:function set(e){this.continuityNode.disable=e}},{key:"transformCamera",value:function transformCamera(e){var _this159=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return _this159.executeTransformCamera(e)}:this.executeTransformCamera(e)}},{key:"executeTransformCamera",value:function executeTransformCamera(e){var t=e;if(t.boundCamera){var _this$screen$camera=this.screen.camera,i=_this$screen$camera.centerX,_r86=_this$screen$camera.centerY,n=_this$screen$camera.scale,s={centerX:Wi(t.centerX,i),centerY:Wi(t.centerY,_r86),scale:Wi(t.scale,n)},_this$cameraView$scre=this.cameraView.screenSize,o=_this$cameraView$scre.width,a=_this$cameraView$scre.height,_this$cameraView$tran=this.cameraView.transformToCombinedCamera(s,{x:o/2,y:a/2}),c=_this$cameraView$tran.valid;(c.centerX!==s.centerX||c.centerY!==s.centerY||c.scale!==s.scale)&&(t=Le(B({},t),{centerX:c.centerX,centerY:c.centerY,scale:c.scale}))}this.screen.transformCamera(t)}},{key:"adaptRectangle",value:function adaptRectangle(e){var _this160=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return _this160.screen.adaptRectangle(e)}:this.screen.adaptRectangle(e)}},{key:"release",value:function release(){this.didRelease||(this.sorter&&this.sorter.cancel(),this.eventProxy.removeListener(this.onBoundlessEvent),this.screen.removeScreenUpdatedListener(this.onScreenUpdatedListener),this.afterWheelDelayer.cancel(),this.didRelease=!0)}},{key:"handleBoundlessEventWhenItIsDesktop",value:function handleBoundlessEventWhenItIsDesktop(e){switch(e.kind){case v.MouseWheel:{this.onMouseWheel(e);break}case v.TouchStart:case v.TouchMove:case v.TouchEnd:case v.TouchCancel:break;case v.KeyDown:case v.KeyUp:{this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break}default:this.dispatchBoundlessEvent(e);}}},{key:"handleBoundlessEventWhenItIsTouch",value:function handleBoundlessEventWhenItIsTouch(e){switch(e.kind){case v.TouchStart:case v.TouchMove:case v.TouchEnd:case v.TouchCancel:{this.sorter.pushTouchEvent(e);break}case v.MouseDown:case v.MouseUp:case v.MouseMove:case v.MouseLeave:break;case v.KeyDown:case v.KeyUp:{this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break}default:this.dispatchBoundlessEvent(e);}}},{key:"handleBoundlessEventWhenItIsSurface",value:function handleBoundlessEventWhenItIsSurface(e){switch(e.kind){case v.MouseWheel:{this.onMouseWheel(e);break}case v.TouchStart:case v.TouchMove:case v.TouchEnd:case v.TouchCancel:{this.sorter.pushTouchEvent(e);break}case v.MouseDown:case v.MouseUp:case v.MouseMove:case v.MouseLeave:default:this.dispatchBoundlessEvent(e);}}},{key:"onMouseWheel",value:function onMouseWheel(e){if(this.disableCameraTransform)return;var _this$screen$camera2=this.screen.camera,t=_this$screen$camera2.centerX,i=_this$screen$camera2.centerY,r=_this$screen$camera2.scale;if(e.scale!==0){var o=1+e.scale,a=e.pointOnScreen.x,c=e.pointOnScreen.y,h=(1-1/o)/r;t+=h*(a-this.screen.width/2),i+=h*(c-this.screen.height/2),r*=o}t-=e.offsetPoint.x/r,i-=e.offsetPoint.y/r;var n=this.cameraView.transformToCombinedCamera({centerX:t,centerY:i,scale:r},e.pointOnScreen),s=Le(B({},this.cameraAppendBorderTransform(n.valid)),{animationMode:Q.Immediately,operatorId:this.operatorId});this.transformationEventDispatcher.dispatch(di.Begin),this.afterWheelDelayer.refreshAndInvokeAfterInterval(Jf.RefreshTimeoutOnDesktop),this.screen.setCameraTransfrom(s,!0)}},{key:"cameraAppendBorderTransform",value:function cameraAppendBorderTransform(e){if(this.transformer){var t=this.transformer.transform;return Object.freeze({centerX:e.centerX+t.deltaX,centerY:e.centerY+t.deltaY,scale:e.scale*t.scale})}else return e}},{key:"addHandToolActiveListener",value:function addHandToolActiveListener(e){this.handToolActiveEventDispatcher.addListener(e)}},{key:"removeHandToolActiveListener",value:function removeHandToolActiveListener(e){this.handToolActiveEventDispatcher.removeListener(e)}},{key:"addCameraTransformationListener",value:function addCameraTransformationListener(e){this.transformationEventDispatcher.addListener(e)}},{key:"removeCameraTransformationListener",value:function removeCameraTransformationListener(e){this.transformationEventDispatcher.removeListener(e)}},{key:"addBoundlessEventListener",value:function addBoundlessEventListener(e){this.boundlessEventDispatcher.addListener(e)}},{key:"removeBoundlessEventListener",value:function removeBoundlessEventListener(e){this.boundlessEventDispatcher.removeListener(e)}}]);return Jf}(),eg=Jf;eg.RefreshTimeoutOnDesktop=200;function Xs(e,t){var i=e.indexOf(t);i!==-1&&e.splice(i,1)}function tg(e,t){e.indexOf(t)===-1&&e.push(t)}var Fk=/*#__PURE__*/function(){function Fk(){var _this161=this;_classCallCheck(this,Fk);this.animationPriorities=[],this.animations={},this.afterAnimationsInvokers=[],this.animationId=null,this.isInAnimationFrame=!1,this.onAnimationFrame=function(){try{_this161.isInAnimationFrame=!0;var _iterator171=_createForOfIteratorHelper(_this161.animationPriorities),_step171;try{for(_iterator171.s();!(_step171=_iterator171.n()).done;){var _e8=_step171.value;for(var _i37=0,_arr3=_toConsumableArray(_this161.animations[_e8]);_i37<_arr3.length;_i37++){var t=_arr3[_i37];t()}}}catch(err){_iterator171.e(err)}finally{_iterator171.f()}for(var _i36=0,_arr2=_toConsumableArray(_this161.afterAnimationsInvokers);_i36<_arr2.length;_i36++){var e=_arr2[_i36];e()}_this161.animationPriorities.length>0?_this161.animationId=window.requestAnimationFrame(_this161.onAnimationFrame):_this161.animationId=null}finally{_this161.isInAnimationFrame=!1}}}_createClass(Fk,[{key:"addAnimation",value:function addAnimation(e,t){var i=this.animations[e],r=!1;i||(i=this.animations[e]=[],this.animationPriorities.push(e),this.animationPriorities.sort(),r=this.animationPriorities.length===1),tg(i,t),r&&this.animationId===null&&(this.animationId=window.requestAnimationFrame(this.onAnimationFrame))}},{key:"removeAnimation",value:function removeAnimation(e,t){var i=this.animations[e];i&&(Xs(i,t),i.length===0&&(delete this.animations[e],Xs(this.animationPriorities,e),this.animationPriorities.length===0&&!this.isInAnimationFrame&&this.animationId!==null&&(window.cancelAnimationFrame(this.animationId),this.animationId=null)))}},{key:"addAfterAnimationsInvoker",value:function addAfterAnimationsInvoker(e){tg(this.afterAnimationsInvokers,e)}},{key:"removeAfterAnimationsInvoker",value:function removeAfterAnimationsInvoker(e){Xs(this.afterAnimationsInvokers,e)}}]);return Fk}(),_i=/*#__PURE__*/function(){function _i(){_classCallCheck(this,_i)}_createClass(_i,[{key:"createAnimationGroup",value:function createAnimationGroup(){return new Bk}},{key:"createAnimation",value:function createAnimation(e,t){return new ig(e,t)}},{key:"createAnimationFrameInvoker",value:function createAnimationFrameInvoker(e){return new jk(e)}},{key:"createAfterAnimationsInvoker",value:function createAfterAnimationsInvoker(e){return new rg(e)}}]);return _i}();_i.animationFrames=new Fk;var Bk=/*#__PURE__*/function(){function Bk(){_classCallCheck(this,Bk);this.children=[]}_createClass(Bk,[{key:"createAnimation",value:function createAnimation(e,t){var _this162=this;var i=new ig(e,t,function(r){return Xs(_this162.children,r)});return this.children.push(i),i}},{key:"createAfterAnimationsInvoker",value:function createAfterAnimationsInvoker(e){var _this163=this;var t=new rg(e,function(i){return Xs(_this163.children,i)});return this.children.push(t),t}},{key:"release",value:function release(){var _iterator172=_createForOfIteratorHelper(this.children.splice(0)),_step172;try{for(_iterator172.s();!(_step172=_iterator172.n()).done;){var e=_step172.value;e.release()}}catch(err){_iterator172.e(err)}finally{_iterator172.f()}}}]);return Bk}(),ig=/*#__PURE__*/function(){function ig(e,t,i){var _this164=this;_classCallCheck(this,ig);this.priority=e,this.onRefresh=t,this.onRelease=i,this.onAnimationFrame=function(){Eh(_this164,_this164.onRefresh)},_i.animationFrames.addAnimation(this.priority,this.onAnimationFrame)}_createClass(ig,[{key:"release",value:function release(){_i.animationFrames.removeAnimation(this.priority,this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]);return ig}(),rg=/*#__PURE__*/function(){function rg(e,t){var _this165=this;_classCallCheck(this,rg);this.onRefresh=e,this.onRelease=t,this.onAnimationFrame=function(){Eh(_this165,_this165.onRefresh)},_i.animationFrames.addAfterAnimationsInvoker(this.onAnimationFrame)}_createClass(rg,[{key:"release",value:function release(){_i.animationFrames.removeAfterAnimationsInvoker(this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]);return rg}(),jk=/*#__PURE__*/function(){function jk(e){var _this166=this;_classCallCheck(this,jk);this.priority=e,this.nextHandler=null,this.banAnimationChange=!1,this.onAnimationFrame=function(){if(_this166.nextHandler){var t=_this166.nextHandler;_this166.nextHandler=null;try{_this166.banAnimationChange=!0,Eh(_this166,t)}finally{_this166.banAnimationChange=!1}_this166.nextHandler===null&&_i.animationFrames.removeAnimation(_this166.priority,_this166.onAnimationFrame)}}}_createClass(jk,[{key:"invoke",value:function invoke(e){!this.banAnimationChange&&!this.nextHandler&&_i.animationFrames.addAnimation(this.priority,this.onAnimationFrame),this.nextHandler=e}},{key:"release",value:function release(){!this.banAnimationChange&&this.nextHandler&&(this.nextHandler=null,_i.animationFrames.removeAnimation(this.priority,this.onAnimationFrame))}}]);return jk}(),ng=new _i;function Eh(e,t){try{t(e)}catch(i){console.error(i)}}function sg(e){var t=Math.abs(e),i=1/(1+t/2),r=i*Math.exp(-t*t-1.26551223+i*(1.00002368+i*(.37409196+i*(.09678418+i*(-.18628806+i*(.27886807+i*(-1.13520398+i*(1.48851587+i*(-.82215223+i*.17087277)))))))));return e>=0?r:2-r}function zk(e){if(e>=2)return-100;if(e<=0)return 100;var t=e<1?e:2-e,i=Math.sqrt(-2*Math.log(t/2)),r=-.70711*((2.30753+i*.27061)/(1+i*(.99229+i*.04481))-i);for(var n=0;n<2;n++){var s=sg(r)-t;r+=s/(1.1283791670955126*Math.exp(-(r*r))-r*s)}return e<1?r:-r}function Ys(e,t){return new Uk(e,t)}function og(e,t){return Ys(t/e,1/e)}var Uk=/*#__PURE__*/function(){function Uk(e,t){_classCallCheck(this,Uk);this.mean=e,this.variance=t,this.standardDeviation=Math.sqrt(t)}_createClass(Uk,[{key:"pdf",value:function pdf(e){var t=this.standardDeviation*Math.sqrt(2*Math.PI);return Math.exp(-Math.pow(e-this.mean,2)/(2*this.variance))/t}},{key:"cdf",value:function cdf(e){return .5*sg(-(e-this.mean)/(this.standardDeviation*Math.sqrt(2)))}},{key:"ppf",value:function ppf(e){return this.mean-this.standardDeviation*Math.sqrt(2)*zk(2*e)}},{key:"mul",value:function mul(e){if(typeof e=="number")return this.scale(e);var t=1/this.variance,i=1/e.variance;return og(t+i,t*this.mean+i*e.mean)}},{key:"div",value:function div(e){if(typeof e=="number")return this.scale(1/e);var t=1/this.variance,i=1/e.variance;return og(t-i,t*this.mean-i*e.mean)}},{key:"add",value:function add(e){return Ys(this.mean+e.mean,this.variance+e.variance)}},{key:"sub",value:function sub(e){return Ys(this.mean-e.mean,this.variance+e.variance)}},{key:"scale",value:function scale(e){return Ys(this.mean*e,this.variance*e*e)}}]);return Uk}(),ag=/*#__PURE__*/function(){function ag(){_classCallCheck(this,ag);for(var _len18=arguments.length,e=new Array(_len18),_key18=0;_key18<_len18;_key18++){e[_key18]=arguments[_key18]}this.configurations=Object.freeze(e.map(function(t){return Object.freeze(B({},t))}))}_createClass(ag,[{key:"create",value:function create(e,t,i){return new lg(e,_toConsumableArray(this.configurations),t,i)}}]);return ag}(),$i=/*#__PURE__*/function(){function $i(e,t,i,r){var _this167=this;_classCallCheck(this,$i);this.priority=e,this._point=i,this.onPointUpdate=r,this.completeTick=!1,this.playingAnimation=null,this.updateIdealPoint=function(a){$i.setPoint(_this167.idealPoint,a),!_this167.playingAnimation&&_this167.shouldContinueMoving()&&(_this167.playingAnimation=ng.createAnimation(_this167.priority,_this167.onTick)),_this167.completeTick=!1},this.onTick=function(){if(_this167.completeTick)_this167.stop();else{_this167.executePhysicalSimulate();var a=!_this167.shouldContinueMoving();_this167.onPointUpdate&&_this167.onPointUpdate(_this167._point,a),a&&(_this167.completeTick=!0)}};var _t$splice=t.splice(0,1),_t$splice2=_slicedToArray(_t$splice,1),n=_t$splice2[0];this.configuration=n,this._point=_toConsumableArray(i),this.idealPoint=_toConsumableArray(i),this.velocity=i.map(function(){return 0}),t.length>0&&(this.guider=new $i(this.priority,t,i,this.updateIdealPoint));var s=this.configuration.pedesisSpeedMean,o=this.configuration.pedesisSpeedVariance;s!==0&&o!==0?this.gaussian=Ys(s,o):this.gaussian=null,this.noPedesisRadius=(s+Math.sqrt(o))*$i.noPedesisRadiusRate}_createClass($i,[{key:"point",get:function get(){return this._point}},{key:"isPlayingAnimation",get:function get(){return!!this.playingAnimation}},{key:"moveRightNow",value:function moveRightNow(e){this.guider&&this.guider.moveRightNow(e),$i.setPoint(this.idealPoint,e),$i.setPoint(this._point,e),$i.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"moveTo",value:function moveTo(e){this.guider?this.guider.moveTo(e):this.updateIdealPoint(e)}},{key:"moveToAndChangeCoordinate",value:function moveToAndChangeCoordinate(e,t){for(var i=0;i<this._point.length;++i){this._point[i]+=e[i]}this.guider?this.guider.moveToAndChangeCoordinate(e,t):this.updateIdealPoint(t)}},{key:"stop",value:function stop(){$i.setPoint(this.idealPoint,this._point),$i.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"executePhysicalSimulate",value:function executePhysicalSimulate(){var e=this.squareDistanceToIdealPoint(),t=this.velocityDamping(e),i=e>this.noPedesisRadius*this.noPedesisRadius;for(var _r87=0;_r87<this._point.length;++_r87){var n=this.idealPoint[_r87]-this._point[_r87],s=this.configuration.kDistance*n;if(this.velocity[_r87]+=s,i&&this.gaussian){var o=this.gaussian.ppf(Math.random());Math.random()>=.5&&(o=-o),this.velocity[_r87]+=o}this._point[_r87]+=this.velocity[_r87],this.velocity[_r87]*=1-t}}},{key:"velocityDamping",value:function velocityDamping(e){var t=0;for(var n=0;n<this.velocity.length;++n){t+=this.velocity[n]*this.velocity[n]}var _this$configuration=this.configuration,i=_this$configuration.heavyDampingRadius,r=_this$configuration.heavyDampingSpeed;return t<r*r||e>i*i?this.configuration.velocityDamping:Math.min(1,t*this.configuration.velocityDamping)}},{key:"squareDistanceToIdealPoint",value:function squareDistanceToIdealPoint(){var e=0;for(var t=0;t<this.velocity.length;++t){var i=this.idealPoint[t]-this._point[t];e+=i*i}return e}},{key:"shouldContinueMoving",value:function shouldContinueMoving(){for(var e=0;e<this._point.length;++e){if(Math.abs(this._point[e]-this.idealPoint[e])>this.configuration.matchingDistance||Math.abs(this.velocity[e])>this.configuration.zeroSpeed)return!0}return!1}}],[{key:"setPoint",value:function setPoint(e,t){for(var i=0;i<e.length;++i){i in t?e[i]=t[i]:e[i]=0}}},{key:"setPointZero",value:function setPointZero(e){for(var t=0;t<e.length;++t){e[t]=0}}}]);return $i}(),lg=$i;lg.noPedesisRadiusRate=2.7;var Qs;(function(e){e[e.ComponentMoving=0]="ComponentMoving",e[e.CameraMoving=1]="CameraMoving",e[e.Rendering=2]="Rendering"})(Qs||(Qs={}));var yr=/*#__PURE__*/function(){function yr(e,t){var _this168=this;_classCallCheck(this,yr);this.referPoint=[],this._isTransition=!1;var i=t&&function(r,n){var s=_this168.convertPointToCamera(r,n),o=_this168._isTransition||!n;t(s,o,_this168.currentOperatorId),n&&(_this168.currentOperatorId=void 0)};this.referPoint[0]=e.centerX,this.referPoint[1]=e.centerY,this.referPoint[2]=e.scale*yr.kScale,this.spaceSpring=yr.spaceSpringFactory.create(Qs.CameraMoving,[0,0,0],i)}_createClass(yr,[{key:"isTransition",get:function get(){return this._isTransition}},{key:"convertPointToCamera",value:function convertPointToCamera(e,t){return t?{centerX:this.referPoint[0],centerY:this.referPoint[1],scale:this.referPoint[2]/yr.kScale}:{centerX:this.referPoint[0]+e[0],centerY:this.referPoint[1]+e[1],scale:(this.referPoint[2]+e[2])/yr.kScale}}},{key:"moveTo",value:function moveTo(e,t,i){var r=[this.referPoint[0]-e.centerX,this.referPoint[1]-e.centerY,this.referPoint[2]-e.scale*yr.kScale];this._isTransition=t,this.currentOperatorId=i,this.referPoint[0]=e.centerX,this.referPoint[1]=e.centerY,this.referPoint[2]=e.scale*yr.kScale,this.spaceSpring.moveToAndChangeCoordinate(r,[0,0,0])}},{key:"moveToRightNow",value:function moveToRightNow(e,t){this._isTransition=t,this.referPoint[0]=e.centerX,this.referPoint[1]=e.centerY,this.referPoint[2]=e.scale*yr.kScale,this.spaceSpring.moveRightNow([0,0,0])}}]);return yr}(),Ah=yr;Ah.kScale=700,Ah.spaceSpringFactory=new ag({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0});function hg(e,t){var i=t;var _iterator173=_createForOfIteratorHelper(e),_step173;try{for(_iterator173.s();!(_step173=_iterator173.n()).done;){var _r88=_step173.value;i=(0,cg.createElement)(_r88,null,i)}}catch(err){_iterator173.e(err)}finally{_iterator173.f()}return i}function dg(e){var t={};var _iterator174=_createForOfIteratorHelper(e.engines),_step174;try{var _loop20=function _loop20(){var i=_step174.value;t[i.id]=i.createRenderLayout({screen:e.screen,tree:e.tree,mode:e.mode,initCamera:e.initCamera,visions:e.visions,leafFilter:function leafFilter(r){return r.value.isVisible(i)},onRenderDuration:e.onRenderDuration})};for(_iterator174.s();!(_step174=_iterator174.n()).done;){_loop20()}}catch(err){_iterator174.e(err)}finally{_iterator174.f()}return t}var Vk=/*#__PURE__*/function(){function Vk(e){_classCallCheck(this,Vk);this.className=e.screen.className,this.layouts=Object.freeze(dg({tree:e.tree,screen:e.screen,initCamera:e.initCamera,visions:e.visions,engines:e.engines,onRenderDuration:e.onRenderDuration,mode:Kr.Preview}))}_createClass(Vk,[{key:"render",value:function render(e){var t=[],i={width:"100%",height:"100%",position:"relative"};for(var _r89 in this.layouts){var n=this.layouts[_r89].getRender();t.push((0,Oh.createElement)(n,{key:_r89}))}return hg(e,(0,Oh.createElement)("div",{className:this.className,style:i},t))}}]);return Vk}(),br;(function(e){var t;(function(o){o[o.Disjoint=0]="Disjoint",o[o.Cross=1]="Cross",o[o.IncludeRectangle=2]="IncludeRectangle",o[o.IncludeByRectangle=3]="IncludeByRectangle"})(t=e.Result||(e.Result={}));function i(o,a,c,h,d,u){var p=o+c,f=a+h;return d>=o&&d<=p&&u>=a&&u<=f}e.testPoint=i;function r(o,a,c,h,d,u,p,f){var m=pg(o,o+c,d,d+p),g=pg(a,a+h,u,u+f);return m===0||g===0?0:m===1||g===1?1:m===2&&g===2?2:m===3&&g===3?3:1}e.testRectangle=r;function n(o,a,c,h,d){d(o,a),d(o+c,a),d(o+c,a+h),d(o,a+h)}e.iterate=n;function s(o,a,c,h){return[{x:o,y:a},{x:o+c,y:a},{x:o+c,y:a+h},{x:o,y:a+h}]}e.allPoints=s})(br||(br={}));function pg(e,t,i,r){var n=e,s=t,o=i,a=r,c=n>o;if(c){var h=n,d=s;n=o,o=h,s=a,a=d}return s<o?br.Result.Disjoint:s<a?br.Result.Cross:c?br.Result.IncludeByRectangle:br.Result.IncludeRectangle}var Wk=/*#__PURE__*/function(){function Wk(e){_classCallCheck(this,Wk);this.component=null,this.componentState={className:e.screen.className},this.layouts=Object.freeze(dg({tree:e.tree,screen:e.screen,engines:e.engines,visions:e.visions,onRenderDuration:e.onRenderDuration,mode:Kr.Normal})),this.logger=e.screen.scene.logger,this.renderClass=this.createRender()}_createClass(Wk,[{key:"setState",value:function setState(e){var t;this.componentState=B({},e),(t=this.component)==null||t.setState(e)}},{key:"renderLayouts",get:function get(){return this.layouts}},{key:"getRender",value:function getRender(){return this.renderClass}},{key:"createRender",value:function createRender(){var e=this;var t=/*#__PURE__*/function(_Zr$Component){_inherits(t,_Zr$Component);var _super43=_createSuper(t);function t(r){var _this169;_classCallCheck(this,t);_this169=_super43.call(this,r);_this169.state=B({},e.componentState),e.component=_assertThisInitialized(_this169);return _this169}_createClass(t,[{key:"componentWillUnmount",value:function componentWillUnmount(){e.component=null}},{key:"render",value:function render(){var r=[],_this$state3=this.state,n=_this$state3.className,s=_this$state3.style,o=Le(B({},s),{width:"100%",height:"100%",position:"relative"});for(var a in e.layouts){r.push((0,Zr.createElement)(Hk,{key:a,logger:e.logger,layout:e.layouts[a]}))}return(0,Zr.createElement)("div",{className:n,style:o},r)}}]);return t}(Zr.Component);return t}}]);return Wk}(),Hk=/*#__PURE__*/function(_Zr$Component2){_inherits(Hk,_Zr$Component2);var _super44=_createSuper(Hk);function Hk(e){var _this170;_classCallCheck(this,Hk);_this170=_super44.call(this,e);_this170.state={error:void 0};return _this170}_createClass(Hk,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e,t){var i=this.props.layout,r=this.state.error;return i!==e.layout||r!==t.error}},{key:"componentDidCatch",value:function componentDidCatch(e,t){var _this$props10=this.props,i=_this$props10.layout,r=_this$props10.logger;r.error("boundless layout ".concat(i.engine.id," render catch error:"),e," stack: ",t.componentStack)}},{key:"render",value:function render(){var e=this.props.layout,t=this.state.error;if(t)return null;{var i=e.getRender();return(0,Zr.createElement)(i,null)}}}],[{key:"getDerivedStateFromError",value:function getDerivedStateFromError(e){return console.error(e),{error:e}}}]);return Hk}(Zr.Component),_k=/*#__PURE__*/function(){function _k(e,t,i,r,n){_classCallCheck(this,_k);var s={};var _loop21=function _loop21(o){var a=e.renderLayouts[o],c={};t.forEach(function(h){h.value.isVisible(a.engine)&&(c[h.id]=!0)}),s[o]=Object.seal({layout:a,visibleSet:c})};for(var o in e.renderLayouts){_loop21(o)}this.camera=r,this.screenSize=n,this.context=i,this.engineNodes=Object.freeze(s)}_createClass(_k,[{key:"flush",value:function flush(e){var t,i,r;ci(this.camera,e.camera)||(t=this.camera=e.camera),ci(this.screenSize,e.screenSize)||(i=this.screenSize=e.screenSize),this.context!==e.context&&(r=this.context=e.context);for(var n in this.engineNodes){this.flushEngine(this.engineNodes[n],e,r,t,i)}}},{key:"flushEngine",value:function flushEngine(e,t,i,r,n){var s=e.visibleSet,o=e.layout.engine,a=t.testSet,c=t.updateSet,h=t.moveSet,d=t.isTransition,_t$diff=t.diff,u=_t$diff.addedSet,p=_t$diff.removedSet,f=[],m=[],g=[];for(var w in u){u[w].value.isVisible(o)?s[w]=!0:g.push(w)}for(var _w2 in a){var P=a[_w2],A=P.treeNode,E=P.isVisible(o),R=(_w2 in s);R&&!E?(m.push(A),delete s[_w2]):!R&&E&&(f.push(A),s[_w2]=!0)}for(var _w3 in p){delete s[_w3]}var y=t.diff.decorate({insertToAdded:f,insertToRemoved:m,maskAdded:g}),b={},S={};for(var _w4 in c){_w4 in s&&(b[_w4]=c[_w4].treeNode)}for(var _w5 in h){_w5 in s&&(S[_w5]=h[_w5].treeNode)}e.layout.update({context:i,camera:r,screenSize:n,isTransition:d,diff:y,updateSet:b,moveSet:S})}}]);return _k}(),$k=/*#__PURE__*/function(){function $k(e){var _this171=this;_classCallCheck(this,$k);this.frameInvoker=ng.createAnimationFrameInvoker(Qs.Rendering),this.didReceiveTransitionFalse=!1,this.onFrameInvoke=function(){var t=!_this171.didReceiveTransitionFalse;_this171.didReceiveTransitionFalse=!1,_this171.frameHandler(t)},this.frameHandler=e}_createClass($k,[{key:"release",value:function release(){this.frameInvoker.release()}},{key:"fire",value:function fire(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;e||(this.didReceiveTransitionFalse=!0),this.frameInvoker.invoke(this.onFrameInvoke)}}]);return $k}();function mg(e,t,i,r){var n=gg(t),s=e.treeNode;Rh(s,n,i,r)}function Gk(e,t,i,r){switch(e.kind){case Ci.Component:{var n=e,s=n.treeNode.parent,o=fg(s,t);if(o){var a=Nh(e,o);a?i(n,a):r(n)}break}case Ci.Group:{var _n36=e.treeNode,_s26=fg(_n36,t);_s26&&Rh(_n36,_s26,i,r);break}}}function fg(e,t){var i=[],r=e;for(;r.parent;){i.push(r),r=r.parent}var n=gg(t);for(var s=i.length-1;s>=0;s--){var o=i[s].value,a=Nh(o,n);if(!a){n=null;break}n=yg(n,a,o)}return n}function Rh(e,t,i,r){var _iterator175=_createForOfIteratorHelper(e),_step175;try{for(_iterator175.s();!(_step175=_iterator175.n()).done;){var n=_step175.value;var s=n.value,o=Nh(s,t);switch(s.kind){case Ci.Component:{var a=s;o?i(a,o):r(a);break}case Ci.Group:{if(o){var _a17=s,c=_a17.treeNode,h=yg(t,o,_a17);Rh(c,h,i,r)}break}}}}catch(err){_iterator175.e(err)}finally{_iterator175.f()}}function gg(_ref62){var e=_ref62.camera,t=_ref62.width,i=_ref62.height;var r={dx:0,dy:0,scale:1},n={dx:-(e.centerX-t/e.scale/2)*e.scale,dy:-(e.centerY-i/e.scale/2)*e.scale,scale:e.scale};return{scene:r,screen:n,rect:{originX:0,originY:0,width:t,height:i},tailor:{left:0,right:0,top:0,bottom:0},absolute:Kk(t,i)}}function Kk(e,t){var i={dx:0,dy:0,scale:1},r={dx:e/2,dy:t/2,scale:1},n={scene:i,screen:r,rect:{originX:0,originY:0,width:e,height:t},tailor:{left:0,right:0,top:0,bottom:0},absolute:null};return n.absolute=n,n}function yg(e,_ref63,n){var t=_ref63.sceneRect,i=_ref63.screenRect,r=_ref63.tailor;var s={dx:t.originX,dy:t.originY,scale:e.scene.scale*n.scale},o={dx:i.originX,dy:i.originY,scale:e.screen.scale*n.scale};return{scene:s,screen:o,rect:i,tailor:r,absolute:e.absolute}}function Nh(e,t){if(e.kind===Ci.Component&&!e.isVisible())return null;var i=t;e.absoluteCoordinates&&(i=i.absolute);var _i38=i,r=_i38.scene,_i38$screen=_i38.screen,n=_i38$screen.scale,s=_i38$screen.dx,o=_i38$screen.dy,a=Xk(e,n),c=e.originX*n+s-a.left,h=e.originY*n+o-a.top,d=e.width*n+a.left+a.right,u=e.height*n+a.top+a.bottom,p=i.rect,f=i.tailor,m=p.originX+f.left-c,g=p.originY+f.top-h,y=c+d-(p.originX+p.width-f.right),b=h+u-(p.originY+p.height-f.bottom);if(!e.disableVisionTrim&&(m>=d||y>=d||m+y>=d||g>=u||b>=u||g+b>=u))return null;var S={left:m,top:g,right:y,bottom:b},w={originX:c,originY:h,width:d,height:u},P=bg(e,n),A={originX:e.originX+r.dx-P.left,originY:e.originY+r.dy-P.top,width:e.width*r.scale+P.left+P.right,height:e.height*r.scale+P.top+P.bottom};return{margin:a,scale:n,tailor:S,sceneRect:A,screenRect:w}}function Xk(e,t){var i=e.sceneMargin,r=e.parallaxMargin,n=i.left*t+r.left,s=i.top*t+r.top,o=i.right*t+r.right,a=i.bottom*t+r.bottom;return Object.freeze({left:n,right:o,top:s,bottom:a})}function bg(e,t){var i=e.sceneMargin,r=e.parallaxMargin,n=i.left+r.left/t,s=i.top+r.top/t,o=i.right+r.right/t,a=i.bottom+r.bottom/t;return Object.freeze({left:n,right:o,top:s,bottom:a})}function vg(e,t,i){mg(t,i,function(r,n){e.bindVision(r.treeNode,n)},function(){})}var Yk=/*#__PURE__*/function(){function Yk(e){var _this172=this;_classCallCheck(this,Yk);this.isCameraUpdated=!1,this.toTestAppearSet={},this.toTestVisibleSet={},this.toUpdateSet={},this.toSortSet={},this.toMoveSet={},this.toShowSet={},this.toHideSet={},this.onScreenUpdate=function(r){ci(_this172.screenState,r)||(_this172.isCameraUpdated=!0,_this172.screenState=r,_this172.refreshFrameNode.fire(r.isTransition))},this.onGroupSorted=function(r){_this172.toSortSet[r.treeNode.id]=r,_this172.refreshFrameNode.fire()},this.onComponentUpdate=function(_ref64){var r=_ref64.node,n=_ref64.behavior;switch(n){case $e.Removed:{delete _this172.toTestAppearSet[r.treeNode.id],delete _this172.toUpdateSet[r.treeNode.id],delete _this172.toTestVisibleSet[r.treeNode.id];break}case $e.Added:case $e.AppearUpdated:{_this172.toTestAppearSet[r.treeNode.id]=r;break}case $e.VisibleUpdated:{r instanceof Dh&&(_this172.toTestVisibleSet[r.treeNode.id]=r);break}case $e.PropertiesUpdated:{r instanceof Dh&&(_this172.toUpdateSet[r.treeNode.id]=r);break}}_this172.refreshFrameNode.fire()},this.handleFrame=function(r){try{_this172.sortAllGroups();var n=_this172.diffBuffer.fetchDiff();_this172.testComponents(n);var s=_this172.commitVisibleAndDecorateDiff(n);_this172.notify(s,r),_this172.cleanSet()}catch(n){_this172.logger.error(n)}},this.refreshComponent=function(r,n){var s=r.treeNode.id,o=_this172.visions.leaf(s),a=_this172.visions.vision(s);if(!a)_this172.toShowSet[s]={component:r,vision:n};else{var c=a.sceneRect,h=o.value;(!ci(c,n.sceneRect)||!ci(h.parallaxMargin,r.parallaxMargin)||!ci(h.sceneMargin,r.sceneMargin))&&(_this172.toMoveSet[s]={component:r,vision:n})}o&&_this172.visions.bindVision(o,n)},this.removeComponent=function(r){var n=r.treeNode;_this172.visions.includes(n.id)&&(_this172.toHideSet[n.id]=r),_this172.visions.unbindVision(n.id)},this.screen=e.screen,this.visions=e.visions,this.logger=this.screen.scene.logger,this.tree=this.screen.scene.tree,this.diffBuffer=this.tree.createDiffBuffer(),this.screenState={width:this.screen.width,height:this.screen.height,camera:Object.freeze(B({},this.screen.camera)),visionRectangle:this.screen.visionRectangle,isTransition:!1},vg(this.visions,this.screen.scene,this.screenState),this.renderer=new Wk({screen:this.screen,engines:e.engines,tree:this.tree,visions:this.visions,onRenderDuration:e.onRenderDuration});var _this$screen=this.screen,t=_this$screen.context,i=_this$screen.camera;this.notifier=new _k(this.renderer,this.visions,t,i,Object.freeze({width:this.screen.width,height:this.screen.height})),this.refreshFrameNode=new $k(this.handleFrame),this.screen.addScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.addGroupSortedListener(this.onGroupSorted),this.screen.scene.addComponentUpdateListener(this.onComponentUpdate)}_createClass(Yk,[{key:"willInterruptEvent",value:function willInterruptEvent(e,t){for(var i in this.renderer.renderLayouts){if(this.renderer.renderLayouts[i].willInterruptEvent(this.screen,e,t))return!0}return!1}},{key:"findComponentWithTarget",value:function findComponentWithTarget(e){for(var t in this.renderer.renderLayouts){var i=this.renderer.renderLayouts[t],_r90=i.findComponentWithTarget(e);if(_r90)return{component:_r90,engine:i.engine}}}},{key:"forEachVisibleComponent",value:function forEachVisibleComponent(e){var _iterator176=_createForOfIteratorHelper(this.tree),_step176;try{for(_iterator176.s();!(_step176=_iterator176.n()).done;){var t=_step176.value;e(t.value)}}catch(err){_iterator176.e(err)}finally{_iterator176.f()}}},{key:"release",value:function release(){this.refreshFrameNode.release(),this.diffBuffer.release(),this.screen.removeScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.removeGroupSortedListener(this.onGroupSorted),this.screen.scene.removeComponentUpdateListener(this.onComponentUpdate)}},{key:"refreshScreenContext",value:function refreshScreenContext(){this.refreshFrameNode.fire()}},{key:"sortAllGroups",value:function sortAllGroups(){for(var e in this.toSortSet){this.toSortSet[e].sortIfNeed()}}},{key:"testComponents",value:function testComponents(e){for(var t in e.removedSet){this.visions.includes(t)&&(this.toHideSet[t]=e.removedSet[t].value)}if(this.isCameraUpdated)mg(this.screen.scene,this.screenState,this.refreshComponent,this.removeComponent),this.isCameraUpdated=!1;else for(var _t13 in this.toTestAppearSet){var i=this.toTestAppearSet[_t13];i.treeNode.parent&&Gk(i,this.screenState,this.refreshComponent,this.removeComponent)}}},{key:"commitVisibleAndDecorateDiff",value:function commitVisibleAndDecorateDiff(e){var t=[],i=[],r=[];for(var n in this.toShowSet){var _this$toShowSet$n=this.toShowSet[n],s=_this$toShowSet$n.vision,o=_this$toShowSet$n.component,a=o.treeNode;e.addedSet[n]||t.push(a),this.visions.bindVision(a,s)}for(var _n37 in this.toMoveSet){var _this$toMoveSet$_n=this.toMoveSet[_n37],_s27=_this$toMoveSet$_n.vision,_o19=_this$toMoveSet$_n.component,_a18=_o19.treeNode;this.visions.bindVision(_a18,_s27)}for(var _n38 in this.toHideSet){var _s28=this.toHideSet[_n38].treeNode;e.removedSet[_n38]||i.push(_s28),this.visions.unbindVision(_n38)}for(var _n39 in e.addedSet){this.visions.includes(_n39)||r.push(_n39)}return e.decorate({insertToAdded:t,insertToRemoved:i,maskAdded:r})}},{key:"notify",value:function notify(e,t){var i={};for(var _r91 in this.toMoveSet){i[_r91]=this.toMoveSet[_r91].component}for(var _r92 in this.toUpdateSet){this.visions.includes(_r92)||delete this.toUpdateSet[_r92]}for(var _r93 in this.toTestVisibleSet){this.visions.includes(_r93)||delete this.toTestVisibleSet[_r93]}this.notifier.flush({context:this.screen.context,camera:this.screenState.camera,diff:e,isTransition:t,moveSet:i,testSet:this.toTestVisibleSet,updateSet:this.toUpdateSet,screenSize:Object.freeze({width:this.screen.width,height:this.screen.height})})}},{key:"cleanSet",value:function cleanSet(){this.toTestVisibleSet={},this.toUpdateSet={},mt(this.toTestAppearSet)&&(this.toTestAppearSet={}),mt(this.toSortSet)&&(this.toSortSet={}),mt(this.toMoveSet)&&(this.toMoveSet={}),mt(this.toShowSet)&&(this.toShowSet={}),mt(this.toHideSet)&&(this.toHideSet={})}}]);return Yk}(),Qk=/*#__PURE__*/function(){function Qk(e){_classCallCheck(this,Qk);this.context=null,this.screen=e.screen,this.engines=e.engines,this.onRenderDuration=e.onRenderDuration,this.visions=new _f,this._wrappedComponents=Object.freeze(_toConsumableArray(e.wrappedComponents))}_createClass(Qk,[{key:"hitTest",value:function hitTest(e,t){var _this173=this;var i=[];if(this.context){var _r94=t/this.screen.camera.scale;this.context.visibleTestNode.forEachVisibleComponent(function(n){_this173.isHitComponent(n,e,_r94)&&i.push(n.id)})}return i.reverse()}},{key:"findComponentWithTarget",value:function findComponentWithTarget(e){if(this.context)return this.context.visibleTestNode.findComponentWithTarget(e)}},{key:"willInterruptEvent",value:function willInterruptEvent(e,t){return this.context?this.context.visibleTestNode.willInterruptEvent(e,t):!1}},{key:"refreshScreenRendererState",value:function refreshScreenRendererState(e){var t;(t=this.context)==null||t.visibleTestNode.renderer.setState(e)}},{key:"refreshScreenContext",value:function refreshScreenContext(){this.context&&this.context.visibleTestNode.refreshScreenContext()}},{key:"isHitComponent",value:function isHitComponent(e,_ref65,r){var t=_ref65.x,i=_ref65.y;var n=bg(e,this.screen.camera.scale),s=Math.max(n.left,r),o=Math.max(n.right,r),a=Math.max(n.top,r),c=Math.max(n.bottom,r),h=e.originX-s,d=e.originY-a,u=e.width+s+o,p=e.height+a+c;return br.testPoint(h,d,u,p,t,i)?e.definition.hitTest(this.screen,e,t,i,r):!1}},{key:"divElement",get:function get(){return this.context&&this.context.divElement},set:function set(e){e!==(this.context&&this.context.divElement)&&(this.context&&(this.context.visibleTestNode.release(),(0,Ra.unmountComponentAtNode)(this.context.divElement)),e?this.context=Object.freeze({divElement:e,visibleTestNode:new Yk({screen:this.screen,engines:this.engines,visions:this.visions,onRenderDuration:this.onRenderDuration})}):(this.visions.clean(),this.context=null),this.refreshScreenRender())}},{key:"wrappedComponents",get:function get(){return this._wrappedComponents},set:function set(e){this._wrappedComponents!==e&&(this._wrappedComponents=Object.freeze(_toConsumableArray(e)),this.refreshScreenRender())}},{key:"refreshScreenRender",value:function refreshScreenRender(){if(this.context){var e=(0,ug.createElement)(this.context.visibleTestNode.renderer.getRender()),t=hg(this._wrappedComponents,e);(0,Ra.render)(t,this.context.divElement)}}}]);return Qk}(),qk=/*#__PURE__*/function(){function qk(e){var _this174=this;_classCallCheck(this,qk);this.screenUpdatedDispatcher=new Zt,this.cameraUpdatedDispatcher=new Zt,this.renderErrorCatchedDispatcher=new Zt,this.sizeUpdatedDispatcher=new Zt,this.centerX=0,this.centerY=0,this.scale=1,this.adaptedRectangle=null,this.dispatchUpdatedEvent=function(t,i,r){var n=_this174.convertVisionRectangle(t,_this174._width,_this174._height);_this174.screenUpdatedDispatcher.dispatch({width:_this174._width,height:_this174._height,camera:t,visionRectangle:n,isTransition:i}),_this174.cameraUpdatedDispatcher.dispatch(Le(B({},t),{operatorId:r}))},this.onResize=function(t){var i=t[0];if(i){var _i$contentRect=i.contentRect,_r95=_i$contentRect.width,n=_i$contentRect.height;_this174.refreshSize(_r95,n)}},this.deviceType=e.scene.deviceType,this.scene=e.scene,this._className=e.className,this._style=e.style,this._context=e.context,this._width=e.width,this._height=e.height,this.cameraAnimation=new Ah(this.camera,this.dispatchUpdatedEvent),this.eventInterrupter=e.eventInterrupter,this.onRenderDuration=e.onRenderDuration,this.updater=new Qk({screen:this,engines:e.engines,wrappedComponents:e.wrappedComponents,onRenderDuration:e.onRenderDuration}),e.autoResize&&(this.resizeObserver=new $f.ResizeObserver(this.onResize))}_createClass(qk,[{key:"className",get:function get(){return this._className},set:function set(e){this._className!==e&&(this._className=e,this.updater.refreshScreenRendererState({className:e}))}},{key:"style",get:function get(){return this._style},set:function set(e){this._style!==e&&(this._style=e,this.updater.refreshScreenRendererState({style:e}))}},{key:"wrappedComponents",get:function get(){return this.updater.wrappedComponents},set:function set(e){this.updater.wrappedComponents=e}},{key:"width",get:function get(){return this._width}},{key:"height",get:function get(){return this._height}},{key:"divElement",get:function get(){return this.updater.divElement},set:function set(e){var t=this.updater.divElement;if(t!==e){if(this.resizeObserver&&t&&this.resizeObserver.unobserve(t),this.updater.divElement=e,e){var i=e.clientWidth,_r96=e.clientHeight;this.refreshSize(i,_r96),this.resizeObserver&&this.resizeObserver.observe(e)}this._eventProxy&&this._eventProxy.bindDivElement(e)}}},{key:"eventProxy",get:function get(){return this._eventProxy||(this._eventProxy=new xk(this,this.eventInterrupter),this._eventProxy.bindDivElement(this.divElement)),this._eventProxy}},{key:"context",get:function get(){return this._context},set:function set(e){this._context!==e&&(this._context=e,this.updater.refreshScreenContext())}},{key:"bounding",get:function get(){if(this.divElement){var e=this.divElement.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}}else return{left:0,right:0,top:0,bottom:0,width:0,height:0}}},{key:"bindCameraman",value:function bindCameraman(e,t){return new eg(this,this.eventProxy,t,e)}},{key:"convertPointToScreen",value:function convertPointToScreen(e,t){return{x:(e-this.centerX)*this.scale+this._width/2,y:(t-this.centerY)*this.scale+this._height/2}}},{key:"convertPointToScene",value:function convertPointToScene(e,t){return{x:(e-this._width/2)/this.scale+this.centerX,y:(t-this._height/2)/this.scale+this.centerY}}},{key:"cameraWithAdaptRectangle",value:function cameraWithAdaptRectangle(e,t){var i=e.originX+e.width/2,r=e.originY+e.height/2,n=this._width/e.width,s=this._height/e.height;switch((Number.isNaN(n)||n<=0)&&(n=1),(Number.isNaN(s)||s<=0)&&(s=1),t){case hi.Centering:return{centerX:i,centerY:r,scale:Math.min(n,s)};case hi.Tailor:return{centerX:i,centerY:r,scale:Math.max(n,s)};default:throw new Error("invalid adapter mode ".concat(t));}}},{key:"adaptRectangle",value:function adaptRectangle(e){if(e.width===0||e.height===0)this.transformCamera({animationMode:e.animationMode,centerX:e.originX+e.width/2,centerY:e.originY+e.height/2,scale:1,operatorId:e.operatorId});else{var t=Le(B({},this.cameraWithAdaptRectangle(e,e.adapterMode)),{animationMode:e.animationMode,operatorId:e.operatorId});this.setCameraTransfrom(t,!1),this.adaptedRectangle=Object.freeze({originX:e.originX,originY:e.originY,width:e.width,height:e.height,adapterMode:e.adapterMode})}}},{key:"transformCamera",value:function transformCamera(e){this.adaptedRectangle=null,this.setCameraTransfrom(e,!1)}},{key:"setTransition",value:function setTransition(e,t){e!==this.cameraAnimation.isTransition&&this.updateCameraAnimation(this.camera,Q.Immediately,e,t)}},{key:"setCameraTransfrom",value:function setCameraTransfrom(e,t){var i=Gs(e.centerX,this.centerX),r=Gs(e.centerY,this.centerY),n=Gs(e.scale,this.scale);(i!==this.centerX||r!==this.centerY||n!==this.scale||t!==this.cameraAnimation.isTransition)&&(this.centerX=i,this.centerY=r,this.scale=n,this.updateCameraAnimation(this.camera,e.animationMode,t,e.operatorId))}},{key:"updateCameraAnimation",value:function updateCameraAnimation(e,t,i,r){switch(t){case Q.Immediately:{this.dispatchUpdatedEvent(e,i,r),this.cameraAnimation.moveToRightNow(e,i);break}case Q.Continuous:{this.cameraAnimation.moveTo(e,i,r);break}}}},{key:"camera",get:function get(){return{centerX:this.centerX,centerY:this.centerY,scale:this.scale}}},{key:"visionRectangle",get:function get(){return this.convertVisionRectangle(this.camera,this._width,this._height)}},{key:"willInterruptEvent",value:function willInterruptEvent(e,t){return this.updater.willInterruptEvent(e,t)}},{key:"convertVisionRectangle",value:function convertVisionRectangle(e,t,i){var r=t/e.scale,n=i/e.scale;return{originX:e.centerX-r/2,originY:e.centerY-n/2,width:r,height:n}}},{key:"hitTest",value:function hitTest(e,t,i){return this.updater.hitTest(this.convertPointToScene(e,t),i)}},{key:"findComponentWithTarget",value:function findComponentWithTarget(e){return this.updater.findComponentWithTarget(e)}},{key:"renderScreenshot",value:function renderScreenshot(e){var t=Wi(e.camera,Object.freeze(this.camera)),i=Wi(e.width,this._width),r=Wi(e.height,this._height),n=new _f;return vg(n,this.scene,{width:this._width,height:this._height,camera:t,isTransition:!1,visionRectangle:this.convertVisionRectangle(t,i,r)}),new Vk({visions:n,tree:this.scene.tree,screen:this,initCamera:t,engines:this.updater.engines,onRenderDuration:this.onRenderDuration}).render(this.updater.wrappedComponents)}},{key:"resize",value:function resize(){if(this.divElement&&!this.resizeObserver){var e=this.divElement;this.refreshSize(e.clientWidth,e.clientHeight)}}},{key:"refreshSize",value:function refreshSize(e,t){if(this._width!==e||this._height!==t){this._width=e,this._height=t;var i;this.adaptedRectangle?i=this.cameraWithAdaptRectangle(this.adaptedRectangle,this.adaptedRectangle.adapterMode):i=this.camera,this.setCameraTransfrom(Le(B({},i),{animationMode:Q.Immediately}),!1),this.dispatchUpdatedEvent(i,!1),this.sizeUpdatedDispatcher.dispatch({width:e,height:t})}}},{key:"addCameraUpdatedListener",value:function addCameraUpdatedListener(e){this.cameraUpdatedDispatcher.addListener(e)}},{key:"removeCameraUpdatedListener",value:function removeCameraUpdatedListener(e){this.cameraUpdatedDispatcher.removeListener(e)}},{key:"addRenderErrorCatchedListener",value:function addRenderErrorCatchedListener(e){this.renderErrorCatchedDispatcher.addListener(e)}},{key:"removeRenderErrorCatchedListener",value:function removeRenderErrorCatchedListener(e){this.renderErrorCatchedDispatcher.removeListener(e)}},{key:"addSizeUpdatedListener",value:function addSizeUpdatedListener(e){this.sizeUpdatedDispatcher.addListener(e)}},{key:"removeSizeUpdatedListener",value:function removeSizeUpdatedListener(e){this.sizeUpdatedDispatcher.removeListener(e)}},{key:"addScreenUpdatedListener",value:function addScreenUpdatedListener(e){this.screenUpdatedDispatcher.addListener(e)}},{key:"removeScreenUpdatedListener",value:function removeScreenUpdatedListener(e){this.screenUpdatedDispatcher.removeListener(e)}},{key:"layoutComponentWithTarget",value:function layoutComponentWithTarget(e){var t=this.findComponentWithTarget(e);if(t)return{componentId:t.component.id,layout:t.engine.orderIndex}}}]);return qk}();function Zk(e,t,i){var r=t,n=e.orderIndex;var s=/*#__PURE__*/function(_Na$Component){_inherits(s,_Na$Component);var _super45=_createSuper(s);function s(){_classCallCheck(this,s);return _super45.apply(this,arguments)}_createClass(s,[{key:"render",value:function render(){var _this$props11=this.props,a=_this$props11.id,c=_this$props11.margin,h=_this$props11.origin,d=_this$props11.size,u=_this$props11.scale,p=_this$props11.payload,f=_this$props11.context,m=_this$props11.cnode;return(0,Na.createElement)(r,{id:a,layout:n,margin:c,origin:h,size:d,scale:u,payload:p,context:f,cnode:m})}}],[{key:"willInterruptEvent",value:function willInterruptEvent(a,c,h){return typeof t.willInterruptEvent=="function"?t.willInterruptEvent(a,c,n,h):typeof t.willInterruptEvent=="boolean"?t.willInterruptEvent:!1}}]);return s}(Na.Component);return s.isVisible=i,s}var Sg=/*#__PURE__*/function(){function Sg(e){_classCallCheck(this,Sg);this.definitionNodes=[];var t=_toConsumableArray(e).sort(function(n,s){return n.layout-s.layout}),i={},r={};var _iterator177=_createForOfIteratorHelper(t),_step177;try{for(_iterator177.s();!(_step177=_iterator177.n()).done;){var n=_step177.value;var s=this.createEngine(n);n.renderMode===Zs.Screen&&(r[s.id]=!0),i[s.id]=s}}catch(err){_iterator177.e(err)}finally{_iterator177.f()}this.engines=Object.freeze(B({},i)),this.absoluteCoordinatesSet=Object.freeze(B({},r))}_createClass(Sg,[{key:"createEngine",value:function createEngine(_ref66){var e=_ref66.layout,t=_ref66.kind,i=_ref66.renderMode,r=_ref66.className,n=_ref66.style;var s;switch(t){case en.HTML:case en.SVG:{s=Hf({orderIndex:e,fixedSize:i===Zs.AbsoluteSize,isSVG:t===en.SVG,className:r,style:n});break}case en.CANVAS:{s=Wf({orderIndex:e,fixedSize:!0});break}default:throw new Error("invalid kind ".concat(t));}return s}},{key:"adaptComponentConstructor",value:function adaptComponentConstructor(e){if(e.definition)return e;var t=e,_this$findDefinitionN=this.findDefinitionNode(t),i=_this$findDefinitionN.definition,r=this.checkIsAbsoluteCoordinates(t);return{id:t.id,definition:i,originX:t.originX,originY:t.originY,width:t.width,height:t.height,parallaxMargin:t.parallaxMargin,sceneMargin:t.sceneMargin,disableVisionTrim:t.disableVisionTrim,absoluteCoordinates:r,payload:t.payload,orderIndex:t.orderIndex}}},{key:"checkIsAbsoluteCoordinates",value:function checkIsAbsoluteCoordinates(e){for(var t in e.render.layouts){var i=this.findEngineWithLayout(parseInt(t,10));if(i)return!!this.absoluteCoordinatesSet[i.id]}return!1}},{key:"findDefinitionNode",value:function findDefinitionNode(e){var t=null;var _iterator178=_createForOfIteratorHelper(this.definitionNodes),_step178;try{for(_iterator178.s();!(_step178=_iterator178.n()).done;){var i=_step178.value;if(i.render===e.render){t=i;break}}}catch(err){_iterator178.e(err)}finally{_iterator178.f()}return t||(t=Object.freeze({definition:this.createDefinition(e),render:e.render,painter:e.painter}),this.definitionNodes.push(t)),t}},{key:"createDefinition",value:function createDefinition(_ref67){var e=_ref67.render;var t;var i=new Kn({name:e.name||"ComponentDefinition",hitTest:(t=e.hitTest)==null?void 0:t.bind(e)});for(var _r97 in e.layouts){var n=this.findEngineWithLayout(parseInt(_r97,10)),s=e.layouts[_r97].isVisible;n instanceof Mh&&n.bind(i)(Zk(n,e,s))}return i}},{key:"findEngineWithLayout",value:function findEngineWithLayout(e){for(var t in this.engines){if(this.engines[t].orderIndex===e)return this.engines[t]}return null}}]);return Sg}(),$e;(function(e){e[e.Added=0]="Added",e[e.Removed=1]="Removed",e[e.VisibleUpdated=2]="VisibleUpdated",e[e.AppearUpdated=3]="AppearUpdated",e[e.PropertiesUpdated=4]="PropertiesUpdated"})($e||($e={}));var Jk=Object.freeze({left:0,right:0,top:0,bottom:0}),eC=new ag({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0}),kg=/*#__PURE__*/function(){function kg(e,t,i){var _this175=this;_classCallCheck(this,kg);this.onRemovedDispatcher=new Zt,this.onRectangleUpdatedDispatcher=new Zt,this.onRectanglePointUpdate=function(){_this175.reporter.update(_this175,$e.AppearUpdated),_this175.onRectangleUpdatedDispatcher.dispatch(_this175)},this.reporter=e,this.id=t.id||(0,wg.v4)().replace(/-/g,""),this.treeNode=i,this._parallaxMargin=Da(t.parallaxMargin),this._sceneMargin=Da(t.sceneMargin),this.disableVisionTrim=!!t.disableVisionTrim,this.absoluteCoordinates=!!t.absoluteCoordinates,this._orderIndex=t.orderIndex,this.rectangleTarget={originX:La(t.originX),originY:La(t.originY),width:La(t.width),height:La(t.height)};var r=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];this.rectangleAnimation=eC.create(Qs.ComponentMoving,r,this.onRectanglePointUpdate)}_createClass(kg,[{key:"originX",get:function get(){return this.rectangleAnimation.point[0]}},{key:"originY",get:function get(){return this.rectangleAnimation.point[1]}},{key:"width",get:function get(){return this.rectangleAnimation.point[2]}},{key:"height",get:function get(){return this.rectangleAnimation.point[3]}},{key:"parallaxMargin",get:function get(){return this._parallaxMargin}},{key:"sceneMargin",get:function get(){return this._sceneMargin}},{key:"orderIndex",get:function get(){return this._orderIndex},set:function set(e){if(e!==this._orderIndex){var t=this.treeNode.parent.value;this._orderIndex=e,t.reportChildOrderUpdate()}}},{key:"moveTo",value:function moveTo(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Q.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.syncRectangleTarget(i))}},{key:"resize",value:function resize(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Q.Immediately;(this.rectangleTarget.width!==e||this.rectangleTarget.height!==t)&&(this.rectangleTarget.width=e,this.rectangleTarget.height=t,this.syncRectangleTarget(i))}},{key:"setRectangle",value:function setRectangle(e,t,i,r){var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:Q.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t||this.rectangleTarget.width!==i||this.rectangleTarget.height!==r)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.rectangleTarget.width=i,this.rectangleTarget.height=r,this.syncRectangleTarget(n))}},{key:"syncRectangleTarget",value:function syncRectangleTarget(e){var t=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];switch(e){case Q.Immediately:{this.rectangleAnimation.moveRightNow(t),this.reporter.update(this,$e.AppearUpdated);break}case Q.Continuous:{this.rectangleAnimation.moveTo(t);break}}}},{key:"setParallaxMargin",value:function setParallaxMargin(e){Cg(this._parallaxMargin,e)||(this._parallaxMargin=Da(e),this.reporter.update(this,$e.AppearUpdated))}},{key:"setSceneMargin",value:function setSceneMargin(e){Cg(this._sceneMargin,e)||(this._sceneMargin=Da(e),this.reporter.update(this,$e.AppearUpdated))}},{key:"release",value:function release(){this.rectangleAnimation.stop(),this.onRemovedDispatcher.dispatch(this)}},{key:"addRemovedListener",value:function addRemovedListener(e){this.onRemovedDispatcher.addListener(e)}},{key:"removeRemovedListener",value:function removeRemovedListener(e){this.onRemovedDispatcher.removeListener(e)}},{key:"addRectangleUpdatedListener",value:function addRectangleUpdatedListener(e){this.onRectangleUpdatedDispatcher.addListener(e)}},{key:"removeRectangleUpdatedListener",value:function removeRectangleUpdatedListener(e){this.onRectangleUpdatedDispatcher.removeListener(e)}}]);return kg}();function La(e){return typeof e=="number"?e:0}function Da(e){return e===void 0||e===0?Jk:typeof e=="number"?Object.freeze({left:e,right:e,top:e,bottom:e}):Object.freeze(B({},e))}function Cg(e,t){return t===void 0?e.top===0&&e.left===0&&e.right===0&&e.bottom===0:typeof t=="number"?e.top===t&&e.left===t&&e.right===t&&e.bottom===t:e.top===t.top&&e.left===t.left&&e.right===t.right&&e.bottom===t.bottom}var tC=/*#__PURE__*/function(_kg){_inherits(tC,_kg);var _super46=_createSuper(tC);function tC(e,t,i,r){var _this176;_classCallCheck(this,tC);_this176=_super46.call(this,e,r,i);_this176.group=new xg(e,t,i),_this176._scale=Wi(r.scale,1);return _this176}_createClass(tC,[{key:"kind",get:function get(){return Ci.Group}},{key:"scale",get:function get(){return this._scale},set:function set(e){this._scale!==e&&(this._scale=e)}},{key:"components",get:function get(){return this.group.components}},{key:"removeComponent",value:function removeComponent(e){return this.group.removeComponent(e)}},{key:"reportChildOrderUpdate",value:function reportChildOrderUpdate(){this.group.reportChildOrderUpdate()}},{key:"addComponent",value:function addComponent(e){return this.group.addComponent(e)}},{key:"addComponentGroup",value:function addComponentGroup(e){return this.group.addComponentGroup(e)}}]);return tC}(kg),Lh=/*#__PURE__*/function(){function Lh(e){_classCallCheck(this,Lh);if(this.engineNodes={},this.enginesCache=null,this.id="".concat(Lh.nextId),this.name=e.name,Lh.nextId+=1,typeof e.hitTest=="boolean"){var t=e.hitTest;this.hitTest=function(){return t}}else e.hitTest?this.hitTest=e.hitTest:this.hitTest=function(){return!0}}_createClass(Lh,[{key:"engines",get:function get(){if(!this.enginesCache){var e=[],t=[];for(var i in this.engineNodes){var _r98=this.engineNodes[i].engine;_r98.orderIndex===void 0?t.push(_r98):e.push(_r98)}e.sort(function(i,r){return i.orderIndex-r.orderIndex}),this.enginesCache=Object.freeze([].concat(e,t))}return this.enginesCache}},{key:"addEngine",value:function addEngine(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this.enginesCache)throw new Error("definition is frozon. you can only do it before bind with screen");if(!(e instanceof Us))throw new Error("it is not RenderEngine");this.engineNodes[e.id]=Object.freeze({engine:e,options:Object.freeze({isVisible:Wi(t.isVisible,!0)})})}},{key:"options",value:function options(e){var t;return(t=this.engineNodes[e.id])==null?void 0:t.options}}]);return Lh}(),Kn=Lh;Kn.nextId=0;var Dh=/*#__PURE__*/function(_kg2){_inherits(Dh,_kg2);var _super47=_createSuper(Dh);function Dh(e,t,i){var _this177;_classCallCheck(this,Dh);_this177=_super47.call(this,e,t,i);if(_this177.visibleMap={},_this177.visibleCount=0,!(t.definition instanceof Kn))throw new Error("it is not ComponentDefinition");_this177.definition=t.definition,_this177._payload=t.payload;var _iterator179=_createForOfIteratorHelper(_this177.definition.engines),_step179;try{for(_iterator179.s();!(_step179=_iterator179.n()).done;){var _r99=_step179.value;var _this177$definition$o=_this177.definition.options(_r99),n=_this177$definition$o.isVisible;n&&(_this177.visibleCount+=1),_this177.visibleMap[_r99.id]=n}}catch(err){_iterator179.e(err)}finally{_iterator179.f()}return _this177}_createClass(Dh,[{key:"kind",get:function get(){return Ci.Component}},{key:"payload",get:function get(){return this._payload},set:function set(e){e!==this._payload&&(this._payload=e,this.reporter.update(this,$e.PropertiesUpdated))}},{key:"isVisible",value:function isVisible(e){return typeof e=="number"?this.visibleMap[e]||!1:e?this.visibleMap[e.id]||!1:this.visibleCount>0}},{key:"setVisible",value:function setVisible(e,t){var i;if(typeof e=="number"?i="".concat(e):i=e.id,this.visibleMap[i]!==void 0&&this.visibleMap[i]!==t){var _r100=this.visibleCount===0;this.visibleMap[i]=t,t?this.visibleCount+=1:this.visibleCount-=1;var n=this.visibleCount===0;_r100===n?this.reporter.update(this,$e.VisibleUpdated):this.reporter.update(this,$e.AppearUpdated)}}}]);return Dh}(kg),xg=/*#__PURE__*/function(){function xg(e,t,i){_classCallCheck(this,xg);this.shouldSort=!1,this.reporter=e,this.tree=t,this.treeNode=i}_createClass(xg,[{key:"components",get:function get(){this.sortIfNeed();var e=[];var _iterator180=_createForOfIteratorHelper(this.treeNode),_step180;try{for(_iterator180.s();!(_step180=_iterator180.n()).done;){var t=_step180.value;e.push(t.value)}}catch(err){_iterator180.e(err)}finally{_iterator180.f()}return e}},{key:"reportChildOrderUpdate",value:function reportChildOrderUpdate(){this.shouldSort=!0,this.reporter.sortGroup(this)}},{key:"sortIfNeed",value:function sortIfNeed(){this.shouldSort&&(this.shouldSort=!1,this.tree.sort(this.treeNode,function(e,t){var i=e.value.orderIndex,r=t.value.orderIndex;return i!==void 0&&r!==void 0?i-r:i!==void 0?-1:r!==void 0?1:e.id.localeCompare(t.id)}))}},{key:"removeComponent",value:function removeComponent(e){return this.treeNode===e.treeNode.parent?(this.tree.remove(e.treeNode),this.reporter.update(e,$e.Removed),e.release(),!0):!1}},{key:"addComponent",value:function addComponent(e){var t=this.tree.wrapLeaf(),i=new Dh(this.reporter,e,t);return this.addNode(t,i)}},{key:"addComponentGroup",value:function addComponentGroup(e){var t=this.tree.wrapGroup(),i=new tC(this.reporter,this.tree,t,e);return this.addNode(t,i)}},{key:"addNode",value:function addNode(e,t){return e.value=t,this.tree.append(e,this.treeNode),this.reporter.update(t,$e.Added),t}}]);return xg}(),Fh=/*#__PURE__*/function(_xg){_inherits(Fh,_xg);var _super48=_createSuper(Fh);function Fh(e,t,i,r,n){var _this178;_classCallCheck(this,Fh);_this178=_super48.call(this,r,n,n.root);_this178.componentUpdateDispatcher=new Zt,_this178.groupSortedDispatcher=new Zt,_this178.deviceType=e,_this178.logger=t,_this178.legacy=i;return _this178}_createClass(Fh,[{key:"createScreen",value:function createScreen(e){return new qk({scene:this,context:e.context,className:e.className,autoResize:!!e.autoResize,width:Gs(e.width,0),height:Gs(e.height,0),engines:this.collectEngines(e),eventInterrupter:e.eventInterrupter||function(){return!1},wrappedComponents:e.wrappedComponents||[],onRenderDuration:e.onRenderDuration})}},{key:"collectEngines",value:function collectEngines(e){var t;if(e.engines){t={};var _iterator181=_createForOfIteratorHelper(e.engines),_step181;try{for(_iterator181.s();!(_step181=_iterator181.n()).done;){var n=_step181.value;if(!(n instanceof Us))throw new Error("it is not RenderEngine");t[n.id]=n}}catch(err){_iterator181.e(err)}finally{_iterator181.f()}}else t=this.legacy.engines;var i=[],r=[];for(var _n40 in t){var s=t[_n40];s.orderIndex===void 0?r.push(s):i.push(s)}return Object.freeze([].concat(i,r))}},{key:"getEngineWithLegacyLayout",value:function getEngineWithLegacyLayout(e){for(var t in this.legacy.engines){var i=this.legacy.engines[t];if(i.orderIndex===e)return i}}},{key:"addComponentUpdateListener",value:function addComponentUpdateListener(e){this.componentUpdateDispatcher.addListener(e)}},{key:"removeComponentUpdateListener",value:function removeComponentUpdateListener(e){this.componentUpdateDispatcher.removeListener(e)}},{key:"reportComponentUpdate",value:function reportComponentUpdate(e,t){this.componentUpdateDispatcher.dispatch({node:e,behavior:t})}},{key:"addGroupSortedListener",value:function addGroupSortedListener(e){this.groupSortedDispatcher.addListener(e)}},{key:"removeGroupSortedListener",value:function removeGroupSortedListener(e){this.groupSortedDispatcher.removeListener(e)}}],[{key:"create",value:function create(e,t,i){var r,n=new $0,s={update:function update(o,a){return r.reportComponentUpdate(o,a)},sortGroup:function sortGroup(o){return r.groupSortedDispatcher.dispatch(o)}};return r=new Fh(e,t,i,s,n),n.root.value=r,r}}]);return Fh}(xg),Se;(function(e){e.Desktop="desktop",e.Touch="touch",e.Surface="surface"})(Se||(Se={}));var qs=/*#__PURE__*/function(){function qs(e){_classCallCheck(this,qs);this.deviceType=e}_createClass(qs,[{key:"createScene",value:function createScene(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:qs.createDefaultLogger();return Fh.create(this.deviceType,e,new Sg([]))}},{key:"createSceneWithLegacyLayoutDescriptions",value:function createSceneWithLegacyLayoutDescriptions(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:qs.createDefaultLogger();return Fh.create(this.deviceType,t,new Sg(e))}}],[{key:"createDefaultLogger",value:function createDefaultLogger(){return zs(new Gn,"Boundless")}}]);return qs}(),hi;(function(e){e.Centering="centering",e.Tailor="tailor"})(hi||(hi={}));function Bh(e){return new Kn(e)}var Ci;(function(e){e[e.Group=0]="Group",e[e.Component=1]="Component"})(Ci||(Ci={}));var jh;(function(e){e[e.Unchanged=0]="Unchanged",e[e.Overlay=1]="Overlay",e[e.Changed=2]="Changed"})(jh||(jh={}));var Jr;(function(e){e[e.Directly=0]="Directly",e[e.GenerateCache=1]="GenerateCache",e[e.Overlay=2]="Overlay",e[e.OverlayOnCache=3]="OverlayOnCache"})(Jr||(Jr={}));var di;(function(e){e.Begin="Begin",e.End="End"})(di||(di={}));var Q;(function(e){e.Continuous="continuous",e.Immediately="immediately"})(Q||(Q={}));function Xn(e,t,i){return e+(t-e)*i}function Ig(e,t){var i=Math.sqrt(e*e+t*t);return i===0?{x:1,y:0}:{x:e/i,y:t/i}}function Pg(e,t,i,r){var n=e-i,s=t-r;return Math.sqrt(n*n+s*s)}var en;(function(e){e[e.HTML=0]="HTML",e[e.SVG=1]="SVG",e[e.CANVAS=2]="CANVAS"})(en||(en={}));var Zs;(function(e){e[e.AbsoluteSize=0]="AbsoluteSize",e[e.RelativeSize=1]="RelativeSize",e[e.Screen=2]="Screen"})(Zs||(Zs={}));var WI=x(require("mobx")),HI=x(require("mobx-react"));var Jd={};No(Jd,{EmuToPt:function EmuToPt(){return rn},EmuToPx:function EmuToPx(){return Tt},RenderMode:function RenderMode(){return al},Slide:function Slide(){return Ky},disableAutoPlayKey:function disableAutoPlayKey(){return m2},loadPPT:function loadPPT(){return ob},playLastStepKey:function playLastStepKey(){return f2},previewPPT:function previewPPT(){return Zd},sequenceIndexesKey:function sequenceIndexesKey(){return p2},toNumber:function toNumber(){return qn},toPt:function toPt(){return I}});var Xi=x(require("react")),cy=x(require("eventemitter3")),co=x(require("react")),J=x(require("color")),hy=x(require("@netless/xml-js")),ze=x(require("react")),xd=x(require("react")),on=x(require("react")),an=x(require("react")),At=x(require("react"));var Eg=x(require("mathjs")),Js,Fa,iC=Object.defineProperty,rC=Object.defineProperties,nC=Object.getOwnPropertyDescriptors,Mg=Object.getOwnPropertySymbols,sC=Object.prototype.hasOwnProperty,oC=Object.prototype.propertyIsEnumerable,Tg=function Tg(e,t,i){return t in e?iC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Gi=function Gi(e,t){for(var i in t||(t={})){sC.call(t,i)&&Tg(e,i,t[i])}if(Mg){var _iterator182=_createForOfIteratorHelper(Mg(t)),_step182;try{for(_iterator182.s();!(_step182=_iterator182.n()).done;){var i=_step182.value;oC.call(t,i)&&Tg(e,i,t[i])}}catch(err){_iterator182.e(err)}finally{_iterator182.f()}}return e},Ba=function Ba(e,t){return rC(e,nC(t))};(Fa=Js||(Js={}))[Fa.Cmd=1]="Cmd",Fa[Fa.State=2]="State";var vr=/*#__PURE__*/function(){function vr(_ref68){var t=_ref68.playerID,i=_ref68.players,_ref68$effectType=_ref68.effectType,r=_ref68$effectType===void 0?"clickEffect":_ref68$effectType;_classCallCheck(this,vr);this.players=[],this._playerID=t,this.players=i,this.effectType=r,this.repeat=Math.max.apply(Math,_toConsumableArray(i.map(function(n){return n.repeat})).concat([1])),this.duration=Math.max.apply(Math,_toConsumableArray(i.map(function(n){return n.duration})).concat([0])),this.delay=i.length>0?Math.min.apply(Math,_toConsumableArray(i.map(function(n){return n.delay}))):0}_createClass(vr,[{key:"playerID",get:function get(){return this._playerID||(this._playerID="par[".concat(this.players.map(function(t){return t.playerID}).join(","),"]")),this._playerID}},{key:"progressTime",get:function get(){return Math.max.apply(Math,_toConsumableArray(this.players.map(function(t){return t.progressTime})||0))}},{key:"isPlaying",get:function get(){return this.players.some(function(t){return t.isPlaying})}},{key:"isComplete",get:function get(){return this.players.every(function(t){return t.isComplete})}},{key:"play",value:function play(){this.players.forEach(function(t){return t.play()})}},{key:"pause",value:function pause(){this.players.forEach(function(t){return t.pause()})}},{key:"seek",value:function seek(t){if(t>this.progressTime)this.players.forEach(function(i){return i.seek(t)});else if(t<this.progressTime)for(var i=this.players.length-1;i>=0;i--){this.players[i].seek(t)}}},{key:"onFrame",value:function onFrame(t){if(t>this.progressTime)this.players.forEach(function(i){return i.onFrame(t)});else if(t<this.progressTime)for(var i=this.players.length-1;i>=0;i--){this.players[i].onFrame(t)}}},{key:"reset",value:function reset(){for(var t=this.players.length-1;t>=0;t--){this.players[t].reset()}}},{key:"stop",value:function stop(){this.players.forEach(function(t){return t.stop()})}},{key:"stopFinite",value:function stopFinite(){this.players.forEach(function(t){return t.stopFinite()})}}]);return vr}();var _Pt=function Pt(){return(_Pt=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){for(var n in t=arguments[i]){Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}}return e}).apply(this,arguments)};function Uh(e,t){var i={};for(var r in e){Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r])}if(e!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++){t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}}return i}var Ag=function Ag(e,t){return function(i){return Math.max(Math.min(i,t),e)}},ja=function ja(e){return e%1?Number(e.toFixed(5)):e},Og=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,za={test:function test(e){return typeof e=="number"},parse:parseFloat,transform:function transform(e){return e}},eo=_Pt(_Pt({},za),{transform:Ag(0,1)}),Ua=_Pt(_Pt({},za),{"default":1}),Vh=function Vh(e){return{test:function test(t){return typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1},parse:parseFloat,transform:function transform(t){return""+t+e}}},tn=Vh("deg"),to=Vh("%"),V=Vh("px"),Rg=_Pt(_Pt({},to),{parse:function parse(e){return to.parse(e)/100},transform:function transform(e){return to.transform(100*e)}}),aC=Ag(0,255),Wh=function Wh(e){return e.red!==void 0},Hh=function Hh(e){return e.hue!==void 0},Ng=function Ng(e){return function(t){if(typeof t!="string")return t;for(var i={},r=function(s){return s.substring(s.indexOf("(")+1,s.lastIndexOf(")"))}(t).replace(/(,|\/)/g," ").split(/ \s*/),n=0;n<4;n++){i[e[n]]=r[n]!==void 0?parseFloat(r[n]):1}return i}},_h=_Pt(_Pt({},za),{transform:function transform(e){return Math.round(aC(e))}});function $h(e,t){return e.startsWith(t)&&Og.test(e)}var Gh,Va={test:function test(e){return typeof e=="string"?$h(e,"rgb"):Wh(e)},parse:Ng(["red","green","blue","alpha"]),transform:function transform(e){var t=e.red,i=e.green,r=e.blue,n=e.alpha,s=n===void 0?1:n;return function(o){var a=o.red,c=o.green,h=o.blue,d=o.alpha;return"rgba("+a+", "+c+", "+h+", "+(d===void 0?1:d)+")"}({red:_h.transform(t),green:_h.transform(i),blue:_h.transform(r),alpha:ja(eo.transform(s))})}},Kh={test:function test(e){return typeof e=="string"?$h(e,"hsl"):Hh(e)},parse:Ng(["hue","saturation","lightness","alpha"]),transform:function transform(e){var t=e.hue,i=e.saturation,r=e.lightness,n=e.alpha,s=n===void 0?1:n;return function(o){var a=o.hue,c=o.saturation,h=o.lightness,d=o.alpha;return"hsla("+a+", "+c+", "+h+", "+(d===void 0?1:d)+")"}({hue:Math.round(t),saturation:to.transform(ja(i)),lightness:to.transform(ja(r)),alpha:ja(eo.transform(s))})}},Lg=_Pt(_Pt({},Va),{test:function test(e){return typeof e=="string"&&$h(e,"#")},parse:function parse(e){var t="",i="",r="";return e.length>4?(t=e.substr(1,2),i=e.substr(3,2),r=e.substr(5,2)):(t=e.substr(1,1),i=e.substr(2,1),r=e.substr(3,1),t+=t,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:1}}}),xi={test:function test(e){return typeof e=="string"&&Og.test(e)||Wh(e)||Hh(e)},parse:function parse(e){return Va.test(e)?Va.parse(e):Kh.test(e)?Kh.parse(e):Lg.test(e)?Lg.parse(e):e},transform:function transform(e){return Wh(e)?Va.transform(e):Hh(e)?Kh.transform(e):e}},Xh=function Xh(e){return e},_t=(Gh=function Gh(e,t,i){return Math.min(Math.max(i,e),t)},function(e,t,i){return i!==void 0?Gh(e,t,i):function(r){return Gh(e,t,r)}});_t(0,1);var lC=typeof performance!="undefined"?function(){return performance.now()}:function(){return Date.now()},Dg=typeof window!="undefined"?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout(function(){return e(lC())},16.666666666666668)},Yh=!0,io=!1,Qh=!1,Wa={delta:0,timestamp:0},Ha=["read","update","preRender","render","postRender"],qh=Ha.reduce(function(e,t){var i,r,n,s,o,a,c;return e[t]=(i=function i(){return io=!0},r=[],n=[],s=0,o=!1,a=new WeakSet,c={schedule:function schedule(h,d,u){d===void 0&&(d=!1),u===void 0&&(u=!1);var p=u&&o,f=p?r:n;return d&&a.add(h),f.indexOf(h)===-1&&(f.push(h),p&&o&&(s=r.length)),h},cancel:function cancel(h){var d=n.indexOf(h);d!==-1&&n.splice(d,1),a["delete"](h)},process:function process(h){var d;if(o=!0,r=(d=[n,r])[0],(n=d[1]).length=0,s=r.length)for(var u=0;u<s;u++){var p=r[u];p(h),a.has(p)&&(c.schedule(p),i())}o=!1}}),e},{}),Ki=Ha.reduce(function(e,t){var i=qh[t];return e[t]=function(r,n,s){return n===void 0&&(n=!1),s===void 0&&(s=!1),io||hC(),i.schedule(r,n,s)},e},{}),_a=Ha.reduce(function(e,t){return e[t]=qh[t].cancel,e},{}),cC=function cC(e){return qh[e].process(Wa)},Fg=function Fg(e){io=!1,Wa.delta=Yh?16.666666666666668:Math.max(Math.min(e-Wa.timestamp,40),1),Wa.timestamp=e,Qh=!0,Ha.forEach(cC),Qh=!1,io&&(Yh=!1,Dg(Fg))},hC=function hC(){io=!0,Yh=!0,Qh||Dg(Fg)},Yn=/*#__PURE__*/function(){function Yn(_ref69){var t=_ref69.playerID,i=_ref69.players,_ref69$effectType=_ref69.effectType,r=_ref69$effectType===void 0?"clickEffect":_ref69$effectType,n=_ref69.repeat,_ref69$rewind=_ref69.rewind,s=_ref69$rewind===void 0?!1:_ref69$rewind,_ref69$reverse=_ref69.reverse,o=_ref69$reverse===void 0?!1:_ref69$reverse,_ref69$delay=_ref69.delay,a=_ref69$delay===void 0?0:_ref69$delay;_classCallCheck(this,Yn);this.players=[],this.progressTime=0,this.loopCount=0,this.elapsed=0,this._playerID=t,this.players=i,this.effectType=r,this.roundDuration=Math.max.apply(Math,_toConsumableArray(i.map(function(c){return c.duration})).concat([0])),this.repeat=n!=null?Math.max(1,n):Math.max.apply(Math,_toConsumableArray(i.map(function(c){return c.repeat})).concat([1])),this.rewind=s,this.reverse=o,this.delay=a,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat}_createClass(Yn,[{key:"playerID",get:function get(){return this._playerID||(this._playerID="par-plus[".concat(this.players.map(function(t){return t.playerID}).join(","),"]")),this._playerID}},{key:"isPlaying",get:function get(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function get(){return this.progressTime>=this.duration}},{key:"play",value:function play(){var _this179=this;this.isPlaying||this.isComplete||(this.frameProcess=Ki.update(function(_ref70){var t=_ref70.delta;if(_this179.progressTime+=t,!(_this179.progressTime<=_this179.delay)&&(_this179.elapsed+=t,_this179.update(),_this179.isPlaying&&_this179.elapsed>_this179.roundDuration)){if(_this179.loopCount<_this179.loop)return _this179.elapsed=0,void(_this179.loopCount+=1);_this179.pause()}},!0))}},{key:"pause",value:function pause(){this.frameProcess&&(_a.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function seek(t){var i=this.progressTime;this.progressTime=_t(0,this.duration,t),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var r=this.reverse&&this.loopCount%2!=0,n=r?this.roundDuration-this.elapsed:this.elapsed;if(i>t||r)for(var s=this.players.length-1;s>=0;s--){this.players[s].seek(n)}else i<t&&this.players.forEach(function(s){return s.seek(n)})}},{key:"onFrame",value:function onFrame(t){var i=this.progressTime;this.progressTime=_t(0,this.duration,t),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var r=this.reverse&&this.loopCount%2!=0,n=r?this.roundDuration-this.elapsed:this.elapsed;if(i>t||r)for(var s=this.players.length-1;s>=0;s--){this.players[s].onFrame(n)}else i<t&&this.players.forEach(function(s){return s.onFrame(n)})}},{key:"reset",value:function reset(){if(this.progressTime>0){this.pause(),this.loopCount=0,this.elapsed=0,this.progressTime=0;for(var t=this.players.length-1;t>=0;t--){this.players[t].reset()}}}},{key:"stop",value:function stop(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function stopFinite(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function update(){var _this180=this;if(this.reverse&&this.loopCount%2!=0)for(var t=this.players.length-1;t>=0;t--){this.players[t].onFrame(this.roundDuration-this.elapsed)}else this.players.forEach(function(t){return t.onFrame(_this180.elapsed)})}}]);return Yn}(),ro=/*#__PURE__*/function(){function ro(_ref71){var t=_ref71.playerID,i=_ref71.players,_ref71$effectType=_ref71.effectType,r=_ref71$effectType===void 0?"clickEffect":_ref71$effectType;_classCallCheck(this,ro);var n,s;this.players=[],this.index=0,this.progressTime=0,this._playerIndex=0,this.elapsed=0,this._playerID=t,this.players=i,this.effectType=r,this.duration=i.reduce(function(o,a){return o+a.duration},0),this.delay=(s=(n=this.players[0])==null?void 0:n.delay)!=null?s:0,this.blocks=[],this.indexBlocks=[];for(var o=0;o<this.players.length;o++){o!==0&&this.players[o].effectType!=="clickEffect"||this.blocks.push(o),this.indexBlocks.push(this.blocks.length-1)}}_createClass(ro,[{key:"playerID",get:function get(){return this._playerID||(this._playerID="seq[".concat(this.players.map(function(t){return t.playerID}).join(","),"]")),this._playerID}},{key:"length",get:function get(){return this.blocks.length}},{key:"currentPlayer",get:function get(){return this.players[this._playerIndex]}},{key:"isPlaying",get:function get(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function get(){return this.index>=this.blocks.length}},{key:"repeat",get:function get(){var t,i;return(i=(t=this.currentPlayer)==null?void 0:t.repeat)!=null?i:1}},{key:"play",value:function play(){var _this181=this;!this.currentPlayer||this.isPlaying||this.isComplete||(this.currentPlayer.play(),this.frameProcess=Ki.update(function(_ref72){var t=_ref72.delta;var i;var r=_this181.currentPlayer;if(r){if(_this181.elapsed+=t,_this181.progressTime+=t,r.isPlaying||r.play(),_this181.elapsed>r.duration){_this181._playerIndex<_this181.players.length&&(_this181._playerIndex+=1,_this181.elapsed=0,_this181.index=(i=_this181.indexBlocks[_this181._playerIndex])!=null?i:_this181.blocks.length);var n=_this181.players[_this181._playerIndex];if(n&&n.effectType!=="clickEffect")return void n.play();_this181.stopTimer()}}else _this181.stopTimer()},!0))}},{key:"pause",value:function pause(){var t;(t=this.currentPlayer)==null||t.pause(),this.stopTimer()}},{key:"seek",value:function seek(t){var i,r;if(t>this.duration){this.pause();for(var s=this._playerIndex;s<this.players.length;s++){var o=this.players[s];o.seek(o.duration)}this.progressTime=this.duration,this.elapsed=0,this._playerIndex=this.players.length,this.index=this.blocks.length}this.progressTime=_t(0,this.duration,t),this.elapsed=this.progressTime;var n=0;for(;n<this.players.length;){var _s29=this.players[n];if(this.elapsed<=_s29.duration)break;this.elapsed-=_s29.duration,n++}if(this._playerIndex<n){for(var _s30=this._playerIndex;_s30<n;_s30++){var _o20=this.players[_s30];!Number.isFinite(_o20.repeat)&&_o20.isPlaying||_o20.seek(_o20.duration)}(i=this.players[n])==null||i.seek(this.elapsed)}else if(this._playerIndex>n)for(var _s31=this.safePlayerIndex(this._playerIndex);_s31>=n;_s31--){var _o21=this.players[_s31];_s31===n?(_o21.pause(),_o21.seek(this.elapsed)):_o21.reset()}this._playerIndex=n,this.index=(r=this.indexBlocks[this._playerIndex])!=null?r:this.blocks.length}},{key:"onFrame",value:function onFrame(t){throw new Error("onFrame not implemented in seq player")}},{key:"reset",value:function reset(){if(this.progressTime>0&&this.players.length>0)for(var t=this.safePlayerIndex(this._playerIndex);t>=0;t--){this.players[t].reset()}this._playerIndex=0,this.index=0,this.progressTime=0,this.elapsed=0}},{key:"stop",value:function stop(){this.pause(),this.seek(this.duration+1)}},{key:"stopFinite",value:function stopFinite(){this.players.forEach(function(t){return t.stopFinite()})}},{key:"seekIndex",value:function seekIndex(t){var i;this.seekPlayerIndex((i=this.blocks[t])!=null?i:this.players.length)}},{key:"next",value:function next(){this.elapsed>0&&this.seekIndex(this.index+1),this.play()}},{key:"back",value:function back(){this.pause(),this.progressTime<=0||(this.seekIndex(this.elapsed>0?this.index:this.index-1),this.pause())}},{key:"stopTimer",value:function stopTimer(){this.frameProcess&&(_a.update(this.frameProcess),this.frameProcess=void 0)}},{key:"safePlayerIndex",value:function safePlayerIndex(t){return Math.min(t,this.players.length-1)}},{key:"seekPlayerIndex",value:function seekPlayerIndex(t){var i;if(t=_t(0,this.players.length,t),this._playerIndex<t)for(var _r101=this._playerIndex;_r101<t;_r101++){this.players[_r101].stopFinite()}else for(var _r102=this.safePlayerIndex(this._playerIndex);_r102>=t;_r102--){this.players[_r102].reset()}this.progressTime=this.getProgressTimeByPlayerIndex(t),this._playerIndex=t,this.index=(i=this.indexBlocks[t])!=null?i:this.blocks.length,this.elapsed=0}},{key:"getProgressTimeByPlayerIndex",value:function getProgressTimeByPlayerIndex(t){var i=0;for(var _r103=0;_r103<t;_r103++){i+=this.players[_r103].duration}return i}}]);return ro}();function dC(e,t){return function(i){return t(e(i))}}function Sr(e,t,i){return(t-e)*i+e}var Bg={exports:{}},jg={exports:{}},uC=function uC(e){return!(!e||typeof e=="string")&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&e.constructor.name!=="String"))},pC=Array.prototype.concat,mC=Array.prototype.slice,zg=jg.exports=function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];uC(n)?t=pC.call(t,mC.call(n)):t.push(n)}return t};zg.wrap=function(e){return function(){return e(zg(arguments))}};var $a={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},no=jg.exports,Ug={};for(Ga in $a){$a.hasOwnProperty(Ga)&&(Ug[$a[Ga]]=Ga)}var Ga,$t=Bg.exports={to:{},get:{}};function wr(e,t,i){return Math.min(Math.max(t,e),i)}function Ka(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}$t.get=function(e){var t,i;switch(e.substring(0,3).toLowerCase()){case"hsl":t=$t.get.hsl(e),i="hsl";break;case"hwb":t=$t.get.hwb(e),i="hwb";break;default:t=$t.get.rgb(e),i="rgb";}return t?{model:i,value:t}:null},$t.get.rgb=function(e){if(!e)return null;var t,i,r,n=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=t[2],t=t[1],i=0;i<3;i++){var s=2*i;n[i]=parseInt(t.slice(s,s+2),16)}r&&(n[3]=parseInt(r,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(r=(t=t[1])[3],i=0;i<3;i++){n[i]=parseInt(t[i]+t[i],16)}r&&(n[3]=parseInt(r+r,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(i=0;i<3;i++){n[i]=parseInt(t[i+1],0)}t[4]&&(n[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?t[1]==="transparent"?[0,0,0,0]:(n=$a[t[1]])?(n[3]=1,n):null:null;for(i=0;i<3;i++){n[i]=Math.round(2.55*parseFloat(t[i+1]))}t[4]&&(n[3]=parseFloat(t[4]))}for(i=0;i<3;i++){n[i]=wr(n[i],0,255)}return n[3]=wr(n[3],0,1),n},$t.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var i=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,wr(parseFloat(t[2]),0,100),wr(parseFloat(t[3]),0,100),wr(isNaN(i)?1:i,0,1)]}return null},$t.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var i=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,wr(parseFloat(t[2]),0,100),wr(parseFloat(t[3]),0,100),wr(isNaN(i)?1:i,0,1)]}return null},$t.to.hex=function(){var e=no(arguments);return"#"+Ka(e[0])+Ka(e[1])+Ka(e[2])+(e[3]<1?Ka(Math.round(255*e[3])):"")},$t.to.rgb=function(){var e=no(arguments);return e.length<4||e[3]===1?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},$t.to.rgb.percent=function(){var e=no(arguments),t=Math.round(e[0]/255*100),i=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||e[3]===1?"rgb("+t+"%, "+i+"%, "+r+"%)":"rgba("+t+"%, "+i+"%, "+r+"%, "+e[3]+")"},$t.to.hsl=function(){var e=no(arguments);return e.length<4||e[3]===1?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},$t.to.hwb=function(){var e=no(arguments),t="";return e.length>=4&&e[3]!==1&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},$t.to.keyword=function(e){return Ug[e.slice(0,3)]};var ui,Xa,fC=Bg.exports;(Xa=ui||(ui={}))[Xa.RGB=0]="RGB",Xa[Xa.HSL=1]="HSL";var so=/*#__PURE__*/function(){function so(t){_classCallCheck(this,so);this.animBox=t,this.$=1}_createClass(so,[{key:"snapshot",get:function get(){if(!this._snapshot){var t=this;this._snapshot={$ppt_x:this.animBox.initState.ppt_x,$ppt_y:this.animBox.initState.ppt_y,$ppt_w:this.animBox.initState.ppt_w,$ppt_h:this.animBox.initState.ppt_h,ppt_x:Number(t.animBox.currentState.ppt_x),ppt_y:Number(t.animBox.currentState.ppt_y),ppt_w:Number(t.animBox.currentState.ppt_w),ppt_h:Number(t.animBox.currentState.ppt_h),get $(){return t.$}}}return this._snapshot}}]);return so}(),kr=/*#__PURE__*/function(){function kr(t,i){_classCallCheck(this,kr);this.expr=t,this.scope=i}_createClass(kr,[{key:"valueOf",value:function valueOf(){var t;return(t=this.value)!=null?t:this.evaluate(1)}},{key:"evaluate",value:function evaluate(t){this.scope.$=t;try{return this.value=this.formula.evaluate(this.scope.snapshot),this.value}catch(i){return console.error(i),t}}},{key:"formula",get:function get(){if(!this._formula)try{this._formula=(0,Eg.compile)(this.expr.replace(/#/g,"$"))}catch(t){console.error(t),this._formula={evaluate:function evaluate(i){return i}}}return this._formula}}]);return kr}(),gC=Object.prototype.hasOwnProperty;function Mt(e,t){return gC.call(e,t)}function Gt(e){return e instanceof kr||typeof e=="number"&&!Number.isNaN(e)}function Vg(e){return e/12700+"pt"}function yC(e){return!!(e&&Mt(e,"r")&&Mt(e,"g")&&Mt(e,"b")&&Mt(e,"a"))}function bC(e){return!!(e&&Mt(e,"h")&&Mt(e,"s")&&Mt(e,"l")&&Mt(e,"a"))}var me=/*#__PURE__*/function(){function me(t){_classCallCheck(this,me);if(typeof t=="string"){var i=fC.get(t);if(i){var _r104=i.model,n=i.value;switch(_r104){case"hsl":return this.model=ui.HSL,void(this._hslCache={h:n[0],s:n[1],l:n[2],a:n[3]});case"rgb":return this.model=ui.RGB,void(this._rgbCache={r:n[0],g:n[1],b:n[2],a:n[3]});}}}else{if(yC(t))return this.model=ui.RGB,this._rgbCache=t,void(this._hslCache=void 0);if(bC(t))return this.model=ui.HSL,this._hslCache=t,void(this._rgbCache=void 0)}throw new TypeError("[Animatic] incorrect color: ".concat(t))}_createClass(me,[{key:"rgb",get:function get(){if(!this._rgbCache){if(!this._hslCache)throw new Error("[Animatic] No color available");this._rgbCache=this.hslToRgb(this._hslCache)}return this._rgbCache}},{key:"hsl",get:function get(){if(!this._hslCache){if(!this._rgbCache)throw new Error("[Animatic] No color available");this._hslCache=this.rbgToHsl(this._rgbCache)}return this._hslCache}},{key:"toString",value:function toString(){if(this.model===ui.HSL){var _this$hsl=this.hsl,s=_this$hsl.h,o=_this$hsl.s,a=_this$hsl.l,c=_this$hsl.a;return"hsla(".concat(s,",").concat(o,",").concat(a,",").concat(c,")")}var _this$rgb=this.rgb,t=_this$rgb.r,i=_this$rgb.g,r=_this$rgb.b,n=_this$rgb.a;return"rgba(".concat(t,",").concat(i,",").concat(r,",").concat(n,")")}},{key:"lighten",value:function lighten(t){var i=this.hsl;return new me(Ba(Gi({},i),{l:_t(0,100,i.l*(1+t))}))}},{key:"darken",value:function darken(t){var i=this.hsl;return new me(Ba(Gi({},i),{l:_t(0,100,i.l*(1-t))}))}},{key:"alpha",value:function alpha(t){var i=this.model===ui.HSL?this.hsl:this.rgb;if(t==null)return i.a;var r=_t(0,1,t);return r===i.a?this:new me(Ba(Gi({},i),{a:r}))}},{key:"rbgToHsl",value:function rbgToHsl(t){var i=t.r/255,r=t.g/255,n=t.b/255,s=Math.min(i,r,n),o=Math.max(i,r,n),a=o-s,c=0,h=0;o===s?c=0:i===o?c=(r-n)/a:r===o?c=2+(n-i)/a:n===o&&(c=4+(i-r)/a),c=Math.min(60*c,360),c<0&&(c+=360);var d=(s+o)/2;return h=o===s?0:d<=.5?a/(o+s):a/(2-o-s),{h:c,s:100*h,l:100*d,a:t.a}}},{key:"hslToRgb",value:function hslToRgb(t){var i=t.s/100,r=t.l/100;if(i===0){var d=255*r;return{r:d,g:d,b:d,a:t.a}}var n=t.h/360,s,o,a;s=r<.5?r*(1+i):r+i-r*i;var c=2*r-s,h=[0,0,0];for(var _d7=0;_d7<3;_d7++){o=n+1/3*-(_d7-1),o<0&&o++,o>1&&o--,a=6*o<1?c+6*(s-c)*o:2*o<1?s:3*o<2?c+(s-c)*(2/3-o)*6:c,h[_d7]=255*a}return{r:h[0],g:h[1],b:h[2],a:t.a}}}]);return me}();function Zh(e,t,i){if(e.model===ui.HSL||t.model===ui.HSL){var _r105=e.hsl,n=t.hsl;return new me({h:Sr(_r105.h,n.h,i),s:Sr(_r105.s,n.s,i),l:Sr(_r105.l,n.l,i),a:Sr(_r105.a,n.a,i)})}{var _r106=e.rgb,_n41=t.rgb;return new me({r:Jh(_r106.r,_n41.r,i),g:Jh(_r106.g,_n41.g,i),b:Jh(_r106.b,_n41.b,i),a:Sr(_r106.a,_n41.a,i)})}}function Jh(e,t,i){var r=e*e,n=t*t;return Math.sqrt(Math.max(0,i*(n-r)+r))}function ed(e,t){var i=Object.keys(t),r=i.reduce(function(n,s){switch(s){case"visible":{var o=e[s],a=t[s];n[s]=function(c){return c<=0?o:a};break}case"fillcolor":{var _o22=e[s],_a19=t[s];if(!_o22||!_a19)throw new Error("Mismatch color animation (Key: ".concat(s,", From: ").concat(_o22,", To: ").concat(_a19,")"));n[s]=function(c){return Zh(_o22,_a19,c)};break}default:{var _o23=e[s],_a20=t[s];if(!Gt(_o23)||!Gt(_a20))throw new Error("Mismatch number animation (Key: ".concat(s,", From: ").concat(_o23,", To: ").concat(_a20,")"));n[s]=function(c){return Sr(_o23,_a20,c)};break}}return n},{});return function(n){return i.reduce(function(s,o){var a;var c=(a=r[o])==null?void 0:a.call(r,n);return c!=null&&(s[o]=c),s},{})}}function Ii(e,t){var i;return function(r){return i||(i=ed(e(),t)),i(r)}}var Ge=/*#__PURE__*/function(){function Ge(_ref73){var t=_ref73.animBox,i=_ref73.eventSource,r=_ref73.playerID,_ref73$effectType=_ref73.effectType,n=_ref73$effectType===void 0?"clickEffect":_ref73$effectType,s=_ref73.duration,o=_ref73.transform,_ref73$ease=_ref73.ease,a=_ref73$ease===void 0?Xh:_ref73$ease,_ref73$repeat=_ref73.repeat,c=_ref73$repeat===void 0?0:_ref73$repeat,_ref73$rewind=_ref73.rewind,h=_ref73$rewind===void 0?!1:_ref73$rewind,_ref73$reverse=_ref73.reverse,d=_ref73$reverse===void 0?!1:_ref73$reverse,_ref73$delay=_ref73.delay,u=_ref73$delay===void 0?0:_ref73$delay,_ref73$by=_ref73.by,p=_ref73$by===void 0?!1:_ref73$by;_classCallCheck(this,Ge);this.progressTime=0,this.loopCount=0,this.fvTime=0,this.elapsed=0,this.animBox=t,this.eventSource=i,this.playerID=r,this.effectType=n,this.roundDuration=s,this.ease=a,this.repeat=Math.max(1,c),this.rewind=h,this.reverse=d,this.delay=u,this.by=p,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat,this.transform=dC(a,o!=null?o:this.noopTransform)}_createClass(Ge,[{key:"isPlaying",get:function get(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function get(){return this.progressTime>=this.duration}},{key:"play",value:function play(){var _this182=this;this.isPlaying||this.isComplete||(this.preAnimationState||(this.preAnimationState=Gi({},this.animBox.currentPureState)),this.frameProcess=Ki.update(function(_ref74){var t=_ref74.delta;if(_this182.progressTime+=t,_this182.progressTime<=_this182.delay)_this182.fvTime=0;else if(_this182.fvTime<=0&&(_this182.fvTime=Date.now()),_this182.elapsed+=t,_this182.update(),_this182.isPlaying&&_this182.elapsed>_this182.roundDuration){if(_this182.loopCount<_this182.loop)return _this182.elapsed=0,void(_this182.loopCount+=1);_this182.pause()}},!0))}},{key:"pause",value:function pause(){this.frameProcess&&(_a.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function seek(t){var _this183=this;this.preAnimationState||(this.preAnimationState=Gi({},this.animBox.currentPureState)),t<=0&&(this.fvTime=0),this.progressTime=_t(0,this.duration,t),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1),Ki.update(function(){return _this183.update()},!1,!1)}},{key:"onFrame",value:function onFrame(t){if(t<=0){if(this.progressTime<=0)return;this.fvTime=0}if(!(t>=this.duration&&this.progressTime>=this.duration)){if(this.preAnimationState||(this.preAnimationState=Gi({},this.animBox.currentPureState)),this.progressTime=_t(0,this.duration,t),this.progressTime<=this.delay)return this.loopCount=0,this.elapsed=0,void(this.by&&this.update());this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration),this.reverse?this.elapsed=(this.progressTime-this.delay)%this.roundDuration:this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1,this.update()}}},{key:"reset",value:function reset(){var _this184=this;this.progressTime>0&&(this.pause(),this.loopCount=0,this.fvTime=0,this.elapsed=0,this.progressTime=0),this.preAnimationState&&Ki.update(function(){_this184.preAnimationState&&(_this184.animBox.resetState(_this184.playerID,_this184.preAnimationState),_this184.preAnimationState=void 0)},!1,!1)}},{key:"stop",value:function stop(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function stopFinite(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function update(){var t=_t(0,1,this.elapsed/this.roundDuration),i=this.transform(this.reverse&&this.loopCount%2!=0?1-t:t);i!=null&&this.animBox.handleStateEvent({type:Js.State,playerID:this.playerID,srcID:this.eventSource,by:this.by,fvTime:this.fvTime,value:i})}},{key:"noopTransform",value:function noopTransform(){return{}}}]);return Ge}(),oo=/*#__PURE__*/function(){function oo(_ref75){var t=_ref75.cmd,i=_ref75.animBox,r=_ref75.eventSource,n=_ref75.playerID,_ref75$effectType=_ref75.effectType,s=_ref75$effectType===void 0?"clickEffect":_ref75$effectType,_ref75$rewind=_ref75.rewind,o=_ref75$rewind===void 0?!1:_ref75$rewind,_ref75$delay=_ref75.delay,a=_ref75$delay===void 0?0:_ref75$delay;_classCallCheck(this,oo);this.repeat=1,this.progressTime=0,this.fvTime=0,this.cmd=t,this.animBox=i,this.eventSource=r,this.playerID=n,this.effectType=s,this.rewind=o,this.delay=a,this.duration=this.delay+1}_createClass(oo,[{key:"isPlaying",get:function get(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function get(){return this.progressTime>=this.duration}},{key:"play",value:function play(){var _this185=this;if(!this.isPlaying&&!this.isComplete)return this.duration===1?(this.progressTime=1,void Ki.update(function(){return _this185.sendEvent()},!1,!1)):void(this.frameProcess=Ki.update(function(_ref76){var t=_ref76.delta;_this185.progressTime+=t,_this185.progressTime<=_this185.delay?_this185.fvTime=0:(_this185.fvTime<=0&&(_this185.fvTime=Date.now()),_this185.sendEvent(),_this185.pause())},!0))}},{key:"pause",value:function pause(){this.frameProcess&&(_a.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function seek(t){t<=0&&(this.fvTime=0),this.progressTime=_t(0,this.duration,t),t<=0&&this.cmd.name!=="pause"&&this.cmd.name!=="stop"&&this.animBox.handleCmdEvent({type:Js.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:Date.now(),value:{name:"pause"}})}},{key:"onFrame",value:function onFrame(t){t<=0&&(this.fvTime=0,this.progressTime<=0)||t>=this.duration&&this.progressTime>=this.duration||(this.progressTime=_t(0,this.duration,t),this.progressTime>=this.delay&&this.sendEvent())}},{key:"reset",value:function reset(){this.progressTime>0&&(this.pause(),this.fvTime=0,this.progressTime=0)}},{key:"stop",value:function stop(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function stopFinite(){Number.isFinite(this.repeat)&&this.stop()}},{key:"sendEvent",value:function sendEvent(){this.animBox.handleCmdEvent({type:Js.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:this.fvTime,value:this.cmd})}}]);return oo}();function td(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.5;if(e.model===ui.HSL&&e.model===t.model){var _r107=e.hsl,n=t.hsl,s=_r107.h,o=n.h;return new me({h:s+i*(o>s&&o-s>180?o-(s+360):o<s&&s-o>180?o+360-s:o-s),s:_r107.s+i*(n.s-_r107.s),l:_r107.l+i*(n.l-_r107.l),a:_r107.a*i+n.a*(1-i)})}{var _r108=e.rgb,_n42=t.rgb,_s32=2*i-1,_o24=_r108.a-_n42.a,a=((_s32*_o24==-1?_s32:(_s32+_o24)/(1+_s32*_o24))+1)/2,c=1-a;return new me({r:a*_r108.r+c*_n42.r,g:a*_r108.g+c*_n42.g,b:a*_r108.b+c*_n42.b,a:_r108.a*i+_n42.a*(1-i)})}}var id=new me({r:0,g:0,b:0,a:0}),rd,nd=0,Wg=typeof window!="undefined"&&window.requestAnimationFrame!==void 0?function(e){return window.requestAnimationFrame(e)}:function(e){var t=Date.now(),i=Math.max(0,16.7-(t-nd));nd=t+i,setTimeout(function(){return e(nd)},i)},Hg=1/60*1e3,Ya=!0,ao=!1,sd=!1,lo={delta:0,timestamp:0},od=["read","update","preRender","render","postRender"],vC=function vC(e){return ao=e},_g=od.reduce(function(e,t){var i,r,n,s,o,a,c,h,d;return e[t]=(i=vC,r=[],n=[],s=0,o=!1,a=0,c=new WeakSet,h=new WeakSet,d={cancel:function cancel(u){var p=n.indexOf(u);c.add(u),p!==-1&&n.splice(p,1)},process:function process(u){var p,f;if(o=!0,r=(p=[n,r])[0],(n=p[1]).length=0,s=r.length)for(a=0;a<s;a++){(f=r[a])(u),h.has(f)!==!0||c.has(f)||(d.schedule(f),i(!0))}o=!1},schedule:function schedule(u,p,f){p===void 0&&(p=!1),f===void 0&&(f=!1);var m=f&&o,g=m?r:n;c["delete"](u),p&&h.add(u),g.indexOf(u)===-1&&(g.push(u),m&&(s=r.length))}}),e},{}),SC=od.reduce(function(e,t){var i=_g[t];return e[t]=function(r,n,s){return n===void 0&&(n=!1),s===void 0&&(s=!1),ao||kC(),i.schedule(r,n,s),r},e},{}),wC=function wC(e){return _g[e].process(lo)},$g=function $g(e){ao=!1,lo.delta=Ya?Hg:Math.max(Math.min(e-lo.timestamp,40),1),Ya||(Hg=lo.delta),lo.timestamp=e,sd=!0,od.forEach(wC),sd=!1,ao&&(Ya=!1,Wg($g))},kC=function kC(){ao=!0,Ya=!0,sd||Wg($g)},ad=function ad(e){var t=e.onRead,i=e.onRender,r=e.uncachedValues,n=r===void 0?new Set:r,s=e.useCache,o=s===void 0||s;return function(a){a===void 0&&(a={});var c=Uh(a,[]),h={},d=[],u=!1;function p(m,g){m.startsWith("--")&&(c.hasCSSVariable=!0);var y=h[m];h[m]=g,h[m]!==y&&(d.indexOf(m)===-1&&d.push(m),u||(u=!0,SC.render(f.render)))}var f={get:function get(m,g){return g===void 0&&(g=!1),!g&&o&&!n.has(m)&&h[m]!==void 0?h[m]:t(m,c)},set:function set(m,g){if(typeof m=="string")p(m,g);else for(var y in m){p(y,m[y])}return this},render:function render(m){return m===void 0&&(m=!1),(u||m===!0)&&(i(h,c,d),u=!1,d.length=0),this}};return f}},CC=/([a-z])([A-Z])/g,Qa=function Qa(e){return e.replace(CC,"$1-$2").toLowerCase()},Gg=new Map,ld=new Map,Kg=["Webkit","Moz","O","ms",""],xC=Kg.length,IC=typeof document!="undefined",Xg=function Xg(e,t){return ld.set(e,Qa(t))},Yg=function Yg(e,t){t===void 0&&(t=!1);var i=t?ld:Gg;return i.has(e)||(IC?function(r){rd=rd||document.createElement("div");for(var n=0;n<xC;n++){var s=Kg[n],o=s==="",a=o?r:s+r.charAt(0).toUpperCase()+r.slice(1);if(a in rd.style||o){if(o&&r==="clipPath"&&ld.has(r))return;Gg.set(r,a),Xg(r,(o?"":"-")+Qa(a))}}}(e):function(r){Xg(r,r)}(e)),i.get(e)||e},PC=["","X","Y","Z"],cd=["translate","scale","rotate","skew","transformPerspective"].reduce(function(e,t){return PC.reduce(function(i,r){return i.push(t+r),i},e)},["x","y","z"]),MC=cd.reduce(function(e,t){return e[t]=!0,e},{});function hd(e){return MC[e]===!0}function TC(e,t){return cd.indexOf(e)-cd.indexOf(t)}var EC=new Set(["originX","originY","originZ"]);function AC(e){return EC.has(e)}var Qg=_Pt(_Pt({},za),{transform:Math.round}),OC={color:xi,backgroundColor:xi,outlineColor:xi,fill:xi,stroke:xi,borderColor:xi,borderTopColor:xi,borderRightColor:xi,borderBottomColor:xi,borderLeftColor:xi,borderWidth:V,borderTopWidth:V,borderRightWidth:V,borderBottomWidth:V,borderLeftWidth:V,borderRadius:V,radius:V,borderTopLeftRadius:V,borderTopRightRadius:V,borderBottomRightRadius:V,borderBottomLeftRadius:V,width:V,maxWidth:V,height:V,maxHeight:V,size:V,top:V,right:V,bottom:V,left:V,padding:V,paddingTop:V,paddingRight:V,paddingBottom:V,paddingLeft:V,margin:V,marginTop:V,marginRight:V,marginBottom:V,marginLeft:V,rotate:tn,rotateX:tn,rotateY:tn,rotateZ:tn,scale:Ua,scaleX:Ua,scaleY:Ua,scaleZ:Ua,skew:tn,skewX:tn,skewY:tn,distance:V,translateX:V,translateY:V,translateZ:V,x:V,y:V,z:V,perspective:V,opacity:eo,originX:Rg,originY:Rg,originZ:V,zIndex:Qg,fillOpacity:eo,strokeOpacity:eo,numOctaves:Qg},dd=function dd(e){return OC[e]},RC=function RC(e,t){return t&&typeof e=="number"?t.transform(e):e},qg=new Set(["scrollLeft","scrollTop"]),NC=new Set(["scrollLeft","scrollTop","transform"]),LC={x:"translateX",y:"translateY",z:"translateZ"};function Zg(e){return typeof e=="function"}function DC(e,t,i,r,n,s,o,a){t===void 0&&(t=!0),i===void 0&&(i={}),r===void 0&&(r={}),n===void 0&&(n={}),s===void 0&&(s=[]),o===void 0&&(o=!1),a===void 0&&(a=!0);var c=!0,h=!1,d=!1;for(var u in e){var p=e[u],f=dd(u),m=RC(p,f);hd(u)?(h=!0,r[u]=m,s.push(u),c&&(f["default"]&&p!==f["default"]||!f["default"]&&p!==0)&&(c=!1)):AC(u)?(n[u]=m,d=!0):NC.has(u)&&Zg(m)||(i[Yg(u,o)]=m)}return(h||typeof e.transform=="function")&&(i.transform=function(g,y,b,S,w,P){P===void 0&&(P=!0);var A="",E=!1;b.sort(TC);for(var R=b.length,N=0;N<R;N++){var _=b[N];A+=(LC[_]||_)+"("+y[_]+") ",E=_==="z"||E}return!E&&w?A+="translateZ(0)":A=A.trim(),Zg(g.transform)?A=g.transform(y,S?"":A):P&&S&&(A="none"),A}(e,r,s,c,t,a)),d&&(i.transformOrigin=(n.originX||"50%")+" "+(n.originY||"50%")+" "+(n.originZ||0)),i}function ud(e){var t=e===void 0?{}:e,i=t.enableHardwareAcceleration,r=i===void 0||i,n=t.isDashCase,s=n===void 0||n,o=t.allowTransformNone,a=o===void 0||o,c={},h={},d={},u=[];return function(p){return u.length=0,DC(p,r,c,h,d,u,s,a),c}}var FC=ad({onRead:function onRead(e,t){var i=t.element,r=t.preparseOutput,n=dd(e);if(hd(e))return n&&n["default"]||0;if(qg.has(e))return i[e];var s=window.getComputedStyle(i,null).getPropertyValue(Yg(e,!0))||0;return r&&n&&n.test(s)&&n.parse?n.parse(s):s},onRender:function onRender(e,t,i){var r=t.element,n=t.buildStyles,s=t.hasCSSVariable;if(Object.assign(r.style,n(e)),s)for(var o=i.length,a=0;a<o;a++){var c=i[a];c.startsWith("--")&&r.style.setProperty(c,e[c])}i.indexOf("scrollLeft")!==-1&&(r.scrollLeft=e.scrollLeft),i.indexOf("scrollTop")!==-1&&(r.scrollTop=e.scrollTop)},uncachedValues:qg}),Jg=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues"]),pd=function pd(e,t){return V.transform(e*t)},BC={x:0,y:0,width:0,height:0};function ey(e,t,i){return typeof e=="string"?e:V.transform(t+i*e)}var ty={enableHardwareAcceleration:!1,isDashCase:!1};function jC(e,t,i,r,n,s){t===void 0&&(t=BC),r===void 0&&(r=ud(ty)),n===void 0&&(n={style:{}}),s===void 0&&(s=!0);var o=e.attrX,a=e.attrY,c=e.originX,h=e.originY,d=e.pathLength,u=e.pathSpacing,p=u===void 0?1:u,f=e.pathOffset,m=f===void 0?0:f,g=r(Uh(e,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]));for(var y in g){y==="transform"?n.style.transform=g[y]:n[s&&!Jg.has(y)?Qa(y):y]=g[y]}return(c!==void 0||h!==void 0||g.transform)&&(n.style.transformOrigin=function(b,S,w){return ey(S,b.x,b.width)+" "+ey(w,b.y,b.height)}(t,c!==void 0?c:.5,h!==void 0?h:.5)),o!==void 0&&(n.x=o),a!==void 0&&(n.y=a),i!==void 0&&d!==void 0&&(n[s?"stroke-dashoffset":"strokeDashoffset"]=pd(-m,i),n[s?"stroke-dasharray":"strokeDasharray"]=pd(d,i)+" "+pd(p,i)),n}function zC(e,t,i){i===void 0&&(i=!0);var r={style:{}},n=ud(ty);return function(s){return jC(s,e,t,n,r,i)}}var ft,iy,UC=ad({onRead:function onRead(e,t){var i=t.element;if(hd(e=Jg.has(e)?e:Qa(e))){var r=dd(e);return r&&r["default"]||0}return i.getAttribute(e)},onRender:function onRender(e,t){var i=t.element,r=(0,t.buildAttrs)(e);for(var n in r){n==="style"?Object.assign(i.style,r.style):i.setAttribute(n,r[n])}}}),VC=ad({useCache:!1,onRead:function onRead(e){return e==="scrollTop"?window.pageYOffset:window.pageXOffset},onRender:function onRender(e){var t=e.scrollTop,i=t===void 0?0:t,r=e.scrollLeft,n=r===void 0?0:r;return window.scrollTo(n,i)}}),md=new WeakMap,WC=function WC(e,t){var i,r,n,s;return e===window?i=VC(e):function(o){return o instanceof HTMLElement||typeof o.click=="function"}(e)?i=function(o,a){a===void 0&&(a={});var c=a.enableHardwareAcceleration,h=a.allowTransformNone,d=Uh(a,["enableHardwareAcceleration","allowTransformNone"]);return FC(_Pt({element:o,buildStyles:ud({enableHardwareAcceleration:c,allowTransformNone:h}),preparseOutput:!0},d))}(e,t):function(o){return o instanceof SVGElement||"ownerSVGElement"in o}(e)&&(n=function(o){try{return function(a){return typeof a.getBBox=="function"?a.getBBox():a.getBoundingClientRect()}(o)}catch(a){return{x:0,y:0,width:0,height:0}}}(r=e),s=function(o){return o.tagName==="path"}(r)&&r.getTotalLength?r.getTotalLength():void 0,i=UC({element:r,buildAttrs:zC(n,s)})),md.set(e,i),i};function ry(e,t){return function(i,r){return md.has(i)?md.get(i):WC(i,r)}(typeof e=="string"?document.querySelector(e):e,t)}function HC(e){switch(e){case"rotate":case"scaleX":case"scaleY":case"fillcolor":return!0;default:return!1;}}(iy=ft||(ft={})).Paragraph="anim-p",iy.Text="anim-t";var fd=/*#__PURE__*/function(){function fd(_ref77){var _this186=this;var t=_ref77.target,i=_ref77.pIndex,r=_ref77.tIndex,n=_ref77.constants,_ref77$initState=_ref77.initState,s=_ref77$initState===void 0?{}:_ref77$initState,o=_ref77.applyStyles;_classCallCheck(this,fd);this.handleStateEvent=function(f){var m=f.playerID,g=f.by,y=f.value,b=Object.keys(y).filter(function(S){return y[S]!=null});if(g){var S=_this186.byStates.get(m);S||(S={},_this186.byStates.set(m,S));var _iterator183=_createForOfIteratorHelper(b),_step183;try{for(_iterator183.s();!(_step183=_iterator183.n()).done;){var w=_step183.value;HC(w)?(S[w]=y[w],_this186.currentState[w]=_this186.currentPureState[w]):(_this186.currentState[w]=y[w],_this186.currentPureState[w]=y[w])}}catch(err){_iterator183.e(err)}finally{_iterator183.f()}}else{_this186.lastStateEvent=f;var _iterator184=_createForOfIteratorHelper(b),_step184;try{for(_iterator184.s();!(_step184=_iterator184.n()).done;){var _S2=_step184.value;_this186.currentState[_S2]=y[_S2],_this186.currentPureState[_S2]=y[_S2]}}catch(err){_iterator184.e(err)}finally{_iterator184.f()}}var _iterator185=_createForOfIteratorHelper(_this186.byStates.values()),_step185;try{for(_iterator185.s();!(_step185=_iterator185.n()).done;){var _S3=_step185.value;var _iterator186=_createForOfIteratorHelper(b),_step186;try{for(_iterator186.s();!(_step186=_iterator186.n()).done;){var _w6=_step186.value;_this186.mergeByStates(_w6,_S3)}}catch(err){_iterator186.e(err)}finally{_iterator186.f()}}}catch(err){_iterator185.e(err)}finally{_iterator185.f()}_this186.applyStyles(_this186.convertStyles(_this186.currentState))},this.handleCmdEvent=function(f){_this186.lastCmdEvent=f,f.value.name==="playFrom"?window==null||window.postMessage({type:"_changeAudioState",targetID:_this186.target,play:1,stop:0},"*"):f.value.name==="playSF"?window==null||window.postMessage({type:"_playSoundEffect",targetID:_this186.target,soundEffectId:f.value.value},"*"):window==null||window.postMessage({type:"_changeAudioState",targetID:_this186.target,play:0,stop:1},"*")},this.byStates=new Map,this.target=t,this.pIndex=i,this.tIndex=r,this.constants=n,this.withSubElem=this.pIndex!=null||this.tIndex!=null;var a=n.x,c=n.y,h=n.slideWidth,d=n.slideHeight,u=n.width,p=n.height;this.initState=Ba(Gi({scaleX:1,scaleY:1,rotate:0,opacity:1,xshear:0,yshear:0,fillcolor:id,visible:!0},s),{ppt_x:a/h,ppt_y:c/d,ppt_w:u/h,ppt_h:p/d}),this.currentState=Gi({},this.initState),this.currentPureState=Gi({},this.initState),o&&(this.applyStyles=o)}_createClass(fd,[{key:"resetState",value:function resetState(t,i){this.lastStateEvent=void 0,this.lastCmdEvent=void 0,this.byStates["delete"](t),Object.assign(this.currentPureState,i),Object.assign(this.currentState,this.currentPureState);var _iterator187=_createForOfIteratorHelper(this.byStates.values()),_step187;try{for(_iterator187.s();!(_step187=_iterator187.n()).done;){var _r109=_step187.value;for(var n in _r109){this.mergeByStates(n,_r109)}}}catch(err){_iterator187.e(err)}finally{_iterator187.f()}this.applyStyles(this.convertStyles(this.currentState))}},{key:"applyStyles",value:function applyStyles(t){var i=this.getStyler();i&&i.forEach(function(r,n){n?r.set({"pointer-events":t["pointer-events"]}):r.set(t)})}},{key:"applyPreAnimation",value:function applyPreAnimation(){this.preAnimationState&&this.applyStyles(this.convertStyles(this.preAnimationState))}},{key:"preAnimation",value:function preAnimation(t){if(!t)return this.preAnimationState;{this.preAnimationState||(this.preAnimationState={});var i=Object.keys(t);for(var _i40=0,_i39=i;_i40<_i39.length;_i40++){var _r110=_i39[_i40];var n=t[_r110];n!=null&&(this.preAnimationState[_r110]=n,this.currentState[_r110]=n,this.currentPureState[_r110]=n)}}}},{key:"clearCache",value:function clearCache(){this._stylerList=void 0}},{key:"mergeByStates",value:function mergeByStates(t,i){var r,n,s,o,a,c;switch(t){case"rotate":this.currentState.rotate=((r=this.currentState.rotate)!=null?r:0)+((n=i.rotate)!=null?n:0);break;case"scaleX":this.currentState.scaleX=((s=this.currentState.scaleX)!=null?s:1)*((o=i.scaleX)!=null?o:1);break;case"scaleY":this.currentState.scaleY=((a=this.currentState.scaleY)!=null?a:1)*((c=i.scaleY)!=null?c:1);break;case"fillcolor":this.currentState.fillcolor&&i.fillcolor?this.currentState.fillcolor=td(this.currentState.fillcolor,i.fillcolor):i.fillcolor&&(this.currentState.fillcolor=i.fillcolor);}}},{key:"convertStyles",value:function convertStyles(t){var i,r,n,s,o,a,c,h;var d={"will-change":"opacity,transform"},_this$constants=this.constants,u=_this$constants.x,p=_this$constants.y,f=_this$constants.width,m=_this$constants.height,g=_this$constants.slideWidth,y=_this$constants.slideHeight;for(var b in t){if(Mt(t,b))switch(b){case"ppt_x":{var S=(i=t.ppt_x)!=null?i:this.currentState.ppt_x;d.translateX=Vg(S*g-u);break}case"ppt_y":{var _S4=(r=t.ppt_y)!=null?r:this.currentState.ppt_y;d.translateY=Vg(_S4*y-p);break}case"scaleX":{var _S5=(n=t.scaleX)!=null?n:1,w=this.currentState.ppt_w;d.scaleX=_S5*w*g/f;break}case"ppt_w":{var _S6=(s=this.currentState.scaleX)!=null?s:1,_w7=(o=t.ppt_w)!=null?o:this.currentState.ppt_w;d.scaleX=_S6*_w7*g/f;break}case"scaleY":{var _S7=(a=t.scaleY)!=null?a:1,_w8=this.currentState.ppt_h;d.scaleY=_S7*_w8*y/m;break}case"ppt_h":{var _S8=(c=this.currentState.scaleY)!=null?c:1,_w9=(h=t.ppt_h)!=null?h:this.currentState.ppt_h;d.scaleY=_S8*_w9*y/m;break}case"fillcolor":if(t.fillcolor!=null){var _S9=t.fillcolor.hsl;d["--sp-fill"]="hsla(".concat(_S9.h,",").concat(_S9.s,"%,").concat(_S9.l,"%,").concat(_S9.a,")"),d["--sp-fill-h"]=_S9.h,d["--sp-fill-s"]=_S9.s+"%",d["--sp-fill-l"]=_S9.l+"%",d["--sp-fill-a"]=_S9.a}break;case"visible":t.visible!=null&&(d.opacity=this.currentState.opacity*(t.visible?1:0),d["pointer-events"]=t.visible?"initial":"none");break;case"opacity":t.opacity!=null&&(d.opacity=t.opacity*(this.currentState.visible?1:0));break;case"rotate":t.rotate!=null&&(d.rotate=Number(t.rotate));break;case"xshear":t.xshear!=null&&(d.skewX=45*t.xshear);break;case"yshear":t.yshear!=null&&(d.skewY=45*t.yshear);break;default:t[b]!=null&&(d[b]=t[b]);}}return this.constants.flipH&&Mt(d,"scaleX")&&(d.scaleX*=-1),this.constants.flipV&&Mt(d,"scaleY")&&(d.scaleY*=-1),Mt(d,"rotate")&&(d.scaleX<0&&(d.rotate*=-1),d.scaleY<0&&(d.rotate*=-1)),d}},{key:"getStyler",value:function getStyler(){if(!this._stylerList){var t=document.getElementById(this.target);if(t&&this.pIndex!=null&&(t=t.querySelectorAll(".".concat(ft.Paragraph))[this.pIndex]),t&&this.tIndex!=null&&(t=t.querySelectorAll(".".concat(ft.Text))[this.tIndex]),t){this._stylerList=[ry(t)];for(var i=0;i<t.children.length;i+=1){t.children[i].classList.contains("ppt-event-source")&&this._stylerList.push(ry(t.children[i]))}}}return this._stylerList}}]);return fd}(),ny={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function n(c,h,d){this.fn=c,this.context=h,this.once=d||!1}function s(c,h,d,u,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new n(d,u||c,p),m=i?i+h:h;return c._events[m]?c._events[m].fn?c._events[m]=[c._events[m],f]:c._events[m].push(f):(c._events[m]=f,c._eventsCount++),c}function o(c,h){--c._eventsCount==0?c._events=new r:delete c._events[h]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),a.prototype.eventNames=function(){var c,h,d=[];if(this._eventsCount===0)return d;for(h in c=this._events){t.call(c,h)&&d.push(i?h.slice(1):h)}return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(c)):d},a.prototype.listeners=function(c){var h=i?i+c:c,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var u=0,p=d.length,f=new Array(p);u<p;u++){f[u]=d[u].fn}return f},a.prototype.listenerCount=function(c){var h=i?i+c:c,d=this._events[h];return d?d.fn?1:d.length:0},a.prototype.emit=function(c,h,d,u,p,f){var m=i?i+c:c;if(!this._events[m])return!1;var g,y,b=this._events[m],S=arguments.length;if(b.fn){switch(b.once&&this.removeListener(c,b.fn,void 0,!0),S){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,h),!0;case 3:return b.fn.call(b.context,h,d),!0;case 4:return b.fn.call(b.context,h,d,u),!0;case 5:return b.fn.call(b.context,h,d,u,p),!0;case 6:return b.fn.call(b.context,h,d,u,p,f),!0;}for(y=1,g=new Array(S-1);y<S;y++){g[y-1]=arguments[y]}b.fn.apply(b.context,g)}else{var w,P=b.length;for(y=0;y<P;y++){switch(b[y].once&&this.removeListener(c,b[y].fn,void 0,!0),S){case 1:b[y].fn.call(b[y].context);break;case 2:b[y].fn.call(b[y].context,h);break;case 3:b[y].fn.call(b[y].context,h,d);break;case 4:b[y].fn.call(b[y].context,h,d,u);break;default:if(!g)for(w=1,g=new Array(S-1);w<S;w++){g[w-1]=arguments[w]}b[y].fn.apply(b[y].context,g);}}}return!0},a.prototype.on=function(c,h,d){return s(this,c,h,d,!1)},a.prototype.once=function(c,h,d){return s(this,c,h,d,!0)},a.prototype.removeListener=function(c,h,d,u){var p=i?i+c:c;if(!this._events[p])return this;if(!h)return o(this,p),this;var f=this._events[p];if(f.fn)f.fn!==h||u&&!f.once||d&&f.context!==d||o(this,p);else{for(var m=0,g=[],y=f.length;m<y;m++){(f[m].fn!==h||u&&!f[m].once||d&&f[m].context!==d)&&g.push(f[m])}g.length?this._events[p]=g.length===1?g[0]:g:o(this,p)}return this},a.prototype.removeAllListeners=function(c){var h;return c?(h=i?i+c:c,this._events[h]&&o(this,h)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a})(ny);var _C=ny.exports,gd=/*#__PURE__*/function(_C2){_inherits(gd,_C2);var _super49=_createSuper(gd);function gd(){_classCallCheck(this,gd);return _super49.call(this)}return gd}(_C);var xy=x(require("react")),tt=x(require("react")),ns=x(require("react")),Xt=x(require("react"));var Ue=x(require("react")),$=x(require("react")),Nd=x(require("react")),Dd=x(require("react")),Fd=x(require("react")),Bd=x(require("react")),sl=x(require("react")),Er=x(require("react")),Ot=x(require("react")),Hy=x(require("react-dom")),as=x(require("react")),ls=x(require("react")),Ar=x(require("react")),mo=x(require("react")),Qi=x(require("react")),jd=x(require("color"));var rb=x(require("bezier-js"));var mi=x(require("react")),ab=x(require("react-dom")),lb=x(require("eventemitter3")),rt=x(require("react")),Rt=x(require("react")),ds=x(require("react")),$C=Object.defineProperty,GC=Object.defineProperties,KC=Object.getOwnPropertyDescriptors,sy=Object.getOwnPropertySymbols,XC=Object.prototype.hasOwnProperty,YC=Object.prototype.propertyIsEnumerable,oy=function oy(e,t,i){return t in e?$C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},M=function M(e,t){for(var i in t||(t={})){XC.call(t,i)&&oy(e,i,t[i])}if(sy){var _iterator188=_createForOfIteratorHelper(sy(t)),_step188;try{for(_iterator188.s();!(_step188=_iterator188.n()).done;){var i=_step188.value;YC.call(t,i)&&oy(e,i,t[i])}}catch(err){_iterator188.e(err)}finally{_iterator188.f()}}return e},D=function D(e,t){return GC(e,KC(t))},bE=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")},rn=12700,Tt=9525,H=1e5,ay=45720,ly=91440,Et=6e4,vE=4.5*rn,QC=1;function xe(e){if(typeof e=="number")return e/H;var t=e.endsWith("%");return parseFloat(e)/(t?100:H)}function I(e){return"".concat(qn(e)/rn,"pt")}function Qn(e){return e===0?0:e/Et}function qn(e){return typeof e=="string"?parseFloat(e):e}function yd(e){return qn(e)*.75}function Zn(e){return qn(e)/.75}function qC(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return _defineProperty({},uy(e,t),dy(e,t))}function dy(e,t){var i=ZC(e.elements)||t;if(e.elements.length>0){var _r111={},n=i&&e.elements.length>1;var _iterator189=_createForOfIteratorHelper(e.elements),_step189;try{for(_iterator189.s();!(_step189=_iterator189.n()).done;){var s=_step189.value;var o=uy(s,n),a=dy(s,t);s.text===void 0?_r111[o]=a:_r111[o]=D(M({},a),{body:s.text})}}catch(err){_iterator189.e(err)}finally{_iterator189.f()}return _r111}else return null}function ZC(e){var t={};var _iterator190=_createForOfIteratorHelper(e),_step190;try{for(_iterator190.s();!(_step190=_iterator190.n()).done;){var i=_step190.value;var _r112=i.name||"";if(_r112 in t)return!0;t[_r112]=!0}}catch(err){_iterator190.e(err)}finally{_iterator190.f()}return!1}function uy(e,t){var i=[];e.attr.forEach(function(n){var s=e.attr.getOptional(n);typeof s=="string"?i.push("".concat(n,"=").concat(JSON.stringify(s))):i.push("".concat(n,"=").concat(s))});var r="";return t&&(r+="[".concat(e.index,"] ")),r+="<".concat(e.name),i.length>0&&(r+=" "+i.join(" ")),r+=">",r}var bd=/*#__PURE__*/function(){function bd(e){_classCallCheck(this,bd);this.tagName=e}_createClass(bd,[{key:"get",value:function get(e,t){return this.assignDefaultValue(e,this.getOptional(e),t)}},{key:"getString",value:function getString(e,t){return this.assignDefaultValue(e,this.getStringOptional(e),t)}},{key:"getNumber",value:function getNumber(e,t){return this.assignDefaultValue(e,this.getNumberOptional(e),t)}},{key:"getBoolean",value:function getBoolean(e,t){return this.assignDefaultValue(e,this.getBooleanOptional(e),t)}},{key:"getColor",value:function getColor(e,t){return this.assignDefaultValue(e,this.getColorOptional(e),t)}},{key:"getColorOptional",value:function getColorOptional(e){return this.getOptional(e)}},{key:"getStringOptional",value:function getStringOptional(e){var t=this.getOptional(e);return typeof t=="number"&&(t="".concat(t)),t}},{key:"getNumberOptional",value:function getNumberOptional(e){var t=this.getOptional(e);if(!(typeof t=="string"&&(t=parseInt(t,10),Number.isNaN(t))))return t}},{key:"getBooleanOptional",value:function getBooleanOptional(e){var t=this.getOptional(e);return t==="true"||t==="1"||t==="on"?t=!0:t==="false"||t==="0"||t==="off"?t=!1:t!==void 0&&(t=!!t),t}},{key:"assignDefaultValue",value:function assignDefaultValue(e,t,i){var r=t;if(r===void 0&&(r=i),r===void 0)throw new Error("can't find attribute ".concat(JSON.stringify(e)," from ").concat(this.tagName));return r}}]);return bd}(),JC=/*#__PURE__*/function(_bd){_inherits(JC,_bd);var _super50=_createSuper(JC);function JC(e){_classCallCheck(this,JC);return _super50.call(this,e)}_createClass(JC,[{key:"length",value:function length(){return 0}},{key:"forEach",value:function forEach(e){}},{key:"getOptional",value:function getOptional(e){}},{key:"has",value:function has(e){return!1}}]);return JC}(bd),ex=/*#__PURE__*/function(_bd2){_inherits(ex,_bd2);var _super51=_createSuper(ex);function ex(e,t){var _this187;_classCallCheck(this,ex);_this187=_super51.call(this,e);_this187.attributes=t;return _this187}_createClass(ex,[{key:"length",value:function length(){return Object.keys(this.attributes).length}},{key:"forEach",value:function forEach(e){for(var t in this.attributes){e(t)}}},{key:"has",value:function has(e){return e in this.attributes}},{key:"getOptional",value:function getOptional(e){return this.attributes[e]}}]);return ex}(bd),tx=/*#__PURE__*/function(_bd3){_inherits(tx,_bd3);var _super52=_createSuper(tx);function tx(e,t,i){var _this188;_classCallCheck(this,tx);_this188=_super52.call(this,e.name);_this188.xml=e,_this188.picker=t,_this188.resourceType=i;return _this188}_createClass(tx,[{key:"length",value:function length(){return-1}},{key:"forEach",value:function forEach(e){this.tagName!==void 0&&this.picker.forEachAttributes(this.tagName,e)}},{key:"has",value:function has(e){return this.getOptional(e)!==void 0}},{key:"getOptional",value:function getOptional(e){var t;return this.cachedValues&&e in this.cachedValues?t=this.cachedValues[e]:this.tagName!==void 0&&(this.cachedXMLMap||(this.cachedXMLMap={}),t=this.picker.getAttribute(this.tagName,e,this.xml,this.cachedXMLMap,this.resourceType),this.cachedValues||(this.cachedValues={}),this.cachedValues[e]=t),t}}]);return tx}(bd),nn=/*#__PURE__*/function(){function nn(e,t){_classCallCheck(this,nn);this.picker=t,this.resourceType=e}_createClass(nn,[{key:"parse",value:function parse(e){return new py(this.picker,null,0,(0,hy.xml2js)(e,{compact:!1,captureSpacesBetweenElements:!0}),this.resourceType)}}]);return nn}(),G=/*#__PURE__*/function(){function G(){_classCallCheck(this,G);for(var _len19=arguments.length,e=new Array(_len19),_key19=0;_key19<_len19;_key19++){e[_key19]=arguments[_key19]}this.tagNames=e}_createClass(G,[{key:"execute",value:function execute(e){return this.tagNames.find(function(t){return t===e})!==void 0}},{key:"toString",value:function toString(){return this.tagNames.join(" or ")}}]);return G}(),py=/*#__PURE__*/function(){function py(e,t,i,r,n){_classCallCheck(this,py);this.picker=e,this.parent=t,this.index=i,this.resourceType=n,this.name=r.name,this.type=r.type,this.attr=new ex(this.name,Object.freeze(M({},r.attributes))),this.extraAttr=e?new tx(this,e,n):new JC(this.name);var s=[];if(r.elements)for(var o=0;o<r.elements.length;++o){var a=r.elements[o];a.type==="text"?this.text=a.text:s.push(new py(e,this,o,a,n))}this.elements=Object.freeze(s)}_createClass(py,[{key:"element",get:function get(){return this.elements[0]}},{key:"displayer",value:function displayer(e){return qC(this,e)}},{key:"elementWithName",value:function elementWithName(e){var _iterator191=_createForOfIteratorHelper(this.elements),_step191;try{for(_iterator191.s();!(_step191=_iterator191.n()).done;){var t=_step191.value;if(t.name===e)return t}}catch(err){_iterator191.e(err)}finally{_iterator191.f()}}},{key:"extraElementWithName",value:function extraElementWithName(e){if(this.picker&&this.name)return this.cachedXMLMap||(this.cachedXMLMap={}),this.picker.getChild(this.name,e,this,this.cachedXMLMap,this.resourceType)}},{key:"elementsWithName",value:function elementsWithName(e){var t=[];var _iterator192=_createForOfIteratorHelper(this.elements),_step192;try{for(_iterator192.s();!(_step192=_iterator192.n()).done;){var i=_step192.value;i.name===e&&t.push(i)}}catch(err){_iterator192.e(err)}finally{_iterator192.f()}return t}},{key:"childElementOptional",value:function childElementOptional(){for(var _len20=arguments.length,e=new Array(_len20),_key20=0;_key20<_len20;_key20++){e[_key20]=arguments[_key20]}var _this$searchChildElem=this.searchChildElement(e),t=_this$searchChildElem.xml,i=_this$searchChildElem.found;if(i)return t}},{key:"childElement",value:function childElement(){for(var _len21=arguments.length,e=new Array(_len21),_key21=0;_key21<_len21;_key21++){e[_key21]=arguments[_key21]}var _this$searchChildElem2=this.searchChildElement(e),t=_this$searchChildElem2.xml,i=_this$searchChildElem2.found;if(i)return t;typeof this.name=="string"&&e.unshift(this.name);var r=e.join(" -> "),n=e.findIndex(function(a){return a===t.name}),s=e.splice(n+1)[0],o=e.join(" -> ");throw new Error("can't find child ".concat(r,": lack of child ").concat(s," from ").concat(o))}},{key:"searchChildElement",value:function searchChildElement(e){var t=this;for(var i=0;i<e.length;++i){var _r113=e[i],n=t;var _iterator193=_createForOfIteratorHelper(t.elements),_step193;try{for(_iterator193.s();!(_step193=_iterator193.n()).done;){var s=_step193.value;if(typeof _r113=="string"){if(s.name===_r113){t=s;break}}else if(_r113.execute(s.name)){t=s;break}}}catch(err){_iterator193.e(err)}finally{_iterator193.f()}if(n===t)return{xml:t,found:!1}}return{xml:t,found:!0}}},{key:"hasChildElementWithName",value:function hasChildElementWithName(e){var t=this;var _iterator194=_createForOfIteratorHelper(t.elements),_step194;try{for(_iterator194.s();!(_step194=_iterator194.n()).done;){var i=_step194.value;if(i.name===e)return!0}}catch(err){_iterator194.e(err)}finally{_iterator194.f()}return!1}},{key:"parentElement",value:function parentElement(e){var t=this.parentElementOptional(e);if(t)return t;throw new Error("can't find parent ".concat(e," from ").concat(this.name))}},{key:"parentElementOptional",value:function parentElementOptional(e){var t=this.parent;for(;t;){if(typeof e=="string"){if(t.name===e)return t}else if(e.execute(t.name))return t;t=t.parent}}}]);return py}(),my={"Arial Rounded MT Bold":"https://convertcdn.netless.link/fonts/ArialRoundedMTBold.woff",Arial:"https://convertcdn.netless.link/fonts/arial.woff","Cooper Black":"https://convertcdn.netless.link/fonts/COOPBL.woff",Calibri:"https://convertcdn.netless.link/fonts/Calibri.woff",:"https://convertcdn.netless.link/fonts/msyh.woff",:"https://convertcdn.netless.link/fonts/HuaWenXinWei-1.woff","\u96C5\u75DE-\u7B80":"https://convertcdn.netless.link/fonts/yuppy.woff",:"https://convertcdn.netless.link/fonts/simhei.woff",:"https://convertcdn.netless.link/fonts/simkai.woff",Heiti:"https://convertcdn.netless.link/fonts/simhei.woff",Aharoni:"https://convertcdn.netless.link/fonts/Aharoni.woff","Aharoni Bold":"https://convertcdn.netless.link/fonts/Aharoni%20Bold.woff","source-han-sans":"https://convertcdn.netless.link/fonts/simhei.woff"},fy="netless-ppt-font-face";function ix(e,t,i){if(document&&i){var _r114=document.getElementById("".concat(fy,"-").concat(t));if(!_r114)_r114=document.createElement("style"),_r114.id="".concat(fy,"-").concat(t),document.head.appendChild(_r114);else return;var n=i.filter(function(s){return s.src}).map(function(s){var o=s.src.split("."),a=o[(o==null?void 0:o.length)-1],c={"font-style":s.fontStyle,"font-weight":s.fontWeight,"font-family":"\"".concat(s.fontFamily,"-").concat(t,"\""),src:"url(\"".concat(e,"/fonts/").concat(s.src,"\") format(\"").concat(a,"\")")};return JSON.parse(JSON.stringify(c))}).map(function(s){return"@font-face {".concat(Object.keys(s).reduce(function(o,a){return"".concat(o,"\n").concat(a,": ").concat(s[a],";")},""),"}")});_r114.innerHTML=n.join("\n")}}var vd=new Map;function gy(_x92,_x93){return _gy.apply(this,arguments)}function _gy(){_gy=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee110(e,t){return regeneratorRuntime.wrap(function _callee110$(_context114){while(1){switch(_context114.prev=_context114.next){case 0:vd.has(e)||(vd.set(e,!0),t&&t[e]?Jn(e,t[e]).then(function(){},function(){}):t&&t["*"]?(Jn(e,t["*"]).then(function(){},function(){}),Jn(e,t["*-bold"],{weight:"500"}).then(function(){},function(){}),Jn(e,t["*-italic"],{style:"italic"}).then(function(){},function(){}),Jn(e,t["*-bold-italic"],{weight:"500",style:"italic"}).then(function(){},function(){})):my[e]&&Jn(e,my[e]).then(function(){},function(){}));case 1:case"end":return _context114.stop();}}},_callee110)}));return _gy.apply(this,arguments)}function Jn(_x94,_x95,_x96){return _Jn.apply(this,arguments)}function _Jn(){_Jn=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee111(e,t,i){var r,n;return regeneratorRuntime.wrap(function _callee111$(_context115){while(1){switch(_context115.prev=_context115.next){case 0:_context115.t0=t;if(!_context115.t0){_context115.next=7;break}_context115.next=4;return fetch(t,{cache:"force-cache"});case 4:_context115.next=6;return _context115.sent.arrayBuffer();case 6:r=_context115.sent;case 7:if(!r){_context115.next=20;break}n=new FontFace(e,r,i);_context115.prev=9;_context115.next=12;return n.load();case 12:document.fonts.add(n);_context115.next=18;break;case 15:_context115.prev=15;_context115.t1=_context115["catch"](9);console.error("".concat(e," load error font"),_context115.t1);case 18:_context115.next=21;break;case 20:vd["delete"](e);case 21:case"end":return _context115.stop();}}},_callee111,null,[[9,15]])}));return _Jn.apply(this,arguments)}function yy(e,t){if(t.masterThemeColorMapping[e]){var i="a:".concat(t.masterThemeColorMapping[e]),_r115=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",i,"a:srgbClr");if(_r115)return _r115.attr.getString("val");{var n=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",i,"a:sysClr");return n?n.attr.getString("lastClr",e):e}}else{var _i41="a:".concat(e),_r116=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",_i41,"a:srgbClr");if(_r116)return _r116.attr.getString("val");{var _n43=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",_i41,"a:sysClr");return _n43?_n43.attr.getString("lastClr",e):e}}}function by(e){var t=qa(e).childElementOptional("a:majorFont");return t===void 0?{}:Sd(t)}function vy(e){var t=qa(e).childElementOptional("a:minorFont");return t===void 0?{}:Sd(t)}function Sd(e){var t={},i=e.childElementOptional("a:latin"),r=e.childElementOptional("a:ea"),n=e.childElementOptional("a:cs");i&&(t.latin=i.attr.getString("typeface","")===""?[]:[i.attr.getString("typeface")]),r&&(t.ea=r.attr.getString("typeface","")===""?[]:[r.attr.getString("typeface")]),n&&(t.cs=n.attr.getString("typeface","")===""?[]:[n.attr.getString("typeface")]);var s=e.elementsWithName("a:font").filter(function(o){return["Hans","Hant","Jpan","Hang"].includes(o.attr.getString("script"))}).map(function(o){return o.attr.getString("typeface")});return t.ea!==void 0?t.ea=t.ea.concat(s):t.ea=s,t}function qa(e){return e.theme.childElement("a:theme","a:themeElements","a:fontScheme")}function rx(e,t){if(e!=="none"){var i=qa(t).childElement("a:".concat(e,"Font")),_r117=Sd(i);return wd(_r117).filter(function(n){return!n.startsWith("+")&&n!==""}).map(function(n){return gy(n,t.userFonts),n})}else return[]}function wd(e){var t=[];return e.latin!==void 0&&t.concat(e.latin),e.ea!==void 0&&t.concat(e.ea),e.cs!==void 0&&t.concat(e.cs),t}var es=["a:blipFill","a:gradFill","a:grpFill","a:noFill","a:pattFill","a:solidFill"],Pi=["a:hslClr","a:schemeClr","a:srgbClr","a:scrgbClr","a:sysClr","a:prstClr"];function kd(e,t){var i=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme"),r=e.childElement("a:effectRef"),n=r.childElement(_construct(G,Pi)),s=r.attr.getNumber("idx"),o=i.childElement("a:effectStyleLst").elements[s-1],a=e.childElement("a:fillRef"),c=a.childElement(_construct(G,Pi)),h=a.attr.getNumber("idx"),d=i.childElement("a:fillStyleLst").elements[h-1],u=e.childElement("a:fontRef"),p=u.attr.getString("idx"),f;p!=="none"&&(f=qa(t).childElement("a:".concat(p,"Font")));var m=e.childElement("a:lnRef"),g=m.childElement(_construct(G,Pi)),y=m.attr.getNumber("idx"),b=i.childElement("a:lnStyleLst").elements[y-1];return{effect:{xml:o,phClr:n},fill:{xml:d,phClr:c},font:{xml:f,fontRef:u},ln:{xml:b,phClr:g}}}var Cr=(0,J["default"])("#FFFFFF").alpha(0),Yi=(0,J["default"])("#FFFFFF").alpha(0),Kt;(function(e){e.None="none",e.Norm="norm",e.Lighten="lighten",e.LightenLess="lightenLess",e.Darken="darken",e.DarkenLess="darkenLess"})(Kt||(Kt={}));var Za=/*#__PURE__*/function(){function Za(){_classCallCheck(this,Za);this.fillColor=Cr.hsl()}_createClass(Za,[{key:"setFillColor",value:function setFillColor(e){e?this.fillColor=e:this.fillColor=Cr.hsl()}},{key:"hsl",value:function hsl(){return this.fillColor.hsl()}},{key:"rgb",value:function rgb(){return this.fillColor.rgb()}}]);return Za}(),Ja=/*#__PURE__*/function(){function Ja(e){_classCallCheck(this,Ja);this.alphaModFix=1,this.resId=e.childElement("a:blip").attr.getString("r:embed"),e.childElementOptional("a:tile")!==void 0?this.tile=!0:this.tile=!1;var t=e.childElement("a:blip").childElementOptional("a:alphaModFix");if(t!==void 0){var i=t.attr.getNumberOptional("amt");i&&(this.alphaModFix=xe(i))}}_createClass(Ja,[{key:"getResId",value:function getResId(){return this.resId}},{key:"getAlphaModFix",value:function getAlphaModFix(){return this.alphaModFix}},{key:"hsl",value:function hsl(){return Cr.hsl()}},{key:"rgb",value:function rgb(){return Cr.rgb()}}]);return Ja}(),ho=/*#__PURE__*/function(){function ho(e,t,i,r){_classCallCheck(this,ho);this.colors=[],this.rotation=0,this.path=void 0;var n=e.hasChildElementWithName("a:gsLst")?e.childElement("a:gsLst").elementsWithName("a:gs"):[];if(this.colors=n.sort(function(s,o){var a=s.attr.getNumber("pos")/H,c=o.attr.getNumber("pos")/H;return a-c}).map(function(s){var o=s.attr.getNumber("pos")/H,a=sn(s.childElement(_construct(G,Pi)),t,i,r);return{stop:o,color:a}}),e.hasChildElementWithName("a:lin")&&(this.rotation=Qn(e.childElement("a:lin").attr.getNumber("ang",0))),e.hasChildElementWithName("a:path")){var s=e.childElement("a:path"),o=s.attr.getStringOptional("path"),a=s.childElementOptional("a:fillToRect");if(!a){this.path={path:o,fillToRect:{left:0,top:0,bottom:0,right:0}};return}var c=a.attr.getNumber("l",0),h=a.attr.getNumber("t",0),d=a.attr.getNumber("b",0),u=a.attr.getNumber("r",0);this.path={path:o,fillToRect:{left:c,top:h,bottom:d,right:u}}}}_createClass(ho,[{key:"getGradientPath",value:function getGradientPath(){return this.path}},{key:"getColors",value:function getColors(){return this.colors}},{key:"getRotation",value:function getRotation(){return this.rotation}},{key:"hsl",value:function hsl(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.hsl():Cr.hsl()}},{key:"rgb",value:function rgb(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.rgb():Cr.rgb()}},{key:"getGradientStyles",value:function getGradientStyles(){var e="linear-gradient(".concat(this.rotation+90,"deg, ");return e+=this.colors.filter(function(t){return t.color}).map(function(t){var i;return"".concat((i=t.color)==null?void 0:i.rgb().string()," ").concat(t.stop*100,"%")}).join(","),e+=")",e}}]);return ho}();function sn(e,t,i,r){var n;if(e.attr.has("val")){var s=e.childElementOptional("a:alpha"),o=e.childElementOptional("a:shade"),a=e.childElementOptional("a:tint"),c=e.childElementOptional("a:lumMod"),h=e.childElementOptional("a:satMod"),d=e.childElementOptional("a:satOff"),u=e.childElementOptional("a:lumOff"),p=e.childElementOptional("a:hueMod"),f=e.childElementOptional("a:hueOff");switch(e.name){case"a:prstClr":return ts((0,J["default"])(e.attr.getString("val")),s,o,c,a,h,u,d,p,f);case"a:srgbClr":return ts((0,J["default"])("#".concat(e.attr.getString("val"))),s,o,c,a,h,u,d,p,f);case"a:schemeClr":{var m=e.attr.getString("val");return m==="phClr"&&(r?m=r:i.name==="a:sysClr"?m=(n=i.attr.getStringOptional("lastClr"))!=null?n:"accent1":m=i.attr.getString("val")),ts((0,J["default"])("#".concat(yy(m,t))),s,o,c,a,h,u,d,p,f)}case"a:hslClr":{var _m14=e.attr.getNumber("hue")/Et,g=e.attr.getNumber("sat")/H,y=e.attr.getNumber("lum")/H;return ts((0,J["default"])({h:_m14,s:g,l:y}),s,o,c,a,h,u)}case"a:scrgbClr":{var _m15=e.attr.getNumber("r")*255/H,_g7=e.attr.getNumber("g")*255/H,_y2=e.attr.getNumber("b")*255/H;return ts((0,J["default"])({r:_m15,g:_g7,b:_y2}),s,o,c,a,h,u)}case"a:sysClr":return ts((0,J["default"])("#".concat(e.attr.getString("lastClr"))),s,o,c,a,h,u,d,p,f);default:return;}}}function Cd(e,t){var i,r,n,s,o,a,c,h,d;var u=Number((i=e.alpha)==null?void 0:i.val),p=Number((r=e.shade)==null?void 0:r.val),f=Number((n=e.tint)==null?void 0:n.val),m=Number((s=e.lumMod)==null?void 0:s.val),g=Number((o=e.satMod)==null?void 0:o.val),y=Number((a=e.satOff)==null?void 0:a.val),b=Number((c=e.lumOff)==null?void 0:c.val),S=Number((h=e.hueMod)==null?void 0:h.val),w=Number((d=e.hueOff)==null?void 0:d.val);return nx((0,J["default"])("#".concat(yy(e.val,t))),u,p,m,f,g,b,y,S,w)}function ts(e,t,i,r,n,s,o,a,c,h){var d=e;if(n&&(d=d.mix((0,J["default"])("white"),1-n.attr.getNumber("val")/H)),i&&(d=d.mix((0,J["default"])("black"),1-i.attr.getNumber("val")/H)),s){var _d$hsl$object=d.hsl().object(),u=_d$hsl$object.h,p=_d$hsl$object.s,f=_d$hsl$object.l,m=p*s.attr.getNumber("val")/H;d=(0,J["default"])({l:f,s:m,h:u})}if(a){var _d$hsl$object2=d.hsl().object(),_u6=_d$hsl$object2.h,_p4=_d$hsl$object2.s,_f4=_d$hsl$object2.l,_m16=a.attr.getNumber("val")/H*100+_p4;d=(0,J["default"])({l:_f4,s:_m16,h:_u6})}if(r){var _d$hsl$object3=d.hsl().object(),_u7=_d$hsl$object3.h,_p5=_d$hsl$object3.s,_f5=_d$hsl$object3.l,_m17=_f5*r.attr.getNumber("val")/H;d=(0,J["default"])({l:_m17,s:_p5,h:_u7})}if(o){var _d$hsl$object4=d.hsl().object(),_u8=_d$hsl$object4.h,_p6=_d$hsl$object4.s,_f6=_d$hsl$object4.l,_m18=o.attr.getNumber("val")/H*100+_f6;d=(0,J["default"])({l:_m18,s:_p6,h:_u8})}if(c){var _d$hsl$object5=d.hsl().object(),_u9=_d$hsl$object5.h,_p7=_d$hsl$object5.s,_f7=_d$hsl$object5.l,_m19=_u9*c.attr.getNumber("val")/H;d=(0,J["default"])({l:_f7,s:_p7,h:_m19})}if(h){var _d$hsl$object6=d.hsl().object(),_u10=_d$hsl$object6.h,_p8=_d$hsl$object6.s,_f8=_d$hsl$object6.l,_m20=h.attr.getNumber("val")/Et+_u10;d=(0,J["default"])({l:_f8,s:_p8,h:_m20})}return t&&(d=d.alpha(t.attr.getNumber("val")/H)),d}function nx(e,t,i,r,n,s,o,a,c,h){var d=e;if(n&&(d=e.mix((0,J["default"])("white"),1-n/H)),i&&(d=e.mix((0,J["default"])("black"),1-i/H)),s){var _e$hsl$object=e.hsl().object(),u=_e$hsl$object.h,p=_e$hsl$object.s,f=_e$hsl$object.l,m=p*s/H;d=(0,J["default"])({l:f,s:m,h:u})}if(a){var _e$hsl$object2=e.hsl().object(),_u11=_e$hsl$object2.h,_p9=_e$hsl$object2.s,_f9=_e$hsl$object2.l,_m21=a/H*100+_p9;d=(0,J["default"])({l:_f9,s:_m21,h:_u11})}if(r){var _e$hsl$object3=e.hsl().object(),_u12=_e$hsl$object3.h,_p10=_e$hsl$object3.s,_f10=_e$hsl$object3.l,_m22=_f10*r/H;d=(0,J["default"])({l:_m22,s:_p10,h:_u12})}if(o){var _e$hsl$object4=e.hsl().object(),_u13=_e$hsl$object4.h,_p11=_e$hsl$object4.s,_f11=_e$hsl$object4.l,_m23=o/H*100+_f11;d=(0,J["default"])({l:_m23,s:_p11,h:_u13})}if(c){var _e$hsl$object5=e.hsl().object(),_u14=_e$hsl$object5.h,_p12=_e$hsl$object5.s,_f12=_e$hsl$object5.l,_m24=_u14*c/H;d=(0,J["default"])({l:_f12,s:_p12,h:_m24})}if(h){var _e$hsl$object6=e.hsl().object(),_u15=_e$hsl$object6.h,_p13=_e$hsl$object6.s,_f13=_e$hsl$object6.l,_m25=h/Et+_u15;d=(0,J["default"])({l:_f13,s:_p13,h:_m25})}return t&&(d=e.alpha(t/H)),d}var xr=/*#__PURE__*/function(){function xr(e){_classCallCheck(this,xr);this.placeHolderColor=e}_createClass(xr,[{key:"read",value:function read(e,t){if(e===void 0)return Yi;switch(e.name){case"a:noFill":return Cr;case"a:solidFill":return sn(e.childElement(_construct(G,Pi)),t,this.placeHolderColor);case"a:gradFill":return new ho(e,t,this.placeHolderColor);case"a:blipFill":return(e.hasChildElementWithName("a:blip")?e.childElement("a:blip").attr.getStringOptional("r:embed"):void 0)!==void 0?new Ja(e):Cr;case"a:grpFill":return new Za;case"a:pattFill":default:return Yi;}}}]);return xr}();function K(e){return e instanceof Ja||e===void 0?"none":e.rgb().string()}function Sy(e,t){if(e==="none")return e;switch(t){case Kt.None:return"none";case Kt.Norm:return e;case Kt.Darken:return(0,J["default"])(e).darken(.4).rgb().string();case Kt.DarkenLess:return(0,J["default"])(e).darken(.2).rgb().string();case Kt.Lighten:return(0,J["default"])(e).lighten(.4).rgb().string();case Kt.LightenLess:return(0,J["default"])(e).lighten(.2).rgb().string();default:return e;}}var sx=/*#__PURE__*/function(){function sx(){_classCallCheck(this,sx);this.tasks={slideDidUpdate:!1},this.isLoadFinished=!1}_createClass(sx,[{key:"reset",value:function reset(e){this.tasks={slideDidUpdate:!1},this.eventHub=e}},{key:"endLoadTask",value:function endLoadTask(e){var _this189=this;return this.tasks[e]=!0,Object.keys(this.tasks).every(function(t){return _this189.tasks[t]})?(this.eventHub.emit("__PresetTransactionReady__"),!0):!1}},{key:"addLoadTask",value:function addLoadTask(e){this.tasks[e]=!1}},{key:"loadImage",value:function(){var _loadImage=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee58(e){var t,i,_r118,n;return regeneratorRuntime.wrap(function _callee58$(_context60){while(1){switch(_context60.prev=_context60.next){case 0:_context60.prev=0;_context60.next=3;return fetch(e);case 3:t=_context60.sent;i=new FileReader;_context60.next=7;return t.blob();case 7:_r118=_context60.sent;n=new Promise(function(s){i.onload=function(o){var a;s((a=o.target)==null?void 0:a.result)},i.onerror=function(){s(e)}});i.readAsDataURL(_r118);_context60.next=12;return n;case 12:return _context60.abrupt("return",_context60.sent);case 15:_context60.prev=15;_context60.t0=_context60["catch"](0);return _context60.abrupt("return",e);case 18:case"end":return _context60.stop();}}},_callee58,null,[[0,15]])}));function loadImage(_x97){return _loadImage.apply(this,arguments)}return loadImage}()}]);return sx}(),Mi=new sx,ox=/*#__PURE__*/function(_co$default$Component){_inherits(ox,_co$default$Component);var _super53=_createSuper(ox);function ox(e){var _this190;_classCallCheck(this,ox);_this190=_super53.call(this,e);_this190.imageUrl="",_this190.state={imageBase64Url:""},_this190.updateImageUrl(_this190.props);return _this190}_createClass(ox,[{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){this.updateImageUrl(e)}},{key:"updateImageUrl",value:function updateImageUrl(e){var _this191=this;var t=e.cSld.extraAttr.getStringOptional("backgroundResId"),i=e.cSld.extraAttr.getStringOptional("backgroundImageResourceType");if(t&&i){var _r119=e.resourceLoader.loadURL(i,t);this.imageUrl!==_r119&&(this.imageUrl=_r119,Mi.addLoadTask(_r119),Mi.loadImage(_r119).then(function(n){_this191.setState({imageBase64Url:n},function(){Mi.endLoadTask(_r119)})},function(){}))}}},{key:"renderImage",value:function renderImage(e,t){var i=this.props.cSld,r=this.state.imageBase64Url,n=i.extraAttr.getStringOptional("backgroundResId"),s=i.extraAttr.getStringOptional("backgroundImageResourceType");if(n&&s){var o=i.extraElementWithName("getBackgroundImageFill");if(o===void 0||o.childElementOptional("a:blip")===void 0)return null;{var a=o.childElement("a:blip").childElementOptional("a:alphaModFix"),c=!!o.childElementOptional("a:tile"),h=1;if(a){var u=a.attr.getNumberOptional("amt");u&&(h=xe(u))}var d={position:"absolute",left:0,top:0,width:I(e),height:I(t),opacity:h,backgroundImage:"url(".concat(r,")"),backgroundSize:c?"auto":"".concat(I(e)," ").concat(I(t))};return co["default"].createElement("div",{style:d})}}else{var _o25=i.extraAttr.getColorOptional("backgroundColor"),_a21;return _o25 instanceof ho?_a21=_o25.getGradientStyles():_a21=K(_o25),_o25?co["default"].createElement("div",{style:{position:"absolute",left:0,top:0,width:I(e),height:I(t),background:_a21}}):null}}},{key:"render",value:function render(){var _this$props12=this.props,e=_this$props12.slideContext,t=_this$props12.slideRef,i=_this$props12.className,r=_this$props12.children,n={position:"relative",width:I(e.slideWidth),height:I(e.slideHeight),overflow:"hidden"};return co["default"].createElement("div",{id:"ppt-animation-hub",ref:t,className:i,style:n},this.renderImage(e.slideWidth,e.slideHeight),r)}}]);return ox}(co["default"].Component),wy=/*#__PURE__*/function(){function wy(e){_classCallCheck(this,wy);this.mapper=e}_createClass(wy,[{key:"map",value:function map(e,t,i){return(!this.buffer||this.buffer.source!==e)&&(this.buffer={source:e,target:this.mapper(e,t,void 0,i)}),this.buffer.target}}]);return wy}();function ky(e){switch(e){case"b":return"flex-end";case"ctr":return"center";default:return"flex-start";}}function Id(e){switch(e){case"l":return"left";case"r":return"right";case"ctr":return"center";case"just":return"justify";case"dist":return"justify";default:return"left";}}function ax(e){switch(e){case"sng":return"underline";default:return"none";}}function Cy(e,t){var i=t.scaleX,r=t.scaleY;return Math.abs(Math.cos(e/180*Math.PI))>=Math.abs(Math.sin(e/180*Math.PI))?{scaleX:i,scaleY:r}:{scaleX:r,scaleY:i}}var lx=/*#__PURE__*/function(_xy$default$Component){_inherits(lx,_xy$default$Component);var _super54=_createSuper(lx);function lx(){_classCallCheck(this,lx);return _super54.apply(this,arguments)}_createClass(lx,[{key:"renderAutoNum",value:function renderAutoNum(e){var _this$props13=this.props,t=_this$props13.buIndexCounter,i=_this$props13.paragraphXML,r=_this$props13.firstRangeXML,n=e.attr.getString("type"),s=e.attr.getNumber("startAt",1),o=t.get(i,s,r)+s;return Py(o,n)}},{key:"renderBuChar",value:function renderBuChar(e){return Iy(e)}},{key:"render",value:function render(){var _this$props14=this.props,e=_this$props14.buXML,t=_this$props14.buIndexCounter;switch(e.name){case"a:buChar":return t.reset(),this.renderBuChar(e.attr.getString("char"));case"a:buAutoNum":return this.renderAutoNum(e);case"a:buNone":case"a:buBlip":return t.reset(),"";}return""}}]);return lx}(xy["default"].Component);function cx(e){return e<=20?String.fromCodePoint(e+9311):e<=35?String.fromCodePoint(e+12860):e<=50?String.fromCodePoint(e+12941):"".concat(e)}function Iy(e){switch(e){case String.fromCodePoint(159):case" ":case"l":return"\u25CF";case"\xFC":return"\u2713";case"\u2022":return"\u2022";case"n":return"\u25FE";case"\u2013":return"\u2013";case"v":return"\u2756";case"u":return"\u25C6";case"&":return"\uD83D\uDD6E";case"\xD8":return"\u27A3";case"p":return"\u25A1";default:return e;}}function is(e){var t=64,i=26,r=e%i;r=r===0?26:r;var n=Math.ceil(e/i);return String.fromCodePoint(r+t).repeat(n)}function rs(e){var t={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},i="",r=e;for(var n in t){for(;r>=t[n];){i+=n,r-=t[n]}}return i}function Py(e,t){switch(t){case"alphaLcParenBoth":return"(".concat(is(e),")");case"alphaLcParenR":return"".concat(is(e).toLowerCase(),")");case"alphaLcPeriod":return"".concat(is(e).toLowerCase(),".");case"alphaUcParenBoth":return"(".concat(is(e),")");case"alphaUcParenR":return"".concat(is(e),")");case"alphaUcPeriod":return"".concat(is(e),".");case"arabicParenBoth":return"(".concat(e,")");case"arabicParenR":return"".concat(e,")");case"arabicPeriod":return"".concat(e,".");case"arabicPlain":return"".concat(e);case"ea1JpnChsDbParenBoth":return"(".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbParenR":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbPeriod":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),".");case"ea1JpnChsDbPlain":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"));case"circleNumDbPlain":return cx(e);case"romanLcParenBoth":return"(".concat(rs(e).toLowerCase(),")");case"romanLcParenR":return"".concat(rs(e).toLowerCase(),")");case"romanLcPeriod":return"".concat(rs(e).toLowerCase(),".");case"romanUcParenBoth":return"(".concat(rs(e),")");case"romanUcParenR":return"".concat(rs(e),")");case"romanUcPeriod":return"".concat(rs(e),".");default:return"".concat(e,".");}}var hx=/*#__PURE__*/function(_tt$default$Component){_inherits(hx,_tt$default$Component);var _super55=_createSuper(hx);function hx(e){_classCallCheck(this,hx);return _super55.call(this,e)}_createClass(hx,[{key:"hasUnderLine",value:function hasUnderLine(e){switch(e){case"none":return"none";default:return"underline";}}},{key:"render",value:function render(){var _this$props15=this.props,e=_this$props15.text,t=_this$props15.highlightColor,i=_this$props15.underLineStyle,r=_this$props15.indent,n=_this$props15.lineHeight,s=_this$props15.isTextWrap,o=_this$props15.fontFamily,a=_this$props15.isBold,c=_this$props15.color,h=_this$props15.isItalic,d=_this$props15.letterSpacing,u=_this$props15.fontSize;return e?tt["default"].createElement("span",{style:{display:"inline-flex",justifyContent:"space-between",backgroundColor:K(t),textDecoration:this.hasUnderLine(i),width:"100%"}},Array.from(e).map(function(p,f){return f===0&&r?tt["default"].createElement("span",{key:"run-text-".concat(f),style:{display:r?"inline-block":"inline",lineHeight:n,whiteSpace:s?"pre-wrap":"pre",fontSize:"".concat(u,"pt"),fontFamily:o,fontWeight:a?500:400,color:K(c),fontStyle:h?"italic":"normal",letterSpacing:"".concat(d/100,"pt"),textIndent:r?I(r):0}},p):tt["default"].createElement("span",{key:"run-text-".concat(f),style:{display:"inline",lineHeight:n,whiteSpace:s?"pre-wrap":"pre",fontSize:"".concat(u,"pt"),fontFamily:o,fontWeight:a?500:400,color:K(c),fontStyle:h?"italic":"normal",letterSpacing:"".concat(d/100,"pt")}},p)})):null}}]);return hx}(tt["default"].Component),dx=/*#__PURE__*/function(_tt$default$Component2){_inherits(dx,_tt$default$Component2);var _super56=_createSuper(dx);function dx(e){var _this192;_classCallCheck(this,dx);_this192=_super56.call(this,e);_this192.defaultPtSize=18;var t=e.rNodeOrBrNode,i=e.lineHeight,r=e.fontScale,n=t.extraAttr.getNumberOptional("sz"),s;n===void 0?s=_this192.defaultPtSize:s=n,typeof i=="string"?_this192.lineHeight=i:_this192.lineHeight="".concat(s*r*1.2*i,"pt"),_this192.fontSize="".concat(s*r,"pt");return _this192}_createClass(dx,[{key:"hasUnderLine",value:function hasUnderLine(e){switch(e){case"none":return"none";default:return"underline";}}},{key:"renderText",value:function renderText(){var e,_this$props16=this.props,t=_this$props16.rNodeOrBrNode,i=_this$props16.slideIndex,r=_this$props16.fontScale,n=_this$props16.lineHeight,s=_this$props16.indent,o=_this$props16.isTextWrap,a=_this$props16.runIndex,c=_this$props16.align,h=_this$props16.lastRunInParagraph,d=t.attr.getStringOptional("type");if(d)switch(d){case"slidenum":{e=i;break}default:e=new Date(Date.now()).toLocaleDateString();}var u=t.childElementOptional("a:t");if(u===void 0)return tt["default"].createElement("span",null);var p=t.extraAttr.getBoolean("b",!1),f=t.extraAttr.getString("u","none"),m=t.extraAttr.getNumber("spc",0),g=t.extraAttr.getBoolean("i",!1),y=t.extraAttr.getColorOptional("color"),b=t.extraAttr.getNumber("sz",0)*r,S=t.extraAttr.getString("fontType",""),w=t.extraAttr.getColorOptional("highlight",void 0),P,A=t.childElementOptional("a:rPr");A!==void 0&&(P=A.attr.getNumberOptional("baseline"));var E;if(P===void 0)E=e||u.text;else{var N;P>0?(N=40,E=tt["default"].createElement("sup",{style:{fontSize:"small",verticalAlign:"".concat(N+P/H*100,"%")}},e||u.text)):P<0?(N=0,E=tt["default"].createElement("sub",{style:{fontSize:"small",verticalAlign:"".concat(N+P/H*100,"%")}},e||u.text)):E=e||u.text}var R;if(typeof n=="string"?R=n:R="".concat(b*1.2*n,"pt"),c==="dist")return tt["default"].createElement(hx,{fontSize:b,text:"".concat(E),lineHeight:R,indent:s,isTextWrap:o,isBold:p,isItalic:g,underLineStyle:f,fontFamily:S,letterSpacing:m,color:y,highlightColor:w});{var _N={display:s?"inline-block":"inline",lineHeight:n,whiteSpace:o?"pre-wrap":"pre",backgroundColor:K(w),fontSize:"".concat(b,"pt"),textDecoration:this.hasUnderLine(f),fontFamily:S,fontWeight:p?500:400,color:K(y),fontStyle:g?"italic":"normal",letterSpacing:"".concat(m/100,"pt"),overflowWrap:"break-word",textIndent:s?I(s):0};if(h&&(typeof E=="string"||typeof E=="number")){var _="",ie=E;if(typeof E=="string")E.length>0&&(ie=E.substring(0,E.length-1),_=E.substring(E.length-1));else if(typeof E=="number"){var ce=E+"";ie=ce.substring(0,ce.length-1),_=ce.substring(ce.length-1)}return _N["--data-last-word-indent"]=s?"".concat(I(-s)):"0pt",tt["default"].createElement("span",{className:"netless-ppt-last-run","data-last-word":_,key:"run-".concat(a),style:_N},ie)}else return tt["default"].createElement("span",{key:"run-".concat(a),style:_N},E)}}},{key:"render",value:function render(){var _this$props17=this.props,e=_this$props17.rNodeOrBrNode,t=_this$props17.runIndex,i=_this$props17.prevElement;switch(e.name){case"a:fld":case"a:r":return this.renderText();case"a:br":return tt["default"].createElement("span",{key:"br-".concat(t),style:{lineHeight:this.lineHeight,fontSize:this.fontSize}},tt["default"].createElement("br",null));case"a:endParaRPr":return i&&i.name==="a:br"?tt["default"].createElement("span",{key:"endParaRPr-".concat(t),style:{lineHeight:this.lineHeight,display:"inline",fontSize:this.fontSize}},tt["default"].createElement("br",null)):null;default:return null;}}}]);return dx}(tt["default"].Component),F;(function(e){e.Horz="horz",e.Vert="vert",e.Vert270="vert270",e.WordArtVert="wordArtVert",e.EaVert="eaVert",e.MongolianVert="mongolianVert",e.WordArtVertRtl="wordArtVertRtl"})(F||(F={}));function My(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.Horz;switch(e){case F.MongolianVert:case F.WordArtVert:return"vertical-lr";case F.WordArtVertRtl:case F.EaVert:return"vertical-rl";default:return"horizontal-tb";}}function ux(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.Horz;return e!==F.Horz?{maxHeight:"100%",width:void 0}:{}}function px(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.Horz;return e===F.WordArtVert||e===F.WordArtVertRtl?{padding:"0.1em"}:{}}function mx(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.Horz;switch(e){case F.EaVert:return["\uFF5E","\uFF08","\uFF09","\uFF5B","\uFF5D","\u3010","\u3011","\u300A","\u300B","\u3008","\u3009"];case F.WordArtVertRtl:case F.WordArtVert:return["\u300A","\u300B","\u2026","\u2026","[","]","{","}","<",">","\uFF5E","\u3008","\u3009","(",")","\uFF08","\uFF09"];default:return[];}}function fx(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.Horz;switch(e){case F.EaVert:return["\u201C","\u201D","\u2018","\u2019","\uFF1A"];default:return[];}}function Ty(e,t,i){var r,n,s;var o=(r=e.left)!=null?r:0,a=(n=e.right)!=null?n:0,c=0,h=0;((s=e.textBodyWrapResource)==null?void 0:s.prop)?(c=e.textBodyWrapResource.prop.width*Tt,h=e.textBodyWrapResource.prop.height*Tt):(c=e.width,h=e.height);var d=a?a-h/2+c/2:h/2-c/2;if(i===F.Vert270&&t.paddingTop&&typeof t.paddingTop=="string"){var u=parseFloat(t.paddingTop)*rn;Number.isNaN(u)||(d-=u)}return{left:I(o?o-c/2+h/2:c/2-h/2),top:I(d),width:I(h),height:I(c)}}function gx(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.Horz;var t=arguments.length>1?arguments[1]:undefined;var i=arguments.length>2?arguments[2]:undefined;var r,n;switch(e){case F.EaVert:return D(M({},t),{writingMode:My(e)});case F.WordArtVert:case F.WordArtVertRtl:return D(M({},t),{writingMode:My(e),textOrientation:"upright"});case F.Vert:{var s=Ty(i,t,e),o=(r=t.transform)!=null?r:"";return D(M(M({},t),s),{position:"absolute",minHeight:i.insideTable?void 0:s.height,paddingLeft:t.paddingBottom,paddingTop:t.paddingLeft,paddingRight:t.paddingTop,paddingBottom:t.paddingRight,transform:"".concat(o," rotate(90deg)")})}case F.Vert270:{var _s33=Ty(i,t,e),_o26=(n=t.transform)!=null?n:"";return D(M(M({},t),_s33),{position:"absolute",minHeight:i.insideTable?void 0:_s33.height,paddingLeft:t.paddingTop,paddingTop:t.paddingRight,paddingRight:t.paddingBottom,paddingBottom:t.paddingLeft,transform:"".concat(_o26," rotate(-90deg)")})}default:return t;}}function Ey(e){var t=e.childElement("a:bodyPr").attr.getStringOptional("vert");if(!t){var i=e.parentElementOptional("a:tc");if(i){var _r120=i.childElementOptional("a:tcPr");_r120&&(t=_r120.attr.getStringOptional("vert"))}}return t||F.Horz}function yx(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.Horz;var t=arguments.length>1?arguments[1]:undefined;return e===F.WordArtVertRtl?D(M({},t),{marginTop:t.marginLeft,marginLeft:t.marginBottom,marginRight:t.marginTop}):e===F.EaVert||e===F.WordArtVert?D(M({},t),{marginTop:t.marginLeft,marginLeft:t.marginTop,marginRight:t.marginBottom}):t}function bx(e,t,i){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;var n,s,o,a,c,h,d,u,p,f,m,g;var y=0,b;return t.includes("m")?b=(a=(o=(s=(n=e==null?void 0:e.master)==null?void 0:n.shapes)==null?void 0:s[t.replace("m","")])==null?void 0:o.textBodyMap)==null?void 0:a[0]:t.includes("l")?b=(u=(d=(h=(c=e==null?void 0:e.layout)==null?void 0:c.shapes)==null?void 0:h[t.replace("l","")])==null?void 0:d.textBodyMap)==null?void 0:u[0]:b=(g=(m=(f=(p=e==null?void 0:e.slide)==null?void 0:p.shapes)==null?void 0:f[t])==null?void 0:m.textBodyMap)==null?void 0:g[0],b&&(i==null?b.paragraphs:b.paragraphs.slice(i,i+1)).forEach(function(S){S.runs.forEach(function(w){w.text&&(r&&w.prop.language==="en"?y+=1:y+=w.text.length)})}),y}function vx(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:F.Horz;var t=arguments.length>1?arguments[1]:undefined;var i=arguments.length>2?arguments[2]:undefined;var r={};return e===F.Horz?r.height="".concat(i,"px"):(r.height="".concat(t,"px"),r.width="".concat(i,"px"),(e===F.Vert||e===F.Vert270)&&(r.width="".concat(t,"px"),r.height="".concat(i,"px")),e===F.WordArtVert||e===F.WordArtVertRtl?r.margin="0 0.6em":r.whiteSpace="nowrap",(e===F.EaVert||e===F.WordArtVertRtl)&&(r.transformOrigin="100% 0")),r}function Sx(e){var t;var i=e.childElementOptional("p:txBody","a:bodyPr");return(t=i==null?void 0:i.attr.getStringOptional("vert"))!=null?t:F.Horz}function wx(e){if(e===void 0)return e;if(/^#([A-Fa-f0-9]{8})$/.test(e)){var t=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),_r121=parseInt(e.slice(5,7),16),n=parseInt(e.slice(7,9),16);return n===255?"rgb(".concat(t,",").concat(i,",").concat(_r121,")"):"rgba(".concat(t,",").concat(i,",").concat(_r121,",").concat(n/256,")")}else return e}function Pd(e){var t;var i=e.run.prop,r;i.underLine&&(r="underline"),i.strikeThrough&&(r=r?"".concat(r," line-through"):"line-through");var n;e.run.runType==="tab"&&(n={display:"inline-block",width:e.run.prop.width});var s="'".concat(i.font,"-").concat(e.uuid,"','").concat(i.font,"'"),o=(1-Math.abs(i.baseline))*i.size,a={fontSize:"".concat(o/e.transformScale,"px"),lineHeight:"".concat(i.lineSpacing/e.transformScale,"px")};return M(M({color:wx((t=i.fillType)==null?void 0:t.color),fontFamily:s,fontSize:"".concat(o,"px"),fontStyle:i.italic?"italic":"normal",fontWeight:kx(i),letterSpacing:"".concat(i.kerning||0,"px"),lineHeight:"".concat(i.lineSpacing,"px"),backgroundColor:i.highlightColor,verticalAlign:i.baseline?"".concat(i.baseline*100,"%"):void 0,textDecoration:r},n),a)}function kx(e){return e.fontWeight?e.fontWeight:e.bold?"bold":"normal"}var el={display:"inline-block",textIndent:0},Cx=/*#__PURE__*/function(_Xt$default$Component){_inherits(Cx,_Xt$default$Component);var _super57=_createSuper(Cx);function Cx(e){var _this193;_classCallCheck(this,Cx);_this193=_super57.call(this,e);_this193.styles=Pd(e);return _this193}_createClass(Cx,[{key:"renderSingleTextNodes",value:function renderSingleTextNodes(e){return e.split("").map(function(t,i){return Xt["default"].createElement("span",{key:i,className:ft.Text,style:el},t)})}},{key:"render",value:function render(){var _this$props18=this.props,e=_this$props18.run,t=_this$props18.withAnimation,i=e.text||" ",r=i.split("").map(function(n,s){return Xt["default"].createElement("span",{key:s,className:ft.Text,style:el},n)});return Xt["default"].createElement("span",{style:M({},this.styles)},t?r:i)}}]);return Cx}(Xt["default"].Component),xx=/*#__PURE__*/function(_Xt$default$Component2){_inherits(xx,_Xt$default$Component2);var _super58=_createSuper(xx);function xx(e){var _this194;_classCallCheck(this,xx);_this194=_super58.call(this,e);_this194.horizontalText="",_this194.needSideWayCharacterList=mx(e.vert),_this194.needUpRightCharacterList=fx(e.vert);var t=Pd(e);_this194.fontSpanStyle=M(D(M({},t),{maxHeight:t.fontSize}),px(e.vert));return _this194}_createClass(xx,[{key:"renderHorizontalNumber",value:function renderHorizontalNumber(e,t){if(!this.horizontalText)return null;var i=this.horizontalText,_this$props19=this.props,r=_this$props19.run,n=_this$props19.vert;return this.horizontalText="",r.prop.kumimoji&&n===F.EaVert?Xt["default"].createElement("span",{className:ft.Text,key:t+i,style:M(D(M({},e),{writingMode:"horizontal-tb"}),el)},i):Xt["default"].createElement("span",{key:t+i,style:e},Xt["default"].createElement("span",{className:ft.Text,style:el},i))}},{key:"render",value:function render(){var _this195=this;var _this$props20=this.props,e=_this$props20.run,t=_this$props20.vert,i=e.runType==="tab"?" ":e.text||" ",r=Pd(this.props),n=D(M({},this.fontSpanStyle),{display:"inline-block",verticalAlign:"middle",textIndent:0});return Xt["default"].createElement("span",{style:M({},r)},i&&i.split("").map(function(s,o){return t===F.EaVert&&!Number.isNaN(parseInt(s,10))?(_this195.horizontalText+=s,_this195.horizontalText.length===2?_this195.renderHorizontalNumber(_this195.fontSpanStyle,o):Number.isNaN(parseInt(i[o+1],10))?_this195.renderHorizontalNumber(_this195.fontSpanStyle,o):null):_this195.needSideWayCharacterList.includes(s)?Xt["default"].createElement("span",{className:ft.Text,key:o,style:D(M({},n),{transform:"rotate(90deg)",display:"inline-block"})},s):_this195.needUpRightCharacterList.includes(s)?Xt["default"].createElement("span",{className:ft.Text,key:o,style:D(M({},n),{transform:"rotate(-90deg)",display:"inline-block"})},s):Xt["default"].createElement("span",{className:ft.Text,key:o,style:D(M({},_this195.fontSpanStyle),{display:"inline-block"})},s)}))}}]);return xx}(Xt["default"].Component),Ix=/*#__PURE__*/function(_ns$default$Component){_inherits(Ix,_ns$default$Component);var _super59=_createSuper(Ix);function Ix(){_classCallCheck(this,Ix);return _super59.apply(this,arguments)}_createClass(Ix,[{key:"getScaleStyle",value:function getScaleStyle(e){var t=e.reduce(function(s,o){return(1-Math.abs(o.prop.baseline))*o.prop.size<(1-Math.abs(s.prop.baseline))*s.prop.size?o:s}),i=(1-Math.abs(t.prop.baseline))*t.prop.size,r={},n=1;return i<12&&(n=i/12,r.transform="scale(".concat(n,")"),r.transformOrigin="0 0",r.lineHeight="1",r.display="block"),{scaleStyle:r,transformScale:n}}},{key:"splitRuns",value:function splitRuns(e){function t(i){var r=i.codePointAt(0)||0;return r>=65&&r<=122}return(e.text||"").split("").reduce(function(i,r){var n=i[i.length-1];if(n===void 0)return i.push(D(M({},e),{text:r})),i;var s=n.text||"",o=s[s.length-1],a=t(o),c=t(r);return a&&c?n.text="".concat(s).concat(r):i.push(D(M({},e),{text:r})),i},[])}},{key:"render",value:function render(){var _this196=this;var _this$props21=this.props,e=_this$props21.line,t=_this$props21.justify,i=_this$props21.vert,r=_this$props21.lineIndent,n=_this$props21.align,s=_this$props21.textBodyWrapResource,o=e,a=this.props.uuid,c={};t?(o=e.reduce(function(y,b){var S=_this196.splitRuns(b),w=y;return w=w.concat(S),w},[]),c={display:"flex",justifyContent:"space-between",width:"calc(100% - ".concat(r||0,"px"),position:"relative",left:r}):c={textIndent:r};var h=o.reduce(function(y,b){return b.prop.lineSpacing>y.prop.lineSpacing?b:y}).prop.lineSpacing,d=0;o.forEach(function(y){d+=Number(y.prop.width)});var u=vx(i,d,h);n==="dist"&&i!==F.Horz&&(u.height=s==null?void 0:s.prop.height);var _this$getScaleStyle=this.getScaleStyle(o),p=_this$getScaleStyle.scaleStyle,f=_this$getScaleStyle.transformScale,m=D(M(M(M({},c),u),p),{whiteSpace:"pre"}),g=this.props.withAnimation;return i!==F.Horz?ns["default"].createElement("div",{style:m},o.map(function(y,b){return ns["default"].createElement(xx,{withAnimation:g,transformScale:f,vert:i,uuid:a,key:b,run:y,firstRun:b===0})})):ns["default"].createElement("div",{style:m},o.map(function(y,b){return ns["default"].createElement(Cx,{withAnimation:g,transformScale:f,uuid:a,key:b,run:y,firstRun:b===0})}))}}]);return Ix}(ns["default"].Component),tl;(function(e){e.r="r",e.l="l",e.crl="ctr",e.dist="dist",e.just="just"})(tl||(tl={}));var Px=/*#__PURE__*/function(_At$default$Component){_inherits(Px,_At$default$Component);var _super60=_createSuper(Px);function Px(e){var _this197;_classCallCheck(this,Px);_this197=_super60.call(this,e);if(!e.paragraphXML||!e.bodyPrXML)return _possibleConstructorReturn(_this197);var t=e.bodyPrXML,i=e.paragraphXML;_this197.runElements=i.elements.filter(function(n){return["a:fld","a:r","a:br","a:endParaRPr"].includes(n.name)}),_this197.biggestFontSize=_toConsumableArray(_this197.runElements).filter(function(n){return n.name==="a:r"}).map(function(n){return n.extraAttr.getNumber("sz",0)}).sort(function(n,s){return n-s})[0],_this197.fontScale=.01;var r=t.childElementOptional("a:normAutofit");if(r&&(_this197.fontScale=xe(r.attr.getNumber("fontScale",H))/100),_this197.buChar=i.extraElementWithName("bu"),_this197.indent=i.extraAttr.getNumber("indent",0),_this197.marL=i.extraAttr.getNumber("marL",0),_this197.lineHeightInXml=i.extraAttr.get("lineHeight"),typeof _this197.lineHeightInXml!="number")_this197.lineHeight="".concat(parseFloat(_this197.lineHeightInXml)*_this197.fontScale*100,"pt");else{var n=_this197.getBigestLineHeight(_toConsumableArray(_this197.runElements),_this197.lineHeightInXml,_this197.fontScale);_this197.lineHeight=n===void 0?void 0:"".concat(n,"pt")}_this197.buClr=i.extraAttr.getColorOptional("buClr"),_this197.noneBuChar=_this197.buChar===void 0||_this197.buChar.name==="a:buNone",_this197.paddingBottom=_this197.getPaddingBottom(i.extraAttr.getStringOptional("a:spcAft"),_this197.biggestFontSize),_this197.paddingBottom=_this197.getPaddingTop(i.extraAttr.getStringOptional("a:spcBef"),_this197.biggestFontSize),_this197.align=i.extraAttr.getStringOptional("algn");return _this197}_createClass(Px,[{key:"getPaddingBottom",value:function getPaddingBottom(e,t){var _this$props22=this.props,i=_this$props22.isLast,r=_this$props22.spcFirstLastPara;return i&&!r?"0pt":this.getPadding(e,t)}},{key:"getPaddingTop",value:function getPaddingTop(e,t){var _this$props23=this.props,i=_this$props23.isFirst,r=_this$props23.spcFirstLastPara;return i&&!r?"0pt":this.getPadding(e,t)}},{key:"getPadding",value:function getPadding(e,t){if(e){if(e.indexOf("pt")!==-1)return e;if(t)return"".concat(t*parseFloat(e)/100,"pt")}return"0pt"}},{key:"getBigestLineHeight",value:function getBigestLineHeight(e,t,i){var r;return e.forEach(function(n){switch(n.name){case"a:fld":case"a:r":case"a:br":case"a:endParaRPr":{var s=n.extraAttr.getNumber("sz",0)*1.2*t*i;(r===void 0||r<s)&&(r=s)}}}),r}},{key:"isFlexSpaceBetween",value:function isFlexSpaceBetween(e,t,i){return e===tl.dist?!0:e===tl.just&&t!==i-1}},{key:"renderWrapParagraph",value:function renderWrapParagraph(e){var _this$props24=this.props,t=_this$props24.paragraphWrapResource,i=_this$props24.bulletInfo,r=_this$props24.vert,n=t,_n$prop=n.prop,s=_n$prop.spaceBefore,o=_n$prop.spaceAfter,a=_n$prop.firstLineIndent,_n$prop2=n.prop,c=_n$prop2.align,h=_n$prop2.bulletChar,d=_n$prop2.indent,u=_n$prop2.marginLeft,p=_n$prop2.marginRight;if(e.length===0&&n.endParagraphRunProp){var _n$endParagraphRunPro=n.endParagraphRunProp,g=_n$endParagraphRunPro.spaceBefore,y=_n$endParagraphRunPro.spaceAfter;s=g,o=y}i.order===0&&(s=0),i.order+1===i.count&&(o=0);var f=yx(r,{marginLeft:u,marginRight:p,marginTop:s,marginBottom:o}),m=D(M({textAlign:Id(c),position:"relative",fontSize:"0",lineHeight:"0"},f),{whiteSpace:"pre"});return a===void 0&&(a=Math.max(d,-u),h&&(a=d>=0?d:Math.max(0,-(u+d)))),At["default"].createElement("div",{className:ft.Paragraph,style:m},h&&this.renderBulletCharNode(e),this.renderLines(e,a,c))}},{key:"renderBulletCharNode",value:function renderBulletCharNode(e){var t;var _this$props25=this.props,i=_this$props25.paragraphWrapResource,r=_this$props25.bulletInfo,n=_this$props25.vert,s=i,_s$prop=s.prop,o=_s$prop.bulletChar,a=_s$prop.indent;if(!o)return;var c=e.length===0,h=r.number,d=e.slice(0,1),u=d[0]&&d[0][0],p=o.colorFollowText&&u?(t=u.prop.fillType)==null?void 0:t.color:o.color,f=o.fontFollowText&&u?u.prop.font:o.font,m=o.sizeFollowText&&u?u.prop.size:o.size,g=u?"".concat(u.prop.lineSpacing,"px"):void 0,y=o.autoNumber!==void 0&&o.autoNumberType!==void 0,b=a>=0?0:a,S="";c||(y&&h&&(S=Py(h,o.autoNumberType)),y||(S+=Iy(o.character||"l")));var w={position:"absolute",fontFamily:f,fontSize:m,textIndent:b,color:p,lineHeight:g};return n===F.EaVert&&(w.textOrientation="sideways"),At["default"].createElement("div",{style:w},S)}},{key:"renderLines",value:function renderLines(e,t,i){var _this198=this;var _this$props26=this.props,r=_this$props26.paragraphWrapResource,n=_this$props26.uuid,s=_this$props26.vert,o=_this$props26.withAnimation,a=_this$props26.textBodyWrapResource;if(e.length===0){var c={},h=r.endParagraphRunProp?r.endParagraphRunProp.lineSpacing:void 0,d=r.endParagraphRunProp?r.endParagraphRunProp.size:void 0,u;if(d&&d<12){var p=d/12;d=12,h=h?h*p:void 0,u="scale(".concat(p,")"),c.display="inline-block"}return c.lineHeight="".concat(h,"px"),c.fontSize="".concat(d,"px"),c.transform=u,At["default"].createElement("span",{style:{lineHeight:"".concat(h,"px"),fontSize:"".concat(d,"px"),transform:u}},At["default"].createElement("br",null))}return e.map(function(c,h){return At["default"].createElement(Ix,{key:h,withAnimation:o,uuid:n,vert:s,lineIndent:h===0?t:void 0,line:c,align:i,textBodyWrapResource:a,justify:_this198.isFlexSpaceBetween(i,h,e.length)})})}},{key:"renderRunOrBrOrEnd",value:function renderRunOrBrOrEnd(e,t,i,r,n,s,o,a,c){var _this$props27=this.props,h=_this$props27.isTextWrap,d=_this$props27.slideContext;return At["default"].createElement(dx,{key:"".concat(t,"-").concat(i),isTextWrap:h,paragraphHasRange:a!==void 0,rNodeOrBrNode:e,fontScale:r,runIndex:i,indent:i===0&&this.noneBuChar&&this.marL!==0?s:void 0,slideIndex:d.slideIndex,prevElement:c,lineHeight:n,align:this.align?this.align:"l",lastRunInParagraph:o})}},{key:"render",value:function render(){var _this199=this;var _this$props28=this.props,e=_this$props28.paragraphXML,t=_this$props28.resourceType,i=_this$props28.paragraphIndex,r=_this$props28.paragraphWrapResource,n=_this$props28.firstRangeXML,s=_this$props28.buIndexCounter,o=_this$props28.isTextWrap,a=e==null?void 0:e.extraAttr.getBoolean("placeHolderType");if(t!=="slide"&&a)return At["default"].createElement("div",{key:"".concat(i)});if(r)return this.renderWrapParagraph(r.lines);if(!e)return null;var c,h=Id(this.align),d=this.runElements.map(function(p,f){var m=h==="left"&&f===_this199.runElements.length-1,g=_this199.renderRunOrBrOrEnd(p,i,f,_this199.fontScale,_this199.lineHeightInXml,_this199.indent,m,n,c);return c=p,g}),u=0;if(n){if(this.buChar&&this.buChar.name!=="a:buNone"){var p=n.extraAttr.getNumber("sz",0),f=n.extraAttr.getString("fontType","");d.unshift(At["default"].createElement("span",{key:"bu-".concat(u+=1),style:{display:"inline-block",position:"absolute",color:this.buClr!==void 0?K(this.buClr):K(n.extraAttr.getColorOptional("color")),fontSize:"".concat(p*this.fontScale,"pt"),lineHeight:this.lineHeight,fontFamily:f,textIndent:I(this.indent)}},At["default"].createElement(lx,{paragraphXML:e,firstRangeXML:n,buXML:this.buChar,buIndexCounter:s})))}}else{var _p14=0,_f14=e.childElementOptional("a:endParaRPr");if(_f14){var m=_f14.extraAttr.getNumberOptional("sz");_p14=m===void 0?0:m}else _p14=e.extraAttr.getNumber("sz",0);d.push(At["default"].createElement("span",{key:"end-".concat(u+=1),style:{display:"block",lineHeight:this.lineHeight,fontSize:"".concat(_p14*this.fontScale,"pt")}},At["default"].createElement("br",null)))}return this.buChar&&this.buChar.name==="a:buNone"&&s.reset(),At["default"].createElement("li",{key:"".concat(i),className:"".concat(ft.Paragraph," Paragraph-").concat(i),style:{whiteSpace:o?"normal":"nowrap",paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,marginLeft:I(e.extraAttr.getNumber("marL",0)),marginRight:I(e.extraAttr.getNumber("marR",0)),lineHeight:"1pt",listStyleType:"none",textAlign:h}},d)}}]);return Px}(At["default"].Component),Md={"*/":function _(e,t,i){return e*t/i},"+-":function _(e,t,i){return e+t-i},"+/":function _(e,t,i){return(e+t)/i},"?:":function _(e,t,i){return e>0?t:i},abs:function abs(e){return Math.abs(e)},at2:function at2(e,t){return Mx(Math.atan2(t,e))},cat2:function cat2(e,t,i){return e*Math.cos(Math.atan2(i,t))},cos:function cos(e,t){return e*Math.cos(Td(t))},max:function max(e,t){return e>t?e:t},min:function min(e,t){return e<t?e:t},mod:function mod(e,t,i){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(i,2))},pin:function pin(e,t,i){return t<e?e:t>i?i:t},sat2:function sat2(e,t,i){return e*Math.sin(Math.atan2(i,t))},sin:function sin(e,t){return e*Math.sin(Td(t))},sqrt:function sqrt(e){return Math.sqrt(e)},tan:function tan(e,t){return e*Math.tan(Td(t))},val:function val(e){return e}};function Td(e){return e/Et*(Math.PI/180)}function Mx(e){return e*(180/Math.PI)*Et}var q=/*#__PURE__*/function(){function q(e){_classCallCheck(this,q);this.expr=e}_createClass(q,[{key:"standardizationTokenSplit",value:function standardizationTokenSplit(e){return e.replace(/\s+/g," ")}},{key:"eval",value:function _eval(e){var t=this.standardizationTokenSplit(this.expr).split(" "),i=t.slice(1,t.length).map(function(r){return Number.isNaN(Number(r))?e.getRequiredVariable(r):parseInt(r,10)});if(Md[t[0]]===void 0)throw new Error("Formula ".concat(t[0]," not supported"));return Md[t[0]].apply(Md,_toConsumableArray(i))}}],[{key:"deconstructShapeGuide",value:function deconstructShapeGuide(e){var _e$split=e.split(" "),_e$split2=_toArray(_e$split),t=_e$split2[0],i=_e$split2.slice(1),r=i.map(function(n){return parseInt(n,10)});return Md[t].apply(Md,_toConsumableArray(r))}}]);return q}();function Ir(_x98,_x99){return _Ir.apply(this,arguments)}function _Ir(){_Ir=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee112(e,t){var i,_r227;return regeneratorRuntime.wrap(function _callee112$(_context116){while(1){switch(_context116.prev=_context116.next){case 0:_context116.next=2;return Oy(e,void 0,t,5e3);case 2:i=_context116.sent;if(!(i.status!==200)){_context116.next=8;break}_context116.next=6;return i.text();case 6:_r227=_context116.sent;throw Ay(e,i.status,t,new Error(_r227)).then(function(){},function(){}),new Error("fetch ".concat(e," failed with ").concat(i.status));case 8:_context116.next=10;return i.text();case 10:return _context116.abrupt("return",_context116.sent);case 11:case"end":return _context116.stop();}}},_callee112)}));return _Ir.apply(this,arguments)}function Pr(_x100,_x101){return _Pr.apply(this,arguments)}function _Pr(){_Pr=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee113(e,t){var i,_r228;return regeneratorRuntime.wrap(function _callee113$(_context117){while(1){switch(_context117.prev=_context117.next){case 0:_context117.next=2;return Oy(e,{headers:{"content-type":"application/json",Accept:"application/json"}},t,5e3);case 2:i=_context117.sent;if(!(i.status!==200)){_context117.next=8;break}_context117.next=6;return i.text();case 6:_r228=_context117.sent;throw Ay(e,i.status,t,new Error(_r228)).then(function(){},function(){}),new Error("fetch ".concat(e," failed with ").concat(i.status));case 8:_context117.next=10;return i.json();case 10:return _context117.abrupt("return",_context117.sent);case 11:case"end":return _context117.stop();}}},_callee113)}));return _Pr.apply(this,arguments)}function Ay(_x102,_x103,_x104,_x105){return _Ay.apply(this,arguments)}function _Ay(){_Ay=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee114(e,t,i,r){return regeneratorRuntime.wrap(function _callee114$(_context118){while(1){switch(_context118.prev=_context118.next){case 0:window&&window.postMessage({name:"pptDataLoadError",src:e,event:"PPT data load failed",status:t},"*"),i==null||i.error("fetch ".concat(JSON.stringify(e)," failed with ").concat(t," : "),r);case 1:case"end":return _context118.stop();}}},_callee114)}));return _Ay.apply(this,arguments)}function Oy(_x106,_x107,_x108,_x109){return _Oy.apply(this,arguments)}function _Oy(){_Oy=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee115(e,t,i,r){var n,s;return regeneratorRuntime.wrap(function _callee115$(_context119){while(1){switch(_context119.prev=_context119.next){case 0:n=setTimeout(function(){i==null||i.warn("fetch ".concat(e," for ").concat(r,"ms"))},r);_context119.prev=1;_context119.next=4;return fetch(e,M({},t));case 4:s=_context119.sent;return _context119.abrupt("return",(clearTimeout(n),s));case 8:_context119.prev=8;_context119.t0=_context119["catch"](1);throw clearTimeout(n),i==null||i.error("fetch ".concat(e," with error ").concat(_context119.t0)),_context119.t0;case 11:case"end":return _context119.stop();}}},_callee115,null,[[1,8]])}));return _Oy.apply(this,arguments)}var Tx=/*#__PURE__*/function(){function Tx(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"keyval-store";var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"keyval";_classCallCheck(this,Tx);this.storeName=t,this._dbp=new Promise(function(i,r){var n=indexedDB.open(e,1);n.onerror=function(){return r(n.error)},n.onsuccess=function(){return i(n.result)},n.onupgradeneeded=function(){n.result.createObjectStore(t)}})}_createClass(Tx,[{key:"_withIDBStore",value:function _withIDBStore(e,t){var _this200=this;return this._dbp.then(function(i){return new Promise(function(r,n){var s=i.transaction(_this200.storeName,e);s.oncomplete=function(){return r()},s.onabort=s.onerror=function(){return n(s.error)},t(s.objectStore(_this200.storeName))})})}}]);return Tx}(),Ed;function Ry(){return Ed||(Ed=new Tx),Ed}function Ex(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Ry();var i;return t._withIDBStore("readonly",function(r){i=r.get(e)}).then(function(){return i.result})}function Ax(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Ry();return i._withIDBStore("readwrite",function(r){r.put(t,e)})}var Ox=/*#__PURE__*/function(){function Ox(){_classCallCheck(this,Ox);this.attributePickers={},this.childPickers={}}_createClass(Ox,[{key:"createPickers",value:function createPickers(){return new Rx(this.attributePickers,this.childPickers)}},{key:"bindAttributePicker",value:function bindAttributePicker(e,t,i){this.bindPicker(e,t,i,this.attributePickers)}},{key:"bindChildPicker",value:function bindChildPicker(e,t,i){this.bindPicker(e,t,i,this.childPickers)}},{key:"bindPicker",value:function bindPicker(e,t,i,r){typeof e=="string"&&(e=[e]),typeof t=="string"&&(t=[t]);var _iterator195=_createForOfIteratorHelper(e),_step195;try{for(_iterator195.s();!(_step195=_iterator195.n()).done;){var n=_step195.value;this.bindPickerWithAttributeNames(n,t,i,r)}}catch(err){_iterator195.e(err)}finally{_iterator195.f()}}},{key:"bindPickerWithAttributeNames",value:function bindPickerWithAttributeNames(e,t,i,r){var n=r[e];if(n||(n=r[e]={}),_typeof(n)=="object"){var _iterator196=_createForOfIteratorHelper(t),_step196;try{for(_iterator196.s();!(_step196=_iterator196.n()).done;){var s=_step196.value;n[s]=i}}catch(err){_iterator196.e(err)}finally{_iterator196.f()}}}}]);return Ox}(),Ny=/*#__PURE__*/function(){function Ny(e){_classCallCheck(this,Ny);this.pickers=e}_createClass(Ny,[{key:"forEach",value:function forEach(e,t){var i=this.pickers[e];if(i)for(var _r122 in i){_r122!=="*"&&t(_r122)}}},{key:"has",value:function has(e,t){var i=this.pickers[e];return i?t in i||"*"in i:!1}},{key:"get",value:function get(e,t,i,r,n,s){var o=this.pickers[t];if(o){var a=o[i];if(a||(a=o["*"]),a)return a(r,e,i,n,s)}}}]);return Ny}(),Rx=/*#__PURE__*/function(){function Rx(e,t){_classCallCheck(this,Rx);this.attributePickers=new Ny(e),this.childPickers=new Ny(t)}_createClass(Rx,[{key:"forEachAttributes",value:function forEachAttributes(e,t){this.attributePickers.forEach(e,t)}},{key:"hasAttribute",value:function hasAttribute(e,t){return this.attributePickers.has(e,t)}},{key:"getAttribute",value:function getAttribute(e,t,i,r,n){if(this.context)return this.attributePickers.get(this.context,e,t,i,r,n)}},{key:"getChild",value:function getChild(e,t,i,r,n){if(this.context)return this.childPickers.get(this.context,e,t,i,r,n)}}]);return Rx}(),uo=/*#__PURE__*/function(){function uo(e){_classCallCheck(this,uo);this.resourceScheme=e}_createClass(uo,[{key:"loadLumiaPSD",value:function(){var _loadLumiaPSD=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee59(e,t){var i,r;return regeneratorRuntime.wrap(function _callee59$(_context61){while(1){switch(_context61.prev=_context61.next){case 0:r="https://convertcdn.netless.link/publicFiles/xml/PresetShapeDefinitions.xml";this.resourceScheme&&(r=r.replace(/^[a-zA-z]+[^://]/,this.resourceScheme));if(!(e===!1)){_context61.next=8;break}_context61.next=5;return Ir(r,t);case 5:i=_context61.sent;_context61.next=18;break;case 8:_context61.next=10;return Ex("PresetShapeDefinitions");case 10:i=_context61.sent;_context61.t0=i===void 0;if(!_context61.t0){_context61.next=18;break}_context61.next=15;return Ir(r,t);case 15:i=_context61.sent;_context61.next=18;return Ax("PresetShapeDefinitions",i);case 18:uo.presetShapeDefinitons=new nn("slide").parse(i).childElement("presetShapeDefinitons");case 19:case"end":return _context61.stop();}}},_callee59,this)}));function loadLumiaPSD(_x111,_x112){return _loadLumiaPSD.apply(this,arguments)}return loadLumiaPSD}()},{key:"preLoad",value:function(){var _preLoad=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee60(e,t,i,r){var n,s,o,a;return regeneratorRuntime.wrap(function _callee60$(_context62){while(1){switch(_context62.prev=_context62.next){case 0:_context62.next=2;return this.fetchAllResourceUrl(t,i,r.logger);case 2:n=_context62.sent;s=0;case 4:if(!(s<n.length)){_context62.next=12;break}o=s+1,a=n[s];_context62.next=8;return this.prefetchPageResource(a);case 8:r.preloadProgress&&r.preloadProgress((o/n.length).toFixed(2));case 9:s++;_context62.next=4;break;case 12:case"end":return _context62.stop();}}},_callee60,this)}));function preLoad(_x113,_x114,_x115,_x116){return _preLoad.apply(this,arguments)}return preLoad}()},{key:"prefetchPageResource",value:function(){var _prefetchPageResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee61(e){var t,_i42,_Object$keys,i;return regeneratorRuntime.wrap(function _callee61$(_context63){while(1){switch(_context63.prev=_context63.next){case 0:t=[];for(_i42=0,_Object$keys=Object.keys(e);_i42<_Object$keys.length;_i42++){i=_Object$keys[_i42];t.push(this.prefetchResource(e[i]))}_context63.next=4;return Promise.all(t);case 4:case"end":return _context63.stop();}}},_callee61,this)}));function prefetchPageResource(_x117){return _prefetchPageResource.apply(this,arguments)}return prefetchPageResource}()},{key:"prefetchResource",value:function(){var _prefetchResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee62(e){var t,i,_i43,_t14,_r123,n,s;return regeneratorRuntime.wrap(function _callee62$(_context64){while(1){switch(_context64.prev=_context64.next){case 0:if(!(Object.keys(e).length>0)){_context64.next=15;break}t=Object.keys(e),i=[];_i43=0,_t14=t;case 3:if(!(_i43<_t14.length)){_context64.next=13;break}_r123=_t14[_i43];n=e[_r123];if(!n.endsWith(".mp4")){_context64.next=8;break}return _context64.abrupt("continue",10);case 8:s=n;this.resourceScheme&&(s=n.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),i.push(this.fetch(s));case 10:_i43++;_context64.next=3;break;case 13:_context64.next=15;return Promise.all(i);case 15:case"end":return _context64.stop();}}},_callee62,this)}));function prefetchResource(_x118){return _prefetchResource.apply(this,arguments)}return prefetchResource}()},{key:"fetch",value:function(_fetch2){function fetch(_x110){return _fetch2.apply(this,arguments)}fetch.toString=function(){return _fetch2.toString()};return fetch}(/*#__PURE__*/function(){var _ref79=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee63(e){return regeneratorRuntime.wrap(function _callee63$(_context65){while(1){switch(_context65.prev=_context65.next){case 0:_context65.prev=0;_context65.next=3;return fetch(e);case 3:_context65.next=8;break;case 5:_context65.prev=5;_context65.t0=_context65["catch"](0);console.debug("cache fail",_context65.t0);case 8:case"end":return _context65.stop();}}},_callee63,null,[[0,5]])}));return function(_x119){return _ref79.apply(this,arguments)}}())},{key:"fetchAllResourceUrl",value:function(){var _fetchAllResourceUrl=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee64(e,t,i){var r,n;return regeneratorRuntime.wrap(function _callee64$(_context66){while(1){switch(_context66.prev=_context66.next){case 0:r=[];for(n=1;n<=t;n++){r.push(Pr("".concat(e,"/resources/resource").concat(n,".json"),i))}_context66.next=4;return Promise.all(r);case 4:return _context66.abrupt("return",_context66.sent);case 5:case"end":return _context66.stop();}}},_callee64)}));function fetchAllResourceUrl(_x120,_x121,_x122){return _fetchAllResourceUrl.apply(this,arguments)}return fetchAllResourceUrl}()},{key:"fetchPageResource",value:function(){var _fetchPageResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee65(e,t,i){return regeneratorRuntime.wrap(function _callee65$(_context67){while(1){switch(_context67.prev=_context67.next){case 0:_context67.next=2;return Pr("".concat(e,"/resources/resource").concat(t,".json"),i);case 2:return _context67.abrupt("return",_context67.sent);case 3:case"end":return _context67.stop();}}},_callee65)}));function fetchPageResource(_x123,_x124,_x125){return _fetchPageResource.apply(this,arguments)}return fetchPageResource}()}]);return uo}(),Ly=/*#__PURE__*/function(){function Ly(e){_classCallCheck(this,Ly);this.foundStartPostion=!1,this.variablesMap=e,this.injectConstant()}_createClass(Ly,[{key:"injectConstant",value:function injectConstant(){this.setVariable("3cd4",162e5),this.setVariable("3cd8",81e5),this.setVariable("5cd8",135e5),this.setVariable("7cd8",189e5),this.setVariable("b",new q("val h").eval(this)),this.setVariable("cd2",108e5),this.setVariable("cd4",54e5),this.setVariable("cd8",27e5),this.setVariable("hc",new q("*/ w 1.0 2.0").eval(this)),this.setVariable("hd2",new q("*/ h 1.0 2.0").eval(this)),this.setVariable("hd3",new q("*/ h 1.0 3.0").eval(this)),this.setVariable("hd4",new q("*/ h 1.0 4.0").eval(this)),this.setVariable("hd5",new q("*/ h 1.0 5.0").eval(this)),this.setVariable("hd6",new q("*/ h 1.0 6.0").eval(this)),this.setVariable("hd8",new q("*/ h 1.0 8.0").eval(this)),this.setVariable("l",0),this.setVariable("ls",new q("max w h").eval(this)),this.setVariable("r",new q("val w").eval(this)),this.setVariable("ss",new q("min w h").eval(this)),this.setVariable("ssd2",new q("*/ ss 1.0 2.0").eval(this)),this.setVariable("ssd4",new q("*/ ss 1.0 4.0").eval(this)),this.setVariable("ssd6",new q("*/ ss 1.0 6.0").eval(this)),this.setVariable("ssd8",new q("*/ ss 1.0 8.0").eval(this)),this.setVariable("ssd16",new q("*/ ss 1.0 16.0").eval(this)),this.setVariable("ssd32",new q("*/ ss 1.0 32.0").eval(this)),this.setVariable("t",0),this.setVariable("vc",new q("*/ h 1.0 2.0").eval(this)),this.setVariable("wd2",new q("*/ w 1.0 2.0").eval(this)),this.setVariable("wd3",new q("*/ w 1.0 3.0").eval(this)),this.setVariable("wd4",new q("*/ w 1.0 4.0").eval(this)),this.setVariable("wd5",new q("*/ w 1.0 5.0").eval(this)),this.setVariable("wd6",new q("*/ w 1.0 6.0").eval(this)),this.setVariable("wd8",new q("*/ w 1.0 8.0").eval(this)),this.setVariable("wd10",new q("*/ w 1.0 10.0").eval(this)),this.setVariable("wd12",new q("*/ w 1.0 12.0").eval(this)),this.setVariable("wd32",new q("*/ w 1.0 32.0").eval(this))}},{key:"getVariable",value:function getVariable(e,t){return this.variablesMap[e]!==void 0?this.variablesMap[e]:t}},{key:"getRequiredVariable",value:function getRequiredVariable(e){if(this.variablesMap[e]!==void 0)return this.variablesMap[e];throw new Error("".concat(e," is required"))}},{key:"setVariable",value:function setVariable(e,t){this.variablesMap[e]=t}},{key:"setVariableIfNotExist",value:function setVariableIfNotExist(e,t){this.variablesMap[e]===void 0&&(this.variablesMap[e]=t)}},{key:"isNumeric",value:function isNumeric(e){return /^-{0,1}\d+$/.test(e)}},{key:"accessValue",value:function accessValue(e){var t;return this.isNumeric(e)?t=parseInt(e,10):t=this.getRequiredVariable(e),t}},{key:"setLatestPostion",value:function setLatestPostion(e,t){this.latestPostionX=e,this.latestPostionY=t,this.foundStartPostion||(this.startPostionX=e,this.startPostionY=t,this.foundStartPostion=!0)}},{key:"getLatestPostion",value:function getLatestPostion(){return{x:this.latestPostionX,y:this.latestPostionY}}},{key:"getStartPostion",value:function getStartPostion(){return{x:this.startPostionX,y:this.startPostionY}}},{key:"inspect",value:function inspect(){console.debug(JSON.stringify(this.variablesMap))}}]);return Ly}(),Dy=/*#__PURE__*/function(){function Dy(){_classCallCheck(this,Dy)}_createClass(Dy,[{key:"renderLumiaPath",value:function renderLumiaPath(e,t){var _this201=this;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var r=e.childElementOptional("".concat(i,"avLst"));r&&r.elementsWithName("".concat(i,"gd")).forEach(function(c){var h=c.attr.getString("fmla"),d=new q(h).eval(t),u=c.attr.getString("name");t.setVariableIfNotExist(u,d)});var n=e.childElementOptional("".concat(i,"gdLst"));n&&n.elementsWithName("".concat(i,"gd")).forEach(function(c){var h=c.attr.getString("fmla"),d=new q(h).eval(t),u=c.attr.getString("name");t.setVariable(u,d)});var s=e.childElementOptional("".concat(i,"rect"));s?(t.setVariable("rectLeft",t.accessValue(s.attr.getString("l"))),t.setVariable("rectTop",t.accessValue(s.attr.getString("t"))),t.setVariable("rectRight",t.accessValue(s.attr.getString("r"))),t.setVariable("rectBottom",t.accessValue(s.attr.getString("b")))):(t.setVariable("rectLeft",t.accessValue("l")),t.setVariable("rectTop",t.accessValue("t")),t.setVariable("rectRight",t.accessValue("r")),t.setVariable("rectBottom",t.accessValue("b")));var o=e.childElement("".concat(i,"pathLst")).elementsWithName("".concat(i,"path")),a=[];return o.forEach(function(c){var h;var d={fill:void 0,pathD:"",isBorder:(h=c.attr.getBooleanOptional("stroke"))!=null?h:!0};d.fill=c.attr.getStringOptional("fill")||void 0;var _this201$calcPathScal=_this201.calcPathScale(c,t),u=_this201$calcPathScal.pathWidthScale,p=_this201$calcPathScal.pathHeightScale,f=c.elements.map(function(m){return new Nx(m,i,u,p).generate(t)});d.pathD=f.join(" "),a.push(d)}),a}},{key:"calcPathScale",value:function calcPathScale(e,t){var i=e.attr.getNumberOptional("w"),r=e.attr.getNumberOptional("h"),n=1,s=1;return i&&(n=t.accessValue("w")/i),r&&(s=t.accessValue("h")/r),{pathWidthScale:n,pathHeightScale:s}}}]);return Dy}(),Nx=/*#__PURE__*/function(){function Nx(e,t,i,r){_classCallCheck(this,Nx);this.actionXML=e,this.namespace=t,this.pathWidthScale=i,this.pathHeightScale=r}_createClass(Nx,[{key:"xUnitTransformAndPathScale",value:function xUnitTransformAndPathScale(e){return e*this.pathWidthScale/Tt}},{key:"yUnitTransformAndPathScale",value:function yUnitTransformAndPathScale(e){return e*this.pathHeightScale/Tt}},{key:"generate",value:function generate(e){var _this202=this;var t=this.actionXML.elementsWithName("".concat(this.namespace,"pt")).map(function(c){return{x:c.attr.getString("x"),y:c.attr.getString("y")}}).map(function(c){var h=_this202.getPtValue(c,e,"x"),d=_this202.getPtValue(c,e,"y");return{x:h,y:d}}),i=t.length>0?t[0].x:0,r=t.length>0?t[0].y:0,n=t.length>1?t[1].x:0,s=t.length>1?t[1].y:0,o=t.length>2?t[2].x:0,a=t.length>2?t[2].y:0;switch(this.actionXML.name){case"".concat(this.namespace,"moveTo"):return e.setLatestPostion(i,r),["M",this.xUnitTransformAndPathScale(i),this.yUnitTransformAndPathScale(r)].join(" ");case"".concat(this.namespace,"lnTo"):return e.setLatestPostion(i,r),["L",this.xUnitTransformAndPathScale(i),this.yUnitTransformAndPathScale(r)].join(" ");case"".concat(this.namespace,"arcTo"):{var c=e.accessValue(this.actionXML.attr.getString("wR")),h=e.accessValue(this.actionXML.attr.getString("hR")),d=e.accessValue(this.actionXML.attr.getString("stAng"))/Et,u=e.accessValue(this.actionXML.attr.getString("swAng"))/Et,_e$getLatestPostion=e.getLatestPostion(),p=_e$getLatestPostion.x,f=_e$getLatestPostion.y,m=this.getSvgArc(c,h,d,u,p,f);return u>=360?(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.middleX),this.yUnitTransformAndPathScale(m.middleY),"A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" ")):(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" "))}case"".concat(this.namespace,"cubicBezTo"):return e.setLatestPostion(o,a),["C",this.xUnitTransformAndPathScale(i),this.yUnitTransformAndPathScale(r),this.xUnitTransformAndPathScale(n),this.yUnitTransformAndPathScale(s),this.xUnitTransformAndPathScale(o),this.yUnitTransformAndPathScale(a)].join(" ");case"".concat(this.namespace,"quadBezTo"):return e.setLatestPostion(t[1].x,t[1].y),["Q",this.xUnitTransformAndPathScale(i),this.yUnitTransformAndPathScale(r),this.xUnitTransformAndPathScale(n),this.yUnitTransformAndPathScale(s)].join(" ");case"".concat(this.namespace,"close"):return e.setLatestPostion(e.getStartPostion().x,e.getStartPostion().y),"Z";default:throw new Error("unknow ".concat(this.actionXML.name));}}},{key:"getPtValue",value:function getPtValue(e,t,i){return t.accessValue(e[i])}},{key:"getSvgArc",value:function getSvgArc(e,t,i,r,n,s){var o=e,a=t,c,h,d,u,p;if(r===0)c=n,h=s,p=0;else if(r>=360)c=n,h=s,d=n+2*e*Math.abs(Math.cos(-i/180*Math.PI)),u=s+2*t*Math.sin(-i/180*Math.PI),p=1;else{var f=-i,m=-(i+r),_this$getCoordinateOn=this.getCoordinateOnEllipse(f,o,a),g=_this$getCoordinateOn.x,y=_this$getCoordinateOn.y,b=n-g,S=s+y,_this$getCoordinateOn2=this.getCoordinateOnEllipse(m,o,a),w=_this$getCoordinateOn2.x,P=_this$getCoordinateOn2.y;c=w+b,h=S-P,r>=-360&&r<-180?p=1:r>=-180&&r<0||r>0&&r<180?p=0:p=1}return{radiusX:o,radiusY:a,xAxisRotation:0,largeArcFlag:p,sweepFlag:r>0?1:0,endX:c,endY:h,middleX:d,middleY:u}}},{key:"getCoordinateOnEllipse",value:function getCoordinateOnEllipse(e,t,i){var r,n,s=e%360;if(s%180==0)r=Math.cos(s*(Math.PI/180))*t,n=0;else if(s%90==0)r=0,n=Math.sin(s*(Math.PI/180))*i;else{var o=this.getTanDeg(s);r=t*i/Math.sqrt(Math.pow(i,2)+Math.pow(t*o,2)),(s>90&&s<270||s<-90&&s>-270)&&(r=-r),n=o*r}return{x:r,y:n}}},{key:"getTanDeg",value:function getTanDeg(e){var t=e*Math.PI/180;return Math.tan(t)}}]);return Nx}();function il(e){return uo.presetShapeDefinitons.childElementOptional(e)||(console.warn("".concat(e," not include preset shape.")),uo.presetShapeDefinitons.childElement("rect"))}var ss;(function(e){e[e.none=0]="none",e[e.triangle=1]="triangle",e[e.stealth=2]="stealth",e[e.diamond=3]="diamond",e[e.oval=4]="oval",e[e.arrow=5]="arrow"})(ss||(ss={}));function Fy(e){switch(e){case"none":return 0;case"triangle":return 1;case"stealth":return 2;case"diamond":return 3;case"oval":return 4;case"arrow":return 5;default:return 0;}}var By=10*1e3,ln=/*#__PURE__*/function(){function ln(e){_classCallCheck(this,ln);this.logger=e}_createClass(ln,[{key:"createMonitor",value:function createMonitor(){return new Lx(this.logger).ref}}]);return ln}(),Lx=/*#__PURE__*/function(){function Lx(e){var _this203=this;_classCallCheck(this,Lx);this.logger=e,this.image=null,this.timer=null,this.beginTimestamp=0,this.ref=function(t){t?_this203.bindImage(t):_this203.releaseImage()},this.onLoad=function(){_this203.beginTimestamp!==0&&(_this203.beginTimestamp=0,_this203.clearTimer())},this.onError=function(t){var i;if(_this203.beginTimestamp!==0){_this203.beginTimestamp=0,_this203.clearTimer();var _r124;typeof t=="string"?_r124=new Error(t):_r124=new Error("".concat(t.message)),(i=_this203.logger)==null||i.error("loading image ".concat(_this203.getImageUrl()," with error: ").concat(_r124))}},this.onTimeout=function(){var t;_this203.beginTimestamp=0,(t=_this203.logger)==null||t.warn("loading image ".concat(_this203.getImageUrl()," timeout for ").concat(By,"ms"))},this.getImageUrl=function(){var t,i;var r;return _this203.image&&_this203.image instanceof SVGImageElement?r=(t=_this203.image)==null?void 0:t.href.animVal:r=(i=_this203.image)==null?void 0:i.src,r}}_createClass(Lx,[{key:"bindImage",value:function bindImage(e){e.onload=this.onLoad,e.onerror=this.onError,this.image=e,this.timer=setTimeout(this.onTimeout,By),this.beginTimestamp=Date.now()}},{key:"releaseImage",value:function releaseImage(){this.image&&(this.image.onload=null,this.image.onerror=null,this.image=null,this.beginTimestamp=0,this.clearTimer())}},{key:"clearTimer",value:function clearTimer(){this.timer!==null&&clearTimeout(this.timer)}}]);return Lx}(),Dx="other",po="body";function Fx(e){switch(e){case"title":case"ctrTitle":return!0;default:return!1;}}function Mr(e,t,i){var r=Bx(e),n=!0;if(i==="master"){var s=rl(e);if(!s)return n=!1,{allShape:[e],masterStyleXML:Ad(t),isTextBox:r,hasPlaceHolder:n};var o=s.type||po,a=nl(o,t,r);return{placeHolderType:o,masterShape:e,masterStyleXML:a,allShape:[e],isTextBox:r,hasPlaceHolder:n}}else if(i==="layout"){var _s34=rl(e);if(!_s34)return n=!1,{allShape:[e],masterStyleXML:Ad(t),isTextBox:r,hasPlaceHolder:n};var _o27=_s34.type||po,_a22=Od(_o27),c=t.masterIndex.typeIndex[_a22],h=[e];c&&h.push(c);var d=nl(_a22,t,r);return{allShape:h,placeHolderType:_a22,layoutShape:e,masterShape:c,masterStyleXML:d,isTextBox:r,hasPlaceHolder:n}}else{var _s35=rl(e);if(!_s35)return n=!1,{allShape:[e],masterStyleXML:Ad(t),isTextBox:r,hasPlaceHolder:n};jx(_s35)&&(_s35.idx="1");var _o28;if(_s35.idx?(_o28=t.layoutIndex.idxIndex[_s35.idx],_s35.type&&_o28===void 0&&(_o28=t.layoutIndex.typeIndex[_s35.type])):_s35.type&&(_o28=t.layoutIndex.typeIndex[_s35.type]),_o28){var _a23=rl(_o28);if(_a23){var _c9=_a23.type||po,_h11=Od(_c9),_d8=t.masterIndex.typeIndex[_h11],u=[e];_o28&&u.push(_o28),_d8&&u.push(_d8);var p=nl(_h11,t,r);return{allShape:u,placeHolderType:_h11,layoutShape:_o28,masterShape:_d8,masterStyleXML:p,isTextBox:r,hasPlaceHolder:n}}else throw new Error("layout ph not existed.")}else{var _a24=_s35.type||po,_c10=Od(_a24),_h12=t.masterIndex.typeIndex[_c10],_d9=[e];_h12&&_d9.push(_h12);var _u16=nl(_c10,t,r);return{allShape:_d9,placeHolderType:_c10,layoutShape:e,masterShape:_h12,masterStyleXML:_u16,isTextBox:r,hasPlaceHolder:n}}}}function Bx(e){var t=!1,i=e.childElementOptional("p:nvSpPr");return i&&i.childElement("p:cNvSpPr").attr.getBooleanOptional("txBox")&&(t=!0),t}function jx(e){return e!==void 0&&e.idx!==void 0&&e.idx==="4294967295"}function rl(e){if(e){var t=e.childElementOptional(new G("p:nvSpPr","p:nvCxnSpPr"));if(t){var i=t.childElementOptional("p:nvPr","p:ph");if(i){var _r125=i.attr.getStringOptional("idx"),n=i.attr.getStringOptional("type");return(n==="title"||n==="ctrTitle")&&(_r125=_r125||"0"),{idx:_r125,type:n}}}}}function nl(e,t,i){if(!t.masterIndex.txStyle)return;var r=t.masterIndex.txStyle[e];return r||(i?r=t.masterIndex.txStyle[po]:r=t.masterIndex.txStyle[Dx]),r}function Ad(e){return e.main.childElementOptional("p:presentation","p:defaultTextStyle")}function Od(e){switch(e){case"ctrTitle":case"title":return"title";case"dt":return"dt";case"ftr":return"ftr";case"sldNum":return"sldNum";default:return"body";}}var os=12700/2;function zx(e){e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:prstGeom",jy),e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:custGeom",jy),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"fillColor",Hx),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderWidth",zy),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderType",Uy),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderColor",_x),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderStrokeDashArray",$x),e.bindAttributePicker("p:sp","spId",function(t,i,r,n,s){return Tr(s)+t.childElement("p:nvSpPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:cxnSp","spId",function(t,i,r,n,s){return Tr(s)+t.childElement("p:nvCxnSpPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:pic","spId",function(t,i,r,n,s){return Tr(s)+t.childElement("p:nvPicPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:grpSp","spId",function(t,i,r,n,s){return Tr(s)+t.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:spTree","spId",function(t,i,r,n,s){return Tr(s)+t.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:graphicFrame","spId",function(t,i,r,n,s){return Tr(s)+t.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getOptional("id")}),e.bindAttributePicker("p:graphicFrame","borderWidth",function(){return 0}),e.bindAttributePicker("p:graphicFrame","borderType",function(){return"none"}),e.bindAttributePicker("p:graphicFrame","borderColor",function(){return"black"}),e.bindAttributePicker("p:graphicFrame","borderStrokeDashArray",function(){return"0"})}function Tr(e){var t="";return e==="master"?t="m":e==="layout"&&(t="l"),t}function Rd(e,t,i,r){var n=i.lnStyleXMLDescription;return n||(n=i.lnStyleXMLDescription=Object.freeze(Vx(e,t,r))),n}function Ux(e,t,i,r){var n=i.fillStyleXMLDescription;return n||(n=i.fillStyleXMLDescription=Object.freeze(Wx(e,t,r))),n}function Vx(e,t,i){var r=[],n,_Mr=Mr(e,t,i),s=_Mr.allShape,o=_Mr.placeHolderType;var _iterator197=_createForOfIteratorHelper(s),_step197;try{for(_iterator197.s();!(_step197=_iterator197.n()).done;){var a=_step197.value;var c=a.childElementOptional(new G("p:spPr","p:grpSpPr"));if(c){var d=c.childElementOptional("a:ln");d&&r.push(d)}var h=a.childElementOptional("p:style");if(h){var _d10=kd(h,t);_d10.ln.xml&&r.push(_d10.ln.xml),n=_d10.ln.phClr}}}catch(err){_iterator197.e(err)}finally{_iterator197.f()}return{shapeStyleXMLList:r,placeHolderType:o,placeHolderColor:n}}function Wx(e,t,i){var r=[],n,_Mr2=Mr(e,t,i),s=_Mr2.allShape,o=_Mr2.placeHolderType;var _iterator198=_createForOfIteratorHelper(s),_step198;try{for(_iterator198.s();!(_step198=_iterator198.n()).done;){var a=_step198.value;var c=a.childElementOptional(new G("p:spPr","p:grpSpPr"),_construct(G,es));c&&r.push(c);var h=a.childElementOptional("p:style");if(h){var d=kd(h,t);d.fill.xml&&r.push(d.fill.xml),n=d.fill.phClr}}}catch(err){_iterator198.e(err)}finally{_iterator198.f()}return{shapeStyleXMLList:r,placeHolderType:o,placeHolderColor:n}}var jy=function jy(e,t,i,r,n){var _Mr3=Mr(e,t,n),s=_Mr3.allShape;var _iterator199=_createForOfIteratorHelper(s),_step199;try{for(_iterator199.s();!(_step199=_iterator199.n()).done;){var o=_step199.value;var a=o.childElementOptional("p:spPr",i);if(a)return a}}catch(err){_iterator199.e(err)}finally{_iterator199.f()}},Hx=function Hx(e,t,i,r,n){if(e.attr.getBoolean("useBgFill",!1)){var o=e.parentElement("p:cSld");if(o){var a=o.extraAttr.getColorOptional("backgroundColor");if(a)return a}}var s=Ux(e,t,r,n);var _iterator200=_createForOfIteratorHelper(s.shapeStyleXMLList),_step200;try{for(_iterator200.s();!(_step200=_iterator200.n()).done;){var _o29=_step200.value;return new xr(s.placeHolderColor).read(_o29,t)||void 0}}catch(err){_iterator200.e(err)}finally{_iterator200.f()}},_x=function _x(e,t,i,r,n){var s=Rd(e,t,r,n);var _iterator201=_createForOfIteratorHelper(s.shapeStyleXMLList),_step201;try{for(_iterator201.s();!(_step201=_iterator201.n()).done;){var o=_step201.value;var a=o.childElementOptional(_construct(G,es));if(a){var c=new xr(s.placeHolderColor).read(a,t);if(c)return c}}}catch(err){_iterator201.e(err)}finally{_iterator201.f()}return Yi},zy=function zy(e,t,i,r,n){var s=Rd(e,t,r,n);var _iterator202=_createForOfIteratorHelper(s.shapeStyleXMLList),_step202;try{for(_iterator202.s();!(_step202=_iterator202.n()).done;){var o=_step202.value;if(o&&o.attr.has("w")){var a=o.attr.getNumber("w");return a>os?a:os}}}catch(err){_iterator202.e(err)}finally{_iterator202.f()}return os},Uy=function Uy(e,t,i,r,n){var s=Rd(e,t,r,n);var _iterator203=_createForOfIteratorHelper(s.shapeStyleXMLList),_step203;try{for(_iterator203.s();!(_step203=_iterator203.n()).done;){var o=_step203.value;var a=o.childElementOptional("a:prstDash");if(a&&a.attr.has("val"))return a.attr.getString("val")}}catch(err){_iterator203.e(err)}finally{_iterator203.f()}return"solid"},$x=function $x(e,t,i,r,n){var s=zy(e,t,i,r,n)/rn;switch(Uy(e,t,i,r,n)){case"solid":return"0";case"dash":return"".concat(5*s);case"dashDot":return" ".concat(5*s,", ").concat(5*s,", ").concat(s,", ").concat(5*s);case"dot":return"".concat(s,",  ").concat(5*s);case"lgDash":return"".concat(2*s,", ").concat(s);case"lgDashDot":return"".concat(10*s,", ").concat(5*s,", ").concat(s,", ").concat(5*s,", ").concat(s,", ").concat(5*s);case"sysDash":return"".concat(5*s,", ").concat(2*s);case"sysDashDot":return"".concat(5*s,", ").concat(2*s,", ").concat(s,", ").concat(5*s);case"sysDashDotDot":return"".concat(5*s,", ").concat(2*s,", ").concat(s,", ").concat(5*s,", ").concat(s,", ").concat(5*s);case"sysDot":return"".concat(2*s,", ").concat(5*s);default:return"0";}},Vy=/*#__PURE__*/function(_Nd$default$Component){_inherits(Vy,_Nd$default$Component);var _super61=_createSuper(Vy);function Vy(e){var _this204;_classCallCheck(this,Vy);_this204=_super61.call(this,e);_this204.isRender=!1,_this204.state={dataUrl:""};var t=e.xlinkHref||e.href;t&&Mi.addLoadTask(t);return _this204}_createClass(Vy,[{key:"componentDidMount",value:function componentDidMount(){this.isRender=!0,this.loadImage()}},{key:"getSnapshotBeforeUpdate",value:function getSnapshotBeforeUpdate(e){var _this$props29=this.props,t=_this$props29.xlinkHref,i=_this$props29.href,r=e.xlinkHref||e.href,n=t||i;return r!==n&&n?(Mi.addLoadTask(n),!0):!1}},{key:"componentDidUpdate",value:function componentDidUpdate(e,t,i){i&&this.loadImage()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.isRender=!1}},{key:"updateImageState",value:function updateImageState(e,t){this.isRender&&this.setState({dataUrl:e},t)}},{key:"loadImage",value:function loadImage(){var _this205=this;var _this$props30=this.props,e=_this$props30.xlinkHref,t=_this$props30.href,i=e||t;i&&Mi.loadImage(i).then(function(r){_this205.updateImageState(r,function(){Mi.endLoadTask(i)})}).then(function(){},function(){})}},{key:"render",value:function render(){var e=this.state.dataUrl,_this$props31=this.props,t=_this$props31.innerref,i=_this$props31.vertTextType,r=_this$props31.width,n=_this$props31.height,s=_this$props31.x,o=_this$props31.y,a=_this$props31.opacity,c=_this$props31.clipPath,h=_this$props31.preserveAspectRatio;if(e){var d={};i&&(d.transform="scale(".concat(r/n,", ").concat(n/r,") rotate(270deg)"),d.transformOrigin="center");var u={xlinkHref:e,href:e,width:I(r),height:I(n),opacity:a,clipPath:c,preserveAspectRatio:h,x:s,y:o};return Nd["default"].createElement("image",D(M({},u),{style:d,ref:t}))}return null}}]);return Vy}(Nd["default"].Component),Gx=/*#__PURE__*/function(_$$default$Component){_inherits(Gx,_$$default$Component);var _super62=_createSuper(Gx);function Gx(e){var _this206;_classCallCheck(this,Gx);_this206=_super62.call(this,e);_this206.pathElements={},_this206.imageElement=$["default"].createRef();var t=e.shapeXML;_this206.spId=e.spId,_this206.graphType=e.shapeXML.name==="p:sp"?"shape":"connection",_this206.prestGeomXML=t.extraElementWithName("a:prstGeom"),_this206.custGeomXML=t.extraElementWithName("a:custGeom"),_this206.svgLoadingMonitor=new ln(e.logger).createMonitor();return _this206}_createClass(Gx,[{key:"getCssVaribleColor",value:function getCssVaribleColor(e){switch(e){case Kt.Darken:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.6),var(--sp-fill-a))";case Kt.DarkenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.8),var(--sp-fill-a))";case Kt.Lighten:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.4),var(--sp-fill-a))";case Kt.LightenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.2),var(--sp-fill-a))";default:return"hsla(var(--sp-fill-h),var(--sp-fill-s),var(--sp-fill-l),var(--sp-fill-a))";}}},{key:"updateFillColor",value:function updateFillColor(e){var _this207=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0;var i,r=[],n=0,s,o;if(e instanceof ho)r=e.getColors(),n=e.getRotation(),s=e.getGradientPath(),i="url(#".concat(this.identification(),"-gradient-fill)");else if(e instanceof Ja)o=e.getResId();else if(e instanceof Za){var a=this.props.groupFillColor;i=K(a)}else i=K(e);if(t&&(Object.keys(this.pathElements).forEach(function(a){var c=_this207.pathElements[a];c&&i&&(o!==void 0?c.setAttribute("fill","none"):c.setAttribute("fill",i))}),this.imageElement.current&&e)){var _a25=e.getAlphaModFix();this.imageElement.current.setAttribute("opacity",_a25.toString())}return{path:s,imageResId:o,colorStops:r,rotation:n,fillColor:i}}},{key:"identification",value:function identification(){var _this$props32=this.props,e=_this$props32.slideIndex,t=_this$props32.spId;return"".concat(e,"-").concat(t,"-")}},{key:"injectAdjustValue",value:function injectAdjustValue(e,t){var i=e.childElementOptional("a:avLst");i&&i.elementsWithName("a:gd").forEach(function(r){var n=r.attr.getString("fmla"),s=new q(n).eval(t),o=r.attr.getString("name");t.setVariable(o,s)})}},{key:"renderSVG",value:function renderSVG(e,t,i,r){var n;var s=null,o=null,_this$props33=this.props,a=_this$props33.shapeXML,c=_this$props33.width,h=_this$props33.height,d=_this$props33.fillColor,u=_this$props33.resourceLoader,p=_this$props33.resourceType,f=_this$props33.borderStyle,m=_this$props33.vertTextType,g=(n=a.childElementOptional("p:nvSpPr","p:cNvSpPr"))==null?void 0:n.attr.getBooleanOptional("txBox"),y=a.childElementOptional("p:spPr","a:blipFill","a:stretch","a:fillRect"),b=(y?y.attr.getNumber("l",0)/H:0)*c,S=(y?y.attr.getNumber("b",0)/H:0)*h,w=(y?y.attr.getNumber("r",0)/H:0)*c,P=(y?y.attr.getNumber("t",0)/H:0)*h;if(r){var N=d.getAlphaModFix();g||(s=$["default"].createElement("clipPath",{id:"clippath-".concat(this.identification())},e));var _=u.loadURL(p,r);o=$["default"].createElement(Vy,{innerref:this.imageElement,xlinkHref:_,vertTextType:m,href:_,width:c-w-b,height:h-S-P,x:I(b),y:I(P),opacity:N,clipPath:"url(#clippath-".concat(this.identification(),")"),preserveAspectRatio:"none"})}var A=this.graphType==="connection"&&f.color||this.graphType==="shape",E,R;return qn(h)/Tt<1?E="1px":E=I(h),qn(c)/Tt<1?R="1px":R=I(c),A?$["default"].createElement("svg",{style:{position:"absolute",width:R,height:E,overflow:"visible"}},$["default"].createElement("defs",null,s,t,$["default"].createElement("marker",{id:"".concat(this.identification(),"-arrow-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i*1.5,markerHeight:i*1.5,stroke:K(f.color),fill:K(f.color),orient:"auto"},$["default"].createElement("path",{d:"M 1 0 L 10 5 L 1 10 L 0 9 L 7.18 5 L 0 1 Z",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-arrow-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i*1.5,markerHeight:i*1.5,stroke:K(f.color),fill:K(f.color),orient:"auto"},$["default"].createElement("path",{d:"M 9 0 L 0 5 L 9 10 L 10 9 L 2.82 5 L 10 1 L 9 0 Z",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-triangle-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},$["default"].createElement("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-triangle-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},$["default"].createElement("path",{d:"M 10 0 L 0 5 L 10 10 z",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-stealth-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},$["default"].createElement("path",{d:"M 0 0 L 10 5 L 0 10 L 3 5 z",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-stealth-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},$["default"].createElement("path",{d:"M 10 0 L 0 5 L 10 10 L 7 5 z",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-diamond-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},$["default"].createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-diamond-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},$["default"].createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-oval-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},$["default"].createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-oval-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:i,markerHeight:i,orient:"auto"},$["default"].createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:K(f.color)})),$["default"].createElement("marker",{id:"".concat(this.identification(),"-none")})),o,e):null}},{key:"render",value:function render(){var _this208=this;var e,t;this.pathElements={};var i,_this$props34=this.props,r=_this$props34.width,n=_this$props34.height,s=_this$props34.shapeXML,o=_this$props34.fillColor,a=_this$props34.borderStyle,c=_this$props34.children,h=new Ly({w:r,h:n}),d="";if(this.prestGeomXML){var U=this.prestGeomXML.attr.getString("prst");this.injectAdjustValue(this.prestGeomXML,h),i=il(U)}else this.custGeomXML?(i=this.custGeomXML,d="a:"):i=il("rect");var u=ss.none,p=ss.none,f=s.childElementOptional("p:spPr","a:ln","a:headEnd"),m=s.childElementOptional("p:spPr","a:ln","a:tailEnd"),g=((e=f==null?void 0:f.parent)==null?void 0:e.attr.getNumber("w",os))||((t=m==null?void 0:m.parent)==null?void 0:t.attr.getNumber("w",os))||os,y=Math.max(3*(g/Tt),10);if(f){var _U=f.attr.getString("type","none");u=Fy(_U)}if(m){var _U2=m.attr.getString("type","none");p=Fy(_U2)}var _this$updateFillColor=this.updateFillColor(o,!1),b=_this$updateFillColor.fillColor,S=_this$updateFillColor.colorStops,w=_this$updateFillColor.imageResId,P=_this$updateFillColor.path,A=null;S.length>0&&(P?A=$["default"].createElement("radialGradient",{id:"".concat(this.identification(),"-gradient-fill")},S.map(function(U,He){return $["default"].createElement("stop",{key:"index-".concat(He),offset:U.stop,stopColor:K(U.color)})})):A=$["default"].createElement("linearGradient",{id:"".concat(this.identification(),"-gradient-fill")},S.map(function(U,He){return $["default"].createElement("stop",{key:"index-".concat(He),offset:U.stop,stopColor:K(U.color)})})));var E=new Dy().renderLumiaPath(i,h,d).map(function(U,He){var ii=U.fill!=="none"?b:"none",Ae=U.isBorder?K(a.color):"none";S.length===0&&(b&&U.fill&&(ii=Sy(b,U.fill)),!s.childElementOptional("p:spPr","a:ln","a:solidFill")&&b!=="none"&&(Ae=Sy(Ae,Kt.Darken)));var bt={};return U.fill!=="none"&&S.length===0&&(bt.fill=_this208.getCssVaribleColor(U.fill)),$["default"].createElement("path",{ref:function ref(_e){_this208.pathElements[He.toString()]=_e},key:"path".concat(He),d:U.pathD,style:bt,fill:w?"none":ii,height:I(n),width:I(r),stroke:Ae,strokeWidth:I(a.width),strokeDasharray:a.strokeDashArray,markerStart:"url(#".concat(_this208.identification(),"-").concat(ss[u],"-start)"),markerEnd:"url(#".concat(_this208.identification(),"-").concat(ss[p],"-end)")})}),R=h.accessValue("rectLeft"),N=h.accessValue("rectTop"),_=h.accessValue("rectRight")-h.accessValue("rectLeft"),ie=h.accessValue("rectBottom")-h.accessValue("rectTop"),ce=$["default"].Children.map(c,function(U){return $["default"].cloneElement(U,{left:R,right:N,width:_,height:ie})});return $["default"].createElement($["default"].Fragment,null,ce,this.renderSVG(E,A,y,w))}}]);return Gx}($["default"].Component),Kx=["textPlain"],Ld;(function(e){e.textNoShape="textNoShape",e.textPlain="textPlain",e.textRingInside="textRingInside",e.textRingOutside="textRingOutside"})(Ld||(Ld={}));var Xx=/*#__PURE__*/function(_Ue$default$Component){_inherits(Xx,_Ue$default$Component);var _super63=_createSuper(Xx);function Xx(e){var _this209;_classCallCheck(this,Xx);_this209=_super63.call(this,e);_this209.contentWidth=0,_this209.fontRowCount=0;var t;var i=e.textBodyWrapResource;_this209.gbDataList=e.shapeGuideList.map(function(n){var s=n.attr.getString("name"),o=n.attr.getString("fmla");return _defineProperty({},s,o)}),_this209.textContent=(t=e.textBodyWrapResource.paragraphs[0].runs)==null?void 0:t.map(function(n){return n.text}).join(""),_this209.height=yd(i.prop.height),_this209.width=yd(i.prop.width);var r=0;i.paragraphs.forEach(function(n){_this209.fontRowCount+=n.lines.length,n.lines.forEach(function(s){var o=0;s.forEach(function(a){o+=parseInt(a.prop.width,10),r||(r=a.prop.lineSpacing),_this209.fontSize||(_this209.fontSize=yd(a.prop.size))}),_this209.contentWidth=Math.max(_this209.contentWidth,o)})}),_this209.contentHeight=Zn((_this209.fontRowCount-1)*r+_this209.fontSize||_this209.fontSize);return _this209}_createClass(Xx,[{key:"textNoShape",value:function textNoShape(){var _this210=this;var e={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(this.height,"pt"),width:"".concat(this.width,"pt"),justifyContent:"center",alignItems:"center"},t=this.height,i=this.width,r=this.contentWidth,n=this.contentHeight,s=Number.isNaN(i/r)?1:Zn(i/r),o=Number.isNaN(t/n)?1:Zn(t/n),a={margin:0,padding:0,fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),width:"".concat(this.fontSize,"pt"),display:"inline-block"},c=this.props.textBodyWrapResource;return Ue["default"].createElement("div",{style:e},Ue["default"].createElement("div",{ref:function ref(h){_this210.spanRef=h},style:{whiteSpace:"initial",transform:"scaleX(".concat(s,") scaleY(").concat(o,")")}},c.paragraphs.map(function(h,d){var u;return Ue["default"].createElement("span",{key:d,style:{whiteSpace:"initial"}},(u=h.lines)==null?void 0:u.map(function(p,f){return Ue["default"].createElement(Ue["default"].Fragment,null,p.map(function(m){var g;return(g=m.text)==null?void 0:g.split("").map(function(y,b){return Ue["default"].createElement("pre",{style:a,key:"".concat(f,"-").concat(b)},y)})}),Ue["default"].createElement("br",null))}))})))}},{key:"textRing",value:function textRing(e){var _this211=this;var t,i,r;var n=Math.atan(this.height/this.width),s=n*180/Math.PI,o=6e4;((t=this.gbDataList[0])==null?void 0:t.adj)&&(o=q.deconstructShapeGuide(this.gbDataList[0].adj));var a=200,c=100,h=(1-xe(o)*c)/this.fontSize;if(!((i=this.textContent)==null?void 0:i.length))return this.textNoShape();var d=this.textContent.length;return Ue["default"].createElement("div",{style:{display:"inline-block",position:"relative",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(c,"pt"),width:"".concat(a,"pt"),transform:"scale(".concat(this.width/a,", ").concat(this.height/c/(Math.cos(n/180)*Math.PI),")")}},Ue["default"].createElement("div",{style:{transformStyle:"preserve-3d",height:"".concat(c,"pt"),width:"".concat(a,"pt"),transform:"rotateX(".concat(-s,"deg)")}},(r=this.textContent)==null?void 0:r.split("").map(function(u,p){return Ue["default"].createElement("span",{style:{position:"absolute",lineHeight:"".concat(_this211.fontSize,"pt"),left:"".concat(a/2-_this211.fontSize/2,"pt"),top:"".concat((c-_this211.fontSize)/2,"pt"),transform:e(p,d,h)},key:p},u)})))}},{key:"textRingInside",value:function textRingInside(){var e=function e(t,i,r){return"rotateY(".concat(70-340/i*t,"deg) translateZ(").concat(-100,"pt) scaleY(").concat(r,")")};return this.textRing(e)}},{key:"textRingOutside",value:function textRingOutside(){var e=function e(t,i,r){return"rotateY(".concat(320*t/(i-1)-60,"deg) translateZ(",100,"pt) scaleY(").concat(r,")")};return this.textRing(e)}},{key:"textPlain",value:function textPlain(){var _this212=this;var e=this.gbDataList[0]?q.deconstructShapeGuide(this.gbDataList[0].adj):5e4,t=this.width,i=this.height,r=xe(e),n=r>.5?(2*r-1)*t:(1-r*2)*t,s=Math.atan(n/i),o=s*180/Math.PI;r<.5&&(o=-o);var a={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"0, 0",height:"".concat(i,"pt"),width:"".concat(t,"pt"),justifyContent:"center",alignItems:"center"},c={display:"block",lineHeight:"".concat(this.fontSize,"pt"),textAlign:"center"},h={display:"inline-block",fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),transformOrigin:"50% 0",margin:0,padding:"0"},d=this.contentWidth,u=this.contentHeight,p=Number.isNaN(t/d)?1:Zn(t)/(d+Math.tan(s)*Zn(i)),f=Number.isNaN(i/u)?1:Zn(i/u),m=0,g=this.props.textBodyWrapResource;return Ue["default"].createElement("div",{style:M({},a)},Ue["default"].createElement("div",{ref:function ref(y){_this212.spanRef=y},style:D(M({},c),{whiteSpace:"initial",transform:"skew(".concat(o,"deg) scaleY(").concat(f,") scaleX(").concat(p,")")})},g.paragraphs.map(function(y,b){var S;return Ue["default"].createElement("div",{key:"wordart-".concat(b),style:D(M({},c),{whiteSpace:"initial"})},(S=y.lines)==null?void 0:S.map(function(w,P){var A=_this212.fontRowCount===1?_this212.fontSize:w[0].prop.lineSpacing,E={};return(m===0||m===_this212.fontRowCount-1)&&(A=(A+_this212.fontSize)/2,E.display="flex",m===_this212.fontRowCount-1&&(E.alignItems="flex-end")),y.prop.align==="l"||y.prop.align==="just"?E.justifyContent="flex-start":y.prop.align==="r"?E.justifyContent="flex-end":y.prop.align==="dist"?E.justifyContent="space-between":y.prop.align==="ctr"&&(E.justifyContent="center"),m+=1,Ue["default"].createElement("div",{key:w[0].text+P.toString(),style:M({whiteSpace:"nowrap",lineHeight:"".concat(A,"pt")},E)},w.map(function(R){var N;return(N=R.text)==null?void 0:N.split("").map(function(_,ie){return Ue["default"].createElement("pre",{style:D(M({},h),{fontFamily:R.prop.font}),key:ie},_)})}),Ue["default"].createElement("br",null))}))})))}},{key:"render",value:function render(){var e=this.props.presetType;return this[e]?this[e]():this.textNoShape()}}]);return Xx}(Ue["default"].Component),Yx=9999,Qx=/*#__PURE__*/function(){function Qx(){_classCallCheck(this,Qx);this.indexByLevel=new Map,this.startAtByLevel=new Map}_createClass(Qx,[{key:"get",value:function get(e,t,i){var r=e.extraAttr.getNumber("level");this.indexByLevel.has(r)||(this.indexByLevel.set(r,0),this.startAtByLevel.set(r,-1));var n=this.startAtByLevel.get(r);if(t!==n)this.indexByLevel.set(r,0),this.startAtByLevel.set(r,t);else{var s=this.indexByLevel.get(r);i&&(s+=1,this.indexByLevel.set(r,s))}return this.indexByLevel.get(r)}},{key:"reset",value:function reset(){this.indexByLevel=new Map,this.startAtByLevel=new Map}}]);return Qx}(),Wy=/*#__PURE__*/function(_an$default$Component){_inherits(Wy,_an$default$Component);var _super64=_createSuper(Wy);function Wy(e){var _this213;_classCallCheck(this,Wy);_this213=_super64.call(this,e);_this213.buIndexCounter=new Qx,_this213.paragraphBulletInfo=[],_this213.numCol=1;var _this213$props=_this213.props,t=_this213$props.txBodyXML,i=_this213$props.textBodyWrapResource,r=_this213$props.flipH,n=_this213$props.flipV,s=_this213$props.insideTable,o=_this213$props.totalPadding,a=_this213$props.height,c=_this213$props.width,h=_this213$props.right,d=_this213$props.left;_this213.bodyPrXML=t.childElement("a:bodyPr"),_this213.paragraphXMLs=t.elementsWithName("a:p");var u=_this213.bodyPrXML.childElementOptional("a:prstTxWarp");u&&(_this213.presetType=u.attr.getString("prst","textNoShape"));var p=_this213.bodyPrXML.extraAttr.getString("anchor","t"),f=_this213.bodyPrXML.extraAttr.getString("wrap","square");_this213.isTextWrap=f==="square",_this213.spcFirstLastPara=_this213.bodyPrXML.extraAttr.getBoolean("spcFirstLastPara",!1),_this213.anchorCtr=_this213.bodyPrXML.extraAttr.getBoolean("anchorCtr",!1),_this213.numCol=_this213.bodyPrXML.extraAttr.getNumber("numCol",1);var m=0,g=0;if(i){var b=i.prop;_this213.vert=b.vert,_this213.paddingLeft=b.lIns*Tt,_this213.paddingRight=b.rIns*Tt,m=b.tIns*Tt,g=b.bIns*Tt}else _this213.vert=Ey(t),_this213.paddingLeft=_this213.bodyPrXML.extraAttr.getNumber("lIns",ly),_this213.paddingRight=_this213.bodyPrXML.extraAttr.getNumber("rIns",ly),m=_this213.bodyPrXML.extraAttr.getNumber("tIns",ay),g=_this213.bodyPrXML.extraAttr.getNumber("bIns",ay);var y;r!==n&&(y="scale(-1, 1)"),_this213.rectStyle=s?{position:"relative",left:0,top:0,width:I(c),paddingTop:I(m-o/2),paddingBottom:I(g-o/2),height:"calc(100% - ".concat(I(o),")"),transform:y}:{position:"absolute",left:I(d===void 0?0:d),top:I(h===void 0?0:h),width:I(c),height:I(a),transform:y},_this213.rectStyle=M({display:"inline-flex",flexDirection:"column",alignItems:_this213.anchorCtr?"center":"flex-start",justifyContent:ky(p),zIndex:Yx,paddingLeft:I(_this213.paddingLeft),paddingTop:I(m),paddingRight:I(_this213.paddingRight),paddingBottom:I(g),boxSizing:"border-box",whiteSpace:_this213.isTextWrap?"normal":"nowrap"},_this213.rectStyle),_this213.updateRectStyleByWrapResource(),_this213.generateParagraphBulletInfo();return _this213}_createClass(Wy,[{key:"updateRectStyleByWrapResource",value:function updateRectStyleByWrapResource(){var e=this.props.textBodyWrapResource;if(e===void 0)return;var t=e.prop.anchor;this.rectStyle=D(M({},this.rectStyle),{justifyContent:ky(t)}),this.rectStyle=gx(this.vert,this.rectStyle,this.props)}},{key:"generateParagraphBulletInfo",value:function generateParagraphBulletInfo(){var e=this.props.textBodyWrapResource;if(e===void 0)return;var t=e.paragraphs.map(function(r){var n,s;return{autoNumber:(n=r.prop.bulletChar)==null?void 0:n.autoNumber,autoNumberType:(s=r.prop.bulletChar)==null?void 0:s.autoNumberType,level:r.prop.level,empty:r.lines.length===0}}),i=[0,0,0,0,0,0,0,0,0];this.paragraphBulletInfo=t.map(function(r,n){var s=r.level,o=r.autoNumberType;if(i=i.map(function(a,c){return c>s?0:c===s?o?a:0:a}),o){var a=r.autoNumber;if(n>0&&t[n-1].autoNumber!==a&&(i[s]=0),r.empty)return{order:n,count:t.length};var c=i[s];return i[s]=c+1,{number:c+(a||1),order:n,count:t.length}}else return{order:n,count:t.length}})}},{key:"renderParagraph",value:function renderParagraph(e,t,i,r,n,s,o,a){var c=0,h=e==null?void 0:e.elements.find(function(b){return b.name==="a:r"}),_this$props35=this.props,d=_this$props35.slideContext,u=_this$props35.width,p=_this$props35.height,f=_this$props35.uuid,m=_this$props35.resourceType,g=_this$props35.withAnimation,y=_this$props35.textBodyWrapResource;return an["default"].createElement(Px,{key:"".concat(i),slideContext:d,isTextWrap:o,width:u,height:p,paragraphIndex:i,firstRangeXML:h,buIndexCounter:this.buIndexCounter,paragraphXML:e,bodyPrXML:t,uuid:f,round:c,spcFirstLastPara:r,isFirst:n,isLast:s,vert:this.vert,resourceType:m,paragraphWrapResource:a,textBodyWrapResource:y,withAnimation:!!g,bulletInfo:this.paragraphBulletInfo[i]})}},{key:"render",value:function render(){var _this214=this;var _this$props36=this.props,e=_this$props36.textBodyWrapResource,t=_this$props36.width;if(this.presetType&&this.presetType!==Ld.textNoShape&&Kx.includes(this.presetType)&&e){var n=this.bodyPrXML.childElementOptional("a:prstTxWarp"),s=n==null?void 0:n.childElementOptional("a:avLst"),o=(s==null?void 0:s.elementsWithName("a:gd"))||[];return an["default"].createElement("div",{style:D(M({},this.rectStyle),{display:"flex",justifyContent:"center",alignItems:"center",padding:0}),className:"txBody"},an["default"].createElement(Xx,{presetType:this.presetType,shapeGuideList:o,textBodyWrapResource:e}))}var i=ux(this.vert),r;return e?r=e.paragraphs.map(function(n,s){return _this214.renderParagraph(void 0,void 0,s,_this214.spcFirstLastPara,s===0,s===e.paragraphs.length-1,_this214.isTextWrap,n)}):r=this.paragraphXMLs.map(function(n,s){return _this214.renderParagraph(n,_this214.bodyPrXML,s,_this214.spcFirstLastPara,s===0,s===_this214.paragraphXMLs.length-1,_this214.isTextWrap)}),this.buIndexCounter.reset(),an["default"].createElement("div",{className:"txBoby",style:this.rectStyle},an["default"].createElement("ol",{style:M({width:I(t-this.paddingLeft-this.paddingRight),marginBlockEnd:0,marginBlockStart:0,paddingBlockStart:0,paddingBlockEnd:0,marginInlineEnd:0,marginInlineStart:0,paddingInlineStart:0,paddingInlineEnd:0,margin:0,padding:0,whiteSpace:this.isTextWrap?"normal":"nowrap",columnCount:this.numCol===1?void 0:this.numCol},i)},r))}}]);return Wy}(an["default"].Component),qx=/*#__PURE__*/function(_on$default$Component){_inherits(qx,_on$default$Component);var _super65=_createSuper(qx);function qx(){_classCallCheck(this,qx);return _super65.apply(this,arguments)}_createClass(qx,[{key:"renderCol",value:function renderCol(e,t,i,r,n,s){var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var a;var c=function c(){var _ref81;return(_ref81=[]).concat.apply(_ref81,arguments).reduce(function(Dv,Fv){return Dv+Fv},0)},h=e.childElementOptional("a:tcPr");if(!h)return null;var d=h.extraAttr.getColor("".concat(t,"-").concat(i,"-fillColor"),Yi),u;d instanceof ho?u=d.getGradientStyles():u=K(d);var p=h.extraAttr.getStringOptional("".concat(t,"-").concat(i,"-fontFamily")),f=h.extraAttr.getBoolean("".concat(t,"-").concat(i,"-isBold"),!1),m=h.extraAttr.getBoolean("".concat(t,"-").concat(i,"-isItalic"),!1),g=h.extraAttr.getString("".concat(t,"-").concat(i,"-bottomBorderStyle"),"none"),y=h.extraAttr.getNumber("".concat(t,"-").concat(i,"-bottomBorderWidth"),0),b=h.extraAttr.getColorOptional("".concat(t,"-").concat(i,"-bottomBorderColor"),Yi),S=h.extraAttr.getString("".concat(t,"-").concat(i,"-topBorderStyle"),"none"),w=h.extraAttr.getNumber("".concat(t,"-").concat(i,"-topBorderWidth"),0),P=h.extraAttr.getColorOptional("".concat(t,"-").concat(i,"-topBorderColor"),Yi),A=h.extraAttr.getString("".concat(t,"-").concat(i,"-leftBorderStyle"),"none"),E=h.extraAttr.getNumber("".concat(t,"-").concat(i,"-leftBorderWidth"),0),R=h.extraAttr.getColorOptional("".concat(t,"-").concat(i,"-leftBorderColor"),Yi),N=h.extraAttr.getString("".concat(t,"-").concat(i,"-rightBorderStyle"),"none"),_=h.extraAttr.getNumber("".concat(t,"-").concat(i,"-rightBorderWidth"),0),ie=h.extraAttr.getColorOptional("".concat(t,"-").concat(i,"-rightBorderColor"),Yi),ce=e.childElementOptional("a:txBody");if(ce===void 0)return null;var U=e.attr.getNumber("gridSpan",1),He=e.attr.getNumber("rowSpan",1),ii=e.attr.getBoolean("hMerge",!1),Ae=e.attr.getBoolean("vMerge",!1),bt=c(s.slice(i,i+U)),_e="".concat(t,"-").concat(i),_this$props37=this.props,lt=_this$props37.slideContext,Ye=_this$props37.uuid,nr=_this$props37.shapeWrapResource;return ii||Ae?null:on["default"].createElement("td",{colSpan:U,rowSpan:He,style:{position:"relative",fontFamily:p&&p,fontWeight:f?500:400,fontStyle:m?"italic":"normal",borderBottomStyle:g,borderTopStyle:S,borderLeftStyle:A,borderRightStyle:N,borderBottomWidth:I(y),borderTopWidth:I(w),borderLeftWidth:I(E),borderRightWidth:I(_),borderBottomColor:K(b),borderTopColor:K(P),borderLeftColor:K(R),borderRightColor:K(ie),width:I(bt),height:I(n),background:u,boxSizing:"border-box",fontSize:0,lineHeight:0},key:"tc-".concat(t,"-").concat(i),className:"tc-".concat(t,"-").concat(i)},on["default"].createElement(Wy,{slideContext:lt,insideTable:!0,width:bt,height:n,totalPadding:o,uuid:Ye,txBodyXML:ce,resourceType:"slide",textBodyWrapResource:(a=nr==null?void 0:nr.textBodyMap)==null?void 0:a[_e]}))}},{key:"render",value:function render(){var _this215=this;var e=this.props.graphXML,t=e.childElementOptional("a:graphic","a:graphicData","a:tbl"),i=t&&t.childElement("a:tblGrid"),r=i?i.elementsWithName("a:gridCol"):[],n=t?t.elementsWithName("a:tr"):[],s=n.length,o=0;if(s>0){var c=0;n.forEach(function(h,d){if(d===0){var p=0;h.elementsWithName("a:tc").forEach(function(f,m){var g=f.childElement("a:tcPr").extraAttr.getNumber("".concat(d,"-").concat(m,"-topBorderWidth"),0);p=Math.max(g,p)}),c+=p}var u=0;h.elementsWithName("a:tc").forEach(function(p,f){var m=p.childElement("a:tcPr").extraAttr.getNumber("".concat(d,"-").concat(f,"-bottomBorderWidth"),0);u=Math.max(m,u)}),c+=u}),o=c/s}var a=n.map(function(c,h){var d=c.attr.getNumber("h"),u=c.elementsWithName("a:tc").map(function(f,m){return r[m].attr.getNumber("w")}),p=c.elementsWithName("a:tc").map(function(f,m){var g=r[m].attr.getNumber("w");return _this215.renderCol(f,h,m,g,d,u,o)});return on["default"].createElement("tr",{key:"tr-"+h},p)});return on["default"].createElement("table",{style:{borderCollapse:"collapse"},cellSpacing:"0",cellPadding:"0"},on["default"].createElement("tbody",null,a))}}]);return qx}(on["default"].Component),Zx=/*#__PURE__*/function(_Dd$default$Component){_inherits(Zx,_Dd$default$Component);var _super66=_createSuper(Zx);function Zx(e){var _this216;_classCallCheck(this,Zx);_this216=_super66.call(this,e);_this216.url=_this216.getUrl(),_this216.imageLoadingMonitor=new ln(e.logger).createMonitor();return _this216}_createClass(Zx,[{key:"getId",value:function getId(){var e=this.props.graphXML,t=e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getStringOptional("id");if(t)return"spId".concat(t);if(e.parent&&e.parent.name==="mc:Choice")return this.getResId()}},{key:"getResId",value:function getResId(){var e;var t=this.props.graphXML,i=(e=t.parent)==null?void 0:e.parent;if(!i)return;var r=i.childElementOptional("mc:Fallback","p:pic","p:blipFill","a:blip");if(r)return r.attr.getStringOptional("r:embed")}},{key:"getUrl",value:function getUrl(){var _this$props38=this.props,e=_this$props38.slideContext,t=_this$props38.resourceType,i=this.getId();return i?e.resourceLoader.loadURL(t,i):void 0}},{key:"render",value:function render(){if(!this.url)return null;var _this$props39=this.props,e=_this$props39.width,t=_this$props39.height;return Dd["default"].createElement("img",{src:this.url,alt:"graph",style:{width:I(e),height:I(t)},ref:this.imageLoadingMonitor})}}]);return Zx}(Dd["default"].Component),Jx=/*#__PURE__*/function(_Fd$default$Component){_inherits(Jx,_Fd$default$Component);var _super67=_createSuper(Jx);function Jx(e){var _this217;_classCallCheck(this,Jx);_this217=_super67.call(this,e);_this217.url=_this217.getUrl(),_this217.imageLoadingMonitor=new ln(e.logger).createMonitor();return _this217}_createClass(Jx,[{key:"getId",value:function getId(){var e=this.props.graphXML;return e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function getUrl(){var _this$props40=this.props,e=_this$props40.slideContext,t=_this$props40.resourceType,i=this.getId();return e.resourceLoader.loadURL(t,"spId".concat(i))}},{key:"render",value:function render(){var _this$props41=this.props,e=_this$props41.width,t=_this$props41.height;return Fd["default"].createElement("img",{src:this.url,alt:"diagram",style:{width:I(e),height:I(t)},ref:this.imageLoadingMonitor})}}]);return Jx}(Fd["default"].Component),e2=/*#__PURE__*/function(_Bd$default$PureCompo){_inherits(e2,_Bd$default$PureCompo);var _super68=_createSuper(e2);function e2(){_classCallCheck(this,e2);return _super68.apply(this,arguments)}_createClass(e2,[{key:"render",value:function render(){return Bd["default"].createElement("div",null)}}]);return e2}(Bd["default"].PureComponent),t2=/*#__PURE__*/function(_sl$default$Component){_inherits(t2,_sl$default$Component);var _super69=_createSuper(t2);function t2(e){var _this218;_classCallCheck(this,t2);_this218=_super69.call(this,e);_this218.url=_this218.getUrl(),_this218.imageLoadingMonitor=new ln(e.logger).createMonitor();return _this218}_createClass(t2,[{key:"getId",value:function getId(){var e=this.props.graphXML;return e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function getUrl(){var _this$props42=this.props,e=_this$props42.slideContext,t=_this$props42.resourceType,i=this.getId();return e.resourceLoader.loadURL(t,"spId".concat(i))}},{key:"render",value:function render(){if(this.url){var _this$props43=this.props,e=_this$props43.width,t=_this$props43.height;return sl["default"].createElement("img",{src:this.url,alt:"oleGraph",style:{width:I(e),height:I(t)},ref:this.imageLoadingMonitor})}else return sl["default"].createElement("div",null)}}]);return t2}(sl["default"].Component),i2=/*#__PURE__*/function(_xd$default$Component){_inherits(i2,_xd$default$Component);var _super70=_createSuper(i2);function i2(e){var _this219;_classCallCheck(this,i2);_this219=_super70.call(this,e);var t=_this219.props.graphXML;_this219.uri=t.childElement("a:graphic","a:graphicData").attr.getStringOptional("uri");return _this219}_createClass(i2,[{key:"subGraphClassWithURI",value:function subGraphClassWithURI(e){switch(e){case"http://schemas.openxmlformats.org/drawingml/2006/table":return qx;case"http://schemas.microsoft.com/office/drawing/2014/chartex":case"http://schemas.openxmlformats.org/drawingml/2006/chart":return Zx;case"http://schemas.openxmlformats.org/drawingml/2006/diagram":return Jx;case"http://schemas.openxmlformats.org/presentationml/2006/ole":return t2;default:return console.debug("Unsupported graph",e),e2;}}},{key:"render",value:function render(){var _this$props44=this.props,e=_this$props44.shapeGroupTransform,t=_this$props44.width,i=_this$props44.height,r=this.subGraphClassWithURI(this.uri),n,s;if(e){var a=e.scaleX,c=e.scaleY;n=t*a,s=i*c}else n=t,s=i;var o=D(M({},this.props),{height:s,width:n});return xd["default"].createElement(r,M({},o))}}]);return i2}(xd["default"].Component),r2="https://convertcdn.netless.link/publicFiles/icon/play.png",n2="https://convertcdn.netless.link/publicFiles/icon/pause.png",_y=function _y(e){var t=e.startTime,i=e.endTime,r=e.duration;return t&&(r-=t),i&&(r-=i),r},$y=/*#__PURE__*/function(_Ot$default$Component){_inherits($y,_Ot$default$Component);var _super71=_createSuper($y);function $y(e){var _this220;_classCallCheck(this,$y);_this220=_super71.call(this,e);_this220.state={total:_y(e)};return _this220}_createClass($y,[{key:"componentDidMount",value:function componentDidMount(){var e=this.props.protalId;this.controllerPortal=document.getElementById(e)}},{key:"onPlayClick",value:function onPlayClick(e){var t=this.props.onPlayClick;e.stopPropagation(),t()}},{key:"onPauseClick",value:function onPauseClick(e){var t=this.props.onPauseClick;e.stopPropagation(),t()}},{key:"onBarClick",value:function onBarClick(e){var _this$props45=this.props,t=_this$props45.duration,i=_this$props45.startTime,r=_this$props45.endTime,n=_this$props45.onSeekClick;if(e.stopPropagation(),t){var s=this.props.duration;i&&(s-=i),r&&(s-=r);var o=e.nativeEvent.offsetX/e.currentTarget.clientWidth*s;i&&(o+=i),n(Math.floor(o))}}},{key:"computedCurrent",value:function computedCurrent(){var e=this.props.startTime,t=this.props.currentTime,i=this.state.total;return e&&(t>e?t-=e:t=0),t>i&&(t=i),t}},{key:"formatTime",value:function formatTime(e){var t="00:00";if(e){var i=Math.floor(e/60),_r126=String(i<0?0:i).padStart(2,"0"),n=Math.floor(e%60),s=String(n<0?0:n).padStart(2,"0");t="".concat(_r126,":").concat(s)}return t}},{key:"renderController",value:function renderController(e){var _this$props46=this.props,t=_this$props46.display,i=_this$props46.style,r=_this$props46.controllerRef,n=_this$props46.resourceLoader,s=_this$props46.playing,o=this.state.total;return Ot["default"].createElement("div",{className:"ppt-event-source",style:M({background:"#FFFFFF",borderRadius:50,height:50,width:300,display:t?"flex":"none",flexDirection:"row",alignItems:"center"},i),ref:r},Ot["default"].createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:s?"none":"block"},onClick:this.onPlayClick.bind(this)},Ot["default"].createElement("img",{style:{height:20},alt:"play",src:n.replaceProtocolByresourceScheme(r2)})),Ot["default"].createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:s?"block":"none"},onClick:this.onPauseClick.bind(this)},Ot["default"].createElement("img",{style:{height:20},alt:"pause",src:n.replaceProtocolByresourceScheme(n2)})),Ot["default"].createElement("div",{style:{width:100},className:"timer"},Ot["default"].createElement("span",{className:"current"},this.formatTime(this.computedCurrent())),Ot["default"].createElement("span",null,"/"),Ot["default"].createElement("span",{className:"total"},this.formatTime(o))),Ot["default"].createElement("div",{className:"ppt-event-source",style:{flex:1,position:"relative",marginRight:10},onMouseDown:this.onBarClick.bind(this)},Ot["default"].createElement("div",{style:{background:"#D9D9D9",position:"relative",height:10,display:"flex"},className:"total"},Ot["default"].createElement("div",{style:{background:"#4F4F4F",top:0,left:0,height:10,flex:e},className:"played"}))))}},{key:"render",value:function render(){var _this$props47=this.props,e=_this$props47.duration,t=_this$props47.endTime,i=_this$props47.currentTime,r=_this$props47.playing,n=_this$props47.onMediaEnd,s=this.state.total;if(t){var a=i+t;e>0&&a>=e&&r&&n()}var o=0;return e&&(o=this.computedCurrent()/s),this.controllerPortal?(0,Hy.createPortal)(this.renderController(o),this.controllerPortal):this.renderController(o)}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(e){return{total:_y(e)}}}]);return $y}(Ot["default"].Component),s2="https://convertcdn.netless.link/publicFiles/icon/audio.png",o2=/*#__PURE__*/function(_Er$default$Component){_inherits(o2,_Er$default$Component);var _super72=_createSuper(o2);function o2(e){var _this221;_classCallCheck(this,o2);_this221=_super72.call(this,e);_this221.videoIntervalId=void 0,_this221.lastAnimeState={stop:0,play:0},_this221.player=Er["default"].createRef(),_this221.controller=Er["default"].createRef(),e.mediaState?_this221.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:_this221.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var t=_this221.state.playing,_this221$props=_this221.props,i=_this221$props.mediaSlideActionUserIds,r=_this221$props.userId;t&&_this221.hasControl(i,r)&&_this221.syncPlayTimeLoop();return _this221}_createClass(o2,[{key:"componentDidMount",value:function componentDidMount(){var _this222=this;var e=this.props.targetID;window==null||window.addEventListener("message",function(t){t.data.type==="_changeAudioState"&&t.data.targetID===e&&_this222.updateAnimation(t.data)})}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){var _this$props48=this.props,t=_this$props48.disableAnimation,i=_this$props48.outsidePausing,r=_this$props48.mediaState,n=_this$props48.rtcClient,s=this.state.playing;if(t===!0){this.player.current&&this.pauseAudio();return}if(!i&&e.outsidePausing){this.player.current&&this.pauseAudio();return}else if(i&&!e.outsidePausing){this.player.current&&this.playAudio();return}if(r!==void 0&&r.playing===e.mediaState.playing&&r.currentTime===e.mediaState.currentTime){s!==r.playing&&this.setState({playing:r.playing});return}this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),r===void 0&&e.mediaState!==void 0?r===void 0&&e.mediaState!==void 0&&(this.player.current&&(this.pauseAudio(),this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing===!0?this.playAudio():this.pauseAudio()),this.setState(e.mediaState)):r!==void 0&&e.mediaState!==void 0&&this.player.current&&(r.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(n==null||n.setAudioMixingPosition(Math.floor(this.player.current.currentTime*1e3)))):this.player.current.currentTime=e.mediaState.currentTime,s&&!e.mediaState.playing?this.pauseAudio():!s&&e.mediaState.playing&&this.playAudio(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime}))}},{key:"onMediaCanPlay",value:function onMediaCanPlay(){var _this$props49=this.props,e=_this$props49.disableAnimation,t=_this$props49.mediaState,i=_this$props49.rtcClient;e===!0?this.pauseAudio():t&&t.playing&&(i&&!this.audioMixing||this.player.current.paused===!0&&(this.player.current.currentTime=t.currentTime,this.playAudio()))}},{key:"onMouseOver",value:function onMouseOver(e){var t=this.state.displayController,i=this.props.slideRef;if(t!==!0){var _r127=e.target,_r127$getBoundingClie=_r127.getBoundingClientRect(),n=_r127$getBoundingClie.x,s=_r127$getBoundingClie.y,o=_r127$getBoundingClie.height,_i$current$getBoundin=i.current.getBoundingClientRect(),a=_i$current$getBoundin.x,c=_i$current$getBoundin.y,h=_i$current$getBoundin.width,d=_i$current$getBoundin.height,u=getComputedStyle(this.controller.current),p=h/parseFloat(getComputedStyle(i.current).width),f=0,m=0;u!==null&&u.width!==null&&(f=parseInt(u.width,10)*p),u!==null&&u.height!==null&&(m=parseInt(u.height,10)*p);var g=0,y=0;n<a?y=0:a+h<n+f?y=h-f:y=n-a,s+o-m<c?g=0:s+o>c+d?g=d-m:g=s+o-c-m,this.setState({displayController:!0,controllerPositionTop:g/p,controllerPositionLeft:y/p})}}},{key:"onMediaPlay",value:function onMediaPlay(){var _this$props50=this.props,e=_this$props50.onMediaPlay,t=_this$props50.shapeId,i=this.state.currentTime;e&&e(t,"audio",i)}},{key:"onMediaPause",value:function onMediaPause(){var _this$props51=this.props,e=_this$props51.onMediaPause,t=_this$props51.shapeId,i=this.state.currentTime;this.stopSyncPlayTime(),e&&e(t,"audio",i)}},{key:"stopSyncPlayTime",value:function stopSyncPlayTime(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"syncPlayTime",value:function syncPlayTime(e){if(this.player.current){var _this$props52=this.props,t=_this$props52.mediaRef,i=_this$props52.onMediaChange,_r128=_this$props52.shapeId,n=this.state.currentTime,s=t.startTime,o=t.endTime,a=e||n,c=this.player.current.duration;o&&(c-=o);var h=a;this.player.current&&a>=c&&(h=s||0),s&&h<s&&(h=s),i({playing:!0,currentTime:h},_r128)}}},{key:"syncPlayTimeLoop",value:function syncPlayTimeLoop(e){var _this223=this;var t=this.props.onMediaChange;t&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval(function(){_this223.syncPlayTime()},1e3))}},{key:"pauseAudio",value:function pauseAudio(){var _this224=this;if(this.player.current){var e=this.props.rtcClient;e!==void 0?this.stopMixAudio(function(){return _this224.player.current.pause()}):this.player.current.pause()}}},{key:"stopMixAudio",value:function stopMixAudio(e){var _this225=this;var _this$props53=this.props,t=_this$props53.rtcClient,i=_this$props53.logger;t.stopAudioMixing(function(r,n){r===714?(i==null||i.error("rtc mixing error : ".concat(n)),console.error(" stop audio mixing error :",n)):(_this225.audioMixing=!1,e())})}},{key:"playLocalAudio",value:function playLocalAudio(){var e=this.player.current.play();if(e!==void 0){var _this$props54=this.props,t=_this$props54.onMediaPlayError,i=_this$props54.logger,_r129=_this$props54.shapeId;e.then(function(){})["catch"](function(n){i?i.error("play audio exception: ".concat(n)):console.error(n),t&&t(_r129,"audio",n)})}}},{key:"playAudio",value:function playAudio(){if(this.player.current){var e=this.props.rtcClient;e!==void 0?this.mixAudio(this.player.current.currentTime,this.playLocalAudio.bind(this)):this.playLocalAudio()}}},{key:"mixAudio",value:function mixAudio(e,t){var _this226=this;var _this$props55=this.props,i=_this$props55.rtcClient,r=_this$props55.audioURL,n=_this$props55.logger,s=this.state.playing;s?(i==null||i.setAudioMixingPosition(Math.floor(e*1e3)),t()):i==null||i.startAudioMixing(r,!0,!1,1,function(o,a){o===714?(n==null||n.error("rtc mixing error : ".concat(a)),console.error("rtc mixing error :",a)):(i==null||i.setAudioMixingPosition(Math.floor(e*1e3)),_this226.audioMixing=!0,t())})}},{key:"updateAnimation",value:function updateAnimation(e){if(this.player.current){var _this$props56=this.props,t=_this$props56.startTime,i=_this$props56.startTimePerfix,_r130=this.state.playing;e.play===1&&this.player.current.paused&&(t?this.player.current.currentTime=i+t:this.player.current.currentTime=i,this.playAudio(),this.setState({playing:!0,currentTime:this.player.current.currentTime})),e.stop===1&&this.player.current&&_r130&&(this.pauseAudio(),this.setState({playing:!1}))}}},{key:"hasControl",value:function hasControl(e,t){var i=this.props.shapeId;return!e||t===void 0?!1:e[i]===t}},{key:"UNSAFE_componentWillReceivePropseslintreact",value:function UNSAFE_componentWillReceivePropseslintreact(){this.pauseAudio(),this.stopSyncPlayTime(),window==null||window.removeEventListener("_changeAudioState",function(){})}},{key:"render",value:function render(){var _this227=this;var _this$props57=this.props,e=_this$props57.resourceLoader,t=_this$props57.width,i=_this$props57.height,r=_this$props57.rtcClient,n=_this$props57.audioURL,s=_this$props57.logger,o=_this$props57.controllerProtalId,a=_this$props57.mediaRef,_this$state4=this.state,c=_this$state4.controllerPositionTop,h=_this$state4.controllerPositionLeft,d=_this$state4.displayController,u=_this$state4.duration,p=_this$state4.playing,f=_this$state4.currentTime;return Er["default"].createElement("div",{style:{position:"relative"},onMouseLeave:function onMouseLeave(){return _this227.setState({displayController:!1})}},Er["default"].createElement("img",{className:"ppt-event-source",alt:"audio",src:e.replaceProtocolByresourceScheme(s2),style:{width:I(t),height:I(i)},onMouseOver:this.onMouseOver.bind(this)}),Er["default"].createElement("audio",{src:n,ref:this.player,muted:!!r,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function onLoadedMetadata(){return _this227.setState({duration:_this227.player.current.duration})},onTimeUpdate:function onTimeUpdate(){return _this227.setState({currentTime:_this227.player.current.currentTime})},onLoadedMetadataCapture:function onLoadedMetadataCapture(){window.__platform==="ios"&&_this227.onMediaCanPlay()},onCanPlay:function onCanPlay(){window.__platform!=="ios"&&_this227.onMediaCanPlay()},onError:function onError(m){var g;m.target.error!==null&&(g=m.target.error),g!==void 0?s==null||s.error("load media: ".concat(n," error, code: ").concat(g.code,", message: ").concat(g.message)):s==null||s.error("load media: ".concat(n," error without error message"))}}),Er["default"].createElement($y,{controllerRef:this.controller,protalId:o,style:{position:"absolute",top:c,left:h,zIndex:1},resourceLoader:e,mediaRef:this.player,display:d,playing:p,duration:u,currentTime:f,onPlayClick:function onPlayClick(){_this227.stopSyncPlayTime(),_this227.syncPlayTimeLoop()},onPauseClick:function onPauseClick(){var _this227$props=_this227.props,m=_this227$props.onMediaChange,g=_this227$props.shapeId,y=_this227.state.currentTime;_this227.stopSyncPlayTime(),_this227.pauseAudio(),m&&m({playing:!1,currentTime:y},g)},onSeekClick:function onSeekClick(m){_this227.stopSyncPlayTime(),_this227.syncPlayTimeLoop(m)},onMediaEnd:function onMediaEnd(){_this227.stopSyncPlayTime(),_this227.pauseAudio(),_this227.setState({playing:!1})},endTime:a.endTime,startTime:a.startTime}))}}]);return o2}(Er["default"].Component),a2=/*#__PURE__*/function(_ls$default$Component){_inherits(a2,_ls$default$Component);var _super73=_createSuper(a2);function a2(){_classCallCheck(this,a2);return _super73.apply(this,arguments)}_createClass(a2,[{key:"identification",value:function identification(){var _this$props58=this.props,e=_this$props58.slideIndex,t=_this$props58.spId;return"".concat(e,"-").concat(t,"-")}},{key:"injectAdjustValue",value:function injectAdjustValue(e,t){var i=e.childElementOptional("a:avLst");i&&i.elementsWithName("a:gd").forEach(function(r){var n=r.attr.getString("fmla"),s=new q(n).eval(t),o=r.attr.getString("name");t.setVariable(o,s)})}},{key:"render",value:function render(){var _this$props59=this.props,e=_this$props59.shapeXML,t=_this$props59.width,i=_this$props59.height,r=_this$props59.fillColor,n=_this$props59.borderStyle,s=_this$props59.children,o=e.childElementOptional("p:spPr","a:prstGeom"),a=e.childElementOptional("p:spPr","a:custGeom"),c,h=new Ly({w:t,h:i}),d="";if(o){var p=o.attr.getString("prst");this.injectAdjustValue(o,h),c=il(p)}else a?(c=a,d="a:"):c=il("rect");var u=new Dy().renderLumiaPath(c,h,d).map(function(p,f){return ls["default"].createElement("path",{key:"path".concat(f),d:p.pathD,fill:K(r),height:I(i),width:I(t),stroke:K(n.color),strokeWidth:I(n.width),strokeDasharray:n.strokeDashArray})});return ls["default"].createElement("svg",{style:{position:"absolute",width:I(t),height:I(i),overflow:"visible"}},ls["default"].createElement("defs",null,ls["default"].createElement("clipPath",{id:"clippath-".concat(this.identification())},u)),s,u)}}]);return a2}(ls["default"].Component),l2=/*#__PURE__*/function(_as$default$Component){_inherits(l2,_as$default$Component);var _super74=_createSuper(l2);function l2(e){var _this228;_classCallCheck(this,l2);_this228=_super74.call(this,e);_this228.spId="",_this228.opacity=1,_this228.imageLoadingMonitor=new ln(e.logger).createMonitor(),_this228.svgLoadingMonitor=new ln(e.logger).createMonitor(),_this228.spId=e.imageXML.extraAttr.getString("spId"),_this228.getAlphaModFix();return _this228}_createClass(l2,[{key:"hasSoftEdge",get:function get(){var e=this.props.imageXML,t=e.childElementOptional("p:spPr","a:effectLst","a:softEdge");return Boolean(t)}},{key:"hasBlipChild",get:function get(){var e=this.props.imageXML,t=e.childElementOptional("p:blipFill","a:blip");return Boolean(t==null?void 0:t.elements.length)}},{key:"needSpUrl",get:function get(){return this.hasSoftEdge||this.hasBlipChild}},{key:"getAlphaModFix",value:function getAlphaModFix(){var e=this.props.imageXML,t=e.childElement("p:blipFill"),i=new Ja(t).getAlphaModFix();i&&(this.opacity=i)}},{key:"identification",value:function identification(){var e=this.props.slideIndex;return"".concat(e,"-").concat(this.spId,"-")}},{key:"render",value:function render(){var _this$props60=this.props,e=_this$props60.imageXML,t=_this$props60.width,i=_this$props60.height,r=_this$props60.spURL,n=_this$props60.imageURL,s=_this$props60.margin,o=_this$props60.uuid,a=_this$props60.slideIndex,c=_this$props60.borderStyle,h=e.childElementOptional("p:blipFill","a:stretch","a:fillRect"),d=(h?h.attr.getNumber("l",0)/H:0)*t,u=(h?h.attr.getNumber("b",0)/H:0)*i,p=(h?h.attr.getNumber("r",0)/H:0)*t,f=(h?h.attr.getNumber("t",0)/H:0)*i;if(e.childElementOptional("p:spPr",new G("a:prstGeom","a:custGeom"))===void 0){var m=e.childElementOptional("p:blipFill","a:srcRect"),g={top:0,left:0,right:0,bottom:0};return m&&(g.top=xe(m.attr.getNumber("t",0)),g.left=xe(m.attr.getNumber("l",0)),g.right=xe(m.attr.getNumber("r",0)),g.bottom=xe(m.attr.getNumber("b",0))),as["default"].createElement("div",{style:{overflow:"hidden",height:"100%"}},as["default"].createElement("img",{src:n,style:{width:I(t),height:I(i),position:"relative",top:"".concat(I(i*-g.top)),left:"".concat(I(t*-g.left))},alt:"",ref:this.imageLoadingMonitor}))}else{var _m26=this.needSpUrl?r:n,_g8=this.needSpUrl?1:this.opacity,y,b,S,w;return this.needSpUrl&&r?(y=t-s.left-s.right,b=i-s.top-s.bottom,S=void 0,w=void 0):(y=t-d-p,b=i-f-u,S=I(-s.left+d),w=I(-s.top+f)),as["default"].createElement(a2,{uuid:o,slideIndex:a,borderStyle:c,width:t-s.left-s.right,height:i-s.top-s.bottom,shapeXML:e,spId:this.spId},as["default"].createElement(Vy,{innerref:this.svgLoadingMonitor,preserveAspectRatio:"none",xlinkHref:_m26||n,href:_m26||n,x:S,y:w,width:y,height:b,clipPath:"url(#clippath-".concat(this.identification(),")"),opacity:_g8}))}}}]);return l2}(as["default"].Component),c2=/*#__PURE__*/function(_Ar$default$Component){_inherits(c2,_Ar$default$Component);var _super75=_createSuper(c2);function c2(e){var _this229;_classCallCheck(this,c2);_this229=_super75.call(this,e);_this229.videoIntervalId=void 0,_this229.lastAnimeState={stop:0,play:0},_this229.player=Ar["default"].createRef(),_this229.controller=Ar["default"].createRef(),_this229.imageLoadingMonitor=new ln(e.logger).createMonitor(),e.mediaState?_this229.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:_this229.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var t=_this229.state.playing,_this229$props=_this229.props,i=_this229$props.mediaSlideActionUserIds,r=_this229$props.userId;t&&_this229.hasControl(i,r)&&_this229.syncPlayTimeLoop();return _this229}_createClass(c2,[{key:"componentDidMount",value:function componentDidMount(){var _this230=this;var e=this.props.targetID;window==null||window.addEventListener("message",function(t){t.data.type==="_changeAudioState"&&t.data.targetID===e&&_this230.updateAnimation(t.data)})}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){var t=this.state.playing,_this$props61=this.props,i=_this$props61.disableAnimation,r=_this$props61.outsidePausing,n=_this$props61.mediaState,s=_this$props61.rtcClient;if(i===!0){this.player.current&&this.pauseVideo();return}if(!r&&e.outsidePausing){this.player.current&&this.pauseVideo();return}else if(r&&!e.outsidePausing){this.player.current&&this.playVideo();return}if(n!==void 0&&n.playing===e.mediaState.playing&&n.currentTime===e.mediaState.currentTime){t!==n.playing&&this.setState({playing:n.playing});return}n===void 0&&e.mediaState!==void 0?(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),n===void 0&&e.mediaState!==void 0&&(this.player.current&&(this.pauseVideo(),this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing===!0?this.playVideo():this.pauseVideo()),this.setState(e.mediaState))):n!==void 0&&e.mediaState!==void 0&&(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),this.player.current&&(n.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(s==null||s.setAudioMixingPosition(Math.floor(this.player.current.currentTime*1e3)))):this.player.current.currentTime=e.mediaState.currentTime,t&&!e.mediaState.playing?this.pauseVideo():!t&&e.mediaState.playing&&this.playVideo(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime})))}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.pauseVideo(),this.stopSyncPlayTime(),window==null||window.removeEventListener("_changeAudioState",function(){})}},{key:"onMediaPause",value:function onMediaPause(){var e=this.state.currentTime,_this$props62=this.props,t=_this$props62.onMediaPause,i=_this$props62.shapeId;this.stopSyncPlayTime(),t&&t(i,"video",e)}},{key:"onMediaPlay",value:function onMediaPlay(){var e=this.state.currentTime,_this$props63=this.props,t=_this$props63.onMediaPlay,i=_this$props63.shapeId;t&&t(i,"video",e)}},{key:"onMouseOver",value:function onMouseOver(e){var t=this.state.displayController,i=this.props.slideRef;if(t!==!0){var _r131=e.target,_r131$getBoundingClie=_r131.getBoundingClientRect(),n=_r131$getBoundingClie.x,s=_r131$getBoundingClie.y,o=_r131$getBoundingClie.height,_i$current$getBoundin2=i.current.getBoundingClientRect(),a=_i$current$getBoundin2.x,c=_i$current$getBoundin2.y,h=_i$current$getBoundin2.width,d=_i$current$getBoundin2.height,u=getComputedStyle(this.controller.current),p=h/parseFloat(getComputedStyle(i.current).width),f=0,m=0;u!==null&&u.width!==null&&(f=parseInt(u.width,10)*p),u!==null&&u.height!==null&&(m=parseInt(u.height,10)*p);var g=0,y=0;n<a?y=0:a+h<n+f?y=h-f:y=n-a,s+o-m<c?g=0:s+o>c+d?g=d-m:g=s+o-c-m,this.setState({displayController:!0,controllerPositionTop:g/p,controllerPositionLeft:y/p})}}},{key:"onMediaCanPlay",value:function onMediaCanPlay(){var _this$props64=this.props,e=_this$props64.disableAnimation,t=_this$props64.mediaState,i=_this$props64.rtcClient;e===!0?this.pauseVideo():t&&t.playing&&(i&&!this.audioMixing||this.player.current.paused===!0&&(this.player.current.currentTime=t.currentTime,this.playVideo()))}},{key:"hasControl",value:function hasControl(e,t){var i=this.props.shapeId;return!e||t===void 0?!1:e[i]===t}},{key:"stopSyncPlayTime",value:function stopSyncPlayTime(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"mixAudio",value:function mixAudio(e,t){var _this231=this;var i=this.state.playing,_this$props65=this.props,r=_this$props65.rtcClient,n=_this$props65.logger,s=_this$props65.videoURL;i?(r==null||r.setAudioMixingPosition(Math.floor(e*1e3)),t()):r==null||r.startAudioMixing(s,!0,!1,1,function(o,a){o===714?(n==null||n.error("rtc mixing error : ".concat(a)),console.error("rtc mixing error :",a)):(r==null||r.setAudioMixingPosition(Math.floor(e*1e3)),_this231.audioMixing=!0,t())})}},{key:"updateAnimation",value:function updateAnimation(e){if(this.player.current&&this.lastAnimeState){var t=this.state.playing,_this$props66=this.props,i=_this$props66.startTime,_r132=_this$props66.startTimePerfix;this.lastAnimeState.play===0&&e.play===1&&this.player.current&&(e.stop===1?t&&(this.pauseVideo(),this.setState({playing:!1})):t||(i?this.player.current.currentTime=_r132+i:this.player.current.currentTime=_r132,this.playVideo(),this.setState({playing:!0}))),this.lastAnimeState.stop===0&&e.stop===1&&this.player.current&&t&&(this.pauseVideo(),this.setState({playing:!1}))}this.lastAnimeState=e}},{key:"syncPlayTime",value:function syncPlayTime(e){if(this.player.current){var t=this.state.currentTime,_this$props67=this.props,i=_this$props67.mediaRef,_r133=_this$props67.onMediaChange,n=_this$props67.shapeId,s=i.startTime,o=i.endTime,a=e||t,c=this.player.current.duration;o&&(c-=o);var h=a;this.player.current&&a>=c&&(h=s||0),s&&h<=s&&(h=s),_r133({playing:!0,currentTime:h},n)}}},{key:"pauseVideo",value:function pauseVideo(){var _this232=this;var e=this.props.rtcClient;this.player.current&&(e!==void 0?this.stopMixAudio(function(){return _this232.player.current.pause()}):this.player.current.pause())}},{key:"syncPlayTimeLoop",value:function syncPlayTimeLoop(e){var _this233=this;var t=this.props.onMediaChange;t&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval(function(){_this233.syncPlayTime()},1e3))}},{key:"stopMixAudio",value:function stopMixAudio(e){var _this234=this;var _this$props68=this.props,t=_this$props68.rtcClient,i=_this$props68.logger;t.stopAudioMixing(function(r,n){r===714?(i==null||i.error("rtc mixing error : ".concat(n)),console.error(" stop audio mixing error :",n)):(_this234.audioMixing=!1,e())})}},{key:"playLocalVideo",value:function playLocalVideo(){var e=this.player.current.play();if(e!==void 0){var _this$props69=this.props,t=_this$props69.onMediaPlayError,i=_this$props69.logger,_r134=_this$props69.shapeId;e.then(function(){})["catch"](function(n){i?i.error("play video exception: ".concat(n)):console.error(n),t&&t(_r134,"video",n)})}}},{key:"playVideo",value:function playVideo(){if(this.player.current){var e=this.props.rtcClient;e!==void 0?this.mixAudio(this.player.current.currentTime,this.playLocalVideo.bind(this)):this.playLocalVideo()}}},{key:"render",value:function render(){var _this235=this;var _this$props70=this.props,e=_this$props70.mediaRef,t=_this$props70.videoURL,i=_this$props70.width,r=_this$props70.height,n=_this$props70.rtcClient,s=_this$props70.logger,o=_this$props70.controllerProtalId,a=_this$props70.resourceLoader,c=_this$props70.onMediaChange,h=_this$props70.shapeId,_this$state5=this.state,d=_this$state5.controllerPositionTop,u=_this$state5.controllerPositionLeft,p=_this$state5.displayController,f=_this$state5.playing,m=_this$state5.duration,g=_this$state5.currentTime,y=e.startTime?e.startTime*1e3:1e4,b="".concat(t,"?x-oss-process=video/snapshot,t_").concat(y,",m_fast,w_800,f_png,ar_auto");return Ar["default"].createElement("div",{className:"ppt-event-source",style:{position:"relative",width:I(i),height:I(r)},onMouseLeave:function onMouseLeave(){return _this235.setState({displayController:!1})}},Ar["default"].createElement("img",{src:b,alt:"poster",style:{position:"absolute",zIndex:0,top:0,left:0,width:I(i),height:I(r)},ref:this.imageLoadingMonitor}),Ar["default"].createElement("video",{className:"ppt-event-source","webkit-playsinline":"true",playsInline:!0,src:t,ref:this.player,muted:!!n,style:{position:"absolute",zIndex:1,top:0,left:0,width:I(i),height:I(r),objectFit:"fill"},poster:b,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function onLoadedMetadata(){return _this235.setState({duration:_this235.player.current.duration})},onTimeUpdate:function onTimeUpdate(){return _this235.setState({currentTime:_this235.player.current.currentTime})},onLoadedMetadataCapture:function onLoadedMetadataCapture(){window.__platform==="ios"&&_this235.onMediaCanPlay()},onCanPlay:function onCanPlay(){window.__platform!=="ios"&&_this235.onMediaCanPlay()},onError:function onError(S){var w;S.target.error!==null&&(w=S.target.error),w!==void 0?s==null||s.error("load media: ".concat(t," error,\n                                code: ").concat(w.code,", message: ").concat(w.message)):s==null||s.error("load media: ".concat(t," error without error message"))},onMouseOver:this.onMouseOver.bind(this),preload:"auto"}),Ar["default"].createElement($y,{protalId:o,style:{position:"absolute",top:d,left:u,zIndex:2,backfaceVisibility:"hidden"},resourceLoader:a,controllerRef:this.controller,mediaRef:this.player,display:p,playing:f,duration:m,currentTime:g,onPlayClick:function onPlayClick(){_this235.stopSyncPlayTime(),_this235.syncPlayTimeLoop()},onPauseClick:function onPauseClick(){_this235.stopSyncPlayTime(),c&&c({playing:!1,currentTime:g},h)},onSeekClick:function onSeekClick(S){_this235.stopSyncPlayTime(),_this235.syncPlayTimeLoop(S)},onMediaEnd:function onMediaEnd(){_this235.stopSyncPlayTime(),_this235.pauseVideo(),_this235.setState({playing:!1})},endTime:e.endTime,startTime:e.startTime}))}}]);return c2}(Ar["default"].Component),h2=/*#__PURE__*/function(){function h2(e){_classCallCheck(this,h2);this.spTreeXML=e}_createClass(h2,[{key:"indexBySpId",value:function indexBySpId(){var e={},t=0;var _iterator204=_createForOfIteratorHelper(this.spTreeXML.elements),_step204;try{for(_iterator204.s();!(_step204=_iterator204.n()).done;){var i=_step204.value;var _r135=i.extraAttr.getStringOptional("spId");typeof _r135=="string"&&(e[_r135]=t,t+=1)}}catch(err){_iterator204.e(err)}finally{_iterator204.f()}return e}}]);return h2}(),d2=/*#__PURE__*/function(_mo$default$PureCompo){_inherits(d2,_mo$default$PureCompo);var _super76=_createSuper(d2);function d2(e){var _this236;_classCallCheck(this,d2);_this236=_super76.call(this,e);_this236.lumiaRef=mo["default"].createRef();var t;var i=0,r=e.shapeGroupTransform,n=e.shapeXML;if(n.name==="p:sp"){var a=n.childElementOptional("p:spPr","a:xfrm");if(a){var c=a.attr.getNumber("rot",0);i=Number(c)/Et}}var s=Sx(n),o=(t=r==null?void 0:r.rotate)!=null?t:0;s===F.EaVert&&i+o===270&&(_this236.vertTextType=!0);return _this236}_createClass(d2,[{key:"renderTextBody",value:function renderTextBody(e){var t;var _this$props71=this.props,i=_this$props71.shapeWrapResource,r=_this$props71.slideContext,n=_this$props71.width,s=_this$props71.height,o=_this$props71.resourceType,a=_this$props71.flipH,c=_this$props71.flipV,h=_this$props71.uuid,d=_this$props71.withAnimation,u;return i&&!i.prop.specialShape&&(u=(t=i.textBodyMap)==null?void 0:t["0"]),mo["default"].createElement(Wy,{slideContext:r,txBodyXML:e,width:n,height:s,resourceType:o,flipH:a,flipV:c,uuid:h,textBodyWrapResource:u,withAnimation:d})}},{key:"renderShape",value:function renderShape(e,t){var i,r,n=0,s=this.vertTextType,o=this.lumiaRef,_this$props72=this.props,a=_this$props72.shapeGroupTransform,c=_this$props72.width,h=_this$props72.height,d=_this$props72.fillColor,u=_this$props72.groupFillColor,p=_this$props72.borderStyle,f=_this$props72.slideIndex,m=_this$props72.uuid,g=_this$props72.resourceLoader,y=_this$props72.resourceType,b=_this$props72.logger;if(e.name==="p:sp"){var S=e.childElementOptional("p:spPr","a:xfrm");if(S){var w=S.attr.getNumber("rot",0);n=Number(w)/Et}}if(a){var _S10=Cy(n,a),_w10=_S10.scaleX,P=_S10.scaleY;i=c*_w10,r=h*P}else i=c,r=h;return mo["default"].createElement(Gx,{vertTextType:s,ref:o,fillColor:d,groupFillColor:u,spId:e.extraAttr.getString("spId"),borderStyle:p,width:i,height:r,slideIndex:f,uuid:m,resourceLoader:g,resourceType:y,logger:b,shapeXML:e},t?this.renderTextBody(t):null)}},{key:"render",value:function render(){var e=this.props.shapeXML,t=e.childElementOptional("p:txBody");return this.renderShape(e,t)}}]);return d2}(mo["default"].PureComponent);function pi(e,t,i){return"".concat(i,"_").concat(t,"_").concat(e)}function u2(e,t){if(!t)return 1;var i=t.slideIndex,r=t.slideCount,n=t.preSlideIndex,s=1;switch(e){case"firstslide":{s=1;break}case"previousslide":{s=i-1;break}case"endshow":{s=r;break}case"lastslide":{s=r;break}case"nextslide":{s=i+1;break}case"lastslideviewed":s=n+1;}return s<1&&(s=1),s>r&&(s=r),s}function Gy(e,t,i,r){var n=F.Horz,s=e.childElementOptional("p:txBody");s&&s.name==="p:txBody"&&(n=Ey(s));var o={x:e.extraAttr.getNumber("x"),y:e.extraAttr.getNumber("y"),width:e.extraAttr.getNumber("width"),height:e.extraAttr.getNumber("height")},a=e.extraAttr.getBoolean("hidden"),c=e.extraAttr.getBoolean("flipV"),h=e.extraAttr.getBoolean("flipH"),d=e.extraAttr.getNumberOptional("rot");if(n===F.EaVert&&d===162e5){d=0;var _o30=o,b=_o30.x,S=_o30.y,w=_o30.width,P=_o30.height;o=D(M({},o),{x:b+(w-P)/2,y:S+(P-w)/2,width:P,height:w})}var u={color:e.extraAttr.getColor("borderColor"),width:e.extraAttr.getNumber("borderWidth"),type:e.extraAttr.getString("borderType"),strokeDashArray:e.extraAttr.getString("borderStrokeDashArray")},p;e.extraAttr.getOptional("fillColor")&&(p=e.extraAttr.getColor("fillColor"),p instanceof Za&&p.setFillColor(r.fillColor));var f=e.childElementOptional("p:blipFill","a:srcRect"),m;if(f){var _b2=xe(f.attr.getNumber("l",0)),_S11=xe(f.attr.getNumber("r",0)),_w11=xe(f.attr.getNumber("t",0)),_P=xe(f.attr.getNumber("b",0)),A=1-_b2-_S11,E=1-_w11-_P,R=o.width/A,N=o.height/E,_=R*_b2,ie=N*_w11,ce=R*_S11,U=N*_P;m={width:R,height:N,margin:{left:_,top:ie,right:ce,bottom:U}}}var g=e.childElementOptional(new G("p:nvSpPr","p:nvPicPr"),"p:cNvPr","a:hlinkClick"),y;if(g&&(y=g.attr.getStringOptional("r:id"),!y)){var _b3=g==null?void 0:g.attr.getStringOptional("action"),_S12=new URL(_b3!=null?_b3:"");if(_S12.pathname==="//hlinkshowjump"){var _w12=["firstslide","previousslide","nextslide","lastslide","endshow","lastslideviewed"],_P2=_S12.searchParams.get("jump");_w12.includes(_P2)&&(y=u2(_P2,t))}}return{rectangle:o,borderStyle:u,fillColor:p,tailor:m,flipV:c,flipH:h,rotate:d,parentGroupShapeId:i,hidden:a,hyperLinkDestination:y}}var zd=/*#__PURE__*/function(_Qi$default$Component){_inherits(zd,_Qi$default$Component);var _super77=_createSuper(zd);function zd(e){var _this237;_classCallCheck(this,zd);_this237=_super77.call(this,e);_this237.animeTarget=Qi["default"].createRef(),_this237.shapeMap=new wy(Gy),_this237.childrenRef=Qi["default"].createRef(),_this237.eventSourceId=void 0,_this237.emptyClick=function(){},_this237.onClick=function(s){var _this237$props=_this237.props,o=_this237$props.onHyperLinkClick,a=_this237$props.onEventSourceClick;if(_this237.shapeWrapperParams.hyperLinkDestination!==void 0)return o?o(_this237.shapeWrapperParams.hyperLinkDestination,s):void 0;if(_this237.eventSourceId!==void 0)return a?a(_this237.eventSourceId):void 0},_this237.state={soundEffectUrl:null};var t=e.shapeXML,i=e.resourceType,r=e.shapeGroupTransform,n=e.onEventSourceClick;if(_this237.spId=t.extraAttr.getString("spId"),_this237.resourceType=i,_this237.player=Qi["default"].createRef(),_this237.shapeWrapperParams=_this237.shapeMap.map(t,e.slideContext,r),e.eventSourceId!==void 0)_this237.eventSourceId=e.eventSourceId;else{var s=pi(e.slideContext.uuid,e.slideContext.slideIndex,_this237.spId);e.interactiveSeqsKeys&&e.interactiveSeqsKeys.indexOf(s)!==-1&&n!==void 0&&(_this237.eventSourceId=s)}return _this237}_createClass(zd,[{key:"componentDidMount",value:function componentDidMount(){var _this238=this;var e=this.props.slideContext;window==null||window.addEventListener("message",function(t){t.data.type==="_playSoundEffect"&&t.data.targetID===pi(e.uuid,e.slideIndex,_this238.spId)&&_this238.playEffectSound(t.data.targetID,t.data.soundEffectId)})}},{key:"getPositionAndSize",value:function getPositionAndSize(){var e,t,i,r,n=0,_this$props73=this.props,s=_this$props73.shapeXML,o=_this$props73.shapeGroupTransform;if(s.name==="p:sp"||s.name==="p:pic"){var a=s.childElementOptional("p:spPr","a:xfrm");if(a){var c=a.attr.getNumber("rot",0);n=Number(c)/Et}}if(o){var _this$shapeWrapperPar=this.shapeWrapperParams.rectangle,_a26=_this$shapeWrapperPar.x,_c11=_this$shapeWrapperPar.y,h=_this$shapeWrapperPar.width,d=_this$shapeWrapperPar.height,u=o.scaleX,p=o.scaleY,f=o.translateX,m=o.translateY;Math.abs(Math.cos(n/180*Math.PI))>=Math.abs(Math.sin(n/180*Math.PI))?(e=(_a26+f)*u,t=(_c11+m)*p,i=h*u,r=d*p):(e=(_a26+f+h/2)*u-h*p/2,t=(_c11+m+d/2)*p-d*u/2,i=h*p,r=d*u)}else e=this.shapeWrapperParams.rectangle.x,t=this.shapeWrapperParams.rectangle.y,i=this.shapeWrapperParams.rectangle.width,r=this.shapeWrapperParams.rectangle.height;return{left:I(e),top:I(t),width:I(i),height:I(r)}}},{key:"transform",value:function transform(e){var t={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0},_this$transformWithSh=this.transformWithShapeParams(e,t),i=_this$transformWithSh.translateX,r=_this$transformWithSh.translateY,n=_this$transformWithSh.scaleX,s=_this$transformWithSh.scaleY,o=_this$transformWithSh.rotate,a=(e.rotate||0)+o;return n<0&&(a=-a),s<0&&(a=-a),"translate(".concat(I(i),", ").concat(I(r),") scale(").concat(n,",").concat(s,") rotate(").concat(Qn(a),"deg)")}},{key:"transformWithShapeParams",value:function transformWithShapeParams(e,t){var i=t.translateX,r=t.translateY,n=e.flipH?-t.scaleX:t.scaleX,s=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&typeof t.rotate=="number"&&(o=t.rotate),{translateX:i,translateY:r,scaleX:n,scaleY:s,rotate:o}}},{key:"playEffectSound",value:function playEffectSound(e,t){if(t!==void 0){var _this$props74=this.props,i=_this$props74.resourceType,_r136=_this$props74.slideContext;if(i==="slide"){var n=_r136.resourceLoader.loadURL(i,t);if(n){var s=document.getElementById("".concat(e));if(s){var o=document.createElement("audio");return o.id="".concat(e,"-").concat(t),o.onpause=function(){o.remove()},o.src=n,o.controls=!1,s.appendChild(o),o.play().then(function(){},function(){}),!0}}}}return!1}},{key:"renderShape",value:function renderShape(e){var t=e.tailor,i={left:0,right:0,top:0,bottom:0},r=e.rectangle;t&&(r=D(M({},r),{width:t.width,height:t.height}),i=t.margin);var _this$props75=this.props,n=_this$props75.flipH,s=_this$props75.flipV,o=_this$props75.shapeGroupTransform,a=_this$props75.resourceType,c=!!n!==e.flipH,h=!!s!==e.flipV;return this.renderChildren({play:e.play,stop:e.stop,width:r.width,height:r.height,borderStyle:e.borderStyle,fillColor:e.fillColor,rotate:e.rotate,margin:i,shapeGroupTransform:o,flipH:c,flipV:h,resoureType:a})}},{key:"renderChildren",value:function renderChildren(e){var t=this.props.children;if(typeof t=="function"){var i=t(e);return i&&Qi["default"].cloneElement(i,{ref:this.childrenRef})}else return Qi["default"].cloneElement(t,{ref:this.childrenRef})}},{key:"render",value:function render(){var e;var t=this.state.soundEffectUrl,_this$getPositionAndS=this.getPositionAndSize(),i=_this$getPositionAndS.left,r=_this$getPositionAndS.top,n=_this$getPositionAndS.height,s=_this$getPositionAndS.width,o;this.shapeWrapperParams.hidden===!0&&(o="none");var a=(e=this.shapeWrapperParams.hyperLinkDestination)!=null?e:this.eventSourceId!==void 0,c=K(this.shapeWrapperParams.fillColor)!=="none"?(0,jd["default"])(K(this.shapeWrapperParams.fillColor)):(0,jd["default"])("#FFFFFF00"),h=c.hsl().array(),_this$props76=this.props,d=_this$props76.slideContext,u=_this$props76.zIndex;return Qi["default"].createElement("div",{className:"spId-".concat(this.spId," ").concat(a?" ppt-event-source":""),id:pi(d.uuid,d.slideIndex,this.spId),ref:this.animeTarget,style:{position:"absolute",display:o,zIndex:u,left:i,top:r,width:s,height:n,transform:this.transform(this.shapeWrapperParams),opacity:1,backfaceVisibility:"hidden","--sp-fill-h":c&&h[0],"--sp-fill-s":c&&h[1]+"%","--sp-fill-l":c&&h[2]+"%","--sp-fill-a":c?c.alpha():0},onClick:a?this.onClick.bind(this,this.spId):this.emptyClick},t&&Qi["default"].createElement("audio",{src:t,ref:this.player,controls:!1}),this.renderShape(this.shapeWrapperParams))}}]);return zd}(Qi["default"].Component);function Ud(e,t,i,r){var n=e.childElementOptional("p:grpSpPr","a:xfrm"),s=0,o=0,a=0,c=0,h=1,d=1,u=1,p;e.extraAttr.getOptional("fillColor")&&(p=e.extraAttr.getColor("fillColor"),p instanceof Za&&p.setFillColor(r.fillColor));var f=!1,m=!1,g=0,y,b={},S={x:0,y:0,width:t?t.slideWidth:0,height:t?t.slideHeight:0},w=0;if(n){var E=e.childElementOptional("p:grpSpPr","a:xfrm","a:chExt"),R=e.childElementOptional("p:grpSpPr","a:xfrm","a:ext"),N=e.childElementOptional("p:grpSpPr","a:xfrm","a:chOff");a=E?E.attr.getNumber("cx"):0,c=E?E.attr.getNumber("cy"):0,h=a===0||!R?1:R.attr.getNumber("cx")/a,h=Number.isNaN(h)?1:h,d=a===0||!R?1:R.attr.getNumber("cy")/c,d=Number.isNaN(d)?1:d,s=N?-N.attr.getNumber("x"):0,o=N?-N.attr.getNumber("y"):0,w=n.attr.getNumber("rot",0),g=w/Et,f=n.attr.getBoolean("flipV",!1),m=n.attr.getBoolean("flipH",!1);var _=e.childElementOptional("p:grpSpPr","a:xfrm","a:off");S={x:_?_.attr.getNumber("x"):0,y:_?_.attr.getNumber("y"):0,width:R?R.attr.getNumber("cx"):0,height:R?R.attr.getNumber("cy"):0}}var P={translateX:s,translateY:o,scaleX:h,scaleY:d,rotate:g,fillColor:p},A=e.extraAttr.getBooleanOptional("hidden");return{rectangle:S,borderStyle:b,opacity:u,tailor:y,flipV:f,flipH:m,transform:P,parentGroupShapeId:i,fillColor:p,rotate:w,hidden:A}}var ol=/*#__PURE__*/function(_ze$default$Component){_inherits(ol,_ze$default$Component);var _super78=_createSuper(ol);function ol(e){var _this239;_classCallCheck(this,ol);_this239=_super78.call(this,e);_this239.animeTarget=ze["default"].createRef(),_this239.eventSourceId=void 0,_this239.shapeWrappers=[],_this239.shapeMap=new wy(Ud),_this239.renderShape=function(s,o,a,c,h,d,u){var p=o.extraAttr.getString("spId"),f=p.replace("l","").replace("m",""),_this239$props=_this239.props,m=_this239$props.slideContext,g=_this239$props.interactiveSeqsKeys,y=_this239$props.onEventSourceClick,b=_this239$props.onHyperLinkClick,S=_this239$props.resourceType,w=_this239$props.uuid,P=_this239$props.wrapResource,A=_this239$props.animationManager,E=!1,R=o.childElementOptional(new G("p:nvSpPr","p:nvCxnSpPr"));if(R&&(E=!!R.childElementOptional("p:nvPr","p:ph")),!(S!=="slide"&&E))return ze["default"].createElement(zd,{key:"".concat(a),ref:function ref(N){return _this239.shapeWrappers.push(N)},shapeXML:o,slideContext:m,shapeGroupTransform:c,interactiveSeqsKeys:g,eventSourceId:_this239.eventSourceId,onEventSourceClick:y,onHyperLinkClick:b,zIndex:_this239.zIndex(s,o),resourceType:S,flipV:u,flipH:d},function(N){return ze["default"].createElement(d2,{uuid:w,width:N.width,fillColor:N.fillColor,slideContext:m,height:N.height,slideIndex:m.slideIndex,groupFillColor:h.fillColor,borderStyle:N.borderStyle,shapeGroupTransform:N.shapeGroupTransform,shapeXML:o,resourceLoader:m.resourceLoader,resourceType:S,shapeWrapResource:P==null?void 0:P.shapes[f],withAnimation:A==null?void 0:A.withTextAnimation(p),flipV:N.flipV,flipH:N.flipH})})},_this239.renderPicture=function(s,o,a,c){var _this239$props2=_this239.props,h=_this239$props2.slideContext,d=_this239$props2.interactiveSeqsKeys,u=_this239$props2.onEventSourceClick,p=_this239$props2.onHyperLinkClick,f=_this239$props2.resourceType;return ze["default"].createElement(zd,{key:"".concat(a),shapeXML:o,ref:function ref(m){return _this239.shapeWrappers.push(m)},slideContext:h,interactiveSeqsKeys:d,shapeGroupTransform:c,eventSourceId:_this239.eventSourceId,onEventSourceClick:u,onHyperLinkClick:p,zIndex:_this239.zIndex(s,o),resourceType:f},function(m){return _this239.renderPictureContent(o,m,h.resourceLoader,c)})},_this239.renderGraph=function(s,o,a,c){var h=o.extraAttr.getString("spId"),_this239$props3=_this239.props,d=_this239$props3.slideContext,u=_this239$props3.interactiveSeqsKeys,p=_this239$props3.onEventSourceClick,f=_this239$props3.onHyperLinkClick,m=_this239$props3.resourceType,g=_this239$props3.uuid,y=_this239$props3.wrapResource;return ze["default"].createElement(zd,{key:"".concat(a),shapeXML:o,ref:function ref(b){return _this239.shapeWrappers.push(b)},slideContext:d,interactiveSeqsKeys:u,eventSourceId:_this239.eventSourceId,onEventSourceClick:p,onHyperLinkClick:f,zIndex:_this239.zIndex(s,o),resourceType:m,shapeGroupTransform:c},function(b){return ze["default"].createElement(i2,{uuid:g,slideContext:d,width:b.width,height:b.height,rotate:b.rotate,borderStyle:b.borderStyle,fillColor:b.fillColor,key:"".concat(a),shapeGroupTransform:b.shapeGroupTransform,graphXML:o,shapeWrapResource:y==null?void 0:y.shapes[h],resourceType:b.resoureType})})},_this239.renderShapeGroup=function(s,o,a,c,h,d){var u=_this239.zIndex(s,o),_this239$props4=_this239.props,p=_this239$props4.uuid,f=_this239$props4.slideRef,m=_this239$props4.slideContext,g=_this239$props4.interactiveSeqsKeys,y=_this239$props4.resourceType,b=_this239$props4.onEventSourceClick,S=_this239$props4.onHyperLinkClick,w=_this239$props4.meidaStates,P=_this239$props4.disableAnimation,A=_this239$props4.onMediaChange,E=_this239$props4.onMediaPause,R=_this239$props4.onMediaPlay,N=_this239$props4.onMediaPlayError,_=_this239$props4.mediaSlideActionUserIds,ie=_this239$props4.rtcClient,ce=_this239$props4.userId,U=_this239$props4.wrapResource;return ze["default"].createElement(ol,{key:"".concat(a),uuid:p,slideRef:f,slideContext:m,zIndex:u,shapeGroupXML:o,interactiveSeqsKeys:g,eventSourceId:_this239.eventSourceId,resourceType:y,onEventSourceClick:b,onHyperLinkClick:S,shapeGroupTransform:c,flipH:h,flipV:d,meidaStates:w,disableAnimation:P,onMediaChange:A,onMediaPlay:R,onMediaPause:E,onMediaPlayError:N,userId:ce,mediaSlideActionUserIds:_,wrapResource:U,rtcClient:ie})},_this239.state={soundEffectUrl:null};var _this239$props5=_this239.props,t=_this239$props5.shapeGroupXML,i=_this239$props5.onEventSourceClick,r=t.extraAttr.getString("spId");_this239.shapeId=r;var n=pi(e.slideContext.uuid,e.slideContext.slideIndex,r);e.interactiveSeqsKeys&&e.interactiveSeqsKeys.indexOf(n)!==-1&&i!==void 0&&(_this239.eventSourceId=n),_this239.player=ze["default"].createRef();return _this239}_createClass(ol,[{key:"componentDidMount",value:function componentDidMount(){var _this240=this;var e=this.props.slideContext;window==null||window.addEventListener("message",function(t){t.data.type==="_playSoundEffect"&&t.data.targetID===pi(e.uuid,e.slideIndex,_this240.shapeId)&&_this240.playEffectSound(t.data.targetID,t.data.soundEffectId)})}},{key:"componentDidCatch",value:function componentDidCatch(e,t){var i=this.props.logger;i&&i.error("catch render error: ",e," stack: ",t.componentStack),this.setState({error:!0})}},{key:"transformWithShapeParams",value:function transformWithShapeParams(e,t){var i=t.translateX,r=t.translateY,n=e.flipH?-t.scaleX:t.scaleX,s=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&typeof t.rotate=="number"&&(o=t.rotate),{translateX:i,translateY:r,scaleX:n,scaleY:s,rotate:o}}},{key:"transform",value:function transform(e){var t=this.props.shapeGroupTransform,i={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0};t&&(i.rotate=t.rotate+i.rotate);var _this$transformWithSh2=this.transformWithShapeParams(e,i),r=_this$transformWithSh2.translateX,n=_this$transformWithSh2.translateY,s=_this$transformWithSh2.scaleX,o=_this$transformWithSh2.scaleY,a=_this$transformWithSh2.rotate;return"translate(".concat(I(r),", ").concat(I(n),") scale(").concat(s,",").concat(o,") rotate(").concat(Qn(a)+e.transform.rotate,"deg)")}},{key:"updateAnimation",value:function updateAnimation(e){var t;((t=this.player)==null?void 0:t.current)&&(e.play===1&&e.stop===0?this.player.current.play().then(function(){},function(){}):e.play===0&&e.stop===1&&this.player.current.pause())}},{key:"playEffectSound",value:function playEffectSound(e,t){if(t!==void 0){var _this$props77=this.props,i=_this$props77.resourceType,_r137=_this$props77.slideContext;if(i==="slide"){var n=_r137.resourceLoader.loadURL(i,t);if(n){var s=document.getElementById("".concat(e));if(s){var o=document.createElement("audio");return o.id="".concat(e,"-").concat(t),o.onpause=function(){o.remove()},o.src=n,o.controls=!1,s.appendChild(o),o.play().then(function(){},function(){}),!0}}}}return!1}},{key:"parseMediaRef",value:function parseMediaRef(e,t){if(t){var i=this.props.resourceType,_r138=t.childElementOptional(new G("a:videoFile","a:audioFile"));if(_r138){var n=_r138.name==="a:videoFile"?"video":"audio",s=_r138.attr.getString("r:link"),o=e.loadURL(i,s);if(o)return{resURL:o,mediaType:n};var a=t.childElementOptional("p:extLst","p:ext");if(a&&a.attr.getString("uri")==="{DAA4B4D4-6D71-4841-9C94-3DE7FCFB9230}"){var c=a.childElement("p14:media"),h=c.attr.getStringOptional("r:link"),d=c.attr.getStringOptional("r:embed"),u=h||d||"unknow";if(c.hasChildElementWithName("p14:trim")){var p=c.childElement("p14:trim"),f=p.attr.getNumberOptional("st"),m=p.attr.getNumberOptional("end");return f&&(f/=1e3),m&&(m/=1e3),{resURL:e.loadURL(i,u),mediaType:n,startTime:f,endTime:m}}else return{resURL:e.loadURL(i,u),mediaType:n}}}return}else return}},{key:"zIndex",value:function zIndex(e,t){var i=t.extraAttr.getStringOptional("spId");if(typeof i=="string"){var _r139=new h2(e).indexBySpId();if(i in _r139)return _r139[i]}return 999}},{key:"renderPictureContent",value:function renderPictureContent(e,_ref82,o,a){var t=_ref82.width,i=_ref82.height,r=_ref82.fillColor,n=_ref82.borderStyle,s=_ref82.margin;var c=e.childElementOptional("p:nvPicPr","p:nvPr"),h=e.childElement("p:nvPicPr","p:cNvPr").attr.getString("id"),d=this.parseMediaRef(o,c),u=e.childElementOptional("p:blipFill","a:blip"),p=0,f=e==null?void 0:e.childElementOptional("p:spPr","a:xfrm");if(f){var _e=f.attr.getNumber("rot",0);p=Number(_e)/Et}var m,g,y=M({},s);if(a){var _e9=Cy(p,a),lt=_e9.scaleX,Ye=_e9.scaleY;m=t*lt,g=i*Ye,y.left*=lt,y.right*=lt,y.top*=Ye,y.bottom*=Ye}else m=t,g=i;var _this$props78=this.props,b=_this$props78.meidaStates,S=_this$props78.uuid,w=_this$props78.slideContext,P=_this$props78.logger,A=_this$props78.slideRef,E=_this$props78.pausing,R=_this$props78.disableAnimation,N=_this$props78.onMediaChange,_=_this$props78.onMediaPause,ie=_this$props78.onMediaPlay,ce=_this$props78.onMediaPlayError,U=_this$props78.userId,He=_this$props78.mediaSlideActionUserIds,ii=_this$props78.rtcClient,Ae=_this$props78.resourceType,bt=b?b[h]:void 0;if(d&&d.mediaType==="video")return ze["default"].createElement(c2,{width:m,uuid:S,controllerProtalId:"netless-media-controller-portal-".concat(w.uuid),logger:P,slideRef:A,startTimePerfix:d.startTime?d.startTime:0,outsidePausing:E,height:g,fillColor:r,borderStyle:n,videoURL:d.resURL,shapeId:h,targetID:pi(w.uuid,w.slideIndex,h),mediaState:bt,resourceLoader:o,disableAnimation:R,onMediaChange:N,onMediaPlay:ie,onMediaPause:_,onMediaPlayError:ce,userId:U,mediaSlideActionUserIds:He,rtcClient:ii,mediaRef:d});if(d&&d.mediaType==="audio")return ze["default"].createElement(o2,{width:m,controllerProtalId:"netless-media-controller-portal-".concat(w.uuid),logger:P,slideRef:A,startTimePerfix:d.startTime?d.startTime:0,outsidePausing:E,height:g,borderStyle:n,uuid:S,audioURL:d.resURL,shapeId:h,targetID:pi(w.uuid,w.slideIndex,h),mediaState:bt,resourceLoader:o,disableAnimation:R,onMediaChange:N,onMediaPlay:ie,onMediaPause:_,onMediaPlayError:ce,userId:U,mediaSlideActionUserIds:He,rtcClient:ii,mediaRef:d});if(u){var _e10=u.attr.getStringOptional("r:embed");if(_e10===void 0)return null;{var _lt=o.loadURL(Ae,_e10),_Ye;return h&&(_Ye=o.loadURL(Ae,"spId".concat(h))),ze["default"].createElement(l2,{width:m,uuid:w.uuid,logger:P,resourceType:Ae,resId:_e10,height:g,slideIndex:w.slideIndex,fillColor:r,borderStyle:n,imageURL:_lt,margin:y,imageXML:e,preload:w.preload,spURL:_Ye})}}else return null}},{key:"renderShapeGroupContent",value:function renderShapeGroupContent(e){var _this241=this;var _this$props79=this.props,t=_this$props79.shapeGroupXML,i=_this$props79.shapeGroupTransform,r=_this$props79.flipH,n=_this$props79.flipV,s=t.elementsWithName("p:sp"),o=t.elementsWithName("p:cxnSp"),a=t.elementsWithName("p:pic"),c=t.elementsWithName("p:graphicFrame"),h=t.elementsWithName("p:grpSp");t.elementsWithName("mc:AlternateContent").forEach(function(m){var g=m.childElementOptional("mc:Choice","p:graphicFrame");if(g)c.push(g);else{var y=m.childElementOptional("mc:Fallback","p:pic");y&&a.push(y)}});var d=M({},e.transform),u=i;u&&(d.rotate+=u.rotate,d.scaleX*=u.scaleX,d.scaleY*=u.scaleY);var p=!!r!==e.flipH,f=!!n!==e.flipV;return ze["default"].createElement(ze["default"].Fragment,null,s.map(function(m,g){return _this241.renderShape(t,m,g,d,e,p,f)}),o.map(function(m,g){return _this241.renderShape(t,m,g,d,e,p,f)}),a.map(function(m,g){return _this241.renderPicture(t,m,g,d)}),c.map(function(m,g){return _this241.renderGraph(t,m,g,d)}),h.map(function(m,g){return _this241.renderShapeGroup(t,m,g,d,p,f)}))}},{key:"render",value:function render(){this.shapeWrappers=[];var _this$state6=this.state,e=_this$state6.error,t=_this$state6.soundEffectUrl;if(e)return ze["default"].createElement("div",{"data-reason":"render error"});var _this$props80=this.props,i=_this$props80.shapeGroupXML,r=_this$props80.slideContext,n=_this$props80.shapeGroupTransform,s=_this$props80.zIndex,o=this.shapeMap.map(i,r,n),a=i.extraAttr.getString("spId"),c,h,d,u;return n?(c=I((o.rectangle.x+n.translateX)*n.scaleX),h=I((o.rectangle.y+n.translateY)*n.scaleY),d=I(o.rectangle.width*n.scaleX),u=I(o.rectangle.height*n.scaleY)):(c=I(o.rectangle.x),h=I(o.rectangle.y),d=I(o.rectangle.width),u=I(o.rectangle.height)),ze["default"].createElement("div",{ref:this.animeTarget,className:"spGoupId-"+a,id:pi(r.uuid,r.slideIndex,a),style:{position:"absolute",left:c,top:h,transform:this.transform(o),width:d,height:u,zIndex:s,opacity:o.opacity}},t&&ze["default"].createElement("audio",{src:t,ref:this.player,controls:!1}),this.renderShapeGroupContent(o))}}]);return ol}(ze["default"].Component),oe="-1",p2="sequenceIndexes",m2="disableAutoPlay",f2="playLastStep",al;(function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"})(al||(al={}));var Ky=/*#__PURE__*/function(_Xi$default$Component){_inherits(Ky,_Xi$default$Component);var _super79=_createSuper(Ky);function Ky(e){var _this242;_classCallCheck(this,Ky);_this242=_super79.call(this,e);_this242.eventHub=new cy["default"],_this242.isImageLoadFinished=!1,_this242.shapeGroupRef=Xi["default"].createRef(),_this242.onHyperLinkClick=function(n,s){var o,a;var _this242$props=_this242.props,c=_this242$props.data,h=_this242$props.stateAdapter,d=_this242.getTurnToSlide(n,s);if(d){var u=d.match(/slide(\S*)/);u!==null&&((o=h==null?void 0:h.onPageJumpTo)==null||o.call(h,c.uuid,parseInt(u[1],10)))}typeof n=="number"&&((a=h==null?void 0:h.onPageJumpTo)==null||a.call(h,c.uuid,n))},_this242.onEventSourceClick=function(n){_this242.mainAnimationManager.interactiveSeqs.get(n)&&_this242.onMasterEventSourceClick(n)},_this242.onMediaPlay=function(n,s,o){window!==void 0&&window.postMessage({shapeId:n,mediaType:s,action:"play"},"*");var a=_this242.props.callbacks;a&&a.onMediaPlay&&a.onMediaPlay(n,s)},_this242.onMediaPause=function(n,s,o){var _this242$props2=_this242.props,a=_this242$props2.userId,c=_this242$props2.callbacks,h=_this242.state.mediaActionUserIds;a!==void 0&&h!==void 0&&h[_this242.currentSlideKey]!==void 0&&h[_this242.currentSlideKey][n]===a&&_this242.setMediaState({playing:!1,currentTime:o},n),window!==void 0&&window.postMessage({shapeId:n,mediaType:s,action:"pause"},"*"),c&&c.onMediaPause&&c.onMediaPause(n,s)},_this242.setMediaState=function(n,s){var _this242$props3=_this242.props,o=_this242$props3.pptState,a=_this242$props3.userId,c=_this242$props3.stateAdapter,h=_this242$props3.data,d,u;if(o===void 0||o.mediaStates===void 0)d=_defineProperty({},_this242.currentSlideKey,_defineProperty({},s,n)),a!==void 0&&(u=_defineProperty({},_this242.currentSlideKey,_defineProperty({},s,a)));else{var p=o.mediaStates[_this242.currentSlideKey];if(p===void 0?p=_defineProperty({},s,n):p[s]=n,a!==void 0){var f=_this242.state.mediaActionUserIds;f!==void 0?f[_this242.currentSlideKey]!==void 0?u=D(M({},f),_defineProperty({},_this242.currentSlideKey,D(M({},f[_this242.currentSlideKey]),_defineProperty({},s,a)))):u=D(M({},f),_defineProperty({},_this242.currentSlideKey,_defineProperty({},s,a))):u=_defineProperty({},_this242.currentSlideKey,_defineProperty({},s,a))}d=D(M({},o.mediaStates),_defineProperty({},_this242.currentSlideKey,p))}c.setState(h.uuid,h.index,D(M({},o),{mediaStates:d,mediaActionUserIds:u}))};var t,i;var r=e.data;_this242.preSlideIndex=(i=(t=e.pptState)==null?void 0:t.preSlideIndex)!=null?i:0,_this242.currentSlideKey="".concat(r.uuid,"-").concat(r.index),_this242.masterAnimationManager=r.animations.masterAnimationManager,_this242.layoutAnimationManager=r.animations.layoutAnimationManager,_this242.slideAnimationManager=r.animations.slideAnimationManager,_this242.mainAnimationManager=r.animations.mainAnimationManager,_this242.animationCount=r.animations.animationCount,_this242.initSlideStates(),_this242.masterInteractiveSeqsKeys=Array.from(_this242.masterAnimationManager.interactiveSeqs.keys()),_this242.layoutInteractiveSeqsKeys=Array.from(_this242.layoutAnimationManager.interactiveSeqs.keys()),_this242.slideInteractiveSeqsKeys=Array.from(_this242.slideAnimationManager.interactiveSeqs.keys()),_this242.slide=Xi["default"].createRef(),_this242.isRenderMaster=e.data.layoutXML.childElement("p:sldLayout").attr.getBoolean("showMasterSp",!0),_this242.changeStep.bind(_assertThisInitialized(_this242)),Mi.reset(_this242.eventHub);return _this242}_createClass(Ky,[{key:"componentDidMount",value:function componentDidMount(){this.isImageLoadFinished=Mi.endLoadTask("slideDidUpdate"),this.mainAnimationManager.animBoxes.forEach(function(s){return s.applyPreAnimation()});var e=this.getMainStepsFromSequences();this.mainAnimationManager.mainSeq.effectType!=="clickEffect"&&e===1?(this.mainAnimationManager.mainSeq.seekIndex(0),this.mainAnimationManager.mainSeq.play()):e&&this.mainAnimationManager.mainSeq.seekIndex(e);var t=this.state[this.currentSlideKey],i=t.sequenceSteps,r=t.layoutSequenceSteps,n=t.masterSequenceSteps;this.mainAnimationManager.interactiveSeqs.forEach(function(s,o){i&&i[o]?s.seekIndex(i[o]):r&&r[o]?s.seekIndex(r[o]):n&&n[o]?s.seekIndex(n[o]):s.seekIndex(0)})}},{key:"UNSAFE_componentWillReceiveProps",value:function UNSAFE_componentWillReceiveProps(e){var _this243=this;if(e.pptState!==void 0){var t=this.props.pptState;if(this.setState(e.pptState),!t||!t[this.currentSlideKey]){this.playAnime(t,e.pptState,this.mainAnimationManager.mainSeq,oe),this.mainAnimationManager.interactiveSeqs.forEach(function(i,r){_this243.playAnime(t,e.pptState,i,r)});return}if(this.mainAnimationManager.interactiveSeqs.forEach(function(i,r){_this243.playAnime(t,e.pptState,i,r)}),!e.pptState[this.currentSlideKey])return;this.playAnime(t,e.pptState,this.mainAnimationManager.mainSeq,oe)}}},{key:"componentDidUpdate",value:function componentDidUpdate(e,t){var _this244=this;var i=this.props.data;e.data.index!==i.index&&Mi.endLoadTask("slideDidUpdate");var r=this.state[this.currentSlideKey],n=t[this.currentSlideKey];n!==void 0&&r===void 0&&(this.resetAnimation(),this.mainAnimationManager.mainSeq.seekIndex(0),setTimeout(function(){_this244.mainAnimationManager.mainSeq.effectType!=="clickEffect"&&_this244.mainAnimationManager.mainSeq.play();var s=_this244.initSlideAnimationState();e.stateAdapter.setState(i.uuid,i.index,M({},_this244.composeSlideStateIntoPPTState(s)))},80))}},{key:"componentDidCatch",value:function componentDidCatch(e){console.error("catched error: ",e);var _this$props81=this.props,t=_this$props81.data,i=_this$props81.userId;t.logger&&t.logger.error("catched ppt: ".concat(t.uuid,",\n                index: ").concat(t.index,", user: ").concat(i," render error : "),e)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.masterAnimationManager.triggerEvent.emit("onUnmount",{target:"master"}),this.layoutAnimationManager.triggerEvent.emit("onUnmount",{target:"layout"}),this.slideAnimationManager.triggerEvent.emit("onUnmount",{target:"slide"}),this.mainAnimationManager.triggerEvent.emit("onUnmount",{target:"slide"})}},{key:"onPageToNext",value:function onPageToNext(){var e=this.props.stateAdapter;return this.setDisableAutoPlay(!1),this.pauseAllAnimation(!0),e.onPageToNext?e.onPageToNext():void 0}},{key:"onPageToPrev",value:function onPageToPrev(){var e=this.props.stateAdapter;return this.pauseAllAnimation(),e.onPageToPrev?e.onPageToPrev():void 0}},{key:"onMasterEventSourceClick",value:function onMasterEventSourceClick(e){var _this$composeSlideSta,_this245=this;var t=this.mainAnimationManager.interactiveSeqs.get(e),i=this.state[this.currentSlideKey],_this$props82=this.props,r=_this$props82.stateAdapter,n=_this$props82.data,s=i.masterSequenceSteps,o=i.layoutSequenceSteps,a=i.sequenceSteps,c=s[e],h="masterSequenceSteps",d=s;if(c===void 0&&(c=o[e],h="layoutSequenceSteps",d=o),c===void 0&&(c=a[e],h="sequenceSteps",d=a),c===void 0)return;var u;t!==void 0&&e!==oe&&(c>t.length||c===t.length&&!t.isPlaying)?u=0:u=c+1,r.setState(n.uuid,n.index,this.composeSlideStateIntoPPTState((_this$composeSlideSta={},_defineProperty(_this$composeSlideSta,h,D(M({},d),_defineProperty({},e,u))),_defineProperty(_this$composeSlideSta,"hasChangeStep",!0),_this$composeSlideSta))),c!==0&&u===0&&setTimeout(function(){var _this245$composeSlide;r.setState(n.uuid,n.index,_this245.composeSlideStateIntoPPTState((_this245$composeSlide={},_defineProperty(_this245$composeSlide,h,D(M({},d),_defineProperty({},e,u+1))),_defineProperty(_this245$composeSlide,"hasChangeStep",!0),_this245$composeSlide)))},80)}},{key:"getTurnToSlide",value:function getTurnToSlide(e,t){var i=this.props.data,r=i.resourceLoader;if(t)return /m/.test(t)?r.resource.master[e]:/l/.test(t)?r.resource.layout[e]:r.resource.slide[e];var n=r.resource.master[e];return n||(n=r.resource.layout[e],n)||(n=r.resource.slide[e]),n}},{key:"getCurrentSequences",value:function getCurrentSequences(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!1;var _ref83=t!=null?t:this.state,r=_ref83[this.currentSlideKey];if(!r)return[void 0,"masterSequenceSteps"];var n=r.sequenceSteps,s=r.layoutSequenceSteps,o=r.masterSequenceSteps;if(typeof e=="number"){var _this$animationCount=this.animationCount,a=_this$animationCount.slide,c=_this$animationCount.layout,h=_this$animationCount.master;if(e<h||i&&e<=h)return[o,"masterSequenceSteps"];if(e<h+c||i&&e<=h+c)return[s,"layoutSequenceSteps"];if(e<h+c+a||i&&e<=h+c+a)return[n,"sequenceSteps"]}return o[e]!==void 0?[o,"masterSequenceSteps"]:s[e]!==void 0?[s,"layoutSequenceSteps"]:[n,"sequenceSteps"]}},{key:"getCurrentSequenceAnimationCount",value:function getCurrentSequenceAnimationCount(e){return e==="sequenceSteps"?this.animationCount.slide:e==="layoutSequenceSteps"?this.animationCount.layout:e==="masterSequenceSteps"?this.animationCount.master:0}},{key:"getMainStepsFromSequences",value:function getMainStepsFromSequences(e){var _ref84=e!=null?e:this.state,t=_ref84[this.currentSlideKey];if(!t)return;var i=t.sequenceSteps,r=t.layoutSequenceSteps,n=t.masterSequenceSteps,s=0;return n&&n[oe]&&n[oe]>0&&(s+=n[oe]),r&&r[oe]&&r[oe]>0&&(s+=r[oe]),i&&i[oe]&&i[oe]>0&&(s+=i[oe]),s}},{key:"getSequencesByKey",value:function getSequencesByKey(e,t){var _ref85=t!=null?t:this.state,i=_ref85[this.currentSlideKey];if(!i)return[void 0,void 0];var r=i.sequenceSteps,n=i.layoutSequenceSteps,s=i.masterSequenceSteps;return r&&r[e]!==void 0?[r,"sequenceSteps"]:n&&n[e]!==void 0?[n,"layoutSequenceSteps"]:s&&s[e]!==void 0?[s,"masterSequenceSteps"]:[void 0,void 0]}},{key:"setDisableAutoPlay",value:function setDisableAutoPlay(e){var _this$props83=this.props,t=_this$props83.stateAdapter,i=_this$props83.data,r=this.state[this.currentSlideKey],n=r.masterSequenceSteps,s=r.layoutSequenceSteps,o=r.sequenceSteps;t.setState(i.uuid,i.index,this.composeSlideStateIntoPPTState({masterSequenceSteps:n,layoutSequenceSteps:s,sequenceSteps:o},e))}},{key:"pauseAllAnimation",value:function pauseAllAnimation(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1;if(this.mainAnimationManager.mainSeq.pause(),e){var _this$animationCount2=this.animationCount,i=_this$animationCount2.slide,_r140=_this$animationCount2.layout,n=_this$animationCount2.master;this.mainAnimationManager.mainSeq.seekIndex(i+_r140+n)}var t=this.getMainStepsFromSequences();t&&this.mainAnimationManager.mainSeq.seekIndex(t),this.mainAnimationManager.interactiveSeqs.forEach(function(i){return i.pause()})}},{key:"initSlideAnimationState",value:function initSlideAnimationState(){var e=_defineProperty({},oe,0),t=_defineProperty({},oe,0),i=_defineProperty({},oe,0),r=!1,n=!1;return this.animationCount.master>0&&this.masterAnimationManager.mainSeq.effectType!=="clickEffect"&&(i[oe]=1,r=!0),this.masterAnimationManager.interactiveSeqs.forEach(function(s,o){i[o]=0}),this.animationCount.layout>0&&this.layoutAnimationManager.mainSeq.effectType!=="clickEffect"&&!r&&(t[oe]=1,n=!0),this.layoutAnimationManager.interactiveSeqs.forEach(function(s,o){t[o]=0}),this.animationCount.slide>0&&this.slideAnimationManager.mainSeq.effectType!=="clickEffect"&&!r&&!n&&(e[oe]=1),this.slideAnimationManager.interactiveSeqs.forEach(function(s,o){e[o]=0}),{masterSequenceSteps:i,layoutSequenceSteps:t,sequenceSteps:e,hasChangeStep:!1}}},{key:"initSlideStates",value:function initSlideStates(){var e,t;var i=this.initSlideAnimationState(),r=i.hasChangeStep,n=i.sequenceSteps,s=i.layoutSequenceSteps,o=i.masterSequenceSteps,a=this.props.pptState,c={};a!==void 0&&(c=a);var h=c[this.currentSlideKey];h&&(o=(e=h.masterSequenceSteps)!=null?e:o,s=(t=h.layoutSequenceSteps)!=null?t:s,n=h.sequenceSteps),this.state=M({},this.composeSlideStateIntoPPTState({masterSequenceSteps:o,layoutSequenceSteps:s,sequenceSteps:n,hasChangeStep:r}))}},{key:"composeSlideStateIntoPPTState",value:function composeSlideStateIntoPPTState(e,t){var _D7,_D8,_D9;var _this$props84=this.props,i=_this$props84.pptState,r=_this$props84.data;if(!this.state)return D(M({},i),(_D7={},_defineProperty(_D7,this.currentSlideKey,M({},e)),_defineProperty(_D7,"uuid",r.uuid),_defineProperty(_D7,"pageIndex",r.index),_D7));var n=this.state[this.currentSlideKey];return t!==void 0?D(M({},i),(_D8={},_defineProperty(_D8,this.currentSlideKey,M(M({},n),e)),_defineProperty(_D8,"uuid",r.uuid),_defineProperty(_D8,"pageIndex",r.index),_defineProperty(_D8,"disableAutoPlay",t),_D8)):D(M({},i),(_D9={},_defineProperty(_D9,this.currentSlideKey,M(M({},n),e)),_defineProperty(_D9,"uuid",r.uuid),_defineProperty(_D9,"pageIndex",r.index),_D9))}},{key:"playAnime",value:function playAnime(e,t,i,r){var n;var s,o;if(r===oe)s=this.getMainStepsFromSequences(e),o=this.getMainStepsFromSequences(t);else{var _this$getSequencesByK=this.getSequencesByKey(r,e),_this$getSequencesByK2=_slicedToArray(_this$getSequencesByK,1),a=_this$getSequencesByK2[0],_this$getSequencesByK3=this.getSequencesByKey(r,t),_this$getSequencesByK4=_slicedToArray(_this$getSequencesByK3,1),c=_this$getSequencesByK4[0];a&&(s=a[r]),c&&(o=c[r])}if(s!==o)if(o){if(o!==s)if(s===-1)i.seekIndex(((n=this.slideAnimationManager.mainSeq)==null?void 0:n.length)||0);else if(o<=i.length&&o>=0){var _a27=o-(s||0);_a27>0?((i.index===o-2&&i.isPlaying||_a27>1)&&i.seekIndex(o-1),i.play()):_a27<0&&(i.pause(),i.seekIndex(o))}else o>i.length&&(i.pause(),i.seekIndex(i.length))}else i.pause(),i.seekIndex(0)}},{key:"resetAnimationSteps",value:function resetAnimationSteps(){var e={},t={},i={};return this.masterAnimationManager.interactiveSeqs.forEach(function(r,n){i[n]=0}),i[oe]=0,this.layoutAnimationManager.interactiveSeqs.forEach(function(r,n){t[n]=0}),t[oe]=0,this.masterAnimationManager.interactiveSeqs.forEach(function(r,n){e[n]=0}),e[oe]=0,{sequenceSteps:e,layoutSequenceSteps:t,masterSequenceSteps:i,hasChangeStep:!1}}},{key:"resetAnimation",value:function resetAnimation(){var _this$props85=this.props,e=_this$props85.stateAdapter,t=_this$props85.data,i=this.resetAnimationSteps(),r=D(M({},this.state),_defineProperty({},this.currentSlideKey,i));e.setState(t.uuid,t.index,r)}},{key:"resetCurrentSlideAnimation",value:function resetCurrentSlideAnimation(){var _this$props86=this.props,e=_this$props86.stateAdapter,t=_this$props86.data,i=D(M({},this.state),_defineProperty({},this.currentSlideKey,void 0));e.setState(t.uuid,t.index,i)}},{key:"resetCurrentPPTAnimation",value:function resetCurrentPPTAnimation(){var _this246=this;var _this$state7=this.state,e=_this$state7.disableAutoPlay,t=_this$state7.pageIndex,i=_this$state7.playLastStep,r=_this$state7.progressIndex,n=_this$state7.uuid,s=_this$state7[this.currentSlideKey];if(!s)return;var _this$props87=this.props,o=_this$props87.data,a=_this$props87.stateAdapter,c=_this$props87.pptState,h=c.preSlideIndex,d={disableAutoPlay:e,pageIndex:t,playLastStep:i,progressIndex:r,uuid:n,preSlideIndex:h},u=Object.keys(this.state).filter(function(f){return f.includes(o.uuid)}).map(function(f){var m=_this246.state[f];return M({key:f},m)}),p={};u.forEach(function(f){var m=f.key;p[m]=void 0}),d=M(M({},d),p),a.setState(o.uuid,o.index,d)}},{key:"toNextPage",value:function toNextPage(){var e=this.props.stateAdapter;e.onPageToNext&&e.onPageToNext()}},{key:"toPrevPage",value:function toPrevPage(){var e=this.props.stateAdapter;e.onPageToPrev&&e.onPageToPrev()}},{key:"changeStep",value:function changeStep(e){var _this$composeSlideSta2,_this$composeSlideSta3;var _this$props88=this.props,t=_this$props88.stateAdapter,i=_this$props88.data,r=this.getMainStepsFromSequences(),_this$getCurrentSeque=this.getCurrentSequences(r!=null?r:1,void 0,e<0),_this$getCurrentSeque2=_slicedToArray(_this$getCurrentSeque,2),n=_this$getCurrentSeque2[0],s=_this$getCurrentSeque2[1];if(n===void 0||s===void 0)return;var o=n[oe];if(o===void 0||this.mainAnimationManager.mainSeq.length===0){e>0?this.onPageToNext():e<0&&this.onPageToPrev();return}o<0&&(this.masterAnimationManager.triggerEvent.emit("onEnd",{target:"slide"}),o=this.mainAnimationManager.mainSeq.length);var a=o+e;a<0?this.onPageToPrev():a>this.getCurrentSequenceAnimationCount(s)?this.onPageToNext():o===1&&a===0?t.setState(i.uuid,i.index,M({},this.composeSlideStateIntoPPTState((_this$composeSlideSta2={},_defineProperty(_this$composeSlideSta2,s,D(M({},n),_defineProperty({},oe,a))),_defineProperty(_this$composeSlideSta2,"hasChangeStep",!0),_this$composeSlideSta2),!0))):t.setState(i.uuid,i.index,M({},this.composeSlideStateIntoPPTState((_this$composeSlideSta3={},_defineProperty(_this$composeSlideSta3,s,D(M({},n),_defineProperty({},oe,a))),_defineProperty(_this$composeSlideSta3,"hasChangeStep",!0),_this$composeSlideSta3))))}},{key:"renderMediaControllerPortal",value:function renderMediaControllerPortal(e){var t=this.props.renderMode;return t===0?Xi["default"].createElement("div",{id:"netless-media-controller-portal-".concat(e.uuid),style:{position:"absolute",zIndex:1e3}}):null}},{key:"render",value:function render(){var e,t,i,r,n,s,o;var _this$props89=this.props,a=_this$props89.disableAnimation,c=_this$props89.renderMode,h=_this$props89.className,d=_this$props89.data,u=_this$props89.pausing,p=_this$props89.userId,f=_this$props89.callbacks,m=_this$props89.pptState,g=d.slideXML.childElement("p:sld","p:cSld","p:spTree"),y=d.masterXML.childElement("p:sldMaster","p:cSld","p:spTree"),b=d.layoutXML.childElement("p:sldLayout","p:cSld","p:spTree"),S=d.slideXML.childElement("p:sld","p:cSld"),w={uuid:d.uuid,resourceLoader:d.resourceLoader,slideWidth:d.width,slideHeight:d.height,preSlideIndex:this.preSlideIndex,slideIndex:d.index+1,preload:d.preload,slideCount:d.slidesCount},P=a;c!==void 0&&c===1&&(P=!0);var A=(e=m==null?void 0:m.mediaStates)==null?void 0:e[this.currentSlideKey];return Xi["default"].createElement(ox,{className:h,slideContext:w,slideRef:this.slide,cSld:S,resourceLoader:d.resourceLoader},this.renderMediaControllerPortal(d),this.isRenderMaster&&Xi["default"].createElement(ol,{uuid:d.uuid,logger:d.logger,slideRef:this.slide,slideContext:w,shapeGroupXML:y,resourceType:"master",disableAnimation:P,zIndex:0,wrapResource:(t=d.WrapResource)==null?void 0:t.master,ref:this.shapeGroupRef,pausing:u,userId:p,interactiveSeqsKeys:this.masterInteractiveSeqsKeys||[],onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:A,mediaSlideActionUserIds:(i=m==null?void 0:m.mediaActionUserIds)==null?void 0:i[this.currentSlideKey],onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:d.rtcClient,animationManager:this.masterAnimationManager}),Xi["default"].createElement(ol,{uuid:d.uuid,logger:d.logger,slideRef:this.slide,slideContext:w,shapeGroupXML:b,resourceType:"layout",disableAnimation:P,zIndex:1,wrapResource:(r=d.WrapResource)==null?void 0:r.layout,ref:this.shapeGroupRef,pausing:u,userId:p,interactiveSeqsKeys:this.layoutInteractiveSeqsKeys||[],onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:A,mediaSlideActionUserIds:(n=m==null?void 0:m.mediaActionUserIds)==null?void 0:n[this.currentSlideKey],onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:d.rtcClient,animationManager:this.layoutAnimationManager}),Xi["default"].createElement(ol,{uuid:d.uuid,ref:this.shapeGroupRef,shapeGroupXML:g,pausing:u,userId:p,logger:d.logger,slideRef:this.slide,slideContext:w,resourceType:"slide",interactiveSeqsKeys:this.slideInteractiveSeqsKeys||[],zIndex:2,onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:A,mediaSlideActionUserIds:(s=m==null?void 0:m.mediaActionUserIds)==null?void 0:s[this.currentSlideKey],disableAnimation:P,onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:d.rtcClient,wrapResource:(o=d.WrapResource)==null?void 0:o.slide,animationManager:this.slideAnimationManager}))}}]);return Ky}(Xi["default"].Component);function Xy(e,t){var i={},r={},n={};var _iterator205=_createForOfIteratorHelper(e.elements),_step205;try{for(_iterator205.s();!(_step205=_iterator205.n()).done;){var s=_step205.value;var o=s.childElementOptional(new G("p:nvSpPr","p:nvCxnSpPr"));if(o){var a=o.childElement("p:cNvPr").attr.getStringOptional("id"),c=o.childElementOptional("p:nvPr","p:ph"),h=c&&c.attr.getStringOptional("idx"),d=c&&c.attr.getStringOptional("type");a!==void 0&&(i[a]=s),h!==void 0?r[h]=s:(d==="title"||d==="ctrTitle")&&(r[0]=s),d==="title"||d==="ctrTitle"?(n.title=s,n.ctrTitle=s):d!==void 0&&(n[d]=s)}}}catch(err){_iterator205.e(err)}finally{_iterator205.f()}return Object.freeze(t?{idIndex:Object.freeze(i),idxIndex:Object.freeze(r),typeIndex:Object.freeze(n),txStyle:Object.freeze(g2(t))}:{idIndex:Object.freeze(i),idxIndex:Object.freeze(r),typeIndex:Object.freeze(n)})}function g2(e){var t={},i=e.elementWithName("p:bodyStyle");i&&(t.body=i);var r=e.elementWithName("p:titleStyle");r&&(t.title=r,t.subTitle=r,t.ctrTitle=r);var n=e.elementWithName("p:otherStyle");return n&&(t.other=n),t}var y2=/*#__PURE__*/function(){function y2(e,t){_classCallCheck(this,y2);this.resource=e,this.resourceScheme=t}_createClass(y2,[{key:"loadURL",value:function loadURL(e,t){var i=this.resource[e]&&this.resource[e][t];return typeof i=="undefined"||(i=this.replaceProtocolByresourceScheme(i)),i}},{key:"replaceProtocolByresourceScheme",value:function replaceProtocolByresourceScheme(e){var t=e;return this.resourceScheme&&(t=t.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),t}}]);return y2}();function b2(e){e.bindAttributePicker("a:p","*",k2),e.bindAttributePicker("a:p","indent",Yy(-342900,0)),e.bindAttributePicker("a:p","marL",Yy(342900,0)),e.bindAttributePicker("a:p","level",C2),e.bindAttributePicker("a:bodyPr","*",v2),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld"],"*",Vd),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld","a:p"],"sz",P2),e.bindAttributePicker(["a:r"],"highlight",I2),e.bindAttributePicker(["a:r","a:fld"],"color",E2),e.bindAttributePicker(["a:r","a:fld"],"fontType",A2),e.bindAttributePicker("a:p","placeHolderType",O2),e.bindChildPicker("a:p","bu",R2),e.bindAttributePicker("a:p","buClr",N2),e.bindAttributePicker("a:p","lineHeight",D2),e.bindAttributePicker("a:p",["a:spcBef","a:spcAft"],F2)}var v2=function v2(e,t,i,r,n){var _S13=S2(e,t,r,n),s=_S13.pPrXMLList;var _iterator206=_createForOfIteratorHelper(s),_step206;try{for(_iterator206.s();!(_step206=_iterator206.n()).done;){var o=_step206.value;var a=o.attr.getOptional(i);if(a!==void 0)return a}}catch(err){_iterator206.e(err)}finally{_iterator206.f()}};function S2(e,t,i,r){var n=i.bodyPrXMlList;return n||(n=i.bodyPrXMlList=Object.freeze(w2(e,t,r))),n}function w2(e,t,i){var r=[],n=e.parentElement(new G("p:sp","p:graphicFrame")),_Mr4=Mr(n,t,i),s=_Mr4.allShape,o=_Mr4.hasPlaceHolder;var _iterator207=_createForOfIteratorHelper(s),_step207;try{for(_iterator207.s();!(_step207=_iterator207.n()).done;){var a=_step207.value;var c=a.childElementOptional("p:txBody","a:bodyPr");c&&r.push(c)}}catch(err){_iterator207.e(err)}finally{_iterator207.f()}return{pPrXMLList:r,hasPlaceHolder:o}}var k2=function k2(e,t,i,r,n){var _cn=cn(e,t,r,n),s=_cn.pPrXMLList;var _iterator208=_createForOfIteratorHelper(s),_step208;try{for(_iterator208.s();!(_step208=_iterator208.n()).done;){var o=_step208.value;var a=o.attr.getOptional(i);if(a!==void 0)return a}}catch(err){_iterator208.e(err)}finally{_iterator208.f()}},Yy=function Yy(e,t){return function(i,r,n,s,o){var _cn2=cn(i,r,s,o),a=_cn2.pPrXMLList,c=_cn2.hasPlaceHolder;var _iterator209=_createForOfIteratorHelper(a),_step209;try{for(_iterator209.s();!(_step209=_iterator209.n()).done;){var h=_step209.value;var d=h.attr.getOptional(n);if(d!==void 0)return d}}catch(err){_iterator209.e(err)}finally{_iterator209.f()}return c?e:t}},C2=function C2(e,t,i,r,n){return cn(e,t,r,n).level};function cn(e,t,i,r){var n=i.pPrXMlList;return n||(n=i.pPrXMlList=Object.freeze(x2(e,t,r))),n}function x2(e,t,i){var r=[],n=e.parentElement(new G("p:sp","p:graphicFrame")),s=e.childElementOptional("a:pPr"),o=0;s&&(r.push(s),o=s.attr.getNumber("lvl",0));var a="a:lvl".concat(o+1,"pPr"),_Mr5=Mr(n,t,i),c=_Mr5.allShape,h=_Mr5.placeHolderType,d=_Mr5.masterStyleXML,u=_Mr5.hasPlaceHolder;var _iterator210=_createForOfIteratorHelper(c),_step210;try{for(_iterator210.s();!(_step210=_iterator210.n()).done;){var _p16=_step210.value;var f=_p16.childElementOptional("p:txBody","a:lstStyle",a);f&&r.push(f)}}catch(err){_iterator210.e(err)}finally{_iterator210.f()}if(d){var p=d.childElementOptional(a);p&&r.push(p)}return{pPrXMLList:r,placeHolderType:h,level:o,hasPlaceHolder:u}}var Vd=function Vd(e,t,i,r,n){var _Wd=Wd(e,t,r,n),s=_Wd.pPrXMLList;var _iterator211=_createForOfIteratorHelper(s),_step211;try{for(_iterator211.s();!(_step211=_iterator211.n()).done;){var o=_step211.value;var a=o.attr.getOptional(i);if(a!==void 0)return a}}catch(err){_iterator211.e(err)}finally{_iterator211.f()}},I2=function I2(e,t){var i=e.childElementOptional("a:rPr","a:highlight",_construct(G,Pi));if(i)return sn(i,t)},P2=function P2(e,t,i,r,n){var s=Vd(e,t,"sz",r,n),o=Vd(e,t,"kern",r,n);return s||o};function Wd(e,t,i,r){var n=i.rangeXMlList;return n||(n=i.rangeXMlList=Object.freeze(M2(e,t,r))),n}function M2(e,t,i){var r=e.elementWithName("a:rPr"),n;e.name==="a:p"?n=e:n=e.parentElement("a:p");var _T=T2(n,t,i),s=_T.placeHolderType,o=_T.pPrXMLList,a=_T.level,c=_T.hasPlaceHolder;return r?{placeHolderType:s,pPrXMLList:[e,r].concat(_toConsumableArray(o)),level:a,hasPlaceHolder:c}:{placeHolderType:s,pPrXMLList:[e].concat(_toConsumableArray(o)),level:a,hasPlaceHolder:c}}function T2(e,t,i){var r=[],n=e.parentElement(new G("p:sp","p:graphicFrame")),s=e.childElementOptional("a:pPr"),o=0;if(s){o=s.attr.getNumber("lvl",0);var p=s.childElementOptional("a:defRPr");p&&r.push(p)}var a="a:lvl".concat(o+1,"pPr"),_Mr6=Mr(n,t,i),c=_Mr6.allShape,h=_Mr6.placeHolderType,d=_Mr6.masterStyleXML,u=_Mr6.hasPlaceHolder;var _iterator212=_createForOfIteratorHelper(c),_step212;try{for(_iterator212.s();!(_step212=_iterator212.n()).done;){var _p18=_step212.value;var f=_p18.childElementOptional("p:txBody","a:lstStyle",a,"a:defRPr");f&&r.push(f);var m=_p18.childElementOptional("p:style");if(m){var g=kd(m,t);r.push(g.font.fontRef),g.font.xml&&r.push(g.font.xml)}}}catch(err){_iterator212.e(err)}finally{_iterator212.f()}if(d){var _p17=d.childElementOptional(a,"a:defRPr");_p17&&r.push(_p17)}return{pPrXMLList:r,placeHolderType:h,level:o,hasPlaceHolder:u}}var E2=function E2(e,t,i,r,n){var _Wd2=Wd(e,t,r,n),s=_Wd2.pPrXMLList;var _iterator213=_createForOfIteratorHelper(s),_step213;try{for(_iterator213.s();!(_step213=_iterator213.n()).done;){var o=_step213.value;var a=o.childElementOptional(_construct(G,es));if(a)return new xr().read(a,t);var c=o.childElementOptional(_construct(G,Pi));if(c)return sn(c,t)}}catch(err){_iterator213.e(err)}finally{_iterator213.f()}},A2=function A2(e,t,i,r,n){var s=Wd(e,t,r,n),o=s.pPrXMLList,a=[];var _iterator214=_createForOfIteratorHelper(o),_step214;try{for(_iterator214.s();!(_step214=_iterator214.n()).done;){var u=_step214.value;var p=u.childElementOptional("a:latin"),f=u.childElementOptional("a:ea");if(p){var m=p.attr.getOptional("typeface");typeof m=="string"&&a.push(m)}if(f){var _m27=f.attr.getOptional("typeface");typeof _m27=="string"&&a.push(_m27)}}}catch(err){_iterator214.e(err)}finally{_iterator214.f()}Fx(s.placeHolderType)?a=a.concat(wd(by(t))):a=a.concat(wd(vy(t))),a=a.filter(function(u){return u!==""});var c=[],h=by(t),d=vy(t);return a.forEach(function(u){switch(u){case"+mj-lt":{c=h.latin?c.concat(h.latin):c;break}case"+mj-ea":{c=h.ea?c.concat(h.ea):c;break}case"+mj-cs":{c=h.cs?c.concat(h.cs):c;break}case"+mn-lt":{c=d.latin?c.concat(d.latin):c;break}case"+mn-ea":{c=d.ea?c.concat(d.ea):c;break}case"+mn-cs":{c=h.cs?c.concat(h.cs):c;break}default:{c.push(u);break}}}),c.forEach(function(u){gy(u,t.userFonts).then(function(){},function(){})}),c.join(",")},O2=function O2(e){var t=e.parentElement(new G("p:sp","p:graphicFrame")).childElementOptional(new G("p:nvSpPr","p:nvCxnSpPr"));return t&&t.childElementOptional("p:nvPr","p:ph")?"true":"false"},R2=function R2(e,t,i,r,n){var _cn3=cn(e,t,r,n),s=_cn3.pPrXMLList;var _iterator215=_createForOfIteratorHelper(s),_step215;try{for(_iterator215.s();!(_step215=_iterator215.n()).done;){var o=_step215.value;var a=o.childElementOptional(new G("a:buChar","a:buNone","a:buAutoNum","a:buBlip"));if(a!==void 0)return a}}catch(err){_iterator215.e(err)}finally{_iterator215.f()}},N2=function N2(e,t,i,r,n){var _cn4=cn(e,t,r,n),s=_cn4.pPrXMLList;var _iterator216=_createForOfIteratorHelper(s),_step216;try{for(_iterator216.s();!(_step216=_iterator216.n()).done;){var o=_step216.value;var a=o.childElementOptional("a:buClr");if(a)return sn(a.childElement(_construct(G,Pi)),t)}}catch(err){_iterator216.e(err)}finally{_iterator216.f()}};function L2(e){var t=e.childElementOptional("a:lnSpc",new G("a:spcPct","a:spcPts"));if(t){var i=0,_r141=e.parentElementOptional("p:txBody");if(_r141){var n=_r141.childElementOptional("a:bodyPr","a:normAutofit");n&&(i=xe(n.attr.getNumber("lnSpcReduction",0)))}switch(t.name){case"a:spcPct":return xe(t.attr.getString("val"))*1.2-i;case"a:spcPts":return"".concat(t.attr.getNumber("val")/100*(1-i),"pt");default:return;}}else return}var D2=function D2(e,t,i,r,n){var _cn5=cn(e,t,r,n),s=_cn5.pPrXMLList;var _iterator217=_createForOfIteratorHelper(s),_step217;try{for(_iterator217.s();!(_step217=_iterator217.n()).done;){var o=_step217.value;var a=L2(o);if(a!==void 0)return a}}catch(err){_iterator217.e(err)}finally{_iterator217.f()}return QC},F2=function F2(e,t,i,r,n){var _cn6=cn(e,t,r,n),s=_cn6.pPrXMLList;var _iterator218=_createForOfIteratorHelper(s),_step218;try{for(_iterator218.s();!(_step218=_iterator218.n()).done;){var o=_step218.value;var a=B2(o,i);if(a!==void 0)return a}}catch(err){_iterator218.e(err)}finally{_iterator218.f()}};function B2(e,t){var i=e.childElementOptional(t,new G("a:spcPct","a:spcPts"));if(i)switch(i.name){case"a:spcPct":return xe(i.attr.getString("val"));case"a:spcPts":return"".concat(i.attr.getNumber("val")/100,"pt");default:return;}else return}function j2(e){e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"x",function(t,i,r,n,s){var o=Qy(t,i,s);return o?o.attr.getOptional("x"):0}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"y",function(t,i,r,n,s){var o=Qy(t,i,s);return o?o.attr.getOptional("y"):0}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"width",function(t,i,r,n,s){var o=qy(t,i,s);return o?o.attr.getOptional("cx"):0}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"height",function(t,i,r,n,s){var o=qy(t,i,s);return o?o.attr.getOptional("cy"):0}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipV",function(t,i){var r=fo(t,i,"slide");return r===void 0?"false":r.attr.getOptional("flipV")?r.attr.getOptional("flipV"):"false"}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipH",function(t,i){var r=fo(t,i,"slide");return r===void 0?"false":r.attr.getOptional("flipH")?r.attr.getOptional("flipH"):"false"}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"hidden",function(t){var i=t.childElementOptional(new G("p:nvGraphicFramePr","p:nvSpPr","p:nvCxnSpPr","p:nvPicPr"),"p:cNvPr");return i?i.attr.get("hidden","false"):"false"}),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp"],"rot",function(t,i){var r=fo(t,i,"slide");return r?r.attr.getOptional("rot"):0})}function Qy(e,t,i){var _Mr7=Mr(e,t,i),r=_Mr7.allShape;var _iterator219=_createForOfIteratorHelper(r),_step219;try{for(_iterator219.s();!(_step219=_iterator219.n()).done;){var s=_step219.value;var o=s.childElementOptional("p:spPr","a:xfrm","a:off");if(o!==void 0||(o=s.childElementOptional("p:xfrm","a:off"),o!==void 0))return o}}catch(err){_iterator219.e(err)}finally{_iterator219.f()}var n=fo(e,t,i);return n&&n.childElementOptional("a:off")}function qy(e,t,i){var _Mr8=Mr(e,t,i),r=_Mr8.allShape;var _iterator220=_createForOfIteratorHelper(r),_step220;try{for(_iterator220.s();!(_step220=_iterator220.n()).done;){var s=_step220.value;var o=s.childElementOptional("p:spPr","a:xfrm","a:ext");if(o!==void 0||(o=s.childElementOptional("p:xfrm","a:ext"),o!==void 0))return o}}catch(err){_iterator220.e(err)}finally{_iterator220.f()}var n=fo(e,t,i);return n&&n.childElementOptional("a:ext")}function fo(e,t,i){var r;if(i!=="slide")return;var n=e.childElementOptional("p:spPr","a:xfrm");if(n)return n;var s=(r=e.childElementOptional("p:nvPicPr","p:nvPr","p:ph"))==null?void 0:r.attr.getStringOptional("idx");if(!s)return;var o=t.layoutIndex.idxIndex[s];if(o)return o.childElementOptional("p:spPr","a:xfrm");var a=t.masterIndex.idxIndex[s];if(a)return a.childElementOptional("p:spPr","a:xfrm")}var Hd=["\u65E0\u6837\u5F0F\uFF0C\u65E0\u7F51\u683C","styleName","wholeTbl","tcTxStyle","fontRef","minor","idx","scrgbClr","0","r","g","b","schemeClr","tx1","val","\u65E0\u6837\u5F0F\uFF0C\u7F51\u683C\u578B","tcStyle","tcBdr","left","ln","12700","w","sng","cmpd","solidFill","right","top","bottom","insideH","insideV","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 1","tblBg","fillRef","2","accent1","effectRef","1","dk1","lnRef","band1H","fill","alpha","40000","band1V","lastCol","on","firstCol","lastRow","firstRow","lt1","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 2","accent2","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 3","accent3","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 4","accent4","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 5","accent5","\u4E3B\u9898\u6837\u5F0F 1 - \u5F3A\u8C03 6","accent6","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 1","3","tint","50000","20000","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 2","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 3","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 4","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 5","\u4E3B\u9898\u6837\u5F0F 2 - \u5F3A\u8C03 6","\u6D45\u8272\u6837\u5F0F 1","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 1","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 2","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 3","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 4","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 5","\u6D45\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 6","\u6D45\u8272\u6837\u5F0F 2","band2V","50800","dbl","bg1","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 1","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 2","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 3","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 4","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 5","\u6D45\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 6","\u6D45\u8272\u6837\u5F0F 3","25400","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 1","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 2","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 3","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 4","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 5","\u6D45\u8272\u6837\u5F0F 3 - \u5F3A\u8C03 6","\u4E2D\u5EA6\u6837\u5F0F 1","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 1","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 2","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 3","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 4","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 5","\u4E2D\u5EA6\u6837\u5F0F 1 - \u5F3A\u8C03 6","\u4E2D\u5EA6\u6837\u5F0F 2","prstClr","black","38100","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 1","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 2","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 3","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 4","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 5","\u4E2D\u5EA6\u6837\u5F0F 2 - \u5F3A\u8C03 6","\u4E2D\u5EA6\u6837\u5F0F 3","seCell","swCell","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 1","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 2","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 3","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 4","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 5","\u4E2D\u5EA6\u6837\u5F0F 3 - \u5F3A\u8C03 6","\u4E2D\u5EA6\u6837\u5F0F 4","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 1","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 2","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 3","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 4","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 5","\u4E2D\u5EA6\u6837\u5F0F 4 - \u5F3A\u8C03 6","\u6DF1\u8272\u6837\u5F0F 1","60000","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 1","shade","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 2","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 3","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 4","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 5","\u6DF1\u8272\u6837\u5F0F 1 - \u5F3A\u8C03 6","\u6DF1\u8272\u6837\u5F0F 2","\u6DF1\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 1/\u5F3A\u8C03 2","\u6DF1\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 3/\u5F3A\u8C03 4","\u6DF1\u8272\u6837\u5F0F 2 - \u5F3A\u8C03 5/\u5F3A\u8C03 6"],l=[{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"12":{"14":13}},{"19":{"21":20,"23":22,"24":{"12":{"14":13}}}},{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"12":{"14":37}},{"38":{"6":36,"12":{"14":34}}},{"6":33,"12":{"14":34}},{"6":36,"12":{"14":34}},{"14":42},{"11":45},{"38":{"6":33,"12":{"14":34}}},{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},{"24":{"12":{"14":34}}},{"38":{"6":33,"12":{"14":49}}},{"38":{"6":36,"12":{"14":51}}},{"6":33,"12":{"14":51}},{"6":36,"12":{"14":51}},{"38":{"6":33,"12":{"14":51}}},{"24":{"12":{"14":51}}},{"38":{"6":36,"12":{"14":53}}},{"6":33,"12":{"14":53}},{"6":36,"12":{"14":53}},{"38":{"6":33,"12":{"14":53}}},{"24":{"12":{"14":53}}},{"38":{"6":36,"12":{"14":55}}},{"6":33,"12":{"14":55}},{"6":36,"12":{"14":55}},{"38":{"6":33,"12":{"14":55}}},{"24":{"12":{"14":55}}},{"38":{"6":36,"12":{"14":57}}},{"6":33,"12":{"14":57}},{"6":36,"12":{"14":57}},{"38":{"6":33,"12":{"14":57}}},{"24":{"12":{"14":57}}},{"38":{"6":36,"12":{"14":59}}},{"6":33,"12":{"14":59}},{"6":36,"12":{"14":59}},{"38":{"6":33,"12":{"14":59}}},{"24":{"12":{"14":59}}},{"16":{"40":{"24":{"12":{"14":49,"41":{"14":64}}}}}},{"3":{"11":45},"16":{"17":{"18":{"38":{"6":33,"12":{"14":49}}}}}},{"3":{"11":45},"16":{"17":{"25":{"38":{"6":33,"12":{"14":49}}}}}},{"3":{"11":45},"16":{"17":{"26":{"38":{"6":33,"12":{"14":49}}}}}},{"3":{"11":45},"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}},{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"12":{"14":49}},{"38":{"6":36,"12":{"14":34,"62":{"14":63}}}},{"14":34},{"38":{"6":36,"12":{"14":51,"62":{"14":63}}}},{"14":51},{"38":{"6":36,"12":{"14":53,"62":{"14":63}}}},{"14":53},{"38":{"6":36,"12":{"14":55,"62":{"14":63}}}},{"14":55},{"38":{"6":36,"12":{"14":57,"62":{"14":63}}}},{"14":57},{"38":{"6":36,"12":{"14":59,"62":{"14":63}}}},{"14":59},{"16":{"40":{"24":{"12":{"14":13,"41":{"14":64}}}}}},{"3":{"11":45}},{"16":{"40":{"24":{"12":{"14":34,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":34}}}},{"16":{"40":{"24":{"12":{"14":51,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":51}}}},{"16":{"40":{"24":{"12":{"14":53,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":53}}}},{"16":{"40":{"24":{"12":{"14":55,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":55}}}},{"16":{"40":{"24":{"12":{"14":57,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":57}}}},{"16":{"40":{"24":{"12":{"14":59,"41":{"14":64}}}}}},{"19":{"21":20,"23":22,"24":{"12":{"14":59}}}},{"38":{"6":36,"12":{"14":13}}},{"12":{"14":13}},{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":81}},{"6":36,"12":{"14":13}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":34}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":51}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":53}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":55}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":57}}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":59}}}}},{"12":{"14":34}},{"12":{"14":51}},{"12":{"14":53}},{"12":{"14":55}},{"12":{"14":57}},{"12":{"14":59}},{"16":{"40":{"24":{"12":{"14":37,"62":{"14":64}}}}}},{"3":{"11":45},"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":37}}}}},"40":{"24":{"12":{"14":49}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":37}}}}},{"24":{"12":{"14":49}}},{"19":{"21":20,"23":22,"24":{"12":{"14":37}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":34}}}}},{"40":{"24":{"12":{"14":34,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":51}}}}},{"40":{"24":{"12":{"14":51,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":53}}}}},{"40":{"24":{"12":{"14":53,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":55}}}}},{"40":{"24":{"12":{"14":55,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":57}}}}},{"40":{"24":{"12":{"14":57,"62":{"14":64}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":49}},"16":{"40":{"24":{"12":{"14":59}}}}},{"40":{"24":{"12":{"14":59,"62":{"14":64}}}}},{"16":{"40":{"24":{"12":{"14":37,"62":{"14":42}}}}}},{"4":{"6":5,"104":{"14":105}},"12":{"14":37}},{"18":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"25":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"26":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"27":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"28":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}},"29":{"19":{"21":20,"23":22,"24":{"12":{"14":49}}}}},{"24":{"12":{"14":37,"62":{"14":64}}}},{"4":{"6":5,"104":{"14":105}},"11":45,"12":{"14":49}},{"40":{"24":{"12":{"14":37}}}},{"26":{"19":{"21":106,"23":22,"24":{"12":{"14":49}}}}},{"24":{"12":{"14":37}}},{"27":{"19":{"21":106,"23":22,"24":{"12":{"14":49}}}}},{"16":{"40":{"24":{"12":{"14":34,"62":{"14":42}}}}}},{"24":{"12":{"14":34,"62":{"14":64}}}},{"40":{"24":{"12":{"14":34}}}},{"16":{"40":{"24":{"12":{"14":51,"62":{"14":42}}}}}},{"24":{"12":{"14":51,"62":{"14":64}}}},{"40":{"24":{"12":{"14":51}}}},{"16":{"40":{"24":{"12":{"14":53,"62":{"14":42}}}}}},{"24":{"12":{"14":53,"62":{"14":64}}}},{"40":{"24":{"12":{"14":53}}}},{"16":{"40":{"24":{"12":{"14":55,"62":{"14":42}}}}}},{"24":{"12":{"14":55,"62":{"14":64}}}},{"40":{"24":{"12":{"14":55}}}},{"16":{"40":{"24":{"12":{"14":57,"62":{"14":42}}}}}},{"24":{"12":{"14":57,"62":{"14":64}}}},{"40":{"24":{"12":{"14":57}}}},{"16":{"40":{"24":{"12":{"14":59,"62":{"14":42}}}}}},{"24":{"12":{"14":59,"62":{"14":64}}}},{"40":{"24":{"12":{"14":59}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"11":45,"12":{"14":37}}},{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}},"27":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}}},"40":{"24":{"12":{"14":49}}}},{"14":37},{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}}},{"3":{"4":{"6":5,"7":{"9":8,"10":8,"11":8}},"12":{"14":37}},"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}},"27":{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}}},"40":{"24":{"12":{"14":49}}}}},{"19":{"21":89,"23":22,"24":{"12":{"14":37}}}},{"40":{"24":{"12":{"14":37,"62":{"14":64}}}}},{"3":{"11":45},"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":{"24":{"12":{"14":37}}}}},{"18":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},{"24":{"12":{"14":37,"62":{"14":130}}}},{"25":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},{"26":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},{"24":{"12":{"14":34,"132":{"14":130}}}},{"24":{"12":{"14":51,"132":{"14":130}}}},{"24":{"12":{"14":53,"132":{"14":130}}}},{"24":{"12":{"14":55,"132":{"14":130}}}},{"24":{"12":{"14":57,"132":{"14":130}}}},{"24":{"12":{"14":59,"132":{"14":130}}}},{"26":{"19":{"21":79,"23":80,"24":{"12":{"14":37}}}}}],z2={"{2D5ABB26-0587-4C30-8999-92F81FD0307C}":{"1":0,"2":{"3":l[0]}},"{5940675A-B579-460E-94D1-54222C63F5DA}":{"1":15,"2":{"3":l[0],"16":{"17":{"18":l[1],"25":l[1],"26":l[1],"27":l[1],"28":l[1],"29":l[1]}}}},"{3C2FFA5D-87B4-456A-9821-1D502468CF0F}":{"1":30,"2":{"3":l[2],"16":{"17":{"18":l[3],"25":l[3],"26":l[3],"27":l[3],"28":l[3],"29":l[3]}}},"31":{"32":l[4],"35":l[5]},"39":{"16":{"40":{"24":{"12":{"14":34,"41":l[6]}}}}},"43":{"16":{"17":{"26":l[3],"27":l[3]},"40":{"24":{"12":{"14":34,"41":l[6]}}}}},"44":{"3":l[7],"16":{"17":{"18":{"38":l[4]},"25":l[3],"26":l[3],"27":l[3],"28":l[3]}}},"46":{"3":l[7],"16":{"17":{"18":l[3],"25":{"38":l[4]},"26":l[3],"27":l[3],"28":l[3]}}},"47":{"3":l[7],"16":{"17":{"18":l[3],"25":l[3],"26":{"38":l[4]},"27":{"38":l[4]}}}},"48":{"3":l[9],"16":{"17":{"18":l[3],"25":l[3],"26":l[3],"27":l[11]},"40":l[10]}}},"{284E427A-3D55-4303-BF80-6455036E1DE7}":{"1":50,"2":{"3":l[2],"16":{"17":{"18":l[12],"25":l[12],"26":l[12],"27":l[12],"28":l[12],"29":l[12]}}},"31":{"32":l[13],"35":l[14]},"39":{"16":{"40":{"24":{"12":{"14":51,"41":l[6]}}}}},"43":{"16":{"17":{"26":l[12],"27":l[12]},"40":{"24":{"12":{"14":51,"41":l[6]}}}}},"44":{"3":l[7],"16":{"17":{"18":{"38":l[13]},"25":l[12],"26":l[12],"27":l[12],"28":l[12]}}},"46":{"3":l[7],"16":{"17":{"18":l[12],"25":{"38":l[13]},"26":l[12],"27":l[12],"28":l[12]}}},"47":{"3":l[7],"16":{"17":{"18":l[12],"25":l[12],"26":{"38":l[13]},"27":{"38":l[13]}}}},"48":{"3":l[9],"16":{"17":{"18":l[12],"25":l[12],"26":l[12],"27":l[11]},"40":l[16]}}},"{69C7853C-536D-4A76-A0AE-DD22124D55A5}":{"1":52,"2":{"3":l[2],"16":{"17":{"18":l[17],"25":l[17],"26":l[17],"27":l[17],"28":l[17],"29":l[17]}}},"31":{"32":l[18],"35":l[19]},"39":{"16":{"40":{"24":{"12":{"14":53,"41":l[6]}}}}},"43":{"16":{"17":{"26":l[17],"27":l[17]},"40":{"24":{"12":{"14":53,"41":l[6]}}}}},"44":{"3":l[7],"16":{"17":{"18":{"38":l[18]},"25":l[17],"26":l[17],"27":l[17],"28":l[17]}}},"46":{"3":l[7],"16":{"17":{"18":l[17],"25":{"38":l[18]},"26":l[17],"27":l[17],"28":l[17]}}},"47":{"3":l[7],"16":{"17":{"18":l[17],"25":l[17],"26":{"38":l[18]},"27":{"38":l[18]}}}},"48":{"3":l[9],"16":{"17":{"18":l[17],"25":l[17],"26":l[17],"27":l[11]},"40":l[21]}}},"{775DCB02-9BB8-47FD-8907-85C794F793BA}":{"1":54,"2":{"3":l[2],"16":{"17":{"18":l[22],"25":l[22],"26":l[22],"27":l[22],"28":l[22],"29":l[22]}}},"31":{"32":l[23],"35":l[24]},"39":{"16":{"40":{"24":{"12":{"14":55,"41":l[6]}}}}},"43":{"16":{"17":{"26":l[22],"27":l[22]},"40":{"24":{"12":{"14":55,"41":l[6]}}}}},"44":{"3":l[7],"16":{"17":{"18":{"38":l[23]},"25":l[22],"26":l[22],"27":l[22],"28":l[22]}}},"46":{"3":l[7],"16":{"17":{"18":l[22],"25":{"38":l[23]},"26":l[22],"27":l[22],"28":l[22]}}},"47":{"3":l[7],"16":{"17":{"18":l[22],"25":l[22],"26":{"38":l[23]},"27":{"38":l[23]}}}},"48":{"3":l[9],"16":{"17":{"18":l[22],"25":l[22],"26":l[22],"27":l[11]},"40":l[26]}}},"{35758FB7-9AC5-4552-8A53-C91805E547FA}":{"1":56,"2":{"3":l[2],"16":{"17":{"18":l[27],"25":l[27],"26":l[27],"27":l[27],"28":l[27],"29":l[27]}}},"31":{"32":l[28],"35":l[29]},"39":{"16":{"40":{"24":{"12":{"14":57,"41":l[6]}}}}},"43":{"16":{"17":{"26":l[27],"27":l[27]},"40":{"24":{"12":{"14":57,"41":l[6]}}}}},"44":{"3":l[7],"16":{"17":{"18":{"38":l[28]},"25":l[27],"26":l[27],"27":l[27],"28":l[27]}}},"46":{"3":l[7],"16":{"17":{"18":l[27],"25":{"38":l[28]},"26":l[27],"27":l[27],"28":l[27]}}},"47":{"3":l[7],"16":{"17":{"18":l[27],"25":l[27],"26":{"38":l[28]},"27":{"38":l[28]}}}},"48":{"3":l[9],"16":{"17":{"18":l[27],"25":l[27],"26":l[27],"27":l[11]},"40":l[31]}}},"{08FB837D-C827-4EFA-A057-4D05807E0F7C}":{"1":58,"2":{"3":l[2],"16":{"17":{"18":l[32],"25":l[32],"26":l[32],"27":l[32],"28":l[32],"29":l[32]}}},"31":{"32":l[33],"35":l[34]},"39":{"16":{"40":{"24":{"12":{"14":59,"41":l[6]}}}}},"43":{"16":{"17":{"26":l[32],"27":l[32]},"40":{"24":{"12":{"14":59,"41":l[6]}}}}},"44":{"3":l[7],"16":{"17":{"18":{"38":l[33]},"25":l[32],"26":l[32],"27":l[32],"28":l[32]}}},"46":{"3":l[7],"16":{"17":{"18":l[32],"25":{"38":l[33]},"26":l[32],"27":l[32],"28":l[32]}}},"47":{"3":l[7],"16":{"17":{"18":l[32],"25":l[32],"26":{"38":l[33]},"27":{"38":l[33]}}}},"48":{"3":l[9],"16":{"17":{"18":l[32],"25":l[32],"26":l[32],"27":l[11]},"40":l[36]}}},"{D113A9D2-9D6B-4929-AA2D-F23B5EE8CBE7}":{"1":60,"2":{"3":l[42],"16":{"17":{"18":l[43],"25":l[43],"26":l[43],"27":l[43]}}},"31":{"32":{"6":61,"12":l[44]},"35":{"6":61,"12":l[44]}},"39":l[37],"43":l[37],"44":{"3":l[7],"16":{"17":{"18":l[11]}}},"46":{"3":l[7],"16":{"17":{"25":l[11]}}},"47":{"3":l[7],"16":{"17":{"26":l[11]}}},"48":{"3":l[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{18603FDC-E32A-4AB5-989C-0864C3EAD2B8}":{"1":65,"2":{"3":l[42],"16":{"17":{"18":l[45],"25":l[45],"26":l[45],"27":l[45]}}},"31":{"32":{"6":61,"12":l[46]},"35":{"6":61,"12":l[46]}},"39":l[37],"43":l[37],"44":{"3":l[7],"16":{"17":{"18":l[11]}}},"46":{"3":l[7],"16":{"17":{"25":l[11]}}},"47":{"3":l[7],"16":{"17":{"26":l[11]}}},"48":{"3":l[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{306799F8-075E-4A3A-A7F6-7FBC6576F1A4}":{"1":66,"2":{"3":l[42],"16":{"17":{"18":l[47],"25":l[47],"26":l[47],"27":l[47]}}},"31":{"32":{"6":61,"12":l[48]},"35":{"6":61,"12":l[48]}},"39":l[37],"43":l[37],"44":{"3":l[7],"16":{"17":{"18":l[11]}}},"46":{"3":l[7],"16":{"17":{"25":l[11]}}},"47":{"3":l[7],"16":{"17":{"26":l[11]}}},"48":{"3":l[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{E269D01E-BC32-4049-B463-5C60D7B0CCD2}":{"1":67,"2":{"3":l[42],"16":{"17":{"18":l[49],"25":l[49],"26":l[49],"27":l[49]}}},"31":{"32":{"6":61,"12":l[50]},"35":{"6":61,"12":l[50]}},"39":l[37],"43":l[37],"44":{"3":l[7],"16":{"17":{"18":l[11]}}},"46":{"3":l[7],"16":{"17":{"25":l[11]}}},"47":{"3":l[7],"16":{"17":{"26":l[11]}}},"48":{"3":l[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{327F97BB-C833-4FB7-BDE5-3F7075034690}":{"1":68,"2":{"3":l[42],"16":{"17":{"18":l[51],"25":l[51],"26":l[51],"27":l[51]}}},"31":{"32":{"6":61,"12":l[52]},"35":{"6":61,"12":l[52]}},"39":l[37],"43":l[37],"44":{"3":l[7],"16":{"17":{"18":l[11]}}},"46":{"3":l[7],"16":{"17":{"25":l[11]}}},"47":{"3":l[7],"16":{"17":{"26":l[11]}}},"48":{"3":l[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{638B1855-1B75-4FBE-930C-398BA8C253C6}":{"1":69,"2":{"3":l[42],"16":{"17":{"18":l[53],"25":l[53],"26":l[53],"27":l[53]}}},"31":{"32":{"6":61,"12":l[54]},"35":{"6":61,"12":l[54]}},"39":l[37],"43":l[37],"44":{"3":l[7],"16":{"17":{"18":l[11]}}},"46":{"3":l[7],"16":{"17":{"25":l[11]}}},"47":{"3":l[7],"16":{"17":{"26":l[11]}}},"48":{"3":l[7],"16":{"17":{"27":{"38":{"6":61,"12":{"14":49}}}}}}},"{9D7B26C5-4107-4FEC-AEDC-1716B250A1EF}":{"1":70,"2":{"3":l[0],"16":{"17":{"26":l[1],"27":l[1]}}},"39":l[55],"43":l[55],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":l[1]}}},"48":{"3":l[7],"16":{"17":{"27":l[1]}}}},"{3B4B98B0-60AC-42C2-AFA5-B58CD77FA1E5}":{"1":71,"2":{"3":l[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[44]}}}}}},"39":l[57],"43":l[57],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[44]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":l[44]}}}}}}},"{0E3FDE45-AF77-4B5C-9715-49D594BDF05E}":{"1":72,"2":{"3":l[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[46]}}}}}},"39":l[59],"43":l[59],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[46]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":l[46]}}}}}}},"{C083E6E3-FA7D-4D7B-A595-EF9225AFEA82}":{"1":73,"2":{"3":l[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[48]}}}}}},"39":l[61],"43":l[61],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[48]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":l[48]}}}}}}},"{D27102A9-8310-4765-A935-A1911B00CA55}":{"1":74,"2":{"3":l[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[50]}}}}}},"39":l[63],"43":l[63],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[50]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":l[50]}}}}}}},"{5FD0F851-EC5A-4D38-B0AD-8093EC10F338}":{"1":75,"2":{"3":l[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[52]}}}}}},"39":l[65],"43":l[65],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[52]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":l[52]}}}}}}},"{68D230F3-CF80-4859-8CE7-A43EE81993B5}":{"1":76,"2":{"3":l[0],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[54]}}}}}},"39":l[67],"43":l[67],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":20,"23":22,"24":{"12":l[54]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":20,"23":22,"24":{"12":l[54]}}}}}}},"{7E9639D4-E3E2-4D34-9284-5A2195B3D0D7}":{"1":77,"2":{"3":l[0],"16":{"17":{"18":l[69],"25":l[69],"26":l[69],"27":l[69]}}},"39":{"16":{"17":{"26":l[69],"27":l[69]}}},"43":{"16":{"17":{"18":l[69],"25":l[69]}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":l[70]}}}}},"48":{"3":l[71],"16":{"32":l[72]}},"78":{"16":{"17":{"18":l[69],"25":l[69]}}}},"{69012ECD-51FC-41F1-AA8D-1B2483CD663E}":{"1":82,"2":{"3":l[0],"16":{"17":{"18":l[3],"25":l[3],"26":l[3],"27":l[3]}}},"39":{"16":{"17":{"26":l[3],"27":l[3]}}},"43":{"16":{"17":{"18":l[3],"25":l[3]}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[44]}}}}}},"48":{"3":l[71],"16":{"32":l[5]}},"78":{"16":{"17":{"18":l[3],"25":l[3]}}}},"{72833802-FEF1-4C79-8D5D-14CF1EAF98D9}":{"1":83,"2":{"3":l[0],"16":{"17":{"18":l[12],"25":l[12],"26":l[12],"27":l[12]}}},"39":{"16":{"17":{"26":l[12],"27":l[12]}}},"43":{"16":{"17":{"18":l[12],"25":l[12]}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[46]}}}}}},"48":{"3":l[71],"16":{"32":l[14]}},"78":{"16":{"17":{"18":l[12],"25":l[12]}}}},"{F2DE63D5-997A-4646-A377-4702673A728D}":{"1":84,"2":{"3":l[0],"16":{"17":{"18":l[17],"25":l[17],"26":l[17],"27":l[17]}}},"39":{"16":{"17":{"26":l[17],"27":l[17]}}},"43":{"16":{"17":{"18":l[17],"25":l[17]}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[48]}}}}}},"48":{"3":l[71],"16":{"32":l[19]}},"78":{"16":{"17":{"18":l[17],"25":l[17]}}}},"{17292A2E-F333-43FB-9621-5CBBE7FDCDCB}":{"1":85,"2":{"3":l[0],"16":{"17":{"18":l[22],"25":l[22],"26":l[22],"27":l[22]}}},"39":{"16":{"17":{"26":l[22],"27":l[22]}}},"43":{"16":{"17":{"18":l[22],"25":l[22]}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[50]}}}}}},"48":{"3":l[71],"16":{"32":l[24]}},"78":{"16":{"17":{"18":l[22],"25":l[22]}}}},"{5A111915-BE36-4E01-A7E5-04B1672EAD32}":{"1":86,"2":{"3":l[0],"16":{"17":{"18":l[27],"25":l[27],"26":l[27],"27":l[27]}}},"39":{"16":{"17":{"26":l[27],"27":l[27]}}},"43":{"16":{"17":{"18":l[27],"25":l[27]}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[52]}}}}}},"48":{"3":l[71],"16":{"32":l[29]}},"78":{"16":{"17":{"18":l[27],"25":l[27]}}}},"{912C8C85-51F0-491E-9774-3900AFEF0FD7}":{"1":87,"2":{"3":l[0],"16":{"17":{"18":l[32],"25":l[32],"26":l[32],"27":l[32]}}},"39":{"16":{"17":{"26":l[32],"27":l[32]}}},"43":{"16":{"17":{"18":l[32],"25":l[32]}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[54]}}}}}},"48":{"3":l[71],"16":{"32":l[34]}},"78":{"16":{"17":{"18":l[32],"25":l[32]}}}},"{616DA210-FB5B-4158-B5E0-FEB733F419BA}":{"1":88,"2":{"3":l[0],"16":{"17":{"18":l[1],"25":l[1],"26":l[1],"27":l[1],"28":l[1],"29":l[1]}}},"39":l[55],"43":l[55],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":l[70]}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":l[70]}}}}}},"{BC89EF96-8CEA-46FF-86C4-4CE0E7609802}":{"1":90,"2":{"3":l[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[44]}}}}}},"39":l[57],"43":l[57],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[44]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[44]}}}}}}},"{5DA37D80-6434-44D0-A028-1B22A696006F}":{"1":91,"2":{"3":l[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[46]}}}}}},"39":l[59],"43":l[59],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[46]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[46]}}}}}}},"{8799B23B-EC83-4686-B30A-512413B5E67A}":{"1":92,"2":{"3":l[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[48]}}}}}},"39":l[61],"43":l[61],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[48]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[48]}}}}}}},"{ED083AE6-46FA-4A59-8FB0-9F97EB10719F}":{"1":93,"2":{"3":l[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[50]}}}}}},"39":l[63],"43":l[63],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[50]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[50]}}}}}}},"{BDBED569-4797-4DF1-A0F4-6AAB3CD982D8}":{"1":94,"2":{"3":l[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[52]}}}}}},"39":l[65],"43":l[65],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[52]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[52]}}}}}}},"{E8B1032C-EA38-4F05-BA0D-38AFFFC7BED3}":{"1":95,"2":{"3":l[0],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[54]}}}}}},"39":l[67],"43":l[67],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[54]}}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[54]}}}}}}},"{793D81CF-94F2-401A-BA57-92F5A7B2D0C5}":{"1":96,"2":{"3":l[2],"16":{"17":{"18":l[89],"25":l[89],"26":l[89],"27":l[89],"28":l[89]},"40":l[88]}},"39":l[85],"43":l[85],"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[88]}},"48":{"3":l[9],"16":l[107]}},"{B301B821-A1FF-4177-AEE7-76D212191A09}":{"1":97,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[44]}}}},"40":l[88]}},"39":{"16":l[91]},"43":{"16":l[91]},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[44]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"40":l[10]}}},"{9DCAF9ED-07DC-4A11-8D7F-57B35C25682E}":{"1":98,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[46]}}}},"40":l[88]}},"39":{"16":l[93]},"43":{"16":l[93]},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[46]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"40":l[16]}}},"{1FECB4D8-DB02-4DC6-A0A2-4F2EBAE1DC90}":{"1":99,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[48]}}}},"40":l[88]}},"39":{"16":l[95]},"43":{"16":l[95]},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[48]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"40":l[21]}}},"{1E171933-4619-4E11-9A3F-F7608DF75F80}":{"1":100,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[50]}}}},"40":l[88]}},"39":{"16":l[97]},"43":{"16":l[97]},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[50]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"40":l[26]}}},"{FABFCF23-3B69-468F-B69F-88F6DE6A72F2}":{"1":101,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[52]}}}},"40":l[88]}},"39":{"16":l[99]},"43":{"16":l[99]},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[52]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"40":l[31]}}},"{10A1B5D5-9B99-4C35-A422-299274C87663}":{"1":102,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[54]}}}},"40":l[88]}},"39":{"16":l[101]},"43":{"16":l[101]},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[54]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"40":l[36]}}},"{073A0DAA-6AF3-43AB-8588-CEC1D06C72B9}":{"1":103,"2":{"3":l[103],"16":{"17":l[104],"40":l[105]}},"39":{"16":{"40":{"24":{"12":{"14":37,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":37,"62":l[6]}}}}},"44":{"3":l[106],"16":l[107]},"46":{"3":l[106],"16":l[107]},"47":{"3":l[106],"16":{"17":l[108],"40":l[109]}},"48":{"3":l[106],"16":{"17":l[110],"40":l[109]}}},"{5C22544A-7EE6-4342-B048-85BDC9FD1C3A}":{"1":107,"2":{"3":l[103],"16":{"17":l[104],"40":l[112]}},"39":{"16":{"40":{"24":{"12":{"14":34,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":34,"62":l[6]}}}}},"44":{"3":l[106],"16":{"40":l[10]}},"46":{"3":l[106],"16":{"40":l[10]}},"47":{"3":l[106],"16":{"17":l[108],"40":l[10]}},"48":{"3":l[106],"16":{"17":l[110],"40":l[10]}}},"{21E4AEA4-8DFA-4A89-87EB-49C32662AFE0}":{"1":108,"2":{"3":l[103],"16":{"17":l[104],"40":l[115]}},"39":{"16":{"40":{"24":{"12":{"14":51,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":51,"62":l[6]}}}}},"44":{"3":l[106],"16":{"40":l[16]}},"46":{"3":l[106],"16":{"40":l[16]}},"47":{"3":l[106],"16":{"17":l[108],"40":l[16]}},"48":{"3":l[106],"16":{"17":l[110],"40":l[16]}}},"{F5AB1C69-6EDB-4FF4-983F-18BD219EF322}":{"1":109,"2":{"3":l[103],"16":{"17":l[104],"40":l[118]}},"39":{"16":{"40":{"24":{"12":{"14":53,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":53,"62":l[6]}}}}},"44":{"3":l[106],"16":{"40":l[21]}},"46":{"3":l[106],"16":{"40":l[21]}},"47":{"3":l[106],"16":{"17":l[108],"40":l[21]}},"48":{"3":l[106],"16":{"17":l[110],"40":l[21]}}},"{00A15C55-8517-42AA-B614-E9B94910E393}":{"1":110,"2":{"3":l[103],"16":{"17":l[104],"40":l[121]}},"39":{"16":{"40":{"24":{"12":{"14":55,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":55,"62":l[6]}}}}},"44":{"3":l[106],"16":{"40":l[26]}},"46":{"3":l[106],"16":{"40":l[26]}},"47":{"3":l[106],"16":{"17":l[108],"40":l[26]}},"48":{"3":l[106],"16":{"17":l[110],"40":l[26]}}},"{7DF18680-E054-41AD-8BC1-D1AEF772440D}":{"1":111,"2":{"3":l[103],"16":{"17":l[104],"40":l[124]}},"39":{"16":{"40":{"24":{"12":{"14":57,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":57,"62":l[6]}}}}},"44":{"3":l[106],"16":{"40":l[31]}},"46":{"3":l[106],"16":{"40":l[31]}},"47":{"3":l[106],"16":{"17":l[108],"40":l[31]}},"48":{"3":l[106],"16":{"17":l[110],"40":l[31]}}},"{93296810-A885-4BE3-A3E7-6D5BEEA58F35}":{"1":112,"2":{"3":l[103],"16":{"17":l[104],"40":l[127]}},"39":{"16":{"40":{"24":{"12":{"14":59,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":59,"62":l[6]}}}}},"44":{"3":l[106],"16":{"40":l[36]}},"46":{"3":l[106],"16":{"40":l[36]}},"47":{"3":l[106],"16":{"17":l[108],"40":l[36]}},"48":{"3":l[106],"16":{"17":l[110],"40":l[36]}}},"{8EC20E35-A176-4012-BC5E-935CFFF8708E}":{"1":113,"2":{"3":{"4":{"6":5},"12":l[131]},"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[88]}},"39":l[85],"43":l[85],"44":{"3":l[9],"16":l[107]},"46":{"3":l[9],"16":l[107]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[109]}},"114":l[129],"115":l[129]},"{6E25E649-3F16-4E02-A733-19D2CDBF48F0}":{"1":116,"2":{"3":l[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[88]}},"39":l[85],"43":l[85],"44":{"3":l[9],"16":{"40":l[10]}},"46":{"3":l[9],"16":{"40":l[10]}},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[10]}},"114":l[129],"115":l[129]},"{85BE263C-DBD7-4A20-BB59-AAB30ACAA65A}":{"1":117,"2":{"3":l[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[88]}},"39":l[85],"43":l[85],"44":{"3":l[9],"16":{"40":l[16]}},"46":{"3":l[9],"16":{"40":l[16]}},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[16]}},"114":l[129],"115":l[129]},"{EB344D84-9AFB-497E-A393-DC336BA19D2E}":{"1":118,"2":{"3":l[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[88]}},"39":l[85],"43":l[85],"44":{"3":l[9],"16":{"40":l[21]}},"46":{"3":l[9],"16":{"40":l[21]}},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[21]}},"114":l[129],"115":l[129]},"{EB9631B5-78F2-41C9-869B-9F39066F8104}":{"1":119,"2":{"3":l[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[88]}},"39":l[85],"43":l[85],"44":{"3":l[9],"16":{"40":l[26]}},"46":{"3":l[9],"16":{"40":l[26]}},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[26]}},"114":l[129],"115":l[129]},"{74C1A8A3-306A-4EB7-A6B1-4F7E0EB9C5D6}":{"1":120,"2":{"3":l[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[88]}},"39":l[85],"43":l[85],"44":{"3":l[9],"16":{"40":l[31]}},"46":{"3":l[9],"16":{"40":l[31]}},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[31]}},"114":l[129],"115":l[129]},"{2A488322-F2BA-4B5B-9748-0D474271808F}":{"1":121,"2":{"3":l[2],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[131]}}},"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[88]}},"39":l[85],"43":l[85],"44":{"3":l[9],"16":{"40":l[36]}},"46":{"3":l[9],"16":{"40":l[36]}},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[88]}},"48":{"3":l[9],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[36]}},"114":l[129],"115":l[129]},"{D7AC3CCA-C797-4891-BE02-D94E43425B78}":{"1":122,"2":{"3":l[2],"16":{"17":{"18":l[89],"25":l[89],"26":l[89],"27":l[89],"28":l[89],"29":l[89]},"40":l[105]}},"39":{"16":{"40":{"24":{"12":{"14":37,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":37,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[131]}}}},"40":l[105]}},"48":{"3":l[7],"16":{"40":l[105]}}},"{69CF1AB2-1976-4502-BF36-3FF5EA218861}":{"1":123,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[44]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[44]}}}},"40":l[112]}},"39":{"16":{"40":{"24":{"12":{"14":34,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":34,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[44]}}}},"40":l[112]}},"48":{"3":l[7],"16":l[91]}},"{8A107856-5554-42FB-B03E-39F5DBC370BA}":{"1":124,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[46]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[46]}}}},"40":l[115]}},"39":{"16":{"40":{"24":{"12":{"14":51,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":51,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[46]}}}},"40":l[115]}},"48":{"3":l[7],"16":l[93]}},"{0505E3EF-67EA-436B-97B2-0124C06EBD24}":{"1":125,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[48]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[48]}}}},"40":l[118]}},"39":{"16":{"40":{"24":{"12":{"14":53,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":53,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[48]}}}},"40":l[118]}},"48":{"3":l[7],"16":l[95]}},"{C4B1156A-380E-4F78-BDF5-A606A8083BF9}":{"1":126,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[50]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[50]}}}},"40":l[121]}},"39":{"16":{"40":{"24":{"12":{"14":55,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":55,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[50]}}}},"40":l[121]}},"48":{"3":l[7],"16":l[97]}},"{22838BEF-8BB2-4498-84A7-C5851F593DF1}":{"1":127,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[52]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[52]}}}},"40":l[124]}},"39":{"16":{"40":{"24":{"12":{"14":57,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":57,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[52]}}}},"40":l[124]}},"48":{"3":l[7],"16":l[99]}},"{16D9F66E-5EB9-4882-86FB-DCBF35E3C3E4}":{"1":128,"2":{"3":l[2],"16":{"17":{"18":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"25":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"26":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"27":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"28":{"19":{"21":20,"23":22,"24":{"12":l[54]}}},"29":{"19":{"21":20,"23":22,"24":{"12":l[54]}}}},"40":l[127]}},"39":{"16":{"40":{"24":{"12":{"14":59,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":59,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":89,"23":22,"24":{"12":l[54]}}}},"40":l[127]}},"48":{"3":l[7],"16":l[101]}},"{E8034E78-7F5D-4C2E-B375-FC64B27BC917}":{"1":129,"2":{"3":l[42],"16":{"40":l[105]}},"39":{"16":{"40":{"24":{"12":{"14":37,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":37,"62":l[6]}}}}},"44":{"3":l[7],"16":{"17":l[137],"40":l[138]}},"46":{"3":l[7],"16":{"17":l[139],"40":l[138]}},"47":{"3":l[7],"16":{"17":l[140],"40":l[138]}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":l[109]}}},"{125E5076-3810-47DD-B79F-674D7AD40C01}":{"1":131,"2":{"3":l[42],"16":{"40":l[10]}},"39":{"16":{"40":l[141]}},"43":{"16":{"40":l[141]}},"44":{"3":l[7],"16":{"17":l[137],"40":l[141]}},"46":{"3":l[7],"16":{"17":l[139],"40":l[141]}},"47":{"3":l[7],"16":{"17":l[140],"40":{"24":{"12":{"14":34,"132":l[6]}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":l[109]}}},"{37CE84F3-28C3-443E-9E96-99CF82512B78}":{"1":133,"2":{"3":l[42],"16":{"40":l[16]}},"39":{"16":{"40":l[142]}},"43":{"16":{"40":l[142]}},"44":{"3":l[7],"16":{"17":l[137],"40":l[142]}},"46":{"3":l[7],"16":{"17":l[139],"40":l[142]}},"47":{"3":l[7],"16":{"17":l[140],"40":{"24":{"12":{"14":51,"132":l[6]}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":l[109]}}},"{D03447BB-5D67-496B-8E87-E561075AD55C}":{"1":134,"2":{"3":l[42],"16":{"40":l[21]}},"39":{"16":{"40":l[143]}},"43":{"16":{"40":l[143]}},"44":{"3":l[7],"16":{"17":l[137],"40":l[143]}},"46":{"3":l[7],"16":{"17":l[139],"40":l[143]}},"47":{"3":l[7],"16":{"17":l[140],"40":{"24":{"12":{"14":53,"132":l[6]}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":l[109]}}},"{E929F9F4-4A8F-4326-A1B4-22849713DDAB}":{"1":135,"2":{"3":l[42],"16":{"40":l[26]}},"39":{"16":{"40":l[144]}},"43":{"16":{"40":l[144]}},"44":{"3":l[7],"16":{"17":l[137],"40":l[144]}},"46":{"3":l[7],"16":{"17":l[139],"40":l[144]}},"47":{"3":l[7],"16":{"17":l[140],"40":{"24":{"12":{"14":55,"132":l[6]}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":l[109]}}},"{8FD4443E-F989-4FC4-A0C8-D5A2AF1F390B}":{"1":136,"2":{"3":l[42],"16":{"40":l[31]}},"39":{"16":{"40":l[145]}},"43":{"16":{"40":l[145]}},"44":{"3":l[7],"16":{"17":l[137],"40":l[145]}},"46":{"3":l[7],"16":{"17":l[139],"40":l[145]}},"47":{"3":l[7],"16":{"17":l[140],"40":{"24":{"12":{"14":57,"132":l[6]}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":l[109]}}},"{AF606853-7671-496A-8E4F-DF71F8EC918B}":{"1":137,"2":{"3":l[42],"16":{"40":l[36]}},"39":{"16":{"40":l[146]}},"43":{"16":{"40":l[146]}},"44":{"3":l[7],"16":{"17":l[137],"40":l[146]}},"46":{"3":l[7],"16":{"17":l[139],"40":l[146]}},"47":{"3":l[7],"16":{"17":l[140],"40":{"24":{"12":{"14":59,"132":l[6]}}}}},"48":{"3":l[7],"16":{"17":{"27":{"19":{"21":89,"23":22,"24":{"12":{"14":49}}}}},"40":l[109]}}},"{5202B0CA-FC54-4496-8BCA-5EF66A818D29}":{"1":138,"2":{"3":l[2],"16":{"40":l[105]}},"39":{"16":{"40":{"24":{"12":{"14":37,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":37,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[105]}},"48":{"3":l[9],"16":l[107]}},"{0660B408-B3CF-4A94-85FC-2B1E0A45F4A2}":{"1":139,"2":{"3":l[2],"16":l[91]},"39":{"16":{"40":{"24":{"12":{"14":34,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":34,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[112]}},"48":{"3":l[9],"16":{"40":l[16]}}},"{91EBBBCC-DAD2-459C-BE2E-F6DE35CF9A28}":{"1":140,"2":{"3":l[2],"16":l[95]},"39":{"16":{"40":{"24":{"12":{"14":53,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":53,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[118]}},"48":{"3":l[9],"16":{"40":l[26]}}},"{46F890A9-2807-4EBB-B81D-B2AA78EC7F39}":{"1":141,"2":{"3":l[2],"16":l[99]},"39":{"16":{"40":{"24":{"12":{"14":57,"62":l[6]}}}}},"43":{"16":{"40":{"24":{"12":{"14":57,"62":l[6]}}}}},"44":{"3":l[7]},"46":{"3":l[7]},"47":{"3":l[7],"16":{"17":{"26":{"19":{"21":79,"23":80,"24":{"12":l[131]}}}},"40":l[124]}},"48":{"3":l[9],"16":{"40":l[36]}}}};function Zy(e){var t={};return Object.keys(e).forEach(function(i){_typeof(e[i])=="object"?t[Hd[Number(i)]]=Zy(e[i]):t[Hd[Number(i)]]=Hd[e[i]]}),t}function U2(e){var t=z2[e];return t?Zy(t):void 0}function V2(e){e.bindAttributePicker("a:tcPr","*",W2)}var W2=function W2(e,t,i,r,n){var s=_2(e,t,i,r,n),o=i.split("-"),a=parseInt(o[0],10),c=parseInt(o[1],10),h=o[2],d=e.parentElement("a:tbl").childElementOptional("a:tblPr"),u=H2(e,t,h,d);if(u!==void 0&&u!==Yi)return u;var p=s.tableStyle,f=s.bandRow,m=s.bandCol;if(p){var g=p.band1H,y=p.band2H,b=p.band1V,S=p.band2V,w=p.firstRow,P=p.firstCol,A=p.wholeTbl,E=(a+1)%2==1,R=(c+1)%2==1;return w&&a===0?ll(w,t,h,A,p):P&&a===0?ll(P,t,h,A,p):f?ll(w?E?y:g:E?g:y,t,h,A,p):m?ll(P?R?S:b:R?b:S,t,h,A,p):cl(A,t,h,p)}};function ll(e,t,i,r,n){if(e){var s=cl(e,t,i,n);return s===void 0?cl(r,t,i,n):s}else return cl(r,t,i,n)}function cl(e,t,i,r){var n,s,o,a,c,h,d,u,p,f,m,g;switch(i){case"isBold":{var y=e&&(e==null?void 0:e.tcTxStyle);return y?(n=y.b)!=null?n:"off":"false"}case"isItalic":{var _y3=e&&(e==null?void 0:e.tcTxStyle);return _y3?(s=_y3.i)!=null?s:"off":"false"}case"fillColor":{var _y4=e&&((c=(a=(o=e.tcStyle)==null?void 0:o.fill)==null?void 0:a.solidFill)==null?void 0:c.schemeClr);if(_y4)return Cd(_y4,t);if(_y4=(d=(h=r.tblBg)==null?void 0:h.fillRef)==null?void 0:d.schemeClr,_y4){var b=Number((p=(u=r.tblBg)==null?void 0:u.fillRef)==null?void 0:p.idx),S=t.theme.childElementOptional("a:theme","a:themeElements","a:fmtScheme","a:fillStyleLst");if(b&&S)return new ho(S==null?void 0:S.elements[b],t,void 0,_y4.val)}return}case"fontFamily":{var _y5=e&&((f=e.tcTxStyle)==null?void 0:f.fontRef);return _y5?rx((m=_y5.idx)!=null?m:"none",t).join(","):void 0}case"fontColor":{var _y6=e&&((g=e.tcTxStyle)==null?void 0:g.schemeClr);return _y6?Cd(_y6,t):void 0}case"bottomBorderWidth":return new Jt(e,"bottom").getBorderWidth();case"bottomBorderColor":return new Jt(e,"bottom").getBorderColor(t);case"bottomBorderStyle":return new Jt(e,"bottom").getBorderType();case"topBorderWidth":return new Jt(e,"top").getBorderWidth();case"topBorderColor":return new Jt(e,"top").getBorderColor(t);case"topBorderStyle":return new Jt(e,"top").getBorderType();case"leftBorderWidth":return new Jt(e,"left").getBorderWidth();case"leftBorderColor":return new Jt(e,"left").getBorderColor(t);case"leftBorderStyle":return new Jt(e,"left").getBorderType();case"rightBorderWidth":return new Jt(e,"right").getBorderWidth();case"rightBorderColor":return new Jt(e,"right").getBorderColor(t);case"rightBorderStyle":return new Jt(e,"right").getBorderType();default:return;}}function H2(e,t,i,r){switch(i){case"isBold":return;case"isItalic":return;case"fillColor":{var n=e.childElementOptional(_construct(G,es));return n?new xr().read(n,t):new xr().read(r,t)}case"fontFamily":return;case"fontColor":return;case"bottomBorderWidth":return new it(e,"a:lnB").getBorderWidth();case"bottomBorderColor":return new it(e,"a:lnB").getBorderColor(t);case"bottomBorderStyle":return new it(e,"a:lnB").getBorderType();case"bottomBorderStrokeDashArray":return new it(e,"a:lnB").getBorderStrokeDashArray();case"topBorderWidth":return new it(e,"a:lnT").getBorderWidth();case"topBorderColor":return new it(e,"a:lnT").getBorderColor(t);case"topBorderStyle":return new it(e,"a:lnT").getBorderType();case"topBorderStrokeDashArray":return new it(e,"a:lnT").getBorderStrokeDashArray();case"leftBorderWidth":return new it(e,"a:lnL").getBorderWidth();case"leftBorderColor":return new it(e,"a:lnL").getBorderColor(t);case"leftBorderStyle":return new it(e,"a:lnL").getBorderType();case"leftBorderStrokeDashArray":return new it(e,"a:lnL").getBorderStrokeDashArray();case"rightBorderWidth":return new it(e,"a:lnR").getBorderWidth();case"rightBorderColor":return new it(e,"a:lnR").getBorderColor(t);case"rightBorderStyle":return new it(e,"a:lnR").getBorderType();case"rightBorderStrokeDashArray":return new it(e,"a:lnR").getBorderStrokeDashArray();default:return;}}function _2(e,t,i,r,n){var s=r.tableStyleXML;return s||(s=r.tableStyleXML=Object.freeze($2(e,t))),s}function $2(e,t){var i=e.parentElement("a:tbl").childElementOptional("a:tblPr");if(i&&i.hasChildElementWithName("a:tableStyleId")){var _r142=i.childElement("a:tableStyleId").text,n=U2(_r142),s=i.attr.getBoolean("bandCol",!1),o=i.attr.getBoolean("bandRow",!1),a=i.attr.getBoolean("firstCol",!1),c=i.attr.getBoolean("firstRow",!1),h=i.attr.getBoolean("lastCol",!1),d=i.attr.getBoolean("lastRow",!1),u=i.attr.getBoolean("rtl",!1);return{tableStyle:n,bandCol:s,bandRow:o,firstCol:a,firstRow:c,lastCol:h,lastRow:d,rtl:u}}else return{tableStyle:void 0,bandCol:!1,bandRow:!1,firstCol:!1,firstRow:!1,lastCol:!1,lastRow:!1,rtl:!1}}var Jt=/*#__PURE__*/function(){function Jt(e,t){_classCallCheck(this,Jt);this.tcStyle=e,this.lnKey=t}_createClass(Jt,[{key:"getBorderColor",value:function getBorderColor(e){var t,i,r,n,s;var o=this.tcStyle&&((s=(n=(r=(i=(t=this.tcStyle.tcStyle)==null?void 0:t.tcBdr)==null?void 0:i[this.lnKey])==null?void 0:r.ln)==null?void 0:n.solidFill)==null?void 0:s.schemeClr);if(o)return Cd(o,e)}},{key:"getBorderWidth",value:function getBorderWidth(){var e,t,i;var r=this.tcStyle&&((i=(t=(e=this.tcStyle.tcStyle)==null?void 0:e.tcBdr)==null?void 0:t[this.lnKey])==null?void 0:i.ln);if(r)return Number(r.w)}},{key:"getBorderType",value:function getBorderType(){var e,t,i;var r=this.tcStyle&&((i=(t=(e=this.tcStyle.tcStyle)==null?void 0:e.tcBdr)==null?void 0:t[this.lnKey])==null?void 0:i.ln);if(r){var n=r.prstDash;if(n&&n.val)return n.val}return"solid"}}]);return Jt}(),it=/*#__PURE__*/function(){function it(e,t){_classCallCheck(this,it);this.tcPrXMl=e,this.lnKey=t}_createClass(it,[{key:"getBorderColor",value:function getBorderColor(e){var t=this.tcPrXMl.childElementOptional(this.lnKey);if(t)return new xr().read(t.childElement(_construct(G,es)),e)}},{key:"getBorderWidth",value:function getBorderWidth(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e)return e.attr.getNumber("w",0)}},{key:"getBorderType",value:function getBorderType(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e){var t=e.childElementOptional("a:prstDash");if(t&&t.attr.has("val")){var i=t.attr.getStringOptional("val");return i==="dot"||i==="sysDot"?"dotted":i==="dash"||i==="sysDash"?"dashed":"solid"}}}},{key:"getBorderStrokeDashArray",value:function getBorderStrokeDashArray(){var e=this.getBorderWidth(),t=this.getBorderType();if(!(e===void 0||t===void 0))switch(t){case"solid":return"0";case"dash":return"".concat(5*e);case"dashDot":return" ".concat(5*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"dot":return"".concat(e,",  ").concat(5*e);case"lgDash":return"".concat(2*e,", ").concat(e);case"lgDashDot":return"".concat(10*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDash":return"".concat(5*e,", ").concat(2*e);case"sysDashDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e);case"sysDashDotDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDot":return"".concat(2*e,", ").concat(5*e);default:return"0";}}}]);return it}();function G2(e){e.bindChildPicker(["p:cSld"],"getBackgroundImageFill",K2),e.bindAttributePicker(["p:cSld"],"backgroundResId",X2),e.bindAttributePicker(["p:cSld"],"backgroundImageResourceType",Y2),e.bindAttributePicker(["p:cSld"],"backgroundColor",Q2)}var K2=function K2(e,t,i,r,n){var s=hl(e,t,i,r,n);if(s.bgXML&&s.bgXML.hasChildElementWithName("p:bgRef")){var o=s.bgXML.childElement("p:bgRef").attr.getNumber("idx");return t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1]}else return s.bgXML.childElementOptional("p:bgPr","a:blipFill")},X2=function X2(e,t,i,r,n){var s=hl(e,t,i,r,n);if(s.bgXML&&s.bgXML.hasChildElementWithName("p:bgRef")){var o=s.bgXML.childElement("p:bgRef").attr.getNumber("idx"),a=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];if(a.name==="a:blipFill")return Jy(a)}else{var _o31=s.bgXML.childElementOptional("p:bgPr","a:blipFill");return Jy(_o31)}};function Jy(e){if(e)return e.childElement("a:blip").attr.getStringOptional("r:embed")}var Y2=function Y2(e,t,i,r,n){var s=hl(e,t,i,r,n);return s.bgXML&&s.bgXML.hasChildElementWithName("p:bgRef")?"theme":s.resourceType},Q2=function Q2(e,t,i,r,n){var s=hl(e,t,i,r,n);if(s.bgXML&&s.bgXML.hasChildElementWithName("p:bgRef")){var o=s.bgXML.childElement("p:bgRef").attr.getNumber("idx"),a=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];return new xr(s.bgXML.childElement("p:bgRef").childElementOptional("a:schemeClr")).read(a,t)}else return new xr().read(s.bgXML.childElement("p:bgPr",_construct(G,es)),t)};function hl(e,t,i,r,n){var s=r.bgXML;return s||(s=r.bgXML=Object.freeze(q2(e,t))),s}function q2(e,t){return e.hasChildElementWithName("p:bg")?{bgXML:e.childElement("p:bg"),resourceType:"slide"}:t.layout.childElementOptional("p:sldLayout","p:cSld","p:bg")?{bgXML:t.layout.childElement("p:sldLayout","p:cSld","p:bg"),resourceType:"layout"}:{bgXML:t.master.childElement("p:sldMaster","p:cSld","p:bg"),resourceType:"master"}}var cs=new Ox;b2(cs);zx(cs);j2(cs);V2(cs);G2(cs);function Z2(){return cs.createPickers()}var _d=/*#__PURE__*/function(){function _d(e,t){_classCallCheck(this,_d);this.slideXML=e,this.context=t,this.animations=[]}_createClass(_d,[{key:"collect",value:function collect(){var e=this.slideXML.childElementOptional(new G("p:sld","p:sldMaster","p:sldLayout"),"p:timing","p:tnLst","p:par","p:cTn","p:childTnLst");if(e){var t=e.elementsWithName("p:seq");for(var i=0;i<t.length;++i){var _r143=t[i],n=_r143.childElement("p:cTn").attr.getString("nodeType","afterEffect");this.searchAndIndexParXMLs(_r143,n,[i],0,void 0)}}return this.animations}},{key:"searchAndIndexParXMLs",value:function searchAndIndexParXMLs(e,t,i,r,n){var s=e.childElementOptional("p:cTn","p:childTnLst"),o=s?s.elementsWithName("p:par"):[],a=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),c=n,h=0;if(a){h=a&&a.attr.getNumberOptional("delay")||0;var d=a.childElementOptional("p:tgtEl","p:spTgt");if(d&&(c=Tr(this.context.resourceType)+d.attr.getString("spid"),this.context.shapeParamsIndex[c].hidden))return}if(o.length===0)this.handleLeafParXML(e,t,i,r,c);else for(var _d12=0;_d12<o.length;++_d12){this.searchAndIndexParXMLs(o[_d12],t,[].concat(_toConsumableArray(i),[_d12]),r+h,c)}}},{key:"handleLeafParXML",value:function handleLeafParXML(e,t,i,r,n){var s,o,a;var c=e.childElementOptional("p:cTn","p:iterate"),h=(s=c==null?void 0:c.attr)==null?void 0:s.getStringOptional("type"),d,u,p=c==null?void 0:c.childElementOptional("p:tmPct");if(p&&(u=xe(p.attr.getString("val"))),u==null){var Ae=c==null?void 0:c.childElementOptional("p:tmAbs");Ae&&(d=Ae.attr.getNumberOptional("val"))}var f=function f(Ae){return d!=null?d:u!=null?u*Ae:0},m=e.childElementOptional("p:cTn","p:childTnLst"),g=m&&m.element.childElementOptional("p:cBhvr","p:tgtEl","p:spTgt"),y=g?Tr(this.context.resourceType)+g.attr.getString("spid"):"",b=g==null?void 0:g.childElementOptional("p:txEl","p:pRg"),S=(o=b==null?void 0:b.attr)==null?void 0:o.getNumberOptional("st"),w=(a=b==null?void 0:b.attr)==null?void 0:a.getNumberOptional("end"),P=!!(g==null?void 0:g.childElementOptional("p:bg")),A=S!=null&&w!=null?{start:S,end:w}:null;if(!this.context.shapeParamsIndex[y]||this.context.shapeParamsIndex[y].hidden)return;var E=e.childElement("p:cTn"),R=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),N=m?m.elements:[],_=Number.MIN_SAFE_INTEGER;N.forEach(function(Ae){var bt=0,_e=Ae.childElementOptional("p:cBhvr","p:cTn","p:stCondLst","p:cond");_e&&(bt=_e.attr.getNumberOptional("delay")||0);var lt=Ae.childElement("p:cBhvr","p:cTn").attr.getNumberOptional("dur");lt===void 0&&(lt=1),lt+bt>_&&(_=lt+bt)});var ie,ce=E.childElementOptional("p:endCondLst");ce!==void 0&&ce.childElement("p:cond").attr.getStringOptional("evt")==="onNext"&&(ie="onNext");var U=E.attr.get("repeatCount","none");U!=="indefinite"&&U!=="none"&&(U=U/1e3,U===0&&(U="none"));var He=E.attr.getStringOptional("presetClass");He||(He="entr");var ii=Object.freeze({eventSourceShapeId:n,spId:y,pRg:A,pBg:P,textAnimMode:h,textAnimIterateDelay:f,sequenceType:t,animationXML:m,sequenceIndex:i[1],parallelIndex:i[3],isLoop:E.attr.has("repeatCount"),id:E.attr.getStringOptional("id")||"",presetClass:He,presetID:E.attr.getStringOptional("presetID")||"",presetSubtype:E.attr.getStringOptional("presetSubtype"),repeatCount:U,repeatEndCondition:ie,nodeType:E.attr.getStringOptional("nodeType")||"afterEffect",delay:R&&R.attr.getNumberOptional("delay")||0,parentDelay:r,duration:_,autoRev:E.attr.getBoolean("autoRev",!1),soundEffectId:this.parseAnimeSoundEffect(e),dimAfter:this.parseDimAfter(e)});this.animations.push(ii)}},{key:"parseAnimeSoundEffect",value:function parseAnimeSoundEffect(e){var t=e.childElementOptional("p:cTn","p:subTnLst","p:audio");if(t!==void 0)return t.childElement("p:cMediaNode","p:tgtEl","p:sndTgt").attr.getString("r:embed")}},{key:"parseDimAfter",value:function parseDimAfter(e){var t,i;var r=e.childElementOptional("p:cTn","p:subTnLst","p:set","p:cBhvr");if(!r)return;var n=r.childElementOptional("p:attrNameLst","p:attrName");if(!!n&&!!String(n.text).includes("visibility"))return((i=(t=r.childElementOptional("p:cTn"))==null?void 0:t.attr)==null?void 0:i.getStringOptional("masterRel"))==="nextClick"?"next":"same"}}]);return _d}();function J2(e){if(!e)return Xh;var t=e.replace(/\s+/g,"").split(";").map(function(s){var _s$split=s.split(","),_s$split2=_slicedToArray(_s$split,2),o=_s$split2[0],a=_s$split2[1];return{input:parseFloat(o),output:parseFloat(a)}});t[t.length-1].input<1&&t.push({input:1,output:1});var i=t.length-1,r=0,n=0;return function(s){if(s>=r)for(var o=n;o<i;o++){var a=t[o],c=t[o+1];if(s>=a.input&&s<=c.input)return n=o,r=s,eb(s,a,c)}else for(var _o32=n;_o32>=0;_o32--){var _a28=t[_o32],_c12=t[_o32+1];if(s>=_a28.input&&s<=_c12.input)return n=_o32,r=s,eb(s,_a28,_c12)}return n=0,r=0,s}}function eb(e,_ref86,_ref87){var t=_ref86.input,i=_ref86.output;var r=_ref87.input,n=_ref87.output;return(e-t)/(r-t)*(n-i)+i}var Or=/*#__PURE__*/function(){function Or(e){_classCallCheck(this,Or);this.behaviorNode=e.childElement("p:cBhvr"),this.timingNode=this.behaviorNode.childElement("p:cTn")}_createClass(Or,[{key:"animeId",value:function animeId(){var e;return String((e=this.timingNode.attr.getNumberOptional("id"))!=null?e:Date.now())}},{key:"duration",value:function duration(){var e=this.timingNode.attr.getStringOptional("dur");return e?e==="indefinite"?1/0:parseInt(e,10):1}},{key:"delay",value:function delay(){var e=this.timingNode.childElementOptional("p:stCondLst","p:cond");return e?e.attr.getNumber("delay",0):0}},{key:"ease",value:function ease(){var e=J2(this.timingNode.attr.getStringOptional("tmFilter")),t=this.timingNode.attr.getStringOptional("spd");if(t){var i=xe(t);if(!Number.isNaN(i)&&i!==1&&i!==0)return i>0?function(r){return e(r/i)}:function(r){return 1-e(r/-i)}}return e}},{key:"reverse",value:function reverse(){return Boolean(this.timingNode.attr.getBooleanOptional("autoRev"))}},{key:"rewind",value:function rewind(){var e=this.timingNode.attr.getStringOptional("fill");return e==="transition"||e==="remove"}},{key:"repeat",value:function repeat(){var e=this.timingNode.attr.get("repeatCount","");if(!e)return 1;if(e==="indefinite")return 1/0;var t=Number(e)/1e3;return Number.isNaN(t)?1:t}},{key:"attrNames",value:function attrNames(){var e=this.behaviorNode.childElementOptional("p:attrNameLst"),t=[];if(e){var i=e.elementsWithName("p:attrName");var _iterator221=_createForOfIteratorHelper(i),_step221;try{for(_iterator221.s();!(_step221=_iterator221.n()).done;){var _r144=_step221.value;var n=this.mapAttrName(_r144.text);n&&t.push(n)}}catch(err){_iterator221.e(err)}finally{_iterator221.f()}}return t}},{key:"mapAttrName",value:function mapAttrName(e){if(typeof e!="string")return;var t=e.toLowerCase();switch(t){case"ppt_x":case"ppt_y":case"ppt_w":case"ppt_h":case"xshear":case"yshear":case"fillcolor":return t;case"scalex":return"scaleX";case"scaley":return"scaleY";case"style.rotation":case"r":return"rotate";case"style.visibility":return"visible";case"style.opacity":return"opacity";default:break;}}}]);return Or}();function eI(e){var t=tI(e.split(/,|\s/i)),i=[],r,n,s;var _iterator222=_createForOfIteratorHelper(t),_step222;try{for(_iterator222.s();!(_step222=_iterator222.n()).done;){var o=_step222.value;if(/^[a-zA-Z]$/.test(o)){if(s!==void 0)throw new Error("invalid path: lack of number");r!==void 0&&i.push({sign:r,points:n}),r=o,n=[]}else{var a=parseFloat(o);if(Number.isNaN(a))throw new Error("invalid path: unrecognized number ".concat(JSON.stringify(o)));s===void 0?s=a:(n.push({x:s,y:a}),s=void 0)}}}catch(err){_iterator222.e(err)}finally{_iterator222.f()}if(s!==void 0)throw new Error("invalid path: lack of number");return r!==void 0&&i.push({sign:r,points:n}),i}function tI(e){var t=[];var _iterator223=_createForOfIteratorHelper(e),_step223;try{for(_iterator223.s();!(_step223=_iterator223.n()).done;){var i=_step223.value;if(i!=="")if(i.length===1)t.push(i);else{var _r145=i[0];/[a-zA-Z]/.test(_r145)?(t.push(_r145),t.push(i.substring(1))):t.push(i)}}}catch(err){_iterator223.e(err)}finally{_iterator223.f()}return t}var tb=/*#__PURE__*/function(){function tb(){_classCallCheck(this,tb);for(var _len22=arguments.length,e=new Array(_len22),_key22=0;_key22<_len22;_key22++){e[_key22]=arguments[_key22]}if(e.length===0)throw new Error("expect 1 curve minimum");var t=[],i=0;for(var _i45=0,_e12=e;_i45<_e12.length;_i45++){var _r146=_e12[_i45];t.push(_r146.rectangle),i+=_r146.length}this.curves=Object.freeze(e),this.length=i,this.rectangle=tb.unionRectangles(t)}_createClass(tb,[{key:"get",value:function get(e){var t=0,i=0,r;var _iterator224=_createForOfIteratorHelper(this.curves),_step224;try{for(_iterator224.s();!(_step224=_iterator224.n()).done;){var n=_step224.value;if(r=n,i=t,e<t+n.length)break;t+=n.length}}catch(err){_iterator224.e(err)}finally{_iterator224.f()}return r.get(e-i)}}],[{key:"unionRectangles",value:function unionRectangles(e){var t=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;var _iterator225=_createForOfIteratorHelper(e),_step225;try{for(_iterator225.s();!(_step225=_iterator225.n()).done;){var s=_step225.value;s.left<t&&(t=s.left),s.right>i&&(i=s.right),s.top<r&&(r=s.top),s.bottom>n&&(n=s.bottom)}}catch(err){_iterator225.e(err)}finally{_iterator225.f()}return Object.freeze({left:t,right:i,top:r,bottom:n})}}]);return tb}(),ib=/*#__PURE__*/function(){function ib(e,t){_classCallCheck(this,ib);this.beginX=e.x,this.beginY=e.y,this.deltaX=t.x-e.x,this.deltaY=t.y-e.y,this.length=Math.sqrt(this.deltaX*this.deltaX+this.deltaY*this.deltaY),this.rectangle=Object.freeze({left:Math.min(e.x,t.x),right:Math.max(e.x,t.x),top:Math.min(e.y,t.y),bottom:Math.max(e.y,t.y)})}_createClass(ib,[{key:"get",value:function get(e){if(this.length===0)return{x:this.beginX,y:this.beginY};var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),{x:this.beginX+t*this.deltaX,y:this.beginY+t*this.deltaY}}}]);return ib}(),$d=/*#__PURE__*/function(){function $d(e,t,i,r){_classCallCheck(this,$d);this.bezier=new rb["default"]([e,t,i,r]),this.length=this.bezier.length(),this.rectangle=this.createRectangle()}_createClass($d,[{key:"createRectangle",value:function createRectangle(){var e=this.bezier.bbox();return Object.freeze({left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max})}},{key:"get",value:function get(e){var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),this.bezier.get(t)}}]);return $d}();function iI(e){var t=eI(e),i=[],r,n,s;var _iterator226=_createForOfIteratorHelper(t),_step226;try{for(_iterator226.s();!(_step226=_iterator226.n()).done;){var _step226$value=_step226.value,o=_step226$value.sign,a=_step226$value.points;switch(o){case"M":{hn(o,a,1),r=a[0],n=a[0],s=void 0;break}case"L":{hn(o,a,1),hs(n),i.push(new ib(n,a[0])),n=a[0],s=void 0;break}case"Z":{hn(o,a,0),hs(n),i.push(new ib(n,r)),n=r,s=void 0;break}case"C":{hn(o,a,3),hs(n),i.push(new $d(n,a[0],a[1],a[2])),s={controller:a[1],end:a[2]},n=a[2];break}case"S":{if(!s)throw new Error("invalid path: expect C or S before S");hn(o,a,2),hs(n);var c=nb(s);i.push(new $d(n,c,a[0],a[1])),s={controller:a[0],end:a[1]},n=a[1];break}case"Q":{hn(o,a,2),hs(n),i.push(new $d(n,a[0],a[1])),s={controller:a[0],end:a[1]},n=a[1];break}case"T":{if(!s)throw new Error("invalid path: expect Q or T before T");hn(o,a,1),hs(n);var _c13=nb(s);s={controller:_c13,end:a[0]},s={controller:_c13,end:a[0]},n=a[0];break}case"E":break;default:throw new Error("invalid path: unrecognized sign ".concat(JSON.stringify(o)));}}}catch(err){_iterator226.e(err)}finally{_iterator226.f()}return _construct(tb,i)}function nb(e){var t=e.controller,i=e.end,r=i.x-t.x,n=i.y-t.y;return{x:i.x+r,y:i.y+n}}function hn(e,t,i){if(t.length!==i)throw new Error("invalid path: sign ".concat(e," should have ").concat(i," points (").concat(2*i," number)"))}function hs(e){if(!e)throw new Error("invalid path: expect M")}var rI=function rI(_ref88){var e=_ref88.node,t=_ref88.animation,i=_ref88.animBox;var r=new Or(e),n=e.attr.getString("path","M 0 0"),s=iI(n),_i$initState=i.initState,o=_i$initState.ppt_x,a=_i$initState.ppt_y;return new Ge({animBox:i,effectType:t.nodeType,playerID:r.animeId(),eventSource:t.eventSourceShapeId,duration:r.duration(),ease:r.ease(),repeat:r.repeat(),delay:r.delay(),reverse:r.reverse(),rewind:r.rewind(),transform:function transform(c){var _s$get=s.get(c*s.length),h=_s$get.x,d=_s$get.y;return{ppt_x:(h||0)+o,ppt_y:(d||0)+a}}})},Gd=/*#__PURE__*/function(){function Gd(_ref89){var e=_ref89.context,t=_ref89.animBox;_classCallCheck(this,Gd);this.context=e,this.animBox=t}_createClass(Gd,[{key:"parse",value:function parse(e,t){var i=e==null?void 0:e.childElementOptional(new G("p:strVal","p:fltVal","p:clrVal","p:intVal"));if(i)switch(i.name){case"p:fltVal":case"p:intVal":{var _r147=parseFloat(i.attr.getString("val"));return Gt(_r147)?_r147:void 0}case"p:clrVal":{var _r148=sn(i.childElement(_construct(G,Pi)),this.context.slideContext);if(_r148){var _r148$rgb$object=_r148.rgb().object(),n=_r148$rgb$object.r,s=_r148$rgb$object.g,o=_r148$rgb$object.b;return new me({r:n,g:s,b:o,a:1})}return}default:return Gt(this.animBox.initState[t])?new kr(i.attr.getString("val"),this.formulaScope):t==="visible"?i.attr.getString("val")!=="hidden":i.attr.getString("val");}}},{key:"formulaScope",get:function get(){return this._formulaScope?this._formulaScope:this._formulaScope=new so(this.animBox)}}]);return Gd}(),nI=function nI(_ref90){var e=_ref90.node,t=_ref90.animation,i=_ref90.context,r=_ref90.animBox;var n=new Or(e),s=n.attrNames(),o={},a=new Gd({context:i,animBox:r});var _iterator227=_createForOfIteratorHelper(s),_step227;try{for(_iterator227.s();!(_step227=_iterator227.n()).done;){var c=_step227.value;switch(c){case"visible":{var h=a.parse(e.childElementOptional("p:to"),"visible");h!=null&&(o.visible=h,r.preAnimation()||r.preAnimation({visible:!h}));break}case"opacity":case"xshear":case"yshear":{var _h13=a.parse(e.childElementOptional("p:to"),c);_h13!=null&&(o[c]=_h13);break}default:break;}}}catch(err){_iterator227.e(err)}finally{_iterator227.f()}return new Ge({animBox:r,effectType:t.nodeType,playerID:n.animeId(),eventSource:t.eventSourceShapeId,duration:n.duration(),delay:n.delay(),transform:Ii(function(){var c={};for(var h in o){if(Mt(o,h))switch(h){case"visible":{c.visible=!o.visible;break}case"opacity":case"xshear":case"yshear":{c[h]=r.currentState[h];break}default:break;}}return c},o)})},sI=function sI(_ref91){var e=_ref91.animBox,t=_ref91.node,i=_ref91.animation;var r=t.attr.getStringOptional("transition");if(!r)return;var n=new Or(t),s=0,o=1;return r==="out"&&(s=1,o=0),new Ge({animBox:e,effectType:i.nodeType,playerID:n.animeId(),eventSource:i.eventSourceShapeId,duration:n.duration(),ease:n.ease(),repeat:n.repeat(),delay:n.delay(),reverse:n.reverse(),rewind:n.rewind(),by:!0,transform:ed({opacity:s},{opacity:o})})},oI=function oI(_ref92){var e=_ref92.node,t=_ref92.animation,i=_ref92.animBox,r=_ref92.context;var n=new Or(e);if(!n.attrNames().includes("fillcolor"))return;var s=!1,o;if(o=Kd(r.slideContext,e.childElementOptional("p:to")),o||(s=!0,o=Kd(r.slideContext,e.childElementOptional("p:by"))),!o)return;var a=o,c=Kd(r.slideContext,e.childElementOptional("p:from")),h;return new Ge({animBox:i,effectType:t.nodeType,playerID:n.animeId(),eventSource:t.eventSourceShapeId,duration:n.duration(),ease:n.ease(),repeat:n.repeat(),delay:n.delay(),reverse:n.reverse(),rewind:n.rewind(),by:s,transform:function transform(d){c||(c=i.currentState.fillcolor,h=c.alpha());var u=Zh(c,a,d);return{fillcolor:h>0?u.alpha(h):u}}})};function Kd(e,t){if(!t)return;var i=t.childElementOptional(new G("p:rgb","p:hsl"));if(i)switch(i.name){case"p:rgb":return new me({r:i.attr.getNumber("r"),g:i.attr.getNumber("g"),b:i.attr.getNumber("b"),a:1});case"p:hsl":return new me({h:i.attr.getNumber("h")/Et,s:i.attr.getNumber("s")/H*100,l:i.attr.getNumber("l")/H*100,a:1});}else{var _r149=t.childElement(_construct(G,Pi)),n=sn(_r149,e);if(n){var _n$rgb$object=n.rgb().object(),s=_n$rgb$object.r,o=_n$rgb$object.g,a=_n$rgb$object.b;return new me({r:s,g:o,b:a,a:1})}}}var aI=function aI(_ref93){var e=_ref93.node,t=_ref93.animation,i=_ref93.context,r=_ref93.animBox;var n=new Or(e),s=!1,o=Xd(e.attr.getStringOptional("to"));if(o==null&&(s=!0,o=Xd(e.attr.getStringOptional("by"))),o==null){var h=new Gd({context:i,animBox:r}).parse(e.childElementOptional("p:by"),"rotate");Gt(h)&&(o=Qn(Number(h)))}if(o==null)return;var a=o,c=Xd(e.attr.getStringOptional("from"));return new Ge({animBox:r,effectType:t.nodeType,playerID:n.animeId(),eventSource:t.eventSourceShapeId,duration:n.duration(),ease:n.ease(),repeat:n.repeat(),delay:n.delay(),reverse:n.reverse(),rewind:n.rewind(),by:s,transform:Ii(function(){var h;return{rotate:c!=null?c:s?0:(h=r.currentState.rotate)!=null?h:0}},{rotate:a})})};function Xd(e){var t=Number(e);if(!Number.isNaN(t))return Qn(t)}var lI=function lI(_ref94){var e=_ref94.node,t=_ref94.animation,i=_ref94.animBox;var r=new Or(e),n=!1,s=Yd(e.childElementOptional("p:to"));if(s==null&&(n=!0,s=Yd(e.childElementOptional("p:by"))),s==null)return;var o=s,a=Yd(e.childElementOptional("p:from"));return new Ge({animBox:i,effectType:t.nodeType,playerID:r.animeId(),eventSource:t.eventSourceShapeId,duration:r.duration(),ease:r.ease(),repeat:r.repeat(),delay:r.delay(),reverse:r.reverse(),rewind:r.rewind(),by:n,transform:Ii(function(){var c,h;return a!=null?a:n?{scaleX:1,scaleY:1}:{scaleX:(c=i.currentState.scaleX)!=null?c:1,scaleY:(h=i.currentState.scaleY)!=null?h:1}},o)})};function Yd(e){if(e)return{scaleX:xe(e.attr.getString("x")),scaleY:xe(e.attr.getString("y"))}}var cI=function cI(_ref95){var e=_ref95.node,t=_ref95.animation,i=_ref95.animBox;var r=new Or(e),n=hI(e.attr.getString("cmd"));return new oo({animBox:i,effectType:t.nodeType,playerID:r.animeId(),eventSource:t.eventSourceShapeId,duration:1,delay:r.delay(),reverse:r.reverse(),rewind:r.rewind(),cmd:n})};function hI(e){var t=/^playFrom\(([^)]+)\)$/.exec(e);return t?{name:"playFrom",value:parseFloat(t[1])}:e.includes("pause")?{name:"pause"}:{name:"stop"}}function dI(_ref96,r,n){var e=_ref96.node,t=_ref96.context,i=_ref96.animBox;function s(h){if(h){if(Gt(i.initState[n]))return new kr(h,a.formulaScope);console.error("Expr ".concat(h," cannot work with targetKey ").concat(n))}}var o=e.childElementOptional("p:tavLst");if(!o)return;var a=new Gd({context:t,animBox:i}),c=o.elementsWithName("p:tav").map(function(h){var d=a.parse(h.childElement("p:val"),n);if(d==null)return;var u=xe(h.attr.getString("tm")),p=s(h.attr.getStringOptional("fmla"));return{val:d,progress:u,fmla:p}}).filter(function(h){return Boolean(h)});if(!(c.length<=0))if(r==="lin"){if(Gt(c[0].val))return Qd(c,n,Sr);if(c[0].val instanceof me)return Qd(c,n,td)}else return Qd(c,n,uI)}function Qd(e,t,i){return function(r){for(var o=1;o<e.length;o++){var a=e[o-1],c=e[o];if(r>=a.progress&&r<=c.progress){var h=i(a.val,c.val,(r-a.progress)/(c.progress-a.progress));return _defineProperty({},t,a.fmla?a.fmla.evaluate(h):h)}}var _e13=e[e.length-1],n=_e13.fmla,s=_e13.val;return _defineProperty({},t,n?n.evaluate(s):s)}}function uI(e,t,i){return i<1?e:t}var pI=/*#__PURE__*/function(){function pI(e,t){_classCallCheck(this,pI);this.node=e,this.animBox=t}_createClass(pI,[{key:"parse",value:function parse(e,t){var i=this.node.attr.getStringOptional(e);if(!i)return;var r=this.animBox.initState[t];if(r instanceof me)try{return new me(i)}catch(n){return}if(Gt(r)){var n=Number(i);return Gt(n)?n:(e==="by"&&(t==="ppt_x"||t==="ppt_y")&&(i+="+#".concat(t)),new kr(i,this.formulaScope))}if(t==="visible")return i!=="hidden"}},{key:"formulaScope",get:function get(){return this._formulaScope?this._formulaScope:this._formulaScope=new so(this.animBox)}}]);return pI}(),mI=function mI(e){var t=e.node,i=e.animation,r=e.animBox,n=new Or(t),s=t.attr.getString("calcmode","lin"),o=n.attrNames()[0];if(!o){console.error("Missing attrName for p:anim",n.animeId());return}var a=new pI(t,r),c=!1,h=dI(e,s,o);if(!h){var d=a.parse("from",o),u=a.parse("to",o);if(u||(c=!0,u=a.parse("by",o)),!u)return;h=Ii(function(){return _defineProperty({},o,d!=null?d:r.currentState[o])},_defineProperty({},o,u))}return new Ge({animBox:r,effectType:i.nodeType,playerID:n.animeId(),eventSource:i.eventSourceShapeId,duration:n.duration(),ease:n.ease(),repeat:n.repeat(),delay:n.delay(),reverse:n.reverse(),rewind:n.rewind(),by:c,transform:h})},fI=function fI(e){switch(e.node.name){case"p:animMotion":return rI(e);case"p:set":return nI(e);case"p:animEffect":return sI(e);case"p:anim":return mI(e);case"p:animClr":return oI(e);case"p:animRot":return aI(e);case"p:animScale":return lI(e);case"p:cmd":return cI(e);default:console.error("failed parsing ".concat(e.node.name," animation node"));}};function gI(e,t){if(e.soundEffectId)return new oo({animBox:t,effectType:e.nodeType,playerID:"SF".concat(String(Date.now())),eventSource:e.eventSourceShapeId,duration:1,delay:0,cmd:{name:"playSF",value:e.soundEffectId}})}function sb(e,t,i){return new Ge({animBox:e,effectType:t,playerID:"Dim".concat(String(Date.now())),duration:1,delay:i,transform:Ii(function(){return{visible:e.currentState.visible}},{visible:!1})})}function yI(e){return typeof e=="number"?e:e==="indefinite"?1/0:1}var dl=/*#__PURE__*/function(){function dl(e,t){var _this247=this;_classCallCheck(this,dl);this.animations=e,this.context=t,this.mainPlayerSeq=[],this.interactivePlayerSeqs=new Map,this.subNextPlayerAnimBoxes=new Map,this.textAnimSpIds=new Set,this.triggerEvent=new gd,this.animBoxes=new Map,this.textCount=0;var i,r,n;this.type=t.resourceType;for(var s=0;s<this.animations.length;s+=1){var o=this.animations[s],a=this.getAnimationSeq(o);if(!a)continue;var c=this.getAnimBox(o.spId,(i=o.pRg)==null?void 0:i.start),h=void 0;if((o.textAnimMode==="lt"||o.textAnimMode==="wd")&&!o.pBg)this.textAnimSpIds.add(o.spId),h=this.getTextAnimationPlayer(o,c);else if(h=this.getAnimationPlayer(o,c),h&&o.parentDelay>0){var u=o.parentDelay-a.reduce(function(p,f){return p+f.duration},0);u>0&&(h=new Yn({players:[h],effectType:h.effectType,delay:u}))}if(!h)continue;h=this.joinSubSamePlayers(h,o,c);var d=this.getSubNextPlayerAnimBoxes(this.getSeqId(o));a.length>0&&h.effectType!==a[a.length-1].effectType&&this.squashLastSeqPlayers(a),h.effectType!=="withEffect"&&this.joinLastSubNextIntoPlayers(this.getSeqId(o),a),(h.effectType!=="withEffect"||s===0)&&d.push([]),o.dimAfter==="next"&&d[d.length-1].push(c),a.push(h)}this.squashLastSeqPlayers(this.mainPlayerSeq),this.joinLastSubNextIntoPlayers("mainSeq",this.mainPlayerSeq),this.interactivePlayerSeqs.forEach(function(s,o){_this247.squashLastSeqPlayers(s),_this247.joinLastSubNextIntoPlayers(o,s)}),this.mainSeq=new ro({playerID:"mainSeq",players:this.mainPlayerSeq,effectType:(n=(r=this.mainPlayerSeq[0])==null?void 0:r.effectType)!=null?n:"clickEffect"}),this.interactiveSeqs=new Map,this.interactivePlayerSeqs.forEach(function(s,o){var a,c;_this247.interactiveSeqs.set(o,new ro({playerID:"interactiveSeq"+o,players:s,effectType:(c=(a=s[0])==null?void 0:a.effectType)!=null?c:"clickEffect"}))})}_createClass(dl,[{key:"withTextAnimation",value:function withTextAnimation(e){return this.textAnimSpIds.has(e)}},{key:"end",value:function end(){console.log("[animation manager]: end"),this.mainSeq.seek(this.mainSeq.duration+1)}},{key:"pause",value:function pause(){console.log("[animation manager]: pause");var _iterator228=_createForOfIteratorHelper(this.mainSeq.players),_step228;try{for(_iterator228.s();!(_step228=_iterator228.n()).done;){var e=_step228.value;e.pause()}}catch(err){_iterator228.e(err)}finally{_iterator228.f()}this.interactiveSeqs.forEach(function(e){var _iterator229=_createForOfIteratorHelper(e.players),_step229;try{for(_iterator229.s();!(_step229=_iterator229.n()).done;){var t=_step229.value;t.pause()}}catch(err){_iterator229.e(err)}finally{_iterator229.f()}})}},{key:"reset",value:function reset(){var _this248=this;console.log("[animation manager]: reset"),this.mainSeq.reset(),this.interactiveSeqs.forEach(function(e){return e.reset()}),Ki.render(function(){_this248.animBoxes.forEach(function(e){return e.clearCache()})},!1,!1)}},{key:"logSeq",value:function logSeq(){var e="";e+="mainSeq\n",t(this.mainSeq,"  "),e+="interactiveSeqs\n",this.interactiveSeqs.forEach(function(i){return t(i,"  ")}),console.log(e);function t(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";i instanceof ro?(e+="".concat(r,"seq ").concat(i.effectType,"\n"),i.players.forEach(function(n){return t(n,r+"  ")})):i instanceof vr?(e+="".concat(r,"par ").concat(i.effectType,"\n"),i.players.forEach(function(n){return t(n,r+"  ")})):i instanceof Yn?(e+="".concat(r,"par2 ").concat(i.effectType,"\n"),i.players.forEach(function(n){return t(n,r+"  ")})):e+="".concat(r).concat(i.playerID," ").concat(i.effectType,"\n")}}},{key:"getPlayer",value:function getPlayer(e,t){var i=t;i||(i=[this.mainSeq].concat(_toConsumableArray(Array.from(this.interactiveSeqs.values()))));var _iterator230=_createForOfIteratorHelper(i),_step230;try{for(_iterator230.s();!(_step230=_iterator230.n()).done;){var _r150=_step230.value;if(_r150.playerID===e)return _r150;var n=_r150.players;if(n){var s=this.getPlayer(e,n);if(s)return s}}}catch(err){_iterator230.e(err)}finally{_iterator230.f()}}},{key:"getAnimationSeq",value:function getAnimationSeq(e){switch(e.sequenceType){case"mainSeq":return this.mainPlayerSeq;case"interactiveSeq":{if(e.eventSourceShapeId!==void 0)return this.getInteractiveSeq(pi(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId));console.error("interactiveSeq animation ".concat(e.id," does not have eventSourceShapeId"),e);break}default:console.error("not support sequenceType: \"".concat(e.sequenceType,"\""),e);}}},{key:"getInteractiveSeq",value:function getInteractiveSeq(e){var t=this.interactivePlayerSeqs.get(e);return t||(t=[],this.interactivePlayerSeqs.set(e,t)),t}},{key:"getTextScale",value:function getTextScale(e){var t=1/0;return e.forEach(function(i){i.prop.size<t&&(t=i.prop.size)}),t>=12?1:t/12}},{key:"getTextRect",value:function getTextRect(e,t){var i,r,n,s,o,a,c;var h=0;if(e){var _iterator231=_createForOfIteratorHelper(e.paragraphs),_step231;try{for(_iterator231.s();!(_step231=_iterator231.n()).done;){var d=_step231.value;var _iterator232=_createForOfIteratorHelper(d.lines),_step232;try{for(_iterator232.s();!(_step232=_iterator232.n()).done;){var u=_step232.value;var p=this.getTextScale(u);var _iterator233=_createForOfIteratorHelper(u),_step233;try{for(_iterator233.s();!(_step233=_iterator233.n()).done;){var f=_step233.value;if(h<=t&&h+((r=(i=f.text)==null?void 0:i.length)!=null?r:0)>t){var m=Number(f.prop.width)/p/((s=(n=f.text)==null?void 0:n.length)!=null?s:1);return{height:(o=f.prop.height)!=null?o:f.prop.size,width:m,textScale:p}}else h+=(c=(a=f.text)==null?void 0:a.length)!=null?c:0}}catch(err){_iterator233.e(err)}finally{_iterator233.f()}}}catch(err){_iterator232.e(err)}finally{_iterator232.f()}}}catch(err){_iterator231.e(err)}finally{_iterator231.f()}}}},{key:"getParagraphRect",value:function getParagraphRect(e,t){var i=e==null?void 0:e.paragraphs[t],r=e==null?void 0:e.prop.width,n=i==null?void 0:i.lines.map(function(s){return Math.max.apply(Math,_toConsumableArray(s.map(function(o){var a;return(a=o.prop.height)!=null?a:o.prop.size})))}).reduce(function(s,o){return s+o},0);if(r&&n)return{height:n,width:r,textScale:1}}},{key:"getTextWrapper",value:function getTextWrapper(e){var t,i,r,n,s,o,a,c,h,d,u,p,f,m,g;return e.includes("m")?(s=(n=(r=(i=(t=this.context.wrapResource)==null?void 0:t.master)==null?void 0:i.shapes)==null?void 0:r[e.replace("m","")])==null?void 0:n.textBodyMap)==null?void 0:s[0]:e.includes("l")?(d=(h=(c=(a=(o=this.context.wrapResource)==null?void 0:o.layout)==null?void 0:a.shapes)==null?void 0:c[e.replace("l","")])==null?void 0:h.textBodyMap)==null?void 0:d[0]:(g=(m=(f=(p=(u=this.context.wrapResource)==null?void 0:u.slide)==null?void 0:p.shapes)==null?void 0:f[e])==null?void 0:m.textBodyMap)==null?void 0:g[0]}},{key:"getAnimBox",value:function getAnimBox(e,t,i){var r,n,s;var o=e,a=i!=null,c=t!=null;c?(o+=",".concat(t),a&&(o+=",".concat(i))):a&&(o+=",,".concat(i));var h=this.animBoxes.get(o);if(!h){var d=this.context.shapeParamsIndex[e],u=id;if(d.fillColor){var _d$fillColor$rgb$obje=d.fillColor.rgb().object(),g=_d$fillColor$rgb$obje.r,y=_d$fillColor$rgb$obje.g,b=_d$fillColor$rgb$obje.b,S=_d$fillColor$rgb$obje.alpha;u=new me({r:g,g:y,b:b,a:S!=null?S:1})}var p,f=pi(this.context.pptUUID,this.context.slideIndex,e),m=d.rotate?Qn(d.rotate):0;if(a||c){m=0;var _g9=this.getTextWrapper(e);a?(p=this.getTextRect(_g9,this.textCount),this.textCount+=1):c&&(p=this.getParagraphRect(_g9,t))}h=new fd({target:f,pIndex:p?t:void 0,tIndex:p?i:void 0,constants:{x:d.rectangle.x,y:d.rectangle.y,width:p?p.width*Tt:d.rectangle.width||1,height:p?p.height*Tt:d.rectangle.height||1,slideWidth:this.context.slideWidth/((r=p==null?void 0:p.textScale)!=null?r:1),slideHeight:this.context.slideHeight/((n=p==null?void 0:p.textScale)!=null?n:1),flipH:d.flipH,flipV:d.flipV},initState:{opacity:(s=d.opacity)!=null?s:1,fillcolor:u,rotate:m}}),this.animBoxes.set(o,h)}return h}},{key:"squashLastSeqPlayers",value:function squashLastSeqPlayers(e,t){var i,r;if(e.length<=1)return;var n=e[e.length-1].effectType;if(n!=="withEffect")return;var s=e.length-1;for(;s>0&&e[s].effectType===n;){s-=1}var o=e.splice(s,e.length-s);e.push(new vr({players:o,effectType:(r=t!=null?t:(i=o[0])==null?void 0:i.effectType)!=null?r:"clickEffect"}))}},{key:"getAnimationPlayer",value:function getAnimationPlayer(e,t){if(!e.animationXML)return;var i=[],r=e.animationXML.elements;var _iterator234=_createForOfIteratorHelper(r),_step234;try{for(_iterator234.s();!(_step234=_iterator234.n()).done;){var _s36=_step234.value;var o=fI({node:_s36,animation:e,context:this.context,triggerEvent:this.triggerEvent,animBox:t});!o||(t.preAnimation()||t.preAnimation({}),i.push(o))}}catch(err){_iterator234.e(err)}finally{_iterator234.f()}if(i.length<=0)return;if(e.soundEffectId){var s=gI(e,t);s&&i.push(s)}var n=yI(e.repeatCount);return e.delay>0||n>1||e.autoRev?new Yn({playerID:"parr"+e.id,players:i,effectType:e.nodeType,delay:e.delay,repeat:n,reverse:Boolean(e.autoRev)}):i.length>1?new vr({playerID:"par"+e.id,players:i,effectType:e.nodeType}):i[0]}},{key:"getTextAnimationPlayer",value:function getTextAnimationPlayer(e,t){var _this249=this;var i;var r=bx(this.context.wrapResource,e.spId,(i=e.pRg)==null?void 0:i.start,e.textAnimMode==="wd");if(r===0)return this.getAnimationPlayer(e,t);var n=Array(r).fill(0).map(function(s,o){var a;var c=_this249.getAnimBox(e.spId,(a=e.pRg)==null?void 0:a.start,o),h=_this249.getAnimationPlayer(e,c);return h?new Yn({effectType:e.nodeType,delay:e.textAnimIterateDelay(h.duration-h.delay)*o,players:[h]}):null}).filter(function(s){return Boolean(s)});return n.length<=1?n[0]:new vr({effectType:e.nodeType,players:n})}},{key:"joinSubSamePlayers",value:function joinSubSamePlayers(e,t,i){return t.sequenceType!=="mainSeq"||t.dimAfter!=="same"?e:new vr({players:[e,sb(i,"withEffect",e.duration+32)],effectType:e.effectType})}},{key:"joinLastSubNextIntoPlayers",value:function joinLastSubNextIntoPlayers(e,t){var i=this.getSubNextPlayerAnimBoxes(e),r=t[t.length-1],n=i[i.length-2];if(!r||!n||n.length<=0)return;var s=[r];var _iterator235=_createForOfIteratorHelper(n),_step235;try{for(_iterator235.s();!(_step235=_iterator235.n()).done;){var o=_step235.value;s.push(sb(o,"withEffect",r.delay))}}catch(err){_iterator235.e(err)}finally{_iterator235.f()}t[t.length-1]=new vr({players:s,effectType:r.effectType})}},{key:"getSubNextPlayerAnimBoxes",value:function getSubNextPlayerAnimBoxes(e){var t=this.subNextPlayerAnimBoxes.get(e);return t||(t=[],this.subNextPlayerAnimBoxes.set(e,t)),t}},{key:"getSeqId",value:function getSeqId(e){return e.sequenceType==="interactiveSeq"&&e.eventSourceShapeId!==void 0?pi(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId):"mainSeq"}}]);return dl}();function bI(e,t){var i=new _d(t.slideContext.master,D(M({},t),{resourceType:"master",shapeParamsIndex:t.masterShapeParamsIndex})).collect(),r=new _d(t.slideContext.layout,D(M({},t),{resourceType:"layout",shapeParamsIndex:t.layoutShapeParamsIndex})).collect(),n=new _d(e,D(M({},t),{resourceType:"slide",shapeParamsIndex:t.slideShapeParamsIndex})).collect(),s=new dl(i,D(M({},t),{resourceType:"master",shapeParamsIndex:t.masterShapeParamsIndex})),o=new dl(r,D(M({},t),{resourceType:"layout",shapeParamsIndex:t.layoutShapeParamsIndex})),a=new dl(n,D(M({},t),{resourceType:"slide",shapeParamsIndex:t.slideShapeParamsIndex})),c=new dl(i.concat.apply(i,_toConsumableArray(r).concat(_toConsumableArray(n))),D(M({},t),{resourceType:"main",shapeParamsIndex:M(M(M({},t.slideShapeParamsIndex),t.layoutShapeParamsIndex),t.masterShapeParamsIndex)})),h={slide:0,layout:0,master:0};return h.slide=a.mainSeq.length,h.layout=o.mainSeq.length,h.master=s.mainSeq.length,a.mainSeq.effectType!=="clickEffect"&&(h.layout>0?h.layout-=1:h.master>0&&(h.master-=1)),o.mainSeq.effectType!=="clickEffect"&&h.master>0&&(h.master-=1),[a,o,s].forEach(function(d){d.triggerEvent.on("onEnd",function(_ref100){var u=_ref100.target;u==="slide"?(a.end(),c.end()):u==="layout"?o.end():u==="master"&&s.end()}),d.triggerEvent.on("onUnmount",function(_ref101){var u=_ref101.target;u==="slide"?(a.reset(),c.reset()):u==="layout"?o.reset():u==="master"&&s.reset()})}),{masterAnimationManager:s,layoutAnimationManager:o,slideAnimationManager:a,mainAnimationManager:c,animationCount:h,sequenceAnimesCounts:{get"-1"(){return a.mainSeq.length}}}}var vI="masterPartName",SI="layoutPartName";function wI(_x126,_x127){return _wI.apply(this,arguments)}function _wI(){_wI=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee116(e,t){var i,r,n,s,o;return regeneratorRuntime.wrap(function _callee116$(_context120){while(1){switch(_context120.prev=_context120.next){case 0:_context120.next=2;return Pr("".concat(e,"/text/slide/slide").concat(t,".json"));case 2:i=_context120.sent;r=i[vI].replace("/ppt/slideMasters/slideMaster","/text/master/master").replace(".xml",".json");n=i[SI].replace("/ppt/slideLayouts/slideLayout","/text/layout/layout").replace(".xml",".json");_context120.next=7;return Pr("".concat(e).concat(r));case 7:s=_context120.sent;_context120.next=10;return Pr("".concat(e).concat(n));case 10:o=_context120.sent;return _context120.abrupt("return",{slide:i,master:s,layout:o});case 12:case"end":return _context120.stop();}}},_callee116)}));return _wI.apply(this,arguments)}function ob(_x128,_x129){return _ob.apply(this,arguments)}function _ob(){_ob=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee117(e,t){var i,r,n,s,o,a,c,h,_yield$Promise$all11,_yield$Promise$all12,d,u,_ref129,_ref129$useServerWrap,p,_args121=arguments;return regeneratorRuntime.wrap(function _callee117$(_context121){while(1){switch(_context121.prev=_context121.next){case 0:i=_args121.length>2&&_args121[2]!==undefined?_args121[2]:!1;r=_args121.length>3?_args121[3]:undefined;n=_args121.length>4?_args121[4]:undefined;s=_args121.length>5?_args121[5]:undefined;o=_args121.length>6?_args121[6]:undefined;s&&s.info("Start load ppt ".concat(t," resource."));a=e.replace(/\/$/i,"");o&&o.scheme&&(c=o.scheme,a=a.replace(/^[a-zA-z]+[^://]/,c));h=new uo(c);_context121.next=11;return Promise.all([Pr(a+"/info.json",s),Ir(a+"/pptxml/ppt.xml",s)]);case 11:_yield$Promise$all11=_context121.sent;_yield$Promise$all12=_slicedToArray(_yield$Promise$all11,2);d=_yield$Promise$all12[0];u=_yield$Promise$all12[1];_context121.next=17;return h.loadLumiaPSD(i,s);case 17:s&&s.info("load ppt ".concat(t," resource success"));_ref129=o||{},_ref129$useServerWrap=_ref129.useServerWrap,p=_ref129$useServerWrap===void 0?!0:_ref129$useServerWrap;return _context121.abrupt("return",(p&&ix(a,t,d.fonts),new kI({uuid:t,url:a,width:d.width,height:d.height,slidesCount:d.totalPageSize,mainXMLContent:u,userFonts:n,preload:i,logger:s,resourceScheme:c,rtcClient:o==null?void 0:o.rtcClient,useServerWrap:p})));case 20:case"end":return _context121.stop();}}},_callee117)}));return _ob.apply(this,arguments)}var kI=/*#__PURE__*/function(){function kI(e){_classCallCheck(this,kI);this.url=e.url,this.uuid=e.uuid,this.width=e.width*rn,this.height=e.height*rn,this.slidesCount=e.slidesCount,this.userFonts=e.userFonts,this.preload=e.preload,this.logger=e.logger,this.resourceScheme=e.resourceScheme,this.mainXMLContent=e.mainXMLContent,this.rtcClient=e.rtcClient,this.useServerWrap=e.useServerWrap}_createClass(kI,[{key:"loadSlide",value:function(){var _loadSlide=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee66(e){var _this250=this;var t,i,r,n,s,o,a,_yield$this$fetchSlid,c,h,d,u,p,f,m,g,y,b,S,w,P,A,E,R,N,_;return regeneratorRuntime.wrap(function _callee66$(_context68){while(1){switch(_context68.prev=_context68.next){case 0:(t=this.logger)==null||t.debug("begin load slide ".concat(e+1));s=Z2(),o=new nn("main",s).parse(this.mainXMLContent);if(!(e<0||e>=this.slidesCount)){_context68.next=4;break}throw new Error("index should be in 0 ~ ".concat(this.slidesCount-1));case 4:a=e+1;_context68.next=7;return this.fetchSlideInfo(a);case 7:_yield$this$fetchSlid=_context68.sent;c=_yield$this$fetchSlid.slideXMLContent;h=_yield$this$fetchSlid.slideRefXMLContent;d=_yield$this$fetchSlid.layoutXMLContent;u=_yield$this$fetchSlid.masterXMLContent;p=_yield$this$fetchSlid.themeXMLContent;f=_yield$this$fetchSlid.resource;m=_yield$this$fetchSlid.wrapResource;this.preload===!0&&((i=this.logger)==null||i.debug("begin preload slide ".concat(a+1)),this.prefetch(a+1)["catch"](function(ie){var ce;(ce=_this250.logger)==null||ce.debug("prefetch slide ".concat(a+1," error: "),ie)}),(r=this.logger)==null||r.debug("preloaded slide ".concat(a+1)));g=new nn("layout",s).parse(d),y=Xy(g.childElement("p:sldLayout","p:cSld","p:spTree")),b=new nn("master",s).parse(u),S=Xy(b.childElement("p:sldMaster","p:cSld","p:spTree"),b.childElementOptional("p:sldMaster","p:txStyles")),w=new nn("theme",s).parse(p),P=new y2(f,this.resourceScheme),A=new nn("slide",s).parse(c),E=new nn("slideRef",s).parse(h),R={};E.element!==void 0&&E.element.elements.forEach(function(ie){R[ie.attr.getString("Id")]=ie.attr.getStringOptional("Target")});N={slide:A,layout:g,layoutIndex:y,master:b,masterIndex:S,masterThemeColorMapping:b.childElement("p:sldMaster","p:clrMap").attr.attributes,theme:w,main:o,userFonts:this.userFonts};s.context=Object.freeze(N);_=bI(A,Object.freeze({pptUUID:this.uuid,slideIndex:a,slideContext:N,slideWidth:this.width,slideHeight:this.height,masterShapeParamsIndex:this.getShapeIndexMap(b.childElement("p:sldMaster","p:cSld","p:spTree")),layoutShapeParamsIndex:this.getShapeIndexMap(g.childElement("p:sldLayout","p:cSld","p:spTree")),slideShapeParamsIndex:this.getShapeIndexMap(A.childElement("p:sld","p:cSld","p:spTree")),wrapResource:m}));return _context68.abrupt("return",((n=this.logger)==null||n.debug("loaded slide ".concat(a)),this.slideIndex=e,Object.freeze({uuid:this.uuid,url:this.url,index:e,width:this.width,height:this.height,masterXML:b,masterIndex:S,layoutXML:g,layoutIndex:y,mainXML:o,themeXML:w,slideXML:A,slideRefIndex:R,resourceLoader:P,animations:_,slidesCount:this.slidesCount,preload:this.preload,logger:this.logger,rtcClient:this.rtcClient,WrapResource:m,preSlideIndex:this.preSlideIndex})));case 22:case"end":return _context68.stop();}}},_callee66,this)}));function loadSlide(_x130){return _loadSlide.apply(this,arguments)}return loadSlide}()},{key:"fetchSlideInfo",value:function(){var _fetchSlideInfo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee67(e){var t,_yield$Promise$all7,_yield$Promise$all8,i,r,n,s,o,a,c;return regeneratorRuntime.wrap(function _callee67$(_context69){while(1){switch(_context69.prev=_context69.next){case 0:t=[Ir("".concat(this.url,"/slide/slide").concat(e,".xml"),this.logger),Ir("".concat(this.url,"/slideRef/slideRef").concat(e,".xml"),this.logger)["catch"](function(h){return console.log("error ",h),""}),Ir("".concat(this.url,"/layout/layout").concat(e,".xml"),this.logger),Ir("".concat(this.url,"/master/master").concat(e,".xml"),this.logger),Ir("".concat(this.url,"/theme/theme").concat(e,".xml"),this.logger),Pr("".concat(this.url,"/resources/resource").concat(e,".json"),this.logger)];_context69.next=3;return Promise.all(t);case 3:_yield$Promise$all7=_context69.sent;_yield$Promise$all8=_slicedToArray(_yield$Promise$all7,6);i=_yield$Promise$all8[0];r=_yield$Promise$all8[1];n=_yield$Promise$all8[2];s=_yield$Promise$all8[3];o=_yield$Promise$all8[4];a=_yield$Promise$all8[5];if(!this.useServerWrap){_context69.next=20;break}_context69.prev=12;_context69.next=15;return wI(this.url,e);case 15:c=_context69.sent;_context69.next=20;break;case 18:_context69.prev=18;_context69.t0=_context69["catch"](12);case 20:return _context69.abrupt("return",{slideXMLContent:i,slideRefXMLContent:r,layoutXMLContent:n,masterXMLContent:s,themeXMLContent:o,resource:a,wrapResource:c});case 21:case"end":return _context69.stop();}}},_callee67,this,[[12,18]])}));function fetchSlideInfo(_x131){return _fetchSlideInfo.apply(this,arguments)}return fetchSlideInfo}()},{key:"prefetch",value:function(){var _prefetch=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee68(e){var t,i,r,n;return regeneratorRuntime.wrap(function _callee68$(_context70){while(1){switch(_context70.prev=_context70.next){case 0:if(!(e>this.slidesCount)){_context70.next=3;break}(t=this.logger)==null||t.debug("no slide need prefetch");return _context70.abrupt("return");case 3:r=new uo(this.resourceScheme);_context70.next=6;return r.fetchPageResource(this.url,e);case 6:n=_context70.sent;r.prefetchPageResource(n).then(function(){},function(){}),(i=this.logger)==null||i.debug("prefetch slide ".concat(e," finish"));case 8:case"end":return _context70.stop();}}},_callee68,this)}));function prefetch(_x132){return _prefetch.apply(this,arguments)}return prefetch}()},{key:"getShapeIndexMap",value:function getShapeIndexMap(e){var t={},i=e.extraAttr.getString("spId"),r=Ud(e);return this.getShapeGroupIndexMap(e,t,i,r.transform),t}},{key:"getShapeGroupIndexMap",value:function getShapeGroupIndexMap(e,t,i,r){var _this251=this;var n=e.elementsWithName("p:sp");this.getChildShapesIndexMap(n,t,i,r);var s=e.elementsWithName("p:cxnSp");this.getChildShapesIndexMap(s,t,i,r);var o=e.elementsWithName("p:pic");this.getChildShapesIndexMap(o,t,i,r);var a=e.elementsWithName("p:graphicFrame");this.getChildShapesIndexMap(a,t,i,r);var c=e.elementsWithName("p:grpSp");c.length>0&&c.forEach(function(h){var d=h.extraAttr.getString("spId"),u=Ud(h,void 0,i,r);_this251.getShapeGroupIndexMap(h,t,d,u.transform),t[d]=u})}},{key:"getChildShapesIndexMap",value:function getChildShapesIndexMap(e,t,i,r){e.forEach(function(n){var s=n.extraAttr.getString("spId"),o=Gy(n,void 0,i,r);t[s]=o})}}]);return kI}(),CI=/*#__PURE__*/function(_rt$default$Component){_inherits(CI,_rt$default$Component);var _super80=_createSuper(CI);function CI(e){var _this252;_classCallCheck(this,CI);_this252=_super80.call(this,e);_this252.state={disableJumpTo:!1};return _this252}_createClass(CI,[{key:"UNSAFE_componentWillMount",value:function UNSAFE_componentWillMount(){var e=this.props.emitter;e.on("nextStep",this.onNextStepHandler,this),e.on("preStep",this.onPreStepHandler,this),e.on("nextPage",this.onNextPageHandler,this),e.on("prePage",this.onPrePageHandler,this),e.on("resetSlideAnimation",this.resetCurrentSlideAnimation,this),e.on("resetPPTAnimation",this.resetCurrentPPTAnimation,this),e.on("changePageTo",this.onClickJumpToHandler,this),e.on("displaySidebar",this.displaySidebar,this),e.on("hideSidebar",this.hideSidebar,this),e.on("displayNote",this.displayNote,this),e.on("hideNote",this.hideNote,this)}},{key:"componentWillUnmount",value:function componentWillUnmount(){var e=this.props.emitter;e.removeAllListeners()}},{key:"onPrePageHandler",value:function onPrePageHandler(){var _this$props90=this.props,e=_this$props90.slideIndex,t=_this$props90.changeToPage;e>0&&t(e-1)}},{key:"onNextPageHandler",value:function onNextPageHandler(){var _this$props91=this.props,e=_this$props91.slideIndex,t=_this$props91.changeToPage,i=_this$props91.total;e<i-1&&t(e+1)}},{key:"onClickJumpToHandler",value:function onClickJumpToHandler(e){var _this$props92=this.props,t=_this$props92.total,i=_this$props92.changeToPage,r=(e||parseInt(this.inputRef.value,10))-1;if(Number.isNaN(r)||r<0){this.inputRef.value="1",i(0);return}if(r>t-1){this.inputRef.value="".concat(t),i(t-1);return}this.inputRef.value=(r+1).toString(),i(r)}},{key:"onPreStepHandler",value:function onPreStepHandler(){var e=this.props.changeStep;e(-1)}},{key:"onNextStepHandler",value:function onNextStepHandler(){var e=this.props.changeStep;e(1)}},{key:"invalidJumpTo",value:function invalidJumpTo(){Number.isNaN(parseInt(this.inputRef.value,10))?this.setState({disableJumpTo:!0}):this.setState({disableJumpTo:!1})}},{key:"resetCurrentSlideAnimation",value:function resetCurrentSlideAnimation(){var e=this.props.resetCurrentSlideAnimation;e()}},{key:"resetCurrentPPTAnimation",value:function resetCurrentPPTAnimation(){var e=this.props.resetCurrentPPTAnimation;e()}},{key:"displaySidebar",value:function displaySidebar(){var e=this.props.changeIsExtendSidebar;e(!0)}},{key:"hideSidebar",value:function hideSidebar(){var e=this.props.changeIsExtendSidebar;e(!1)}},{key:"displayNote",value:function displayNote(){var e=this.props.changeIsShowNote;e(!0)}},{key:"hideNote",value:function hideNote(){var e=this.props.changeIsShowNote;e(!1)}},{key:"render",value:function render(){var _this253=this;var e=this.state.disableJumpTo,_this$props93=this.props,t=_this$props93.slideIndex,i=_this$props93.total,r=_this$props93.isExtendSidebar,n=_this$props93.isShowNote,s=_this$props93.international,o=_this$props93.disableSidebar,a=_this$props93.disableNote;return rt["default"].createElement("div",{className:"ppt-preview-beauty-scroll-bar ppt-preview-controls"},rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:t===0,onClick:function onClick(){_this253.onPrePageHandler()}},s&&s.prePage||"\u4E0A\u4E00\u9875"),rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.onPreStepHandler()}},s&&s.preStep||"\u4E0A\u4E00\u6B65"),rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.onNextStepHandler()}},s&&s.nextStep||"\u4E0B\u4E00\u6B65"),rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:t===i-1,onClick:function onClick(){_this253.onNextPageHandler()}},s&&s.nextPage||"\u4E0B\u4E00\u9875"),rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.resetCurrentSlideAnimation()}},s&&s.resetCurrentSlideAnimation||"\u91CD\u7F6E\u5F53\u524D\u9875\u52A8\u753B"),rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.resetCurrentPPTAnimation()}},s&&s.resetCurrentPPTAnimation||"\u91CD\u7F6E\u6240\u6709\u52A8\u753B"),rt["default"].createElement("input",{className:"ppt-preview-controls-input",type:"text",onInput:function onInput(){_this253.invalidJumpTo()},ref:function ref(c){_this253.inputRef=c}}),rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.onClickJumpToHandler()},disabled:e},s&&s.jumpTo||"\u8DF3\u8F6C\u5230\u6B64\u9875"),r?rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.hideSidebar()}},s&&s.hideSidebar||"\u9690\u85CF\u4FA7\u8FB9\u680F"):rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.displaySidebar()},disabled:o},s&&s.displaySidebar||"\u663E\u793A\u4FA7\u8FB9\u680F"),n?rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.hideNote()}},s&&s.hideNote||"\u9690\u85CF\u5907\u6CE8"):rt["default"].createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function onClick(){_this253.displayNote()},disabled:a},s&&s.displayNote||"\u663E\u793A\u5907\u6CE8"),rt["default"].createElement("p",{className:"ppt-preview-controls-page"},s&&s.pageNumber||"\u9875\u7801","\uFF1A",t+1," ","/",i))}}]);return CI}(rt["default"].Component),xI=/*#__PURE__*/function(_Rt$default$PureCompo){_inherits(xI,_Rt$default$PureCompo);var _super81=_createSuper(xI);function xI(e){_classCallCheck(this,xI);return _super81.call(this,e)}_createClass(xI,[{key:"render",value:function render(){var _this$props94=this.props,e=_this$props94.isShow,t=_this$props94.noteList;return Rt["default"].createElement("div",{style:{width:"100%",height:"200px",overflow:"auto",position:"absolute",bottom:e?0:"-200px",transition:"1s",zIndex:"2",fontSize:"12px",padding:"12px",boxSizing:"border-box",fontFamily:"\u7B49\u7EBF"},className:"ppt-preview-beauty-scroll-bar ppt-preview-note"},t.map(function(i,r){var n;var s={textAlign:Id((n=i.align)!=null?n:"l"),marginLeft:i.marginLeft?"".concat(i.marginLeft,"px"):0,marginRight:i.marginRight?"".concat(i.marginRight,"px"):0,textIndent:i.indent?"".concat(i.indent,"px"):0};return Rt["default"].createElement("div",{key:r,style:s},i.buchar&&Rt["default"].createElement("span",null,parseInt(i.buchar,10)?i.buchar+".":i.buchar,"\xA0\xA0"),!i.runs&&Rt["default"].createElement("br",null),i.runs&&i.runs.map(function(o,a){var c;var h={letterSpacing:o.wordSpace?"".concat(o.wordSpace,"px"):0,verticalAlign:o.baseline?"".concat(o.baseline,"px"):0,textDecoration:o.underLine?ax(o.underLine):"none",strikeThrough:o.strikeThrough?"":"none",fontWeight:o.bold?"bolder":"normal",fontStyle:o.italic?"italic":"normal"},d=o.text?o.text:"";if((c=o.text)==null?void 0:c.includes("\t")){var u=[];for(var p=0;p<o.text.length;p+=1){o.text[p]==="\t"?u.push(Rt["default"].createElement("span",{key:"tab"+p},"\t")):u.push(Rt["default"].createElement("span",{key:"tab"+p,style:{fontFamily:"\u7B49\u7EBF"}},o.text[p]))}return Rt["default"].createElement("pre",{key:d+r+a,style:{margin:"0",display:"inline"}},u)}return o.strikeThrough==="sngStrike"?Rt["default"].createElement("span",{key:d+r+a,style:h},Rt["default"].createElement("s",null,o.text)):o.runType==="br"?Rt["default"].createElement("br",null):o.runType==="text"?Rt["default"].createElement("span",{key:d+r+a,style:h},o.text):Rt["default"].createElement("span",{key:d+r+a})}))}))}}]);return xI}(Rt["default"].PureComponent),II=/*#__PURE__*/function(_ds$default$Component){_inherits(II,_ds$default$Component);var _super82=_createSuper(II);function II(){_classCallCheck(this,II);return _super82.apply(this,arguments)}_createClass(II,[{key:"clickHandler",value:function clickHandler(e){var t=this.props.changeToPage;t(e)}},{key:"render",value:function render(){var _this254=this;var _this$props95=this.props,e=_this$props95.isExtend,t=_this$props95.previewList,i={display:"flex",flexDirection:"column",justifyContent:"flex-start",position:"absolute",right:e?0:"-20%",width:"20%",overflow:"auto",transition:"1s",top:0,bottom:0,zIndex:"3",borderLeft:"1px solid #ccc",backgroundColor:"#eee"},r={display:"flex",flexDirection:"column",justifyContent:"space-around"};return ds["default"].createElement("div",{style:i,className:"ppt-preview-beauty-scroll-bar ppt-preview-sidebar"},t.map(function(n,s){return ds["default"].createElement("div",{className:"ppt-preview-sidebar-item ppt-event-source",key:n,style:r,onClick:function onClick(){_this254.clickHandler(s)}},ds["default"].createElement("img",{className:"ppt-preview-sidebar-img",src:n,alt:"PPT\u7565\u7F29\u56FE"}),ds["default"].createElement("span",{className:"ppt-preview-sidebar-span"},s+1))}))}}]);return II}(ds["default"].Component),qd;(function(e){e.waiting="Waiting",e.converting="Converting",e.finished="Finished",e.fail="Fail"})(qd||(qd={}));var cb;(function(e){e.packaging="Packaging",e.extracting="Extracting",e.generatingPreview="GeneratingPreview",e.mediaTranscode="MediaTranscode"})(cb||(cb={}));var hb;(function(e){e.dynamic="dynamic",e["static"]="static"})(hb||(hb={}));var PI=/*#__PURE__*/function(_mi$default$Component){_inherits(PI,_mi$default$Component);var _super83=_createSuper(PI);function PI(e){var _this255;_classCallCheck(this,PI);_this255=_super83.call(this,e);_this255.previewList=[],_this255.PPTSliderList=[],_this255.stateAdapter={disableInteractive:!1,setState:function(){var _setState=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee69(t,i,r){return regeneratorRuntime.wrap(function _callee69$(_context71){while(1){switch(_context71.prev=_context71.next){case 0:_this255.setState({globalPPTState:r});case 1:case"end":return _context71.stop();}}},_callee69)}));function setState(_x133,_x134,_x135){return _setState.apply(this,arguments)}return setState}(),onPageToPrev:function onPageToPrev(){var t=_this255.state.slideIndex;_this255.changePageTo(t-1).then(function(){},function(){})},onPageToNext:function onPageToNext(){var t=_this255.state.slideIndex;_this255.changePageTo(t+1).then(function(){},function(){})},onPageJumpTo:function(){var _onPageJumpTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee70(t,i){return regeneratorRuntime.wrap(function _callee70$(_context72){while(1){switch(_context72.prev=_context72.next){case 0:_this255.changePageTo(i-1).then(function(){},function(){});case 1:case"end":return _context72.stop();}}},_callee70)}));function onPageJumpTo(_x136,_x137){return _onPageJumpTo.apply(this,arguments)}return onPageJumpTo}(),setSlideStateAdapterCallbacks:function setSlideStateAdapterCallbacks(t){}},_this255.clickSidebarHandler=function(t){_this255.changePageTo(t).then(function(){},function(){})},_this255.clickControllerHandler=function(t){_this255.changePageTo(t).then(function(){},function(){})},_this255.changeIsExtendSidebar=function(t){_this255.previewList.length!==0&&_this255.setState({isExtendingSidebar:t})},_this255.changeIsShowNote=function(t){var i=_this255.state.noteList;i.length!==0&&_this255.setState({isShownNote:t})},_this255.resetCurrentSlideAnimation=function(){_this255.slideRef&&_this255.slideRef.resetCurrentSlideAnimation()},_this255.resetCurrentPPTAnimation=function(){_this255.slideRef&&_this255.slideRef.resetCurrentPPTAnimation()},_this255.state={slide:void 0,slideIndex:0,globalPPTState:void 0,isExtendingSidebar:!1,isShownNote:!1,noteList:[],isLoading:!0},_this255.isGotNodeList=!1,e.conversionResponse.status===qd.finished&&(_this255.uuid=e.conversionResponse.uuid,e.conversionResponse.progress.convertedFileList.forEach(function(t){_this255.PPTSliderList.push(D(M({},t),{conversionFileUrl:t.conversionFileUrl.replace(/\d.slide/g,"")})),t.preview&&_this255.previewList.push(t.preview)}),_this255.total=_this255.PPTSliderList.length);return _this255}_createClass(PI,[{key:"UNSAFE_componentWillMount",value:function(){var _UNSAFE_componentWillMount=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee71(){var e,_this$props96,t,i,r,n,s;return regeneratorRuntime.wrap(function _callee71$(_context73){while(1){switch(_context73.prev=_context73.next){case 0:e=this.state.slideIndex,_this$props96=this.props,t=_this$props96.preloadProgress,i=_this$props96.userFonts,r=_this$props96.logger,n=this.PPTSliderList[e];_context73.next=3;return ob(n.conversionFileUrl,this.uuid,!0,t,i,r,{scheme:"https",useServerWrap:!0});case 3:this.ppt=_context73.sent;_context73.next=6;return this.ppt.loadSlide(e);case 6:s=_context73.sent;_context73.next=9;return this.getNoteList();case 9:this.setState({slide:s,isLoading:!1});case 10:case"end":return _context73.stop();}}},_callee71,this)}));function UNSAFE_componentWillMount(){return _UNSAFE_componentWillMount.apply(this,arguments)}return UNSAFE_componentWillMount}()},{key:"componentWillUnmount",value:function componentWillUnmount(){var e=this.props.emitter;e.removeAllListeners()}},{key:"getNoteList",value:function(){var _getNoteList=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee72(){var e,t,i;return regeneratorRuntime.wrap(function _callee72$(_context74){while(1){switch(_context74.prev=_context74.next){case 0:e=this.state.slideIndex,t=this.PPTSliderList[e];_context74.prev=1;_context74.next=4;return Pr("".concat(t.conversionFileUrl.replace("pptx","https"),"notes/note").concat(e+1,".json"));case 4:i=_context74.sent;this.setState({noteList:i});_context74.next=11;break;case 8:_context74.prev=8;_context74.t0=_context74["catch"](1);this.setState({noteList:[]});case 11:this.isGotNodeList=!0;case 12:case"end":return _context74.stop();}}},_callee72,this,[[1,8]])}));function getNoteList(){return _getNoteList.apply(this,arguments)}return getNoteList}()},{key:"changePageTo",value:function(){var _changePageTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee73(e){var t,i;return regeneratorRuntime.wrap(function _callee73$(_context75){while(1){switch(_context75.prev=_context75.next){case 0:if(!(e<0||e>=this.total)){_context75.next=2;break}return _context75.abrupt("return");case 2:t=this.state.isLoading;if(!t){_context75.next=5;break}return _context75.abrupt("return");case 5:this.setState({isLoading:!0});_context75.next=8;return this.ppt.loadSlide(e);case 8:i=_context75.sent;this.setState({slide:i,slideIndex:e,isLoading:!1,isShownNote:!1});_context75.next=12;return this.getNoteList();case 12:case"end":return _context75.stop();}}},_callee73,this)}));function changePageTo(_x138){return _changePageTo.apply(this,arguments)}return changePageTo}()},{key:"changeStep",value:function changeStep(e){var t=this.state.isLoading;t||this.slideRef.changeStep(e)}},{key:"emitData",value:function emitData(){var _this256=this;clearTimeout(this.emitSetTimeout),this.emitSetTimeout=setTimeout(function(){if(!_this256.isGotNodeList)return;var e=_this256.total,_this256$state=_this256.state,t=_this256$state.slideIndex,i=_this256$state.isExtendingSidebar,r=_this256$state.isShownNote,n=_this256$state.noteList,s=_this256.props.emitter,o=!_this256.previewList.length,a=!n.length;s.emit("update",{index:t+1,total:e,disableNote:a,disableSidebar:o,isShowNote:r,isExtendSidebar:i})},500)}},{key:"render",value:function render(){var _this257=this;var e=this.total,t=this.PPTSliderList,_this$state8=this.state,i=_this$state8.globalPPTState,r=_this$state8.slide,n=_this$state8.slideIndex,s=_this$state8.isExtendingSidebar,o=_this$state8.isShownNote,a=_this$state8.noteList,c=_this$state8.isLoading,_this$props97=this.props,h=_this$props97.parentElement,d=_this$props97.config,u=_this$props97.emitter,p=!this.previewList.length,f=!a.length,m=t[0].width;this.emitData();var g=t[0].height+40,y={width:"".concat(m,"px"),height:"".concat(g,"px"),transform:""},b=Math.min(h.offsetWidth/m,h.offsetHeight/g);return h.style.width&&(y.transform="scale(".concat(b,", ").concat(b,")")),mi["default"].createElement("div",{style:y,className:"ppt-preview-container"},mi["default"].createElement(CI,{international:d&&d.international,isShowNote:o,emitter:u,disableNote:f,disableSidebar:p,isExtendSidebar:s,changeStep:function changeStep(S){_this257.changeStep(S)},changeIsShowNote:this.changeIsShowNote,changeIsExtendSidebar:this.changeIsExtendSidebar,total:e,resetCurrentSlideAnimation:this.resetCurrentSlideAnimation,resetCurrentPPTAnimation:this.resetCurrentPPTAnimation,changeToPage:this.clickControllerHandler,slideIndex:n}),mi["default"].createElement("div",{style:{position:"relative",display:"inline-block",overflow:"hidden",width:"100%",fontSize:"0"},className:"ppt-preview-main-container"},mi["default"].createElement("div",{style:{display:"inline-block"},className:"ppt-preview-slide-container"},!c&&r&&mi["default"].createElement(Ky,{ref:function ref(S){_this257.slideRef=S},stateAdapter:this.stateAdapter,pptState:i,data:r,renderMode:al.Normal}),c&&mi["default"].createElement("div",{style:y})),this.previewList.length>0&&mi["default"].createElement(II,{isExtend:s,previewList:this.previewList,changeToPage:this.clickSidebarHandler}),a.length>0&&mi["default"].createElement(xI,{isShow:o,noteList:a})))}}]);return PI}(mi["default"].Component);function Zd(e,t,i){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:!1;var n=arguments.length>4?arguments[4]:undefined;var s=arguments.length>5?arguments[5]:undefined;var o=arguments.length>6?arguments[6]:undefined;var a=arguments.length>7?arguments[7]:undefined;t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center";var c=a!=null?a:new lb["default"];return ab["default"].render(mi["default"].createElement(PI,{conversionResponse:e,parentElement:t,preload:r,userFonts:n,logger:s,config:i,pptPrams:o,emitter:c}),t),c}var fb=x(require("react")),gb=x(require("url-parse")),yb=x(require("textarea-caret-ts"));var MI=Object.defineProperty,db=Object.getOwnPropertySymbols,TI=Object.prototype.hasOwnProperty,EI=Object.prototype.propertyIsEnumerable,ub=function ub(e,t,i){return t in e?MI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},AI=function AI(e,t){for(var i in t||(t={})){TI.call(t,i)&&ub(e,i,t[i])}if(db){var _iterator236=_createForOfIteratorHelper(db(t)),_step236;try{for(_iterator236.s();!(_step236=_iterator236.n()).done;){var i=_step236.value;EI.call(t,i)&&ub(e,i,t[i])}}catch(err){_iterator236.e(err)}finally{_iterator236.f()}}return e},BE=typeof require!="undefined"?require:function(e){throw new Error("Dynamic require of \""+e+"\" is not supported")};function OI(e){var t=e.split("/");return t.pop(),t.join("/")}var RI=/*#__PURE__*/function(){function RI(){var _this258=this;_classCallCheck(this,RI);this.libraryMap={},this.paddingMap={},this.freeInterrupters={},this.defineLibrary=function(i,r){if(i.libName in _this258.libraryMap)throw new Error("found duplicated library ".concat(JSON.stringify(i.libName)));r&&(_this258.freeInterrupters[i.libName]=r),_this258.libraryMap[i.libName]=Object.freeze(AI({},i))},this.requireModules=function(i){return new Promise(function(r,n){var s=_this258.paddingMap[i];s||(s=_this258.paddingMap[i]=[]),s.push({resolve:r,reject:n})})},this.loader=function(i,r,n){if(r||n){var s=i;_this258.handlePanddingNodes(s,r,n);return}else{var _s37=i;return _this258.createRequireFunction(_s37)}};var e="__netlessJavaScriptLoader",t=window;if(t[e]!==void 0)throw new Error("window.".concat(e," was override"));Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:this.loader})}_createClass(RI,[{key:"handlePanddingNodes",value:function handlePanddingNodes(e,t,i){var r=this.paddingMap[e];if(r){delete this.paddingMap[e];var _iterator237=_createForOfIteratorHelper(r),_step237;try{for(_iterator237.s();!(_step237=_iterator237.n()).done;){var n=_step237.value;if(i)n.reject(i);else try{n.resolve(this.handleModules(t))}catch(s){n.reject(s)}}}catch(err){_iterator237.e(err)}finally{_iterator237.f()}}else if(!i&&t){var _n44=OI(e),s=this.freeInterrupters[_n44];s&&s(e,t)}else console.warn("find invalid async module ".concat(JSON.stringify(e)))}},{key:"createRequireFunction",value:function createRequireFunction(e){var t=this.libraryMap[e];if(!t)throw new Error("undefined library ".concat(JSON.stringify(e)));return function(i){var r=t.dependencies,n=r&&r[i];if(!n)throw new Error("cannot find module ".concat(JSON.stringify(i)," of library ").concat(JSON.stringify(e)));return n}}},{key:"handleModules",value:function handleModules(e){for(var t in e){var i=e[t];"__esModule"in i||Object.defineProperty(i,"__esModule",{value:!0})}return Object.freeze(e)}}]);return RI}(),NI=new RI,LI=NI.requireModules,DI=NI.defineLibrary;function FI(e,t){var i=window.atob(e),r=new Uint8Array(i.length);for(var n=0;n<i.length;n++){r[n]=i.charCodeAt(n)}return new Blob([r],t)}function BI(e){return new Promise(function(t,i){try{var _r151=new FileReader;_r151.onload=function(n){var s;var o=(s=n.target)==null?void 0:s.result;typeof o=="string"?t(o):i(new Error("blob load wrong type "+_typeof(o)))},_r151.readAsDataURL(e)}catch(r){i(r)}})}var jI="__netlessJavaScriptCache",zI=1,go="modules";function eu(e){return new Promise(function(t,i){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var _r152=new Error(e.error.message);_r152.name=e.error.name,i(_r152)}else i(new Error("failed with null Error"))}})}var ul=/*#__PURE__*/function(){function ul(e,t,i){_classCallCheck(this,ul);var _URL2=new URL(t),r=_URL2.protocol,n=_URL2.host,s=new Oi({fetcher:window.fetch.bind(window),retryCount:ul.retryCount,retryLoopsCount:0,configmap:{module:{useSSL:r==="https:",hosts:{"*":n}}}});this.fetcher=s.fetch("module"),this.storeBase64=e,this.findPath=i}_createClass(ul,[{key:"findObjectURL",value:function(){var _findObjectURL=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee74(e){var t;return regeneratorRuntime.wrap(function _callee74$(_context76){while(1){switch(_context76.prev=_context76.next){case 0:_context76.next=2;return this.readBlob(e);case 2:t=_context76.sent;_context76.t0=t;if(_context76.t0){_context76.next=10;break}_context76.next=7;return this.fetchBuffer(e);case 7:t=_context76.sent;_context76.next=10;return this.writeBlob(e,t);case 10:return _context76.abrupt("return",URL.createObjectURL(t,{oneTimeOnly:!0}));case 11:case"end":return _context76.stop();}}},_callee74,this)}));function findObjectURL(_x139){return _findObjectURL.apply(this,arguments)}return findObjectURL}()},{key:"readBlob",value:function(){var _readBlob=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee75(e){var i,r,_r$split,_r$split2,n,s,o;return regeneratorRuntime.wrap(function _callee75$(_context77){while(1){switch(_context77.prev=_context77.next){case 0:_context77.next=2;return ul.dbp;case 2:i=_context77.sent.transaction([go],"readonly").objectStore(go).get(e);_context77.next=5;return eu(i);case 5:r=_context77.sent;if(typeof r=="string"){_r$split=r.split(/;base64,/im),_r$split2=_slicedToArray(_r$split,2),n=_r$split2[0],s=_r$split2[1],o=n.replace(/^data:/im,"");r=FI(s,{type:o})}return _context77.abrupt("return",r);case 8:case"end":return _context77.stop();}}},_callee75)}));function readBlob(_x140){return _readBlob.apply(this,arguments)}return readBlob}()},{key:"writeBlob",value:function(){var _writeBlob=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee76(e,t){var i,n;return regeneratorRuntime.wrap(function _callee76$(_context78){while(1){switch(_context78.prev=_context78.next){case 0:i=t;_context78.t0=this.storeBase64;if(!_context78.t0){_context78.next=6;break}_context78.next=5;return BI(i);case 5:i=_context78.sent;case 6:_context78.next=8;return ul.dbp;case 8:n=_context78.sent.transaction([go],"readwrite").objectStore(go).put(i,e);_context78.next=11;return eu(n);case 11:case"end":return _context78.stop();}}},_callee76,this)}));function writeBlob(_x141,_x142){return _writeBlob.apply(this,arguments)}return writeBlob}()},{key:"fetchBuffer",value:function(){var _fetchBuffer2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee77(e){var t,i;return regeneratorRuntime.wrap(function _callee77$(_context79){while(1){switch(_context79.prev=_context79.next){case 0:t="http://module"+this.findPath(e);_context79.next=3;return this.fetcher(t,{method:"get",headers:{Accept:"application/javascript"}});case 3:i=_context79.sent;if(!(i.status!==200)){_context79.next=6;break}throw new Error("failed to fetch ".concat(JSON.stringify(t)," with status ").concat(i.status));case 6:_context79.next=8;return i.blob();case 8:return _context79.abrupt("return",_context79.sent);case 9:case"end":return _context79.stop();}}},_callee77,this)}));function fetchBuffer(_x143){return _fetchBuffer2.apply(this,arguments)}return fetchBuffer}()}],[{key:"dbp",get:function get(){if(!this._dbp){var e=indexedDB.open(jI,zI);e.onupgradeneeded=function(t){t.target.result.createObjectStore(go)},this._dbp=eu(e)}return this._dbp}}]);return ul}(),pb=ul;pb.retryCount=5;var UI=/*#__PURE__*/function(){function UI(e){_classCallCheck(this,UI);this.params=e,this.completeCallbacks=[]}_createClass(UI,[{key:"load",value:function(){var _load=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee78(){var e,_iterator238,_step238,t;return regeneratorRuntime.wrap(function _callee78$(_context80){while(1){switch(_context80.prev=_context80.next){case 0:e=[];this.params.timeout!==void 0&&e.push(this.startTimeout(this.params.timeout)),e.push(this.loadScript());_context80.prev=2;_context80.next=5;return Promise.race(e);case 5:_context80.prev=5;_iterator238=_createForOfIteratorHelper(this.completeCallbacks);try{for(_iterator238.s();!(_step238=_iterator238.n()).done;){t=_step238.value;t()}}catch(err){_iterator238.e(err)}finally{_iterator238.f()}return _context80.finish(5);case 9:case"end":return _context80.stop();}}},_callee78,this,[[2,,5,9]])}));function load(){return _load.apply(this,arguments)}return load}()},{key:"loadScript",value:function(){var _loadScript=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee79(){var _this$params2,e,t,i,r,n;return regeneratorRuntime.wrap(function _callee79$(_context81){while(1){switch(_context81.prev=_context81.next){case 0:_this$params2=this.params,e=_this$params2.origin,t=_this$params2.findPath,i=_this$params2.identifier,r=_this$params2.storage;if(!r){_context81.next=13;break}_context81.prev=2;_context81.next=5;return r.findObjectURL(i);case 5:n=_context81.sent;_context81.next=11;break;case 8:_context81.prev=8;_context81.t0=_context81["catch"](2);console.warn("read from storage failed: ".concat(_context81.t0.message)),n="".concat(e).concat(t(i));case 11:_context81.next=14;break;case 13:n="".concat(e).concat(t(i));case 14:_context81.next=16;return this.loadScriptWithURL(n);case 16:case"end":return _context81.stop();}}},_callee79,this,[[2,8]])}));function loadScript(){return _loadScript.apply(this,arguments)}return loadScript}()},{key:"loadScriptWithURL",value:function loadScriptWithURL(e){var _this259=this;return new Promise(function(t,i){var r=document.createElement("script");_this259.completeCallbacks.push(function(){r.onerror=null,r.onload=null,r.remove()}),r.charset="utf-8",r.src=e,r.onload=function(){t()},r.onerror=function(n){var s=n&&(n.type==="load"?"missing":n.type);i(new Error("fetch ".concat(JSON.stringify(e)," failed: ").concat(s)))},document.head.appendChild(r)})}},{key:"startTimeout",value:function startTimeout(e){var _this260=this;var t=null;return this.completeCallbacks.push(function(){t!==null&&(clearTimeout(t),t=null)}),new Promise(function(i,r){t=setTimeout(function(){t=null,r(new Error("fetch ".concat(_this260.params.identifier," timeout")))},e)})}}]);return UI}();function mb(e){return new VI(e)}var VI=/*#__PURE__*/function(){function VI(e){var _this261=this;_classCallCheck(this,VI);this.modulesMap={},this.taskPromises={},this.onInterruptFreeModules=function(i,r){_this261.modulesMap[i]||(_this261.modulesMap[i]=r)};var t={libName:e.libName,dependencies:e.dependencies};DI(t,this.onInterruptFreeModules),this.origin=e.origin,this.findPath=e.findPath,this.timeout=e.timeout,this.storage=e.cache?new pb(!!e.storeBase64,e.origin,e.findPath):void 0}_createClass(VI,[{key:"require",value:function(){var _require=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee81(e,t){var _this262=this;var i,n,r;return regeneratorRuntime.wrap(function _callee81$(_context83){while(1){switch(_context83.prev=_context83.next){case 0:i=this.modulesMap[e];if(i){_context83.next=7;break}n=this.taskPromises[e];n===void 0&&(n=this.taskPromises[e]=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee80(){var s,_yield$Promise$all9,_yield$Promise$all10,o;return regeneratorRuntime.wrap(function _callee80$(_context82){while(1){switch(_context82.prev=_context82.next){case 0:_context82.prev=0;s={identifier:e,origin:_this262.origin,findPath:_this262.findPath,timeout:_this262.timeout,storage:_this262.storage};_context82.next=4;return Promise.all([LI(e),new UI(s).load()]);case 4:_yield$Promise$all9=_context82.sent;_yield$Promise$all10=_slicedToArray(_yield$Promise$all9,1);o=_yield$Promise$all10[0];return _context82.abrupt("return",o);case 8:_context82.prev=8;delete _this262.taskPromises[e];return _context82.finish(8);case 11:case"end":return _context82.stop();}}},_callee80,null,[[0,,8,11]])}))());_context83.next=6;return n;case 6:i=this.modulesMap[e]=_context83.sent;case 7:r=i[t];if(r){_context83.next=10;break}throw new Error("can't find module ".concat(JSON.stringify(t)," from ").concat(e));case 10:return _context83.abrupt("return",r);case 11:case"end":return _context83.stop();}}},_callee81,this)}));function require(_x144,_x145){return _require.apply(this,arguments)}return require}()}]);return VI}();var ee=tu(C);function tu(e){if(_typeof(e)!="object"||e===null)return e;if(e.constructor===Object){var t={};for(var i in e){t[i]=tu(e[i])}return Object.freeze(t)}else if(Array.isArray(e)){var _t16=[];for(var _i46=0;_i46<e.length;++_i46){_t16[_i46]=tu(e[_i46])}return Object.freeze(_t16)}else return e}var Rr;(function(r){r.DisableCache="disableCache",r.StoreAsBlob="storeAsBlob",r.StoreAsBase64="storeAsBase64"})(Rr||(Rr={}));var pl=Rr.StoreAsBase64,ml=null;function bb(e){if(pl===void 0)throw new Error("cannot set async module load mode after joined or replay any room");pl=e}function vb(_x146){return _vb.apply(this,arguments)}function _vb(){_vb=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee118(e){var t;return regeneratorRuntime.wrap(function _callee118$(_context122){while(1){switch(_context122.prev=_context122.next){case 0:ml||(ml=_I(pl),pl=void 0);_context122.next=3;return Promise.all([ml.require(e,"white-model"),ml.require(e,"white-render")]);case 3:t=_context122.sent;return _context122.abrupt("return",Object.freeze({WhiteModel:t[0],WhiteRender:t[1]}));case 5:case"end":return _context122.stop();}}},_callee118)}));return _vb.apply(this,arguments)}function _I(e){var t,i;switch(e){case Rr.DisableCache:{t=!1,i=!1;break}case Rr.StoreAsBlob:{t=!0,i=!1;break}case Rr.StoreAsBase64:{t=!0,i=!0;break}}return mb({libName:ee.modules.identifier,timeout:2*60*1e3,cache:t,storeBase64:i,origin:ee.modules.origin,findPath:function findPath(r){return"/dynamic-libraries/".concat(r,".js")},dependencies:{akko:ph,boundless:zh,mobx:WI,"mobx-react":HI,react:fb["default"],"netless-ppt":Jd,"url-parse":gb["default"],"textarea-caret-ts":yb["default"]}})}function Sb(e){var t=document.createElement("style"),i=document.createTextNode(e);t.appendChild(i),document.head.appendChild(t)}var wb=".netless-whiteboard div.highlight-box{border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>*.cursor-nwse{cursor:nwse-resize}.netless-whiteboard div.editor-box>*.cursor-nesw{cursor:nesw-resize}.netless-whiteboard div.editor-box>*.cursor-ns{cursor:ns-resize}.netless-whiteboard div.editor-box>*.cursor-ew{cursor:ew-resize}.netless-whiteboard div.editor-box{pointer-events:none;border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>.lock{pointer-events:none;position:absolute;width:22px;height:22px;top:-11px;left:-11px}.netless-whiteboard div.editor-box>div.operation-point-desktop{width:7px;height:7px;position:absolute;pointer-events:auto}.netless-whiteboard div.editor-box>div.operation-point-touch{width:33px;height:33px;position:absolute;pointer-events:auto;display:flex;align-items:center;justify-content:center}.netless-whiteboard div.editor-box>div.operation-point-touch>*{pointer-events:none;width:7px;height:7px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-top{left:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-top{right:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-bottom{left:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-bottom{right:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.top{top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right{right:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.bottom{bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left{left:-4px}.netless-whiteboard div.editor-box>.operation-point-touch.left-top{left:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-top{right:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left-bottom{left:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-bottom{right:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.top{top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right{right:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.bottom{bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left{left:-17px}.netless-whiteboard div.editor-box-others{border:1px solid}.netless-whiteboard textarea{-webkit-appearance:none;-webkit-user-select:text;-moz-user-select:text;user-select:text;padding:0;margin:0;outline:none;border:none;resize:none;overflow:hidden}.netless-whiteboard .textarea-border{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed}.netless-whiteboard .textarea-border>*{position:absolute;pointer-events:auto}.netless-whiteboard .textarea-layout{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed;border-style:solid;border-color:#0000}.netless-whiteboard .textarea-layout>*{position:absolute;pointer-events:auto}.netless-whiteboard textarea.readonly-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.editable-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.my-textarea{pointer-events:auto}.netless-whiteboard div.float-bar{display:flex;flex-direction:row;align-items:center;background:#ffffff;border:1px solid #EFEFEF;box-shadow:0 6px 12px #0000001f;border-radius:4px}.netless-whiteboard div.float-bar div,.netless-whiteboard div.float-bar input{pointer-events:auto}.netless-whiteboard div.float-bar img{pointer-events:none}.netless-whiteboard div.float-bar .button{display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar .button:hover{background:#EEF0F6}.netless-whiteboard div.float-bar .button.disable{opacity:.5;cursor:not-allowed;background:transparent}.netless-whiteboard div.float-bar>.decorator{height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar>.normal-button{width:40px;height:40px}.netless-whiteboard div.float-bar>.highlight-button{background:#EEF0F6}.netless-whiteboard div.float-bar img.font-size-icon{width:16px;height:16px;margin-left:12px}.netless-whiteboard div.float-bar>input.font-size-input::-webkit-outer-spin-button,.netless-whiteboard div.float-bar>input.font-size-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.netless-whiteboard div.float-bar>input.middle:focus,.netless-whiteboard div.float-bar>input:focus{outline-width:0}.netless-whiteboard div.float-bar>input.font-size-input{-moz-appearance:textfield;width:29px;height:20px;margin-left:10px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#212324;line-height:14px;border-radius:2px;border:1px solid #e7e7e7;text-align:center}.netless-whiteboard div.float-bar div.font-size-buttons{display:flex;flex-direction:column;flex-wrap:none;justify-content:space-between;align-items:stretch;margin-left:5px;margin-right:7px}.netless-whiteboard div.float-bar div.font-size-buttons>div.arrow-button{display:flex;flex-direction:column;flex-wrap:none;justify-content:center;align-items:center;width:16px;height:8px}.netless-whiteboard div.float-bar div.font-size-buttons>div.arrow-button>img{width:6px;height:3px}.netless-whiteboard div.float-bar div.font-size-menu{position:absolute;display:flex;flex-direction:column;justify-content:center;align-items:stretch;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-size-menu>div.hover{background:#e7e7e7}.netless-whiteboard div.float-bar div.font-size-menu>div.cell{display:flex;flex-direction:row;justify-content:center;align-items:center;width:64px;height:24px}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>span{padding-left:4px;padding-right:4px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#000}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>.check{width:8px;height:8px}.netless-whiteboard div.float-bar div.font-colors-icon{position:relative;width:16px;height:16px}.netless-whiteboard div.float-bar div.font-colors-icon>img{position:absolute;top:0;left:0;width:16px;height:16px;z-index:1}.netless-whiteboard div.float-bar div.font-colors-icon>div.bar{position:absolute;left:2px;right:2px;top:12.5px;height:1.5px;z-index:2}.netless-whiteboard div.float-bar div.font-colors-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:8px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-selected{border-color:#a7a7a7}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-not-selected{border-color:#fff}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button{display:flex;justify-content:center;align-items:center;cursor:pointer;margin:4px;width:20px;height:20px;border-radius:50%;border-width:1px;border-style:solid}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button>.core{width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,.12)}.netless-whiteboard div.float-bar div.image-layer-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:4px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.image-layer-menu>.normal-button{width:32px;height:32px}.netless-whiteboard *{-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}.cursor-selector .ppt-event-source{cursor:pointer;pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.cursor-clicker .ppt-event-source{pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.netless-whiteboard{text-align:start}.netless-whiteboard *{box-sizing:border-box}.netless-whiteboard *>svg{text-align:start}.netless-ppt-last-run:after{content:attr(data-last-word);margin-left:var(--data-last-word-indent);display:inline-block;width:0}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar{width:12px;height:6px}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-track{border-radius:3px;background:rgba(0,0,0,.06);-webkit-box-shadow:inset 0 0 5px rgba(0,0,0,.08);box-shadow:inset 0 0 5px #00000014}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-thumb{border-radius:3px;background:rgba(0,0,0,.12);-webkit-box-shadow:inset 0 0 10px rgba(0,0,0,.2);box-shadow:inset 0 0 10px #0003}.ppt-preview-main-container{border:1px solid #222}.ppt-preview-show-note-svg{width:40px;height:40px}.ppt-preview-show-sidebar-svg{width:40px;height:40px}.ppt-preview-controls{height:40px;width:100%}.ppt-preview-controls-button{margin:0 2px}.ppt-preview-sidebar{border-left:1px solid #ccc;background-color:#eee}.ppt-preview-sidebar-item{margin:14px 14px 16px}.ppt-preview-sidebar-span{font-size:10pt;text-align:center}.ppt-preview-note{background-color:#eee}.ppt-preview-animation-svg{width:20px;height:20px}.ppt-preview-controls-page{float:right;line-height:16px;font-size:16px;padding:0;margin:0}\n";Sb(wb);var tc=x(require("mobx"));var Ov=x(require("detect-it")),ec=x(require("react"));var kb=x(require("mobx")),iu=x(require("mobx"));var dn=/*#__PURE__*/function(){function dn(e){_classCallCheck(this,dn);this.onChanged=null,this.atoms=[],this.observers={},this.id=e}_createClass(dn,[{key:"addObservedAtom",value:function addObservedAtom(e,t){this.observers&&this.atoms&&(this.observers[e.identifier]=e,this.atoms.push(t))}},{key:"takeObservers",value:function takeObservers(){var e=this.observers;return this.observers=null,e}},{key:"replay",value:function replay(){if(this.atoms){var _iterator239=_createForOfIteratorHelper(this.atoms),_step239;try{for(_iterator239.s();!(_step239=_iterator239.n()).done;){var e=_step239.value;e.reportObserved()}}catch(err){_iterator239.e(err)}finally{_iterator239.f()}}}},{key:"reportChanged",value:function reportChanged(){if(this.atoms){var e=this.onChanged;this.atoms=null,this.observers=null,this.onChanged=null,e==null||e()}}}],[{key:"collectObservations",value:function collectObservations(e,t){var i=new dn("".concat(dn.nextId));dn.nextId+=1,dn.hub=i;try{return e()}finally{dn.hub=null;try{t(i)}catch(r){console.error(r)}}}},{key:"observedHub",value:function observedHub(){return dn.hub}}]);return dn}(),fl=dn;fl.nextId=0;var GI=/*#__PURE__*/function(){function GI(e,t){_classCallCheck(this,GI);this.atoms={},this.keysHubs={},this.iterationAtom=null,this.iterationHubs=null,this.identifier=e,this.debugName=t}_createClass(GI,[{key:"releaseHubs",value:function releaseHubs(){for(var e in this.keysHubs){delete this.keysHubs[e]}this.iterationHubs=null}},{key:"reportChanged",value:function reportChanged(e,t,i){this.reportAtomChanged(e,i),this.disposeHubs(e)}},{key:"reportAtomChanged",value:function reportAtomChanged(e,t){var i=this.atoms[e];if(i&&i.reportChanged(),this.iterationAtom)switch(t){case j.Removed:case j.Inserted:{this.iterationAtom.reportChanged();break}}i&&t===j.Removed&&delete this.atoms[e]}},{key:"disposeHubs",value:function disposeHubs(e){for(var i in this.iterationHubs){this.iterationHubs[i].reportChanged()}this.iterationHubs=null;var t=this.keysHubs[e];if(t){for(var _i47 in t){t[_i47].reportChanged()}delete this.keysHubs[e]}}},{key:"reportObservedIteration",value:function reportObservedIteration(){var e=this.iterationAtom;e||(e=this.iterationAtom=(0,iu.createAtom)(this.debugName)),e.reportObserved();var t=fl.observedHub();if(t){var i=this.iterationHubs;i||(i=this.iterationHubs={}),i[t.id]||(i[t.id]=t,t.addObservedAtom(this,e))}}},{key:"reportObservedKey",value:function reportObservedKey(e){var t=this.atoms[e];t||(t=this.atoms[e]=(0,iu.createAtom)(this.debugName)),t.reportObserved();var i=fl.observedHub();if(i){var _r153=this.keysHubs[e];_r153||(_r153=this.keysHubs[e]={}),_r153[i.id]||(_r153[i.id]=i,i.addObservedAtom(this,t))}}}]);return GI}(),KI=/*#__PURE__*/function(){function KI(){_classCallCheck(this,KI);this.observers={}}_createClass(KI,[{key:"addObserverHub",value:function addObserverHub(e){var t=e.takeObservers();for(var i in t){this.observers[i]=t[i]}}},{key:"clean",value:function clean(){for(var e in this.observers){this.observers[e].releaseHubs()}}}]);return KI}(),Cb=/*#__PURE__*/function(){function Cb(){_classCallCheck(this,Cb)}_createClass(Cb,[{key:"observeUpdate",value:function observeUpdate(e){(0,kb.runInAction)(e)}},{key:"create",value:function create(e,t){return new GI(e,t)}},{key:"createObserverCollection",value:function createObserverCollection(){return new KI}},{key:"collectObservations",value:function collectObservations(e,t){return fl.collectObservations(e,t)}}]);return Cb}();var ru=/*#__PURE__*/function(){function ru(){_classCallCheck(this,ru);this.listenerNodes=[]}_createClass(ru,[{key:"isOnline",get:function get(){return navigator.onLine}},{key:"addListener",value:function addListener(t){var i={origin:t,onOffline:function onOffline(){return t.onOffline()},onOnline:function onOnline(){return t.onOnline()}};this.listenerNodes.push(i),window.addEventListener("online",i.onOnline),window.addEventListener("offline",i.onOffline)}},{key:"removeListener",value:function removeListener(t){var i=this.listenerNodes.findIndex(function(r){return r.origin===t});if(i!==-1){var _this$listenerNodes$s=this.listenerNodes.splice(i,1),_this$listenerNodes$s2=_slicedToArray(_this$listenerNodes$s,1),_r154=_this$listenerNodes$s2[0];window.removeEventListener("online",_r154.onOnline),window.removeEventListener("offline",_r154.onOffline)}}}]);return ru}();var Ab=x(require("query-string"));var gl=new Oi({fetcher:window.fetch.bind(window),retryCount:2,retryLoopsCount:0,configmap:{api:{hosts:{"*":ee.shuntApiHosts}},"ppt-api":{hosts:{"*":ee.hosts.pptApi}}}});var yl=/*#__PURE__*/function(){function yl(){_classCallCheck(this,yl);this.map={}}_createClass(yl,[{key:"values",value:function values(t){return this.map[t]}},{key:"has",value:function has(t,i){var r=this.map[t];return r?r.indexOf(i)!==-1:!1}},{key:"put",value:function put(t,i){var r=this.map[t];r||(r=this.map[t]=[]),r.indexOf(i)===-1&&r.push(i)}},{key:"remove",value:function remove(t,i){if(t){if(!i)delete this.map[t];else{var _r155=this.map[t];if(_r155){var n=_r155.indexOf(i);n!==-1&&(_r155.splice(n,1),_r155.length===0&&delete this.map[t])}}}else for(var _r156 in this.map){delete this.map[_r156]}}}]);return yl}();var Yt=/*#__PURE__*/function(){function Yt(t){_classCallCheck(this,Yt);this.listeners=new yl;this.oncesListeners=new yl;if(t)for(var i in t){var _r157=t[i];_r157&&this.listeners.put(i,_r157)}}_createClass(Yt,[{key:"dispatch",value:function dispatch(t,i){var r=0;return r+=this.dispatchTo(t,this.listeners,i),r+=this.dispatchTo(t,this.oncesListeners,i),this.oncesListeners.remove(t),r}},{key:"dispatchTo",value:function dispatchTo(t,i,r){var n=i.values(t);if(n){var _iterator240=_createForOfIteratorHelper(n),_step240;try{for(_iterator240.s();!(_step240=_iterator240.n()).done;){var s=_step240.value;try{r(s)}catch(o){console.error(o)}}}catch(err){_iterator240.e(err)}finally{_iterator240.f()}return n.length}else return 0}},{key:"on",value:function on(t,i){this.listeners.put(t,i)}},{key:"once",value:function once(t,i){this.oncesListeners.put(t,i)}},{key:"off",value:function off(t,i){this.listeners.remove(t,i),this.oncesListeners.remove(t,i)}},{key:"forwardTo",value:function forwardTo(t,i){var r=function r(){for(var _len23=arguments.length,n=new Array(_len23),_key23=0;_key23<_len23;_key23++){n[_key23]=arguments[_key23]}i.dispatch(t,function(s){return s.apply(void 0,n)})};return this.on(t,r),r}}]);return Yt}();var Nt;(function(i){i.Mac="mac",i.Windows="windows"})(Nt||(Nt={}));var nu=Object.freeze({"delete":Object.freeze(["Backspace","Delete"]),lock:"Shift",undo:function undo(e,t){var i;switch(t){case Nt.Mac:return e.key==="z"&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!!((i=e.nativeEvent)==null?void 0:i.metaKey);case Nt.Windows:return e.kind==="KeyDown"&&e.key==="z"&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1;}},redo:function redo(e,t){var i;switch(t){case Nt.Mac:return e.key==="y"&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!!((i=e.nativeEvent)==null?void 0:i.metaKey);case Nt.Windows:return e.kind==="KeyDown"&&e.key==="y"&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1;}},copy:function copy(e,t){var i;switch(t){case Nt.Mac:return e.key==="c"&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!!((i=e.nativeEvent)==null?void 0:i.metaKey);case Nt.Windows:return e.kind==="KeyDown"&&e.key==="c"&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1;}},paste:function paste(e,t){var i;switch(t){case Nt.Mac:return e.key==="v"&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!!((i=e.nativeEvent)==null?void 0:i.metaKey);case Nt.Windows:return e.kind==="KeyDown"&&e.key==="v"&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1;}}}),su=/*#__PURE__*/function(){function su(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:nu;_classCallCheck(this,su);var i=[];for(var _r158 in t){var n=t[_r158];n&&i.push(Object.freeze({kind:_r158,checker:this.toHotKeyChecker(n)}))}this.nodes=Object.freeze(i)}_createClass(su,[{key:"checkHotKey",value:function checkHotKey(t){var i=this.getKeyboardKind();var _iterator241=_createForOfIteratorHelper(this.nodes),_step241;try{for(_iterator241.s();!(_step241=_iterator241.n()).done;){var _r159=_step241.value;if(_r159.checker(t,i))return _r159.kind}}catch(err){_iterator241.e(err)}finally{_iterator241.f()}}},{key:"getKeyboardKind",value:function getKeyboardKind(){return /^Mac/i.test(navigator.platform)?Nt.Mac:Nt.Windows}},{key:"toHotKeyChecker",value:function toHotKeyChecker(t){var i=t;if(typeof i!="function"&&(i instanceof Array||(i=[i]),i instanceof Array)){var _r160=Object.freeze(i.map(function(n){var s=n;return typeof s=="string"&&(s={key:s,altKey:null,ctrlKey:null,shiftKey:null}),Object.freeze(T({},s))}));i=function i(n){var _iterator242=_createForOfIteratorHelper(_r160),_step242;try{for(_iterator242.s();!(_step242=_iterator242.n()).done;){var s=_step242.value;if(s.key===n.key&&(s.altKey===null||s.altKey===n.altKey)&&(s.ctrlKey===null||s.ctrlKey===n.ctrlKey)&&(s.shiftKey===null||s.shiftKey===n.shiftKey))return!0}}catch(err){_iterator242.e(err)}finally{_iterator242.f()}return!1}}return i}}]);return su}();var qi=x(require("mobx"));var un=x(require("mobx"));function xb(e,t){return(0,un.isObservable)(e)?(0,un.has)(e,t):t in e}function Ib(e){return(0,un.isObservable)(e)?(0,un.keys)(e):Object.keys(e)}function Nr(e,t){if(_typeof(e)!=_typeof(t))return!1;if(_typeof(e)!="object"||e===null)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){var _iterator243=_createForOfIteratorHelper(Ib(e)),_step243;try{for(_iterator243.s();!(_step243=_iterator243.n()).done;){var i=_step243.value;if(xb(t,i)){if(!Nr(e[i],t[i]))return!1}else return!1}}catch(err){_iterator243.e(err)}finally{_iterator243.f()}var _iterator244=_createForOfIteratorHelper(Ib(t)),_step244;try{for(_iterator244.s();!(_step244=_iterator244.n()).done;){var _i48=_step244.value;if(!xb(e,_i48))return!1}}catch(err){_iterator244.e(err)}finally{_iterator244.f()}return!0}else if(e.constructor===Array){var _i49=e,_r161=t;if(_i49.length===_r161.length){for(var n=0;n<_i49.length;++n){if(!Nr(e[n],t[n]))return!1}}else return!1;return!0}else return!0}var yo=/*#__PURE__*/function(){function yo(_ref103){var _this263=this;var t=_ref103.disableMaskKey,i=_ref103.useMobXMode,r=_ref103.propertyGetters,n=_ref103.onStateChanged;_classCallCheck(this,yo);this.didStateReady=!1;this.updatedState={};this.activeUpdateKey=null;this.updateState=function(){var t=_this263.updatedState;_this263._state=_this263.patchState(t),_this263.updatedState={},_this263.onStateChanged&&_this263.onStateChanged(t)};this.disableActiveCallback=t,this.useMobXMode=i,this.updateLimiter=new ct(0,this.updateState),this.onStateChanged=n,this.disposers=this.createAutoRun(r),(0,qi.makeObservable)(this,{activeUpdate:qi.action,patchState:qi.action})}_createClass(yo,[{key:"state",get:function get(){return this._state}},{key:"release",value:function release(){var _iterator245=_createForOfIteratorHelper(this.disposers),_step245;try{for(_iterator245.s();!(_step245=_iterator245.n()).done;){var t=_step245.value;t()}}catch(err){_iterator245.e(err)}finally{_iterator245.f()}}},{key:"activeUpdate",value:function activeUpdate(t,i){try{this.activeUpdateKey=t;var _r162=i();return this._state=this.setState(t,_r162),this.onStateChanged&&!this.disableActiveCallback&&this.onStateChanged(_defineProperty({},t,_r162)),_r162}finally{this.activeUpdateKey=null}}},{key:"createAutoRun",value:function createAutoRun(t){var _this264=this;var i=[],r={fireImmediately:!0};var _loop22=function _loop22(n){var s=t[n],o=function o(a){if(!_this264.didStateReady)_this264.updatedState[n]=a;else{var c=n in _this264.updatedState?_this264.updatedState[n]:_this264._state[n];_this264.activeUpdateKey!==n&&!Nr(a,c)&&(_this264.updatedState[n]=a,_this264.updateLimiter.invoke())}};i.push((0,qi.reaction)(function(){return s()},o,r))};for(var n in t){_loop22(n)}return this._state=this.createState(this.updatedState),this.updatedState={},this.didStateReady=!0,i}},{key:"createState",value:function createState(t){return this.useMobXMode?(0,qi.observable)(t):Object.freeze(t)}},{key:"patchState",value:function patchState(t){if(this.useMobXMode){for(var i in t){this._state[i]=t[i]}return this._state}else return Object.freeze(T(T({},this._state),t))}},{key:"setState",value:function setState(t,i){return this.useMobXMode?(this._state[t]=i,this._state):Object.freeze(z(T({},this._state),_defineProperty({},t,i)))}}]);return yo}();function bo(e){switch(e){case Lt.Desktop:return 2.42;case Lt.Phone:return 2.42;case Lt.Pad:return 2.42;case Lt.TV:return 2.42;default:return 1;}}function bl(_x147){return _bl.apply(this,arguments)}function _bl(){_bl=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee119(e){var t,i,r,s,n;return regeneratorRuntime.wrap(function _callee119$(_context123){while(1){switch(_context123.prev=_context123.next){case 0:t=3,i=null,r=null;s=0;case 2:if(!(s<t)){_context123.next=19;break}_context123.prev=3;_context123.next=6;return fetch(e);case 6:i=_context123.sent;_context123.next=13;break;case 9:_context123.prev=9;_context123.t0=_context123["catch"](3);r=_context123.t0;return _context123.abrupt("continue",16);case 13:if(!(i.status===200)){_context123.next=15;break}return _context123.abrupt("break",19);case 15:throw new Error("fetch ".concat(JSON.stringify(e)," failed with status ").concat(i.status));case 16:++s;_context123.next=2;break;case 19:if(!r){_context123.next=21;break}throw r;case 21:_context123.next=23;return i.blob();case 23:n=_context123.sent;_context123.next=26;return XI(n);case 26:return _context123.abrupt("return",_context123.sent);case 27:case"end":return _context123.stop();}}},_callee119,null,[[3,9]])}));return _bl.apply(this,arguments)}function XI(_x148){return _XI.apply(this,arguments)}function _XI(){_XI=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee120(e){return regeneratorRuntime.wrap(function _callee120$(_context124){while(1){switch(_context124.prev=_context124.next){case 0:return _context124.abrupt("return",window.createImageBitmap?window.createImageBitmap(e):new Promise(function(t,i){var r=URL.createObjectURL(e),n=document.createElement("img");n.addEventListener("load",function(){URL.revokeObjectURL(n.src),t(n)}),n.src=r}));case 1:case"end":return _context124.stop();}}},_callee120)}));return _XI.apply(this,arguments)}var YI="https://sdk.netless.link/resource/mouse-cursor/easer-cursor.png",Pb=Object.freeze({x:8,y:18}),Mb=Object.freeze({width:26,height:26}),Tb=36,Eb=1,vl=/*#__PURE__*/function(){function vl(t){var _this265=this;_classCallCheck(this,vl);this.cursors=Object.freeze([]);bl(YI).then(function(i){var r=[];for(var n=0;n<Eb;++n){r[n]=null}for(var _n45=Eb;_n45<=Tb;++_n45){r[_n45]=_this265.createCursor(_n45,i)}_this265.cursors=Object.freeze(r)})["catch"](function(i){return t.error(i)})}_createClass(vl,[{key:"cursorStyle",value:function cursorStyle(t){var i=this.cursors[Math.min(Math.ceil(t),Tb)];if(i)return"url(".concat(i.url,") ").concat(i.centerX," ").concat(i.centerY,", auto")}},{key:"release",value:function release(){var _iterator246=_createForOfIteratorHelper(this.cursors),_step246;try{for(_iterator246.s();!(_step246=_iterator246.n()).done;){var t=_step246.value;t&&URL.revokeObjectURL(t.url)}}catch(err){_iterator246.e(err)}finally{_iterator246.f()}this.cursors=Object.freeze([])}},{key:"createCursor",value:function createCursor(t,i){var r=-t,n=-t,s=-Pb.x,o=-Pb.y,a=Number.MAX_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;a=Math.min(a,r),a=Math.min(a,s),c=Math.min(c,n),c=Math.min(c,o),h=Math.max(h,r)+2*t,h=Math.max(h,s)+2*Mb.width,d=Math.max(c,n)+2*t,d=Math.max(c,o)+2*Mb.height;var u=-a,p=-c,f=h-a,m=d-c;s+=u,o+=p;var g=document.createElement("canvas"),y=g.getContext("2d");return g.width=f,g.height=m,y.fillStyle="rgba(216,216,216,146)",y.beginPath(),y.ellipse(u,p,t,t,0,0,2*Math.PI),y.fill(),y.drawImage(i,s,o),Object.freeze({centerX:u,centerY:p,url:g.toDataURL("mycanvas")})}}]);return vl}();var QI=20,ou=/*#__PURE__*/function(){function ou(t){_classCallCheck(this,ou);this.stackMap=new Map;this.stackIndexMap=new Map;this.index=0;this.textareaExtraStep=0;this.execute=t.execute,this.onCanUndoStepsUpdate=t.onCanUndoStepsUpdate,this.onCanRedoStepsUpdate=t.onCanRedoStepsUpdate}_createClass(ou,[{key:"canUndoSteps",get:function get(){return this.stack.length-this.index+this.textareaExtraStep}},{key:"canRedoSteps",get:function get(){return this.index}},{key:"stack",get:function get(){var t=this.stackMap.get(this.currentScenePath);return t||(t=[],this.stackMap.set(this.currentScenePath,t)),t}},{key:"commit",value:function commit(t){var i=this.stack,r=this.canUndoSteps,n=this.canRedoSteps;for(i.splice(0,this.index,se(t)),this.index=0;i.length>QI;){i.pop()}var s=this.canUndoSteps,o=this.canRedoSteps;s!==r&&this.onCanUndoStepsUpdate(s),o!==n&&this.onCanRedoStepsUpdate(o)}},{key:"undo",value:function undo(){var t=this.stack[this.index];t&&(this.index+=1,this.textareaExtraStep=0,this.execute(t.undo),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"redo",value:function redo(){this.index>0&&(this.index-=1,this.textareaExtraStep=0,this.execute(this.stack[this.index].redo),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"setCurrentScenePath",value:function setCurrentScenePath(t){this.currentScenePath=t,this.index=this.stackIndexMap.get(this.currentScenePath)||0,this.textareaExtraStep=0,this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps)}},{key:"onTextareaUpdate",value:function onTextareaUpdate(t){this.textareaExtraStep=t?1:0,this.onCanUndoStepsUpdate(this.canUndoSteps)}}]);return ou}();var au=/*#__PURE__*/function(){function au(){_classCallCheck(this,au);this.creators={}}_createClass(au,[{key:"addTextareaRectGetter",value:function addTextareaRectGetter(t,i){this.creators[t]=i}},{key:"removeTextareaRectGetter",value:function removeTextareaRectGetter(t){delete this.creators[t]}},{key:"getTextareaSizeMap",value:function getTextareaSizeMap(t){var i={};for(var _r163 in this.creators){var n=this.creators[_r163](t);n&&(i[_r163]=n)}return i}}]);return au}();var pn=x(require("mobx")),lu=/*#__PURE__*/function(){function lu(){var _this266=this;_classCallCheck(this,lu);this.mainView=null;this._cameraState={centerX:0,centerY:0,scale:1,width:0,height:0};this.onSizeUpdated=function(t){(t.width!==_this266._cameraState.width||t.height!==_this266._cameraState.height)&&(_this266._cameraState=Object.freeze(T(T({},_this266._cameraState),t)))};this.onCameraUpdated=function(t){(t.centerX!==_this266._cameraState.centerX||t.centerY!==_this266._cameraState.centerY||t.scale!==_this266._cameraState.scale)&&(_this266._cameraState=Object.freeze(T(T({},_this266._cameraState),t)))};(0,pn.makeObservable)(this,{_cameraState:pn.observable,onSizeUpdated:pn.action,onCameraUpdated:pn.action})}_createClass(lu,[{key:"cameraState",get:function get(){return this._cameraState}},{key:"setupMainView",value:function setupMainView(t){this.releaseMainView(),this.mainView=t,t.callbacks.on("onSizeUpdated",this.onSizeUpdated),t.callbacks.on("onCameraUpdated",this.onCameraUpdated)}},{key:"releaseMainView",value:function releaseMainView(){this.mainView&&(this.mainView.callbacks.off("onSizeUpdated",this.onSizeUpdated),this.mainView.callbacks.off("onCameraUpdated",this.onCameraUpdated),this.mainView=null)}},{key:"dispose",value:function dispose(){this.releaseMainView()}}]);return lu}();var mn;(function(i){i.Dynamic="dynamic",i.Static="static"})(mn||(mn={}));var Sl;(function(i){i.Waiting="Waiting",i.Converting="Converting"})(Sl||(Sl={}));var wl;(function(n){n.Extracting="Extracting",n.Packaging="Packaging",n.GeneratingPreview="GeneratingPreview",n.MediaTranscode="MediaTranscode"})(wl||(wl={}));function Ob(e){return new vo(e)}var So=/*#__PURE__*/function(){function So(t){_classCallCheck(this,So);this.pptPromise=null;this.uuid=t.uuid,this.region=t.region||ee.defaultRegion,this.kind=t.kind,this.taskToken=t.taskToken,this.checkProgressInterval=t.checkProgressInterval||So.defaultCheckProgressInterval,this.checkProgressTimeout=t.checkProgressTimeout||So.defaultCheckProgressTimeout,this.callbacks=new Yt(t.callbacks)}_createClass(So,[{key:"checkUtilGet",value:function checkUtilGet(){var _this267=this;return this.pptPromise?this.pptPromise:(this.pptPromise=this.getPPTResult(),this.pptPromise.then(function(t){_this267.callbacks.dispatch("onTaskSuccess",function(i){return i(t)})})["catch"](function(t){_this267.callbacks.dispatch("onTaskFail",function(i){return i(t)})}),this.pptPromise)}},{key:"getPPTResult",value:function(){var _getPPTResult=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee82(){var _this268=this;var t,i,_loop23,_ret3;return regeneratorRuntime.wrap(function _callee82$(_context85){while(1){switch(_context85.prev=_context85.next){case 0:t=!1,i=Date.now();_loop23=/*#__PURE__*/regeneratorRuntime.mark(function _loop23(){var r,n,s,o;return regeneratorRuntime.wrap(function _loop23$(_context84){while(1){switch(_context84.prev=_context84.next){case 0:r=Date.now();_context84.next=3;return _this268.fetchProgress(_this268.uuid,_this268.kind,_this268.taskToken);case 3:n=_context84.sent;_context84.t0=n.status;_context84.next=_context84.t0==="Waiting"?7:_context84.t0==="Converting"?7:_context84.t0==="Finished"?9:_context84.t0==="Fail"?10:11;break;case 7:_this268.updateProgress(n);return _context84.abrupt("break",11);case 9:return _context84.abrupt("return",{v:(t||_this268.updateProgress(n),_this268.toPPT(n))});case 10:throw new Error(n.failedReason);case 11:s=r+_this268.checkProgressInterval;if(!(s>=i+_this268.checkProgressTimeout)){_context84.next=14;break}throw new Error("timeout");case 14:n.progress.convertedPercentage===100&&(t=!0);o=s-Date.now();_context84.t1=o>0;if(!_context84.t1){_context84.next=20;break}_context84.next=20;return new Promise(function(a){return setTimeout(a,o)});case 20:case"end":return _context84.stop();}}},_loop23)});case 2:return _context85.delegateYield(_loop23(),"t0",3);case 3:_ret3=_context85.t0;if(!(_typeof(_ret3)==="object")){_context85.next=6;break}return _context85.abrupt("return",_ret3.v);case 6:_context85.next=2;break;case 8:case"end":return _context85.stop();}}},_callee82)}));function getPPTResult(){return _getPPTResult.apply(this,arguments)}return getPPTResult}()},{key:"updateProgress",value:function updateProgress(t){var i=Object.freeze({status:t.status,currentStep:t.progress.currentStep,totalPageSize:t.progress.totalPageSize,convertedPageSize:t.progress.convertedPageSize,convertedPercentage:t.progress.convertedPercentage});this.callbacks.dispatch("onProgressUpdated",function(r){return r(i)})}},{key:"toPPT",value:function toPPT(t){var i=t.progress.convertedFileList,r=[],n=0,s=0;for(var o=0;o<i.length;++o){var a=i[o],c={name:"".concat(o+1),ppt:{src:a.conversionFileUrl,previewURL:a.preview,width:a.width,height:a.height}};n=Math.max(n,a.width),s=Math.max(s,a.height),r.push(c)}return{uuid:this.uuid,kind:this.kind,width:n,height:s,scenes:r}}},{key:"fetchProgress",value:function(){var _fetchProgress=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee83(t,i,r){var n,s,o,a;return regeneratorRuntime.wrap(function _callee83$(_context86){while(1){switch(_context86.prev=_context86.next){case 0:n="http://ppt-api/v5/services/conversion/tasks/".concat(t);s=(0,Ab.stringify)({type:i});_context86.next=4;return So.apiFetch(n+"?"+s,{method:"get",headers:{"content-type":"application/json",token:r,region:this.region}});case 4:o=_context86.sent;if(!(o.status!==200)){_context86.next=10;break}_context86.next=8;return o.json();case 8:a=_context86.sent;throw new Error(a.error.title);case 10:_context86.next=12;return o.json();case 12:return _context86.abrupt("return",_context86.sent);case 13:case"end":return _context86.stop();}}},_callee83,this)}));function fetchProgress(_x149,_x150,_x151){return _fetchProgress.apply(this,arguments)}return fetchProgress}()}]);return So}(),vo=So;vo.apiFetch=gl.fetch("api"),vo.defaultCheckProgressInterval=1500,vo.defaultCheckProgressTimeout=5*60*1e3;var cu=x(require("query-string"));var Zi=/*#__PURE__*/function(){function Zi(t){_classCallCheck(this,Zi);this.roomToken=t}_createClass(Zi,[{key:"convert",value:function(){var _convert=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee84(t){var i,r;return regeneratorRuntime.wrap(function _callee84$(_context87){while(1){switch(_context87.prev=_context87.next){case 0:_context87.next=2;return this.createPPTTask(t);case 2:i=_context87.sent;_context87.next=5;return this.checkUtilHasResult(i,t);case 5:r=_context87.sent;return _context87.abrupt("return",Zi.wrapPPTDescriptions(i,t.kind,r));case 7:case"end":return _context87.stop();}}},_callee84,this)}));function convert(_x152){return _convert.apply(this,arguments)}return convert}()},{key:"createPPTTask",value:function(){var _createPPTTask=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee85(t){var i,r,n,_yield$n$json,_yield$n$json$msg,s,o,a;return regeneratorRuntime.wrap(function _callee85$(_context88){while(1){switch(_context88.prev=_context88.next){case 0:i=Zi.prefix+"/services/conversion/tasks";r=(0,cu.stringify)({roomToken:this.roomToken});_context88.next=4;return fetch(i+"?"+r,{method:"post",headers:{"content-type":"application/json",Accept:"application/json"},body:JSON.stringify({sourceUrl:t.url,serviceType:Zi.convertPPTKindToServiceType(t.kind)})});case 4:n=_context88.sent;if(!(n.status!==200)){_context88.next=13;break}_context88.t0=Error;_context88.t1="failed to convert ".concat(JSON.stringify(t.url)," with status ").concat(n.status," message:");_context88.next=10;return n.text();case 10:_context88.t2=_context88.sent;_context88.t3=_context88.t1.concat.call(_context88.t1,_context88.t2);throw new _context88.t0(_context88.t3);case 13:_context88.next=15;return n.json();case 15:_yield$n$json=_context88.sent;_yield$n$json$msg=_yield$n$json.msg;s=_yield$n$json$msg.succeed;o=_yield$n$json$msg.reason;a=_yield$n$json$msg.taskUUID;if(s){_context88.next=22;break}throw new Error("create ppt task failed: "+o);case 22:return _context88.abrupt("return",a);case 23:case"end":return _context88.stop();}}},_callee85,this)}));function createPPTTask(_x153){return _createPPTTask.apply(this,arguments)}return createPPTTask}()},{key:"checkUtilHasResult",value:function(){var _checkUtilHasResult=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee86(t,i){var _this269=this;var r,n,s,o,_loop24,_ret4;return regeneratorRuntime.wrap(function _callee86$(_context90){while(1){switch(_context90.prev=_context90.next){case 0:r=!1,n=Date.now(),s=i.checkProgressInterval||Zi.defaultCheckProgressInterval,o=i.checkProgressTimeout||Zi.defaultCheckProgressTimeout;_loop24=/*#__PURE__*/regeneratorRuntime.mark(function _loop24(){var a,c,h,d,u,p,f;return regeneratorRuntime.wrap(function _loop24$(_context89){while(1){switch(_context89.prev=_context89.next){case 0:a=Date.now();_context89.next=3;return _this269.fetchProgress(t,i.kind);case 3:c=_context89.sent;_context89.t0=c.convertStatus;_context89.next=_context89.t0==="Finished"?7:_context89.t0==="Fail"?8:_context89.t0==="NotFound"?8:9;break;case 7:return _context89.abrupt("return",{v:(i.onProgressUpdated&&!r&&i.onProgressUpdated(1),c.convertedFileList.map(function(m){return{width:m.width,height:m.height,src:c.prefix+m.conversionFileUrl}}))});case 8:throw new Error("failed to convert ".concat(JSON.stringify(i.url),": ").concat(c.reason));case 9:h=c.totalPageSize,d=c.convertedPercentage,u=h===0?0:d/100,p=a+s;if(!(p>=n+o)){_context89.next=12;break}throw new Error("failed to convert ".concat(JSON.stringify(i.url),": timeout"));case 12:i.onProgressUpdated&&i.onProgressUpdated(u),u===1&&(r=!0);f=p-Date.now();_context89.t1=f>0;if(!_context89.t1){_context89.next=18;break}_context89.next=18;return new Promise(function(m){return setTimeout(m,f)});case 18:case"end":return _context89.stop();}}},_loop24)});case 2:return _context90.delegateYield(_loop24(),"t0",3);case 3:_ret4=_context90.t0;if(!(_typeof(_ret4)==="object")){_context90.next=6;break}return _context90.abrupt("return",_ret4.v);case 6:_context90.next=2;break;case 8:case"end":return _context90.stop();}}},_callee86)}));function checkUtilHasResult(_x154,_x155){return _checkUtilHasResult.apply(this,arguments)}return checkUtilHasResult}()},{key:"fetchProgress",value:function(){var _fetchProgress2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee87(t,i){var r,n,s;return regeneratorRuntime.wrap(function _callee87$(_context91){while(1){switch(_context91.prev=_context91.next){case 0:r="".concat(Zi.prefix,"/services/conversion/tasks/").concat(t,"/progress");n=(0,cu.stringify)({roomToken:this.roomToken,serviceType:Zi.convertPPTKindToServiceType(i)});_context91.next=4;return fetch(r+"?"+n,{headers:{"content-type":"application/json",Accept:"application/json"}});case 4:s=_context91.sent;if(!(s.status!==200)){_context91.next=7;break}throw new Error("failed to fetch progress of ".concat(JSON.stringify(r)));case 7:_context91.next=9;return s.json();case 9:return _context91.abrupt("return",_context91.sent.msg.task);case 10:case"end":return _context91.stop();}}},_callee87,this)}));function fetchProgress(_x156,_x157){return _fetchProgress2.apply(this,arguments)}return fetchProgress}()}],[{key:"wrapPPTDescriptions",value:function wrapPPTDescriptions(t,i,r){var n=[],s=[],o=0,a=0;for(var c=0;c<r.length;++c){var _r$c=r[c],h=_r$c.src,d=_r$c.width,u=_r$c.height;n[c]=h,s[c]={name:"".concat(c+1),ppt:{src:h,width:d,height:u}},o=d,a=u}return{uuid:t,kind:i,width:o,height:a,slideURLs:n,scenes:s}}},{key:"convertPPTKindToServiceType",value:function convertPPTKindToServiceType(t){switch(t){case mn.Dynamic:return"dynamic_conversion";case mn.Static:return"static_conversion";default:throw new Error("invalid kind ".concat(JSON.stringify(t)));}}}]);return Zi}(),us=Zi;us.prefix="https://console-api.netless.link",us.defaultCheckProgressInterval=1500,us.defaultCheckProgressTimeout=5*60*1e3;var Oo=x(require("react"));var Il=x(require("react")),Wb=x(require("mobx-react"));var Hb=x(require("mobx"));var yt=x(require("react"));var fe=x(require("react")),Rb=x(require("mobx-react"));var Ve={"arrow-down-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","bold-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",bold:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",check:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIG9wYWNpdHk9Ii4wMSIgZD0iTTAgMGg4djhIMHoiLz48cGF0aCBkPSJNNy4xMjUgMS40ODRoLS41NDZhLjI0OS4yNDkgMCAwIDAtLjE5Ni4wOTZMMy4xNjIgNS42NiAxLjYxNyAzLjcwM2EuMjUuMjUgMCAwIDAtLjE5Ni0uMDk1SC44NzVhLjA2Mi4wNjIgMCAwIDAtLjA1LjFsMi4xNCAyLjcxMmEuMjUuMjUgMCAwIDAgLjM5NCAwbDMuODE1LTQuODM2YS4wNjIuMDYyIDAgMCAwLS4wNDktLjF6Ii8+PC9zdmc+","delete":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDZ2NmEyIDIgMCAwIDEtMiAySDZhMiAyIDAgMCAxLTItMlY2aDBtMS0yYTIgMiAwIDAgMSAyLTJoMmEyIDIgMCAwIDEgMiAyaDBNMyA0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",duplicate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMSAySDZhMSAxIDAgMCAwLTEgMXY4YTEgMSAwIDAgMCAxIDFoNmExIDEgMCAwIDAgMS0xVjRoMGwtMi0yeiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTExIDJ2MWExIDEgMCAwIDAgMSAxaDFsLTItMnoiLz48cGF0aCBkPSJNOSAxNEg0YTEgMSAwIDAgMS0xLTFWNWgwIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L2c+PC9zdmc+","easer-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANKSURBVHgB1VTdS5NhFD/7iuXa8KNw7SK/IjBYo13soqvEITENtj9AwZiCOCTvQrNWF9rFFPGLrC1iF10Oiy68mBSUF2KB4YabhKKyTfFCc+3Lzb2ds72LsfbxCkZ04Mf7Puc5z/k95+M5AP+R8OAvCW9nZ6cyHo8/SSaTc4RQKKQ+S0JyxFtbW6va39//ZjKZmMbGRkar1TJOp5MhYtwXwBkQkgMROnyXIcmGw+FgYrHY00JkQm4cqYPCaDQ6ZrFY7i4sLPxhMDg4SJ8hTOOWRCJ5jf8npyUiEgE6eGy1Wk12u72gIZHJZDLr4eHhVnl5+YdsslL5pH1+JBIx22y2h9PT01BKpFIpLC4ufhKJRFpcxhEM6fmlSMLh8P35+XlOJCTBYBC2t7dr8fdctv+iRHjI4HK5LAMDA8BVFAoFyOVyH/6KIKsxCtVIgC188+Dg4CV2GJxGpqamYHR09AHklEWQY5d6K/gg67HD3huNRrlKpYLNzU3gIsPDw8Dn84fa29s/4zIK6Rol8xIhSUMikXB2dXXV4AHo6en5KhaLFcvLy0VJent7QaPRzKrV6le4DCEi2UTCnGgE1dXVj3Q6XY1er08drKiosK2urnbjnrFQQxBJU1PTC3y4kyxJGHEMWe2dTUSNIcLZVXl0dAStra3BiYmJOTqgVCqfu91uull3LhlFjbZv6urqiCTIElHaEsC2dq4QqXRlZeUePsrUDFtfX/eZzebbqL+GuIFks1js32OHRtHu7u5H3FMiahFViPNQYuZRO8oQVzY2NibJocFgYAKBgLuzs/M66hsQKuzELx0dHak9rKe3paXlFurrERdZEiGUGARkcAFxmSJAJ/aRkRGGnOKwdPn9/rG9vT0HXaC5uZnxer3+vr4+HdpeRVxClBWLJFuZqhF7gAjL0PGz8fFxvcfjSY0WevVUv5mZmQDWyog1/I52PyBdlxgUqUu+qMSQznVtW1ubBlP3dmlpicnA5/N5+vv770C6bhS9lEu6eHnWFP45NioJS5xxRLdNsrenKH5CusNOWH1BEeTRMTnI6MgZpYYeYhhOmS5eEX0mMhELPktGoBd/zCWSUkTAOs4QZqZ8JsokS8Kp8KWICtlwdv5P5BchBHaEIRURoQAAAABJRU5ErkJggg==","easer-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAgrSURBVHgB7ZprTBRXFIDP7gIt8lQppTwE5V0KaAn6o1pqNGkDDTEmTUhsgKRp+gNJw68CFkLbVC2QkDS+gD8KJdWmARvbFBNNWpuIRGPFWBXQRMPDqIki+KLATs+ZnTvcvXtnX8w2beJJToaduTP3fHPOPffcOwC8kP+2WCDwIvahGFxTuN8KmNSZmULPNjLeqF9F8rdPkIEGEn+r+vjx46LQ0NA8/Dsader58+e/h4WFDWntFO7ot6fMFAt3JLWi2lCDpqamCux2+2+KROj82NhYGrXT2lu5Z/DP/deFByElA4Pv3LlTiHY/nJ6eVnbv3q1s2bJFyc7OVrZu3arU1dUp4+PjxPUQoT+g9tp9PkMFgpo9kxljHRoaWp2Xl3duYmIiurKyEvDoclNCQgIcPnxYPc7MzHwcGRnZhaft4Ag7O9fUbRhaITCie4lgcnNzT7qDIaHz27dvh+vXr0NEREQneqoCHKFnAR+8ZCaQGGq2CxcurCGYycnJZHcwTNAzUFFRoUJFRUV1IFQ5OKBsXB9uxSwgl0TQ3d29Yt26dccwoyVXV1d7hGEiQmGi2AzOUHx/hob4K2yuYS9G987s7OwPISEh7xPM6dOnwVfBsIMjR45AZmbmo5s3b76Xnp7+J55egMVxBSAZT0v1ED+76yn66dOnLQSzd+9ev2BIyFP0MjBco1JTU/sxfFeDazp3cYgZHmKqdoaGNISHh9fv378fSJcqlPV6e3sBJ+I/goOD34VFL0k95Y+HxPHCYGxmw5DQ2NuzZw8EBQVtunXr1jvgwUP+hhz/QDXMMCNVE8zx48dNg2FCz6QQjI2N/RA8VBFmANnu3btXihnpG8pM9fX1EAi5du0aeWkVOAMBCF7yN+R0z4yOjq6NiYlpp9CgdBtIwXpPH6vgDKWLt0CygtM6MDCwBuUYZSKaOCksAiVY9wFOBePgDOOytPAGSKzNVCCC2bBhw69YdK7ypgpYimzbtk2dl7CM+hFcveOUHDylbTFO1YdhFbByx44dA1QFUP0VSJj4+Hjo6+sDq9U6iEmHKvFZTedQ50GYbN15SITVlwNlZWUnLRZL8s6dOwMOQ9UCTtKTra2ttdppt9V2kMF5cbmsjxuM43bMNrmUzc6fP6+GQiDGDoOJi4ubwb4qm5ubafyIE6nLxGqTPEsGo1cBOGNX0TyDYafC0CyOaxcVziyh53Z2dkJycvLMvn37PmpoaBgFR4jxYSbWdVIgI89Iq4CjR48CZjlYv369+tssqI6ODsjPz4f+/v668vLycxrEHHfkYdwC8SB6mGEV8Cl64cuuri5oa2tTG+EyGjZu3AiXLl1qefDgwV8lJSUFZkDV1tZCcXExXLx4sbWoqKgPFj0zx8GI9ZwO5W4M6ekZYeqpaqbqmaSqqkpNpcPDw4dwzfM9nrLduHEjEs+X0XV/Sx96LnqE1kLtBQUF3eDwCO8dGQyzV5rl+JyuegfXI29jRotiRlKnpFghHMzKyjqotVXS0tLacKPjF3bdHxjSq1evduAkepAD+ZsDYlC8V5w8ZBVg+PPq2MGMlkInqE4joTf45MmT4YyMjAPcA+ltLSQlJX2BafxnX6HI29QeK44TOTk57mCYZ0QoJ8OBM4yB6dkNkwGlSygsLFQvYtYB3BTMxFL+M+0eFgZqp4mJiU2+QKGX1fGIk/QIrn0aYXGsyDxjmAyMhO2jhaCGoUbX1NSkLSwsPMJqV8Fspu6lIZS6OYhjiOLwdU7fQM1HfRPD7wS1obZ0j0xpb4726Z49ezaJf2/S7s9ATUGNR41BjdJseRnke3WGwhrRTS9pD1mOGoeG15BxOOfoxuCkp0Ih6NeaEaSZGlieJyiCoc1FgsGldokGk8nBvAKOrWIGQ5uPsm0tt0BWDiicAaGuGhkZ+YqMw9StGzU4OKhCnT179hNsswY1FTXdE5QEJhc1S3tGogazXLOBwQSBl3tzIhQPtAL1VQJCTcNx8y1vHIUghSKFZE9PT7H2dlM1b+Wgrr1y5Uq77J75+fnplpaWMg2ch4nlYEI5z7hdensDpI4hrYNErcMMXJ32koG4ztf3pultz83NjWG99Ra2WQ0OL2VjZjwgeufUqVOqV8+cOdPIwdBLSNJeHg8TAh5WqJ6EfSmgt7IMNRJ1JThiOlnrOAMHshprmMKdoGSCpb9s3B3SYLIFGIqICJB7xisYi+RvfiypXw40DWGdlJaWRmMd141hk8V2OWm7ieYTXhBc3+BgaZyqAISjOYxSMVvXsBTNlzdiNQDgRao2AtK3pjggpmrqbGpqSsLPIN/dv38/gaBwUjTshMHcvn27JyUlpRmc5xpPMD599LIYnLNyUKKndKjGxsakXbt2deMCLIE8IVvs0YRM1fjdu3d/wrXN5+BcnzEgvor2uN3rjzAYMp5lPEoQlE5fA0fWo8GfhlCbKVFQ1pKNIfzcOHH58mWqaimVUwJI0+6n59D4pIlzmdZPMPiZzXjDjX47Le5g0Uu8x2zgPqWyKpjVe7x3+AUbq9NYjQbgp2dsBud5o8TP7d5kHAWcQchQfoEmLgn8HjOiBIF7o5hI1x6CEbLNP3bdqYAF44JzyWLzcN1i8DcT/o3awbm8Fz3DAy2A62INwPV/E3wWdx5inmBHuwChCBD6R2JwHge80TIQRQLjt7e8DTkGZgfX8cUMZTDAteFDkveaIlzjX9ySQs8X18r2t2VHUURPKoICmDR+eCO9aSdmOIub3/w9RgpgUpiJhvraXpa6jZKHGEqyusw0GLFzX+5RhN/8kYnMSNMMfyH/V/kHST6OYVElTPAAAAAASUVORK5CYII=","font-colors-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-colors":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-size-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","font-size":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","hand-grasp":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTExLjcyIDE0LjM0NEg0Ljk3OGMtLjUxMyAwLS45MzEtLjQ3My0uOTMxLTEuMDU1IDAtLjQ0Mi0uMS0uNzQ0LS4zMzQtMS4wMUwuNDQ2IDguNzQxLjQ0NCA4Ljc0QTEuNzkgMS43OSAwIDAgMSAwIDcuNTU0VjQuODc4QzAgMy45OC42NDUgMy4yNSAxLjQzNyAzLjI1Yy4zOTQgMCAuNzU5LjE3NiAxLjAyOC40OTUuMDkyLjExLjE3LjIzMS4yMzIuMzYzVjIuMjAyYzAtLjg5OC42NDUtMS42MjggMS40MzctMS42MjguNTcgMCAxLjA1NC4zNjcgMS4yODcuOTEzLjA1OC0uMzYuMjEtLjY5Mi40NDMtLjk1NUExLjUwNiAxLjUwNiAwIDAgMSA3IDBhLjguOCAwIDAgMSAuMTc0LjAxNWMuNjMyLjA4IDEuMTQyLjU3OSAxLjM0MSAxLjI1LjItLjYyNi43My0xLjA3NCAxLjM1LTEuMDc0LjEgMCAuMTkzLjAxMy4yOC4wMjdsLjAxNS4wMDNjLjY2Mi4xNTYgMS4xNDMuODQzIDEuMTQzIDEuNjM1di4zM2MuMjQ0LS41MDQuNzE3LS44NDggMS4yNi0uODQ4LjM5NCAwIC43NTkuMTc2IDEuMDI4LjQ5NC4yNjQuMzEyLjQwOS43MjguNDA5IDEuMTd2Mi45NGMwIC4zNTItLjAzOC42ODYtLjExNC45OTNsLTEuMTM4IDUuMjEtLjAwMS4wMDRhMy41MyAzLjUzIDAgMCAwLS4wOTYuODQxdi4yOTljMCAuNTgyLS40MTcgMS4wNTUtLjkzIDEuMDU1eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Im0xLjAyNCA4LjM5OSAzLjE1MiAzLjQxMi4wMDIuMDAyYy4zMi4zNjMuNDY4LjguNDY4IDEuMzc0IDAgLjI0OC4xODUuNDU3LjQwNC40NTdoNi41MDdjLjIxOCAwIC40MDMtLjIxLjQwMy0uNDU3VjEyLjljMC0uMzQuMDM3LS42NjIuMTEtLjk1OWwxLjA5OC01LjAyNlY2LjkxYTMuMzcgMy4zNyAwIDAgMCAuMDkzLS44MTJWMy4yNjJjMC0uNTg2LS4zOTEtMS4wNDUtLjg5MS0xLjA0NS0uNDkyIDAtLjg5MS40NTMtLjg5MSAxLjAxdi42NWgtLjgyVjIuMTU1YzAtLjQ5Ni0uMjk1LS45MjYtLjcwMS0xLjAyNS0uMDY2LS4wMS0uMTMtLjAyLS4xOTEtLjAyLS40OTEgMC0uODkxLjQ1My0uODkxIDEuMDF2MS43NTdoLS44MlYyLjE5YzAtLjY1MS0uNDA4LTEuMTktLjk0OC0xLjI1NEw3LjA5Ni45MzQgNy4wODUuOTMyYy0uMDI3LS4wMDYtLjA1LS4wMDYtLjA4My0uMDA2LS41ODEgMC0xLjA1NC41MzYtMS4wNTQgMS4xOTV2MS43NTZoLS44MlYyLjUyNGMwLS41ODYtLjM5Mi0xLjA0NC0uODkxLTEuMDQ0LS40OTIgMC0uODkyLjQ1My0uODkyIDEuMDF2NS41OTJsLS44Mi0uODcyVjUuMTA2YzAtLjU4Ni0uMzkxLTEuMDQ1LS44OS0xLjA0NS0uNDkzIDAtLjg5Mi40NTMtLjg5MiAxLjAxdjIuNTgzYzAgLjI3NC4xLjUzOC4yOC43NDV6IiBmaWxsPSIjRkZGIi8+PHBhdGggZD0iTTUuNTY2IDYuMDgydjQuNjM2YzAgLjE5LjIyMy4zNDQuNS4zNDQuMjc2IDAgLjUtLjE1NC41LS4zNDRWNi4wODJjMC0uMTktLjIyNC0uMzQ0LS41LS4zNDQtLjI3NyAwLS41LjE1NC0uNS4zNDR6bTIuMTggMHY0LjYzNmMwIC4xOS4yMjQuMzQ0LjUuMzQ0cy41LS4xNTQuNS0uMzQ0VjYuMDgyYzAtLjE5LS4yMjQtLjM0NC0uNS0uMzQ0cy0uNS4xNTQtLjUuMzQ0em0yLjE4IDB2NC42MzZjMCAuMTkuMjI0LjM0NC41LjM0NHMuNS0uMTU0LjUtLjM0NFY2LjA4MmMwLS4xOS0uMjI0LS4zNDQtLjUtLjM0NHMtLjUuMTU0LS41LjM0NHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","hand-loosen":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTkuMTU0IDBBMS4yMjYgMS4yMjYgMCAwIDAgOC4xMS42MDdjLS4yMDguMzQ4LS4yOTUuNzY4LS4zNDUgMS4yMzItLjEuOTI5LS4wMjUgMi4wNTgtLjAxNCAzLjA0Ni4wMDcuNTEyLjAwNCAxLjA0MS0uMDAxIDEuNTQ3YTYzLjMxIDYzLjMxIDAgMCAxLS4zNS0uOXYtLjAwM2wtLjAwMS0uMDAxYy0uMzU5LS45MjYtLjY5Mi0xLjg3LTEuMTUtMi41NjItLjIzLS4zNDYtLjQ5Ni0uNjQtLjg1LS44MDctLjM1Ni0uMTY2LS43OTItLjE2NS0xLjIwNC4wMmwtLjAwMy4wMDEtLjAwNC4wMDJjLS40LjE4Ny0uNjUuNTYzLS43MjIuOTU4LS4wNzQuMzk0LS4wMTkuODEyLjA4MiAxLjI2Mi4yMDMuOS42MTMgMS45NC44OTIgMi45Ny4yMi44MTMuNDM0IDEuNjMyLjYxMyAyLjMyMmExMy44NTUgMTMuODU1IDAgMCAwLS44NzQtLjgxNmMtLjU0My0uNDYyLTEuMTQtLjg4OS0xLjc1Ny0xLjExOS0uNjE2LS4yMy0xLjMyMy0uMjQ0LTEuODQ1LjIxOGwtLjAwNC4wMDQtLjAwNC4wMDRjLS40MS4zODQtLjYxNC44Ni0uNTYgMS4zMjMuMDUzLjQ2NC4zMDcuODcxLjY0MiAxLjI5LjY2OS44MzYgMS43MiAxLjc1MSAyLjczNCAyLjk2OCAxLjEzNSAxLjM2MiAyLjM3MiAzLjUzOCAzLjI1MSA0LjY4MWwuMTE4LjE1M2g3LjcwNGwuMDg2LS4yNzRjLjE1LS40ODIuMzE4LTEuNDQyLjU4Ny0yLjY0Mi4yNjgtMS4yLjYyNy0yLjYxIDEuMTA0LTMuODQ3LjYzNS0xLjY0NiAxLjI4NS0zLjE5NCAxLjU3Ny00LjQyMy4xNDctLjYxNC4yMTQtMS4xNTEuMDk1LTEuNjI2YTEuMzA2IDEuMzA2IDAgMCAwLTEuMDQ4LS45NmMtLjQ2Ny0uMDg4LS45MS4xMi0xLjIyLjQzNC0uMzEuMzE2LS41NDYuNzM2LS43NjUgMS4yMDctLjE3LjM2NS0uMzI3Ljc2NS0uNDgxIDEuMTY2bC0uMDEtMS43MzRjLS4wMDQtMS4wMDcuMDU5LTIuMTM2LS4wMTctMy4wNDQtLjAzOC0uNDU1LS4xMDMtLjg1NS0uMjcyLTEuMTkxLS4xNjUtLjMyNy0uNTI0LS42LS45MjUtLjU4NWExLjE4IDEuMTggMCAwIDAtLjk2OS40NmMtLjIyMy4yODUtLjM1NC42MzYtLjQ1OSAxLjAyMy0uMjEuNzczLS4zMDIgMS43MDktLjQ0MyAyLjQ4bC0uMTk1IDEuMDkyYTQ1Ljg3NCA0NS44NzQgMCAwIDEtLjEzNi0xLjE4N2MtLjA5NC0uOTM3LS4xNi0yLjA1NS0uMzU2LTIuOTctLjA5Ny0uNDU3LS4yMjItLjg2Ni0uNDM1LTEuMTk5LS4yMTQtLjMzMi0uNTgyLS41OTctMS4wMS0uNTc5aC4wM0w5LjE1NSAweiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik05LjE1Ljc4NGguMDQ5Yy4xMzItLjAwNS4xOTUuMDMuMzE3LjIyLjEyMy4xOTIuMjQxLjUyOC4zMjkuOTM5LjE3NS44Mi4yNDUgMS45MjQuMzQyIDIuODg0LjIxMiAyLjEwOC41MTQgMy42MzUuNTE0IDMuNjM1bC43Ny0uMDEzcy4yODctMS43NjMuNTk4LTMuNDYzYy4xNS0uODIuMjQ3LTEuNzQ2LjQyOS0yLjQxNy4wOS0uMzM1LjIwNy0uNi4zMTktLjc0My4xMTItLjE0Mi4xNjktLjE3NC4zMTktLjE2M2wuMDMuMDAyLjAyOC0uMDAyYy4xMi0uMDA5LjExNi0uMDEuMi4xNTYuMDg0LjE2Ny4xNTcuNDk1LjE5MS45MDMuMDY4LjgxNS4wMSAxLjk0Mi4wMTUgMi45ODNsLjAxOSAzLjcwNS43NDUuMTY4Yy40NTUtLjk0OC44MTktMi4xMTIgMS4yMjEtMi45NzguMjAxLS40MzMuNDE1LS43ODcuNjEzLS45ODguMTk3LS4yLjMyMy0uMjUuNTE2LS4yMTNoLjAwNGwuMDA1LjAwMmMuMjk5LjA1MS4zNi4xMjcuNDI0LjM3OC4wNjMuMjUuMDM1LjY5Ny0uMDk3IDEuMjU0LS4yNjUgMS4xMTUtLjkwNyAyLjY2NC0xLjU0NiA0LjMyMi0uNTAyIDEuMy0uODY2IDIuNzQtMS4xMzggMy45NTctLjIyLjk4My0uMzg3IDEuODM0LS40OTkgMi4zMDRINy4xNDRjLS44MDItMS4wOS0xLjk5Ny0zLjE2LTMuMTU3LTQuNTUyLTEuMDYtMS4yNzEtMi4xMzYtMi4yMi0yLjcyNC0yLjk1Ni0uMjk0LS4zNjgtLjQ1LS42NzMtLjQ3Ni0uODktLjAyNS0uMjE1LjAyNi0uMzg2LjMxMi0uNjU2LjI3LS4yMzcuNTgyLS4yNDMgMS4wNDktLjA2OS40NjcuMTc1IDEuMDE4LjU1MiAxLjUyNC45ODJhMTUuODggMTUuODggMCAwIDEgMS44NDcgMS45MDRsLjY4Ny0uMzRzLS41MDQtMi4wMS0xLjAxLTMuODcyQzQuOTAzIDYuMDggNC40OTQgNS4wMyA0LjMxNCA0LjIzYy0uMDktLjQtLjExNi0uNzMzLS4wNzctLjk0Ny4wNC0uMjEzLjA5Ny0uMzAyLjI4My0uMzkuMjQ4LS4xMS4zODgtLjA5OC41NDctLjAyNC4xNTkuMDc0LjM0NC4yNTEuNTI5LjUzLjM2OC41NTcuNzEgMS40NzYgMS4wNzMgMi40MTJsLS4wMDItLjAwNGMuMzcuOTgzIDEuMDc4IDIuNzE0IDEuMDc4IDIuNzE0bC43NTUtLjEzN3MuMDU1LTEuOTEuMDM2LTMuNTA5Yy0uMDEyLTEuMDE4LS4wNzgtMi4xMzYuMDEtMi45NTIuMDQzLS40MDguMTMxLS43MzUuMjM4LS45MTUuMTA3LS4xNzkuMTctLjIyNS4zNjctLjIyNHoiIGZpbGw9IiNGRkYiLz48cGF0aCBkPSJNNy43MjMgMTAuOHY0LjY5MmMwIC4xOTIuMjIzLjM0OC41LjM0OC4yNzYgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OC0uMjc3IDAtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OHMuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OHMtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OC4yNzcgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjIzLS4zNDgtLjUtLjM0OC0uMjc2IDAtLjUuMTU2LS41LjM0OHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","italic-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",italic:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","laser-pointer-cursor":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGZpbHRlciB4PSItMTIwJSIgeT0iLTEyMCUiIHdpZHRoPSIzNDAlIiBoZWlnaHQ9IjM0MCUiIGZpbHRlclVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgaWQ9ImEiPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQiIGluPSJTb3VyY2VHcmFwaGljIi8+PC9maWx0ZXI+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkgOSkiIGZpbGw9IiNGRjAxMDAiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PGNpcmNsZSBmaWx0ZXI9InVybCgjYSkiIGN4PSI1IiBjeT0iNSIgcj0iNSIvPjxwYXRoIGQ9Ik01IDhhMyAzIDAgMSAwIDAtNiAzIDMgMCAwIDAgMCA2em0wLTEuNzE0YTEuMjg2IDEuMjg2IDAgMSAxIDAtMi41NzIgMS4yODYgMS4yODYgMCAwIDEgMCAyLjU3MnoiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvZz48L3N2Zz4=","layer-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+",layer:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","line-through-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","line-through":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","lock-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM3RDdEN0QiLz48L2c+PC9zdmc+","lock-new-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM1QjkwOEUiLz48L2c+PC9zdmc+",lock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiLz48L3N2Zz4=","pencil-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJ2SURBVHgB7ZXPqxJRFMfvjI4F+cqkTcrjge9B+B+0LJQ27lq4ijZprly6DaF1COKPjYRrVy0CF/aof6Baa6ChOPkLFcdMm1+dM93RafzxZuptgnfgC3ecO+dzz497JOTKNsZMp9OAoihvZFku4xp/I5dsbL/fP221Wl/D4bCKwnWn0znDd+SSDE/N6ZBgMKjJBNuKzC4dHTgQ5PF4bququn7R7XZJPB4/kSTpHcBOiQlmJ6cMpCvAcdz5ZDJhF4tF1u12v4jFYkc8z683+f1+Uq1W38K+x/AogVQ7ETF4SnB+Ho1GTxKJxDFC2u32q1KpJPh8vvVGjHK5XM4xahv+tYgRcranJrNarfay2WwKoVBIRTUajW42m70P390EOYmFrOEGdhfECEMIwur1Og+p5VOp1CP47piCOB3EXBBJAIuLRcZi7zKsSaVSEbxe70N4FEEL0AyE6VuBZEJD2wmyAkHDmoxGIwGW36ljBP2gUEXf5/wXCDZBsVjky+XyUwpCyBL0k0ai7gNp3WUVUigUvgHoWSaTaRoi2YJojk1r52q1eh2JRJ5YgUB3Pc/n83WyXRPV/A1rWrtgSAZsQL6Q3ynTI1F2QdCMqXNQEGsDMqMgrMt6ChwCaXcGYdBFjA3InELkQxBCtkcEI4riHyPFCMnlcnEKMbYzQhRi0TCKa6A76XT6wWAweD8ejz8Oh8PPcEc+9Xq9D8lkMgLv74Hugo5ALmJzlumG4+IG6BZ1dJ06wtPqN14gmza2FYljD1SljrCTsAaYpjnZFP7CmpADEel/ai4qffLiqSUKFSlEP8xfgYwwlmzyr1KYHoUtgBU4Y9D/Y78AxCeE/aWoyrkAAAAASUVORK5CYII=","pencil-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAYISURBVHgB7ZpNSCtXFIBPEuvz+dMGpYUKD/sWFX+Qti6kK7Hqpm6e9q0rIoIUFUShPLV10VZx4+JZqa9v20LBhdq9fyBUCtKNPH8qYl2IOw3G38Rkek4y15y5uTOZJDOWggcOSSYzN/ebc+45554JwIM8iBCPyTEP+86T4vyMfsRN4b+nQTKIJp0vzuGvlpID7os8EQNEIBD4oKio6Bm9DwaDv/v9/n/076JgbtWUYPchwrW8qD7UnOvr6wFNkpubm+/wu7f0c7y6mrnlvQufxB0Iau7V1dX3BDA/P6/V1dVpzc3N2uLiIofK1c8VYHys/wRKBUN3/hGHqaysNOjc3FwMis6hc0FtLTHuvYLxCCZgci8uLn4wg5Gh6Fy8Jk+/NkcCAlAAuUkoW4g0B+d5tLS05O/r67O8eGxsDNra2uDy8nKsoKCAwCIQDxQa0yTxgrvCYXyTk5Ml+Orf2dlJeeHIyAigFSE/P38ELfUNqNdSkjgF5FF89jL1TU1NlQwODl5gZPujp6cHWltbUw7Koc7Pz8mkZpHPFeFrJuZeqLnoMoPoZqe0JjDP/IZgnyLUG/o8NDRkuo5Ua2pjY6MC4oFCFf1cA0oKzRSOp6enRfTaGh0d/QxBt+1CUVgnOTs7+xrHfQzGyOcKkK3QTJMnQffZ6e/v/xwttmsHqqmpKXbdycnJCxy7ABLh3FEgVZ6hZJhnFZoFFMF0d3c/w7v+dyookXBnZ2c/xvHfhriVcvXfdBRItsxjnOhYqjwjoAimq6vrCysoGofk+Ph4Esd/F/UdiFtJAGUd2DygTpp5dmBUUJ2dnc9VUALm8PDwJY7/BPU9VD8k3M4RC6kskxZMKigKIMLN9vf3p3H8DyWgfEhEOwOQD9IXOTz7EObbwsLC4YWFBRgeHrY9ECXYo6MjaGlpKWlsbPxkYGDgRW1tbSEWquVlZWXBzc3Nl1VVVa8hXiXc6ioqBqGaPDk7AACJTRZ3NS9lcUp86cJwoSQ7Pj4Op6enfxUXF3/V0NCQv7q6GsCvwrqGUG/01xAD4+VQTOxaSF43d5bBOisrGBJRCtXX17+/trb268rKSgASFgmz97KFkmo6OztWuVyPweiWGc4WRkhFRQVEIpHg8vJyQAIQVlLBROVxvBYQHsXnO8tk62ZcyN0wecLBwcEvYHSzEPscBqOLCRhLC4n9uqaA8UAWAcAKhtbQ3t7eTHl5+Y9gtAp3twhT056CDMQ7MRzIFTeTYKb1yYYVQFH9VdzsqNmYKpfTJBDX3Ixgdnd3XyHMT2AMALJlBBSPaMpNngrIsTyTCgaj288YDGakictrxizvKFNOjgSSBLS+vv6UYHDb7DgMVgsChjTEgCIKGG4ZU+EWkgNBzN1qamq+pAMTExPgFMzW1tZrhHkFyWE5KxgSszx0527RaDRmOSpRshEOU11dPQPG8CwHARHJlMnTSrwSRFIlfXt7m3V5ngJGuJtqzaQtZkFBVNJezN5ZAdmwjKo2k9tVtrcI3OXk4tPgcg7ChCDZ1URgMOu72Xa5VFHOkymQhWVU60YVmjN6wiC7k6p+S1syCACOwJBYFaexV+yhBekNPsMBO6KAEeE4BMaCU67RsoYhSbXgaT//ht709vZCaWmp6YkEbLFmVJWzas04+iBL7EKpm0J7duqu0B7+CTUpNJuyvb1NCfMj1CqI9wLKUOlOUMeG+gGFkHii4HizUF4z/KFUrPsJ8WbEIyx7nnZ0dDynME6BAuce09iFHo+GrnmGltltb2//E4wVAN82y7vOjKOZXSBhJdHNiT3TYWD8OY2PTUJkdd7MkJMnT5wZVQF2RFX6yBMUdzPMvvfqxz3sXHF+GNT9ANXit/10O1sgHkZvdQAOKvs9B5L7ARELGAAXLSTvM8QExTE+YbHe+HURhZp1aRyF4CJXClbbWwGketgkW9VsY+YaiBCVhfgE+XvxRwgZSM4jUVCDZFQ9pytmXR8hUTB2gnidx4XffVWydN0yQjwmx/jkAZJBrIBI5J7ZvQGZWUgVSuU/EqmOAzicKNMVu816DdRWUV1/7xAP8n+SfwF3Du3NF2sYhwAAAABJRU5ErkJggg==",rotate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEzIDZhNiA2IDAgMSAxLTMuNzA5IDEuMjgzIi8+PHBhdGggZD0ibTEzIDYgMS40MTQgMi40NUwxMyA2bDIuNDUtMS40MTQiLz48L2c+PC9zdmc+","selector-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKeSURBVHgB3VTLi1JhFD86zlQ4ysxSXAy1GWYZzMxmYAhHagRB/QN8FLqPFq4FIQhXkS6kTQ4t2ilIKEWgSS0SmVpIm0BdaBJSaOP78XU+PXey6+saburAD+73uL/feX0H4H81GQdj7D7ilrCGFRonk3c6nXvhcJiFQiGWy+Xy/X7/WbPZ1K1KkBOsl0qlO36/n+3t7Q1hs9kYF+WC3W73MTpxc1lBmej7KuJaoVDInZ6eqsWXDw4OwGKxwPHx8Se1Wn1Wr9cjW1tbOTxi9D9bJCJHXEFslsvlR263+246nYZZptPpQK/Xg8lkSvZ6vbNGo5EgQRCLiSPhIqpoNHobo3keCARgkalUKjg5ORlGuL+/n8T6PVAqlefjYmKRdYQSsZ3P5z8aDAYVLGFarRbi8fhbhUKhx2VPEJGP3eEbfTrs4MUwr4EU49FYrVbweDy1SqXyipy95FaI7g8QXS6SyWReHx4e2ubVBc+HtTk6OjqvVqtvvF7vi0gkUiSByyyJ21BGwpswJ2Vmsxlw/0Kj0bxMJBJJl8vFPWkhGogLQoeyMhEJo2jGUzYRjcPh+Op0Oq2pVOoHkXE0SahF/w+E+3KYNEaX2pSyiSiKxeJTFPiGyyriO6FKEUgSESLp4ht4bzQaf4pFYrHYO/ysEXGNyJtjKRqM/zNNhFuf0B7vst3dXdjZ2Yn4fL4vRFwn8jaMGqYPU179LBEGf3bZcNNutwPOtScwKnCLPJ9KLMWEh7mNuIFdVsNXzbBNP+D6Ou1vwAqm8hqMWlmbzWYf4mz6HAwGzbjWwGgqrEklmucJT+UGCfG3wiPjueeNwGvB0zkAid7OMmF8CyOck/I6NJcR4KZYcM6J2vCbUGhvyQIA0gonzCEZkQud9Fcd9W/bL57cJu3lkjuNAAAAAElFTkSuQmCC","selector-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAxCAYAAABznEEcAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAZoSURBVHgB7VlLSCRXFL3ljNEhEXTGhMQJmOjCz8ZNVLKICz9xIYhCNi7UgINkGEk2En8hW5cBUQNxo05GAoKikuCAmvGzGMdPcCUGjDPxD/4Vv/3JvWW97luvq7ur+hMZ8MKlqrteNfe8e965970GuLVbC5kpJr53+hjHx9yY3TUxJgLMAQG4ITARfp5T4Mri4uL9q6urnxwOxz/oY5eXl1/Pzs7e195X2FX4jZsIhAK7gx5ps9m6nGj9/f3OtbU1pzAE0318fPwVjYHrrN7R3AjU/wpOBwA9Cmf/9ejoqDMtLU31iooKGdA+ATo4OMiXAEWAHhBAGEApXj4rPAik0vPt7e0vCgoKPH4gMzMTSktLIS8vD2JiYgABvcHMTZyennbHxsaOg3udOJmLzwqEYB0ZgRCZENm4u7e39yQuLq65srISZmZmvP5Ybm4u5OfnQ0lJyXWUCAgzNLS+vt6SnJz8WgvYwV5xSlcRgyVg3ha2Dkxzc3MvfZmVlQW+bGxsDBobGyE7O1u94uJPjIqKqklKSvrbbrfPnp+ff7e8vJwMnlSTKWfJjDKhywJo6wLp0YcZ+dyIUr7s4cOHLsrRlQwBTSBFuzc2NiZYhjjVAIyzZBqEwgCQv0OOM/gNzuiP/ijlDxBRjgClpqa6AF1cXDydmpoaLCws3JcAGYHyC4JMzoKaibKysvienp6FtrY2IA/WCFB5ebkqCHSvARo8Ozt7igIxwIJ2gJ+seFMnDoIyEUV+dHT0G3qWVUr5M043DdAB0m2IKZwAYpgZX+qkywR6NFbuR0iDxmAoZRUQKRxSLTMnJ8eIaqqSeVMnIYUOdu+sq6vrp4f+VCoYo8khZaNs01VRlERUu2/BrWAA7sl2Anink1Ao18JGjyY/PDx8hq1GZqgp5c2mp6chMjLy2b179x7hRzvoqeUUwXIzqq4O5nZsNUaEbIbLqPLTou/s7FTvT05OpsA9sXJG1AVsZDwjutqBIN6gUlWjxod8XRBNKXgsrqpqYZfwEqX9h8TExD7wbFm8LmzxHQ0QHSlXKZVSqFC/hkqlaKapTaGgCQTK7PHW1lb/wsLC86KiokkccoV+qV1tcE0pO7AWxmhTxBszDzqRr66ujqanp2cRpQLNBgUsCh8BwQ54bn5+/s+mpqa+4eHhfS1gb52vwuP0trPjhSZCBtLQ0NA3MDDQQIFYAUHBYhuvzjpVbJr1lZWVP3p7e19UVVXNgHumXYrI4uBx6Yqevz02b0FcRQ8CoBQF3dXVpQLZ3d39C7n+ora29vfJyclDYFnWgFyxK3cxhss/+KoT/N6DVkQpKypFGUCp3Ozo6HgSHx//GLW/BwHsg57zl5pzADajwLn52mPL1ZHPloMoRYPMFL6EhAR18e7s7MxVV1fPsAAp4Avteq7dC/c1+wKI4g+EfGzDM+EYHBw8RDrNiA2QL6upqVGvKJ2/gHu2L1nA5wwEB2YDfSYMO1x/px0cgEc2zBY+eo67u6H29vZ/wU2VC8l58JxKNjDOgojNEp08aFVfX++3l6JMEdDx8fEB0FNIBsDXBc8ArwuW1EkeI1RKdLWmCx+1DhkZGRvR0dFfSsHKxYtnW0iqvJAN9xNm6MR/QO5sfapUSkqKmqW5ubmfwVgyZdpw/vPZl2kUEAinBMSUStG+gwra0NDQSynQKyloIxnlewafjDFLJzLRBJqiFMnqyMgIbG5uDuD996Dnv8iAPOMAPmbcm5lVJwA/vZRMKZGZlpaWVtAvUL4GZMqE1fjRJrUd76LHoX+InlhcXPwZnWW2tra6jjrpiBM3UK/weQr6J+gfodMh9HtwncG7YLA3CMSsLmxx5WuDCt8B7vZeicInTjCWlpb6wc15mfey7oc9E8LElpVmMgb9AXoC+qcTExOPKRu4NlTHs6Q10GfhgfYOvRsJQZ76BWMKuDtaolQs+gfoH6Mn436gDg+e+5BKXUQx/C5Je/a+NpbeiQJPKgUdlNXx/BCBKxVdxW5Q0I3XBqFKRhU4KLtjYawi3csuTKdc4FnIXNvKUJkVEGRG20QZAAUpA5DbaYAQLmQzfzxyk/ffdnCD4NWVnGdE7kQBQvQHC5lVEDxgMaM29lkxGCNLKrDnIbFAMkFmBIaDkHstU41coGZ1TZD5UjReCGUAYbNgdNqoXZB/T67yYbFAMiGML3BhYeH8rb0t9h/zgcTBcTNGiQAAAABJRU5ErkJggg==","to-bottom-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-bottom":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-top":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDIydi04bTAgMC0yIDJtMi0yIDIgMm0tNC02aDEybS02IDRoNm0tNiA0aDZtLTYgNGg2IiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","underline-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",underline:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","unlock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiMzMzgxRkYiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0xYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDN2MyIgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+",unlock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSI4IiBjeT0iOSIgcj0iMSIvPjxyZWN0IHN0cm9rZT0iIzQ0NEU2MCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiB4PSIzIiB5PSI2IiB3aWR0aD0iMTAiIGhlaWdodD0iOCIgcng9IjIiLz48cGF0aCBkPSJtNS4yMDQgNC40NDcuMjYtLjk2NmEzIDMgMCAxIDEgNS43OTUgMS41NTNMMTEgNmgwTTggOXYzIiBzdHJva2U9IiM0NDRFNjAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4="};function We(e){return Ve[e]}var kl=x(require("react")),Ke=/*#__PURE__*/function(_kl$Component){_inherits(Ke,_kl$Component);var _super84=_createSuper(Ke);function Ke(t){var _this270;_classCallCheck(this,Ke);_this270=_super84.call(this,t);_this270.didUnmount=!1;_this270.onMouseDown=function(t){var i=0;if(t.button===i){_this270.setState({isPressed:!0});var _r164=function _r164(n){n.button===i&&(document.body.removeEventListener("mouseup",_r164),_this270.didUnmount||_this270.setState({isPressed:!1}))};document.body.addEventListener("mouseup",_r164)}};_this270.state={isHover:!1,isPressed:!1};return _this270}_createClass(Ke,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.didUnmount=!0}},{key:"render",value:function render(){var _this271=this;var t=this.props.className;t!==void 0?t="button "+t:t="button",this.props.disable&&(t+=" disable");var i=this.props.refObject;return kl.createElement("div",{className:t,ref:i,onMouseEnter:function onMouseEnter(){return _this271.setState({isHover:!0})},onMouseLeave:function onMouseLeave(){return _this271.setState({isHover:!1})},onMouseDown:this.onMouseDown,onClick:this.props.onClick},this.props.children)}}]);return Ke}(kl.Component);var ps=x(require("react")),fi=/*#__PURE__*/function(_ps$Component){_inherits(fi,_ps$Component);var _super85=_createSuper(fi);function fi(t){var _this272;_classCallCheck(this,fi);_this272=_super85.call(this,t);_this272.divRef=ps.createRef();_this272.onMouseDown=function(t){var i=_this272.divRef.current,r=t.target;if(i&&!fi.isEventFiredOnElement(r,i)){var n=_this272.props.onShouldBecomeHide;n(r)}};document.body.addEventListener("mousedown",_this272.onMouseDown);return _this272}_createClass(fi,[{key:"componentWillUnmount",value:function componentWillUnmount(){document.body.removeEventListener("mousedown",this.onMouseDown)}},{key:"render",value:function render(){var t=z(T({},this.props),{ref:this.divRef});delete t.onShouldBecomeHide;var i=t.children;return ps.createElement("div",T({},t),i)}}],[{key:"isEventFiredOnElement",value:function isEventFiredOnElement(t,i){var r=t;for(;r;){if(r===i)return!0;r=r.parentElement}return!1}}]);return fi}(ps.Component);function Nb(_ref104){var e=_ref104.viewMovingState,t=_ref104.delegate,i=_ref104.components;return{width:95,height:40,node:function node(s,o,a,c,h,d){var p=o+c/2<=d/2;return fe.createElement(_gt,{key:"font-size",delegate:t,viewMovingState:e,components:i,isMenuToDown:p})}}}function Lb(e){var t=Math.floor(e);return e>=t+.5&&(t+=1),t}var _gt=/*#__PURE__*/function(_fe$Component){_inherits(gt,_fe$Component);var _super86=_createSuper(gt);function gt(t){var _this273;_classCallCheck(this,gt);_this273=_super86.call(this,t);_this273.inputRef=fe.createRef();_this273.upArrowButton=Object.freeze({iconName:"arrow-up",isUp:!0,ref:fe.createRef()});_this273.downArrowButton=Object.freeze({iconName:"arrow-down",isUp:!1,ref:fe.createRef()});_this273.onFocusInput=function(){var t=_this273.inputRef.current;t&&(t.type="text",t.setSelectionRange(0,t.value.length),t.type="number",_this273.setState({isFocusInput:!0}))};_this273.onShouldBecomeHide=function(t){var i=_this273.inputRef.current,r=_this273.upArrowButton.ref.current,n=_this273.downArrowButton.ref.current;i&&r&&n&&!fi.isEventFiredOnElement(t,r)&&!fi.isEventFiredOnElement(t,n)&&_this273.commitFontSizeWithString(i.value)};_this273.onPressKeyInput=function(t){t.key==="Enter"&&_this273.commitFontSizeWithString(t.target.value)};_this273.state={overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1};return _this273}_createClass(gt,[{key:"onSelectFontSize",value:function onSelectFontSize(t){this.commitFontSizeWithInt(t),this.setState({overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1})}},{key:"getFontSize",value:function getFontSize(){var t=this.props.components,i;var _iterator247=_createForOfIteratorHelper(t),_step247;try{for(_iterator247.s();!(_step247=_iterator247.n()).done;){var _r165=_step247.value;var n=_r165.currentScale,s=_r165.textSize,o=Lb(n*s);if(i===void 0)i=o;else if(i!==o){i=void 0;break}}}catch(err){_iterator247.e(err)}finally{_iterator247.f()}return i}},{key:"shouldUpdateFontSize",value:function shouldUpdateFontSize(t){var i=this.props.components;var _iterator248=_createForOfIteratorHelper(i),_step248;try{for(_iterator248.s();!(_step248=_iterator248.n()).done;){var _r166=_step248.value;var n=_r166.currentScale,s=_r166.textSize;if(n*s!==t)return!0}}catch(err){_iterator248.e(err)}finally{_iterator248.f()}return!1}},{key:"commitFontSizeWithString",value:function commitFontSizeWithString(t){var r;var i=Number.parseFloat(t);Number.isNaN(i)||(i=Lb(i),i=Math.max(i,_gt.minFontSize),i=Math.min(i,_gt.maxFontSize),this.commitFontSizeWithInt(i),(r=this.inputRef.current)==null||r.blur(),this.setState({overrideFontSize:void 0,isFocusInput:!1,hoverIndex:void 0}))}},{key:"commitFontSizeWithInt",value:function commitFontSizeWithInt(t){if(this.shouldUpdateFontSize(t)){var _this$props98=this.props,i=_this$props98.viewMovingState,_r167=_this$props98.delegate;i.maskHideFloatBarSometime(),_r167.updateTextareaFontSize(t)}}},{key:"renderMenu",value:function renderMenu(t){var _this274=this;var i=this.inputRef.current;if(!i)return null;var _gt2=_gt,r=_gt2.menuMargin,_gt2$menuSize=_gt2.menuSize,n=_gt2$menuSize.width,s=_gt2$menuSize.height,o=this.props.isMenuToDown,a=i.offsetLeft+(i.offsetWidth-n)/2,c;return o?c=i.offsetTop+i.offsetHeight+r:c=i.offsetTop-r-s,fe.createElement(fi,{className:"font-size-menu",style:{left:a,top:c,width:n,height:s},onMouseLeave:function onMouseLeave(){return _this274.setState({hoverIndex:void 0})},onShouldBecomeHide:this.onShouldBecomeHide},this.renderFontSizeList(t))}},{key:"renderFontSizeList",value:function renderFontSizeList(t){var _this275=this;var i=parseInt(t,10),_gt3=_gt,r=_gt3.fontSizeList,n=[];var _loop25=function _loop25(s){var o=r[s],a=null,c="cell";i===o&&(a=fe.createElement("img",{className:"check",alt:"check",src:We("check")}));var h=_this275.state.hoverIndex;s===h&&(c+=" hover"),n.push(fe.createElement("div",{key:"".concat(s),className:c,onMouseEnter:function onMouseEnter(){return _this275.setState({hoverIndex:s})},onClick:function onClick(){return _this275.onSelectFontSize(o)}},a&&fe.createElement("div",{className:"check"}),fe.createElement("span",null,o),a))};for(var s=0;s<r.length;++s){_loop25(s)}return n}},{key:"renderArrowButton",value:function renderArrowButton(t,i){var _this276=this;var r,n=Number.parseFloat(t),_gt4=_gt,s=_gt4.fontSizeList;if(!Number.isNaN(n))if(i.isUp)for(var c=0;c<s.length;++c){var h=s[c];if(h>n){r=h;break}}else for(var _c14=s.length-1;_c14>=0;--_c14){var _h14=s[_c14];if(_h14<n){r=_h14;break}}var o=i.iconName,a=function a(){if(r!==void 0){var _c15=_this276.props.viewMovingState;_c15.maskHideFloatBarSometime(),_this276.commitFontSizeWithInt(r),_this276.setState({overrideFontSize:void 0,hoverIndex:void 0})}};return fe.createElement(Ke,{className:"arrow-button",disable:r===void 0,refObject:i.ref,onClick:a},fe.createElement("img",{alt:"icon",src:We(o)}))}},{key:"render",value:function render(){var _this277=this;var _this$state9=this.state,t=_this$state9.overrideFontSize,i=_this$state9.isFocusInput,r=t;if(r===void 0){var s=this.getFontSize();s===void 0?r="":r="".concat(s)}return fe.createElement(fe.Fragment,{key:"font-size"},fe.createElement("div",{className:"decorator"},fe.createElement("img",{className:"font-size-icon",alt:"icon",src:We(i?"font-size-active":"font-size")})),fe.createElement("input",{className:"font-size-input",type:"number",value:r,ref:this.inputRef,onFocus:this.onFocusInput,onKeyUp:this.onPressKeyInput,onChange:function onChange(s){return _this277.setState({overrideFontSize:s.target.value})}}),i&&this.renderMenu(r),fe.createElement("div",{className:"decorator"},fe.createElement("div",{className:"font-size-buttons"},this.renderArrowButton(r,this.upArrowButton),this.renderArrowButton(r,this.downArrowButton))))}}]);return gt}(fe.Component);_gt.minFontSize=1,_gt.maxFontSize=999,_gt.fontSizeList=Object.freeze([12,14,18,24,36,48,64,80,144,288]),_gt.menuMargin=21,_gt.menuSize=Object.freeze({width:64,height:248}),_gt=sr([Rb.observer],_gt);var Db=x(require("mobx-react")),Dt=x(require("react"));function Fb(_ref105){var e=_ref105.viewMovingState,t=_ref105.delegate,i=_ref105.components,r=_ref105.colors;return{width:40,height:40,node:function node(o,a,c,h,d,u){var f=a+h/2<=u/2;return Dt.createElement(_nt,{key:"font-colors",delegate:t,viewMovingState:e,colors:r,components:i,parentWidth:c,parentHeight:h,isMenuToDown:f})}}}function Bb(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i){if(e[i]!==t[i])return!1}return!0}var _nt=/*#__PURE__*/function(_Dt$Component){_inherits(nt,_Dt$Component);var _super87=_createSuper(nt);function nt(t){var _this278;_classCallCheck(this,nt);_this278=_super87.call(this,t);_this278.onClickDisplayButton=function(){var t=_this278.state.isDisplayMenu;t||_this278.setState({isDisplayMenu:!0})};_this278.state={isDisplayMenu:!1};return _this278}_createClass(nt,[{key:"onClickColorButton",value:function onClickColorButton(t){var i=_toConsumableArray(t),r=this.props.delegate;r.updateTextareaFormat({color:i}),this.setState({isDisplayMenu:!1})}},{key:"getSelectedColor",value:function getSelectedColor(){var t=null,i=this.props.components;var _iterator249=_createForOfIteratorHelper(i),_step249;try{for(_iterator249.s();!(_step249=_iterator249.n()).done;){var _r168=_step249.value;var n=_r168.format.color;if(!t)t=n;else if(!Bb(t,n)){t=null;break}}}catch(err){_iterator249.e(err)}finally{_iterator249.f()}return t}},{key:"renderMenu",value:function renderMenu(t){var _this279=this;var _this$props99=this.props,i=_this$props99.isMenuToDown,r=_this$props99.colors,n=_this$props99.parentWidth,s=_this$props99.parentHeight,o=Math.ceil(r.length/_nt.menuLineCellsCount),c=Math.min(r.length,_nt.menuLineCellsCount)*_nt.menuCellSize.width+2*_nt.menuPadding,h=o*_nt.menuCellSize.height+2*_nt.menuPadding,_nt2=_nt,d=_nt2.menuMargin,u=n-c,p;return i?p=s+d:p=-(d+h),Dt.createElement(fi,{className:"font-colors-menu",style:{left:u,top:p,width:c,height:h},onShouldBecomeHide:function onShouldBecomeHide(){return _this279.setState({isDisplayMenu:!1})}},this.renderColorButtons(t))}},{key:"renderColorButtons",value:function renderColorButtons(t){var _this280=this;var i=this.props.colors,r=[];var _loop26=function _loop26(n){var s=i[n],o="rgb(".concat(s[0],", ").concat(s[1],", ").concat(s[2],")"),a="font-color-button";t&&Bb(t,s)?a+=" font-color-selected":a+=" font-color-not-selected",r.push(Dt.createElement("div",{key:"".concat(n),className:a,onClick:function onClick(){return _this280.onClickColorButton(s)}},Dt.createElement("div",{className:"core",style:{backgroundColor:o}})))};for(var n=0;n<i.length;++n){_loop26(n)}return r}},{key:"render",value:function render(){var t=this.getSelectedColor(),i=t&&Dt.createElement("div",{className:"bar",style:{backgroundColor:"rgb(".concat(t[0],",").concat(t[1],",").concat(t[2],")")}}),r=this.state.isDisplayMenu,n=r?"font-colors-active":"font-colors";return Dt.createElement(Dt.Fragment,null,Dt.createElement(Ke,{className:"normal-button",onClick:this.onClickDisplayButton},Dt.createElement("div",{className:"font-colors-icon"},Dt.createElement("img",{alt:"icon",src:We(n)}),i)),r&&this.renderMenu(t))}}]);return nt}(Dt.Component);_nt.menuMargin=8,_nt.menuPadding=8,_nt.menuLineCellsCount=4,_nt.menuCellSize=Object.freeze({width:28,height:28}),_nt=sr([Db.observer],_nt);var st=x(require("react")),jb=x(require("mobx-react"));function zb(_ref106){var e=_ref106.delegate;return{width:40,height:40,node:function node(r,n,s,o,a,c){var d=n+o/2<=c/2;return st.createElement(_Ji,{key:"image-layer-button",isMenuToDown:d,delegate:e})}}}var _Ji=/*#__PURE__*/function(_st$Component){_inherits(Ji,_st$Component);var _super88=_createSuper(Ji);function Ji(t){var _this281;_classCallCheck(this,Ji);_this281=_super88.call(this,t);_this281.buttonRef=st.createRef();_this281.state={isDisplayMenu:!1};return _this281}_createClass(Ji,[{key:"renderMenu",value:function renderMenu(){var _this282=this;var t=this.buttonRef.current;if(!t)return null;var _Ji$menuSize=_Ji.menuSize,i=_Ji$menuSize.width,r=_Ji$menuSize.height,_Ji2=_Ji,n=_Ji2.menuMargin,_this$props100=this.props,s=_this$props100.isMenuToDown,o=_this$props100.delegate,a=t.offsetLeft+(t.offsetWidth-i)/2,c;return s?c=t.offsetTop+t.offsetHeight+n:c=t.offsetTop-n-r,st.createElement(fi,{className:"image-layer-menu",style:{left:a,top:c,width:i,height:r},onShouldBecomeHide:function onShouldBecomeHide(){return _this282.setState({isDisplayMenu:!1})}},st.createElement(Ke,{key:"layer-unlock",className:"normal-button",onClick:function onClick(){return o.moveSelectedComponentsToTop()}},st.createElement("img",{alt:"icon",src:We("to-top")})),st.createElement(Ke,{key:"layer-lock",className:"normal-button",onClick:function onClick(){return o.moveSelectedComponentsToBottom()}},st.createElement("img",{alt:"icon",src:We("to-bottom")})))}},{key:"render",value:function render(){var _this283=this;var t=this.state.isDisplayMenu,i=t?"layer-pressed":"layer";return st.createElement(st.Fragment,null,st.createElement(Ke,{key:"layer",className:"normal-button ".concat(t?"highlight-button":""),refObject:this.buttonRef,onClick:function onClick(){return _this283.setState({isDisplayMenu:!t})}},st.createElement("img",{alt:"icon",src:We(i)})),t&&this.renderMenu())}}]);return Ji}(st.Component);_Ji.menuMargin=21,_Ji.menuSize=Object.freeze({width:72,height:40}),_Ji=sr([jb.observer],_Ji);var er=Object.freeze({top:12,bottom:24,left:12,right:12}),wo=Object.freeze({top:1,bottom:1,left:1,right:1});function Ub(e){var _e$whiteModel=e.whiteModel,t=_e$whiteModel.ImageShape,i=_e$whiteModel.TextareaShape,r=[],n=e.components;if(n.length===0)return r;var s=0,o=0,a=!0,c=!0,h=!0,d=!0,u=!0;var _iterator250=_createForOfIteratorHelper(n),_step250;try{for(_iterator250.s();!(_step250=_iterator250.n()).done;){var m=_step250.value;if(Vt(m,t))s+=1;else if(Vt(m,i)){var g=m,y=g.format;y.bold||(c=!1),y.italic||(h=!1),y.underline||(d=!1),y.lineThrough||(u=!1),o+=1}m.locked||(a=!1)}}catch(err){_iterator250.e(err)}finally{_iterator250.f()}var p=40,f=40;return s===n.length?(r.push({width:p,height:f,node:function node(){return Vb(e)}}),r.push({width:p,height:f,node:function node(){return qI(e,a)}}),a||r.push(zb(e)),r.push({width:p,height:f,node:function node(){return iP(e)}})):o===n.length&&(r.push({width:p,height:f,node:function node(){return Vb(e)}}),r.push({width:p,height:f,node:function node(){return ZI(e,c)}}),r.push({width:p,height:f,node:function node(){return JI(e,h)}}),r.push({width:p,height:f,node:function node(){return eP(e,u)}}),r.push({width:p,height:f,node:function node(){return tP(e,d)}}),r.push(Nb(e)),r.push(Fb(e))),r}function Vb(_ref107){var e=_ref107.delegate,t=_ref107.isEditTextarea;return yt.createElement(Ke,{key:"delete",className:"normal-button",onClick:function onClick(){return e["delete"]()},disable:t},yt.createElement("img",{alt:"delete",src:We("delete")}))}function qI(_ref108,t){var e=_ref108.delegate;var i=!t;return yt.createElement(Ke,{key:"lock",className:"normal-button",onClick:function onClick(){return e.lockImages(i)}},yt.createElement("img",{alt:"lock",src:We(t?"unlock-new":"lock-new")}))}function ZI(_ref109,i){var e=_ref109.viewMovingState,t=_ref109.delegate;var r=!i;return yt.createElement(Ke,{key:"text-blob",className:"normal-button",onClick:function onClick(){e.maskHideFloatBarSometime(),t.updateTextareaFormat({bold:r})}},yt.createElement("img",{alt:"text-blob",src:We(i?"bold-active":"bold")}))}function JI(_ref110,i){var e=_ref110.viewMovingState,t=_ref110.delegate;var r=!i;return yt.createElement(Ke,{key:"text-italic",className:"normal-button",onClick:function onClick(){e.maskHideFloatBarSometime(),t.updateTextareaFormat({italic:r})}},yt.createElement("img",{alt:"text-italic",src:We(i?"italic-active":"italic")}))}function eP(_ref111,i){var e=_ref111.viewMovingState,t=_ref111.delegate;var r=!i;return yt.createElement(Ke,{key:"text-line-through",className:"normal-button",onClick:function onClick(){e.maskHideFloatBarSometime(),t.updateTextareaFormat({lineThrough:r})}},yt.createElement("img",{alt:"text-line-through",src:We(i?"line-through-active":"line-through")}))}function tP(_ref112,i){var e=_ref112.viewMovingState,t=_ref112.delegate;var r=!i;return yt.createElement(Ke,{key:"text-underline",className:"normal-button",onClick:function onClick(){e.maskHideFloatBarSometime(),t.updateTextareaFormat({underline:r})}},yt.createElement("img",{alt:"text-underline",src:We(i?"underline-active":"underline")}))}function iP(_ref113){var e=_ref113.delegate;return yt.createElement(Ke,{key:"duplicate",className:"normal-button",onClick:function onClick(){return e.duplicate()}},yt.createElement("img",{alt:"duplicate",src:We("duplicate")}))}var tr=x(require("mobx"));function Cl(e,t){return Math.abs(e-t)<=.01}var xl=/*#__PURE__*/function(){function xl(t){var _this284=this;_classCallCheck(this,xl);this.latestCallMaskTimestamp=0;this.timer=null;this._shouldHideFloatBar=!1;this.onAfterMoving=function(){_this284._shouldHideFloatBar&&(_this284._shouldHideFloatBar=!1),_this284.timer=null};this.rectangle=t,(0,tr.makeObservable)(this,{_shouldHideFloatBar:tr.observable,setState:tr.action,release:tr.action})}_createClass(xl,[{key:"shouldHideFloatBar",get:function get(){return this._shouldHideFloatBar}},{key:"setState",value:function setState(t,i){var _this285=this;var r=this.rectangle,n=!Cl(r.originX,t.originX)||!Cl(r.originY,t.originY),s=!Cl(r.width,t.width)||!Cl(r.height,t.height);(n||!i&&s)&&(!this._shouldHideFloatBar&&Date.now()>=this.latestCallMaskTimestamp+xl.maskDuration&&(this._shouldHideFloatBar=!0),this.timer!==null&&clearTimeout(this.timer),this.timer=setTimeout(function(){return(0,tr.runInAction)(_this285.onAfterMoving)},xl.cameraTouchInterval)),(n||s)&&(this.rectangle=t)}},{key:"maskHideFloatBarSometime",value:function maskHideFloatBarSometime(){this.latestCallMaskTimestamp=Date.now()}},{key:"release",value:function release(){this.timer!==null&&(clearTimeout(this.timer),this.timer=null,this._shouldHideFloatBar=!1)}}]);return xl}(),ko=xl;ko.cameraTouchInterval=300,ko.maskDuration=100;var ei;(function(s){s[s.Top=0]="Top",s[s.Bottom=1]="Bottom",s[s.Left=2]="Left",s[s.Right=3]="Right",s[s.Center=4]="Center"})(ei||(ei={}));var ms=/*#__PURE__*/function(_Il$Component){_inherits(ms,_Il$Component);var _super89=_createSuper(ms);function ms(t){var _this286;_classCallCheck(this,ms);_this286=_super89.call(this,t);_this286.lockView=function(t){_this286.setState({lockedPosition:t})};_this286.state={lockedPosition:void 0},_this286.viewMovingState=new ko(t.rectangle);return _this286}_createClass(ms,[{key:"componentDidMount",value:function componentDidMount(){var _this287=this;var t=!0;this.disposer=(0,Hb.autorun)(function(){_this287.viewMovingState.shouldHideFloatBar?t||(_this287.unlockView(),t=!0):t=!1})}},{key:"componentDidUpdate",value:function componentDidUpdate(){var t=this.props.rectangle;this.viewMovingState.setState(t,this.isEditTextarea())}},{key:"componentWillUnmount",value:function componentWillUnmount(){var t;this.viewMovingState.release(),(t=this.disposer)==null||t.call(this)}},{key:"isEditTextarea",value:function isEditTextarea(){var _this$props101=this.props,t=_this$props101.components,i=_this$props101.whiteModel.TextareaShape;var _iterator251=_createForOfIteratorHelper(t),_step251;try{for(_iterator251.s();!(_step251=_iterator251.n()).done;){var _r169=_step251.value;if(Vt(_r169,i)&&_r169.editedBy!==void 0)return!0}}catch(err){_iterator251.e(err)}finally{_iterator251.f()}return!1}},{key:"position",value:function position(t,i,r){var n=t.originX,s=t.originY,o=n+t.width,a=s+t.height,c=wo.left+wo.right,h=wo.top+wo.bottom,d=0;var _iterator252=_createForOfIteratorHelper(r),_step252;try{for(_iterator252.s();!(_step252=_iterator252.n()).done;){var _step252$value=_step252.value,b=_step252$value.width,S=_step252$value.height;c+=b,d=Math.max(d,S)}}catch(err){_iterator252.e(err)}finally{_iterator252.f()}h+=d;var u=c+er.left+er.right,p=h+er.top+er.bottom,f=this.props.screenSize,m=f.width,g=f.height,y;return s>=p?y=0:g-a>=p?y=1:n>=u?y=2:m-o>=u?y=3:y=4,{left:n,right:o,top:s,bottom:a,position:y,boxWidth:c,boxHeight:h,width:u,height:p}}},{key:"centerXWithTopOrBottom",value:function centerXWithTopOrBottom(t,i){var r=Math.max(t.left,0),n=Math.min(t.right,i),s=t.width/2,o=(r+n)/2;return o-s<0?o=s:o+s>i&&(o=i-s),o}},{key:"unlockView",value:function unlockView(){this.setState({lockedPosition:void 0})}},{key:"render",value:function render(){var _this288=this;var _this$props102=this.props,t=_this$props102.whiteModel,i=_this$props102.components,r=_this$props102.screenSize,n=_this$props102.rectangle,s=_this$props102.cnode,o=_this$props102.room;if(!o||this.viewMovingState.shouldHideFloatBar)return null;var a=this.state.lockedPosition,c=Ub({viewMovingState:this.viewMovingState,isEditTextarea:this.isEditTextarea(),whiteModel:t,components:i,delegate:o.floatBarDelegate,colors:o.floatBarOptions.colors});if(c.length<=0)return null;var h=a||this.position(n,o,c),d=r.width,u=r.height,p,f;switch(h.position){case 0:{p=this.centerXWithTopOrBottom(h,d),f=h.top-h.height/2;break}case 1:{p=this.centerXWithTopOrBottom(h,d),f=h.bottom+h.height/2;break}case 2:{p=h.left-h.width/2,f=Math.max(h.top,0)+h.height/2;break}case 3:{p=h.right+h.width/2,f=Math.max(h.top,0)+h.height/2;break}case 4:{var w=Math.max(h.left,0),P=Math.min(h.right,d),A=Math.max(h.top,0);p=(w+P)/2,f=A+h.height/2;break}}var m=p-h.width/2,g=f-h.height/2,y="translate(".concat(m,"px,").concat(g,"px)"),b=[],S=m;var _iterator253=_createForOfIteratorHelper(c),_step253;try{for(_iterator253.s();!(_step253=_iterator253.n()).done;){var _step253$value=_step253.value,_w13=_step253$value.width,_P3=_step253$value.node;var _A=_P3(S,g,h.boxWidth,h.boxHeight,d,u);b.push(_A),S+=_w13}}catch(err){_iterator253.e(err)}finally{_iterator253.f()}return Il.createElement(gr,{context:s,className:"float-bar",onMouseEnter:function onMouseEnter(){return _this288.lockView(h)},style:{WebkitTransform:y,transform:y,width:h.boxWidth,height:h.boxHeight,padding:0,marginLeft:er.left,marginRight:er.right,marginTop:er.top,marginBottom:er.bottom}},b)}}],[{key:"willInterruptEvent",value:function willInterruptEvent(){return!0}}]);return ms}(Il.Component);ms=sr([Wb.observer],ms);function Co(e){return function(){return e}}function _b(){return hu(1)}function hu(e){return function(t,i){var r=t.width/i.width,n=t.height/i.height,s=Math.max(r,n)*e;return Number.isNaN(s)?1:s}}function $b(){return du(1,0)}function Gb(e){return du(1,e)}function Kb(e){return du(e,0)}function du(e,t){return function(i,r){var n=i.width/(r.width+t*2),s=i.height/(r.height+t*2),o=Math.min(n,s)*e;return Number.isNaN(o)||o===1/0?0:o}}function rP(e){for(var t in e){e[t]===void 0&&delete e[t]}return e}var Pl=/*#__PURE__*/function(){function Pl(t,i){_classCallCheck(this,Pl);this._cameraBound=i,this.cameraman=t.bindCameraman(this.toCameraBorder(i),"device")}_createClass(Pl,[{key:"cameraBound",get:function get(){return this._cameraBound}},{key:"setScreenSize",value:function setScreenSize(t){(!this.screenSize||this.screenSize.width!==t.width||this.screenSize.height!==t.height)&&(this.screenSize=t,this.setCameraBound({maxContentMode:this.maxContentMode,minContentMode:this.minContentMode}))}},{key:"setCameraBound",value:function setCameraBound(t){this._cameraBound=t,this.cameraman.setCameraBorder(this.toCameraBorder(t))}},{key:"toCameraBorder",value:function toCameraBorder(t){var i=t.damping,r=t.centerX,n=t.centerY,s=t.width,o=t.height,a=this.boundSize(s,o);this.maxContentMode=t.maxContentMode,this.minContentMode=t.minContentMode;var c=1/0,h=0;return this.screenSize&&(this.maxContentMode&&(c=this.maxContentMode(this.screenSize,a)),this.minContentMode&&(h=this.minContentMode(this.screenSize,a))),rP({damping:i,centerX:r,centerY:n,width:s,height:o,maxScale:c,minScale:h})}},{key:"boundSize",value:function boundSize(t,i){return this.cameraman?{width:t===void 0?this.cameraman.cameraBorder.width:t,height:i===void 0?this.cameraman.cameraBorder.height:i}:{width:t===void 0?1/0:t,height:i===void 0?1/0:i}}}]);return Pl}();var Ml;(function(n){n.Triangle="triangle",n.Rhombus="rhombus",n.Pentagram="pentagram",n.SpeechBalloon="speechBalloon"})(Ml||(Ml={}));var X;(function(p){p.selector="selector",p.clicker="clicker",p.laserPointer="laserPointer",p.pencil="pencil",p.rectangle="rectangle",p.ellipse="ellipse",p.shape="shape",p.eraser="eraser",p.text="text",p.straight="straight",p.arrow="arrow",p.hand="hand"})(X||(X={}));var ot;(function(n){n.None="none",n.Dir="dir",n.Page="page",n.Conflict="conflict"})(ot||(ot={}));function Xb(e,t){var i=[],r=new ct(t,function(){i.length>0&&e(i.splice(0,i.length))});function n(s){i.push(s),r.invoke()}return Object.defineProperty(n,"proxyListener",{writable:!1,value:e}),n}var uu=/*#__PURE__*/function(){function uu(){_classCallCheck(this,uu);this.listeners={};this.eventsMergers={};this.waitingNodes=[]}_createClass(uu,[{key:"dispatchEvent",value:function dispatchEvent(t,i,r){var n=this.listeners[t.event];if(n){var _iterator254=_createForOfIteratorHelper(n),_step254;try{for(_iterator254.s();!(_step254=_iterator254.n()).done;){var o=_step254.value;if(!r||o.isAfterCommit===i)try{o.invoke(t)}catch(a){console.error(a)}}}catch(err){_iterator254.e(err)}finally{_iterator254.f()}}var s=this.waitingNodes.findIndex(function(o){return o.filter(t)?(o.resolve(t),!0):!1});s!==-1&&this.waitingNodes.splice(s,1)}},{key:"addMagixEventsListener",value:function addMagixEventsListener(t,i,r,n){var s=Xb(i,r),o=this.eventsMergers[t];o||(o=[],this.eventsMergers[t]=o),o.push(s),this.addMagixEventListener(t,s,n)}},{key:"addMagixEventListener",value:function addMagixEventListener(t,i,r){var n=this.listeners[t];n||(n=[],this.listeners[t]=n),n.push({invoke:i,isAfterCommit:r})}},{key:"removeMagixEventListener",value:function removeMagixEventListener(t,i){if(i){var _r170=this.removeFromEventMerges(t,i);_r170?this.removeFromListeners(t,_r170):this.removeFromListeners(t,i)}else delete this.listeners[t],delete this.eventsMergers[t]}},{key:"removeFromEventMerges",value:function removeFromEventMerges(t,i){var r=this.eventsMergers[t];if(r){var n=-1;for(var s=0;s<r.length;++s){if(r[s].proxyListener===i){n=s;break}}if(n!==-1){var _s38=r[n];return r.splice(n,1),r.length===0&&delete this.eventsMergers[t],_s38}}}},{key:"removeFromListeners",value:function removeFromListeners(t,i){var r=this.listeners[t];if(r){var n=r.findIndex(function(s){return s.invoke===i});n!==-1&&(r.splice(n,1),r.length===0&&delete this.listeners[t])}}},{key:"waitMagixEvent",value:function waitMagixEvent(t){var _this289=this;return new Promise(function(i){_this289.waitingNodes.push({resolve:i,filter:t})})}}]);return uu}();var Yb=/*#__PURE__*/function(){function Yb(){_classCallCheck(this,Yb)}_createClass(Yb,[{key:"parse",value:function parse(t){var i=t.split("/");if(i[0]!=="")throw new Error("path ".concat(JSON.stringify(t)," should start with \"/\""));i[i.length-1]===""&&i.pop();var r=[];for(var n=1;n<i.length;++n){r.push(i[n].trim())}return r}},{key:"stringify",value:function stringify(t){return"/".concat(t.join("/"))}}]);return Yb}(),Ft=new Yb;var fn=x(require("react")),pu=fn.createContext(void 0),mu=fn.createContext(void 0),fu=fn.createContext(void 0);function fs(e,t){var i=e.Provider;return function(_ref114){var r=_ref114.children;return fn.createElement(i,{value:t},r)}}var gu=pu.Consumer,xo=mu.Consumer,yu=fu.Consumer;function bu(e){return new gs(e)}var gs=/*#__PURE__*/function(){function gs(t){_classCallCheck(this,gs);this.cacheContextMap={};this.manager=null;this.plugins=this.copyAndFreezePlugins(t)}_createClass(gs,[{key:"copyAndFreezePlugins",value:function copyAndFreezePlugins(t){var i={};for(var _r171 in t){var n=t[_r171];if(n.kind!==void 0&&_r171!==n.kind)throw new Error("plugin's kind ".concat(JSON.stringify(n.kind)," is not equals key ").concat(JSON.stringify(_r171)));var s=n.defaultAttributes;_typeof(s)=="object"&&s!==null&&(s=Object.freeze(T({},s))),i[_r171]=Object.freeze({kind:_r171,render:n.render,defaultAttributes:s,hitTest:n.hitTest,willInterruptEvent:n.willInterruptEvent})}return Object.freeze(i)}},{key:"setPluginContext",value:function setPluginContext(t,i){this.manager?this.manager.setPluginContext(t,i):this.cacheContextMap&&t in this.plugins&&(this.cacheContextMap[t]=i)}},{key:"getPluginContext",value:function getPluginContext(t){return this.manager?this.manager.getPluginContext(t):this.cacheContextMap?this.cacheContextMap[t]:void 0}},{key:"setPluginManager",value:function setPluginManager(t){if(this.cacheContextMap){for(var i in this.cacheContextMap){t.setPluginContext(i,this.cacheContextMap[i])}this.cacheContextMap=null}else if(this.manager)for(var _i50 in this.plugins){var _r172=this.manager.getPluginContext(_i50);t.setPluginContext(_i50,_r172)}this.manager=t}}]);return gs}();var gn=x(require("mobx"));var ys=/*#__PURE__*/function(){function ys(t){_classCallCheck(this,ys);this.enableCallbackUpdate=!0;this.disposer=null;this.copiedAttributes=null;this.kind=t.kind,this._displayer=t.displayer,this._callbacks=new Yt,this.onAttributesUpdate&&this._callbacks.on("onAttributesUpdate",this.onAttributesUpdate.bind(this)),this.onDestroy&&this._callbacks.on("onDestroy",this.onDestroy.bind(this)),this.autorunAttributesUpdate(),(0,gn.makeObservable)(this,{attributes:gn.computed})}_createClass(ys,[{key:"autorunAttributesUpdate",value:function autorunAttributesUpdate(){var _this290=this;if(!this._displayer.useMobXState){var t=!1;this.disposer=(0,gn.autorun)(function(){_this290._displayer.applianceManager.hasInvisibilePluginKind(_this290.kind)&&(_this290.copiedAttributes=se(_this290.attributes),t&&_this290.enableCallbackUpdate&&_this290._callbacks.dispatch("onAttributesUpdate",function(i){return i(_this290.copiedAttributes)}),t=!0)})}}},{key:"displayer",get:function get(){return this._displayer}},{key:"callbacks",get:function get(){return this._callbacks}},{key:"attributes",get:function get(){var t;if(this._displayer.useMobXState)t=this._displayer.applianceManager.getAttributesWithInvisiblePlugin(this.kind);else{if(!this.copiedAttributes)throw new Error("invisible plugin \"".concat(this.kind,"\" not exits"));t=this.copiedAttributes}return t}},{key:"getAttributesValue",value:function getAttributesValue(t){var i=this._displayer.applianceManager;return i.getAttributesWithInvisiblePlugin(this.kind,t)}},{key:"setAttributes",value:function setAttributes(t){var _this291=this;if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var _this$_displayer=this._displayer,i=_this$_displayer.applianceManager,_r173=_this$_displayer.parametersFilter,n=_r173?_r173.filter(t):t;i.updateAttributesInvisiblePlugin(this.kind,n)}finally{Promise.resolve(function(){_this291.enableCallbackUpdate=!0})}}},{key:"updateAttributes",value:function updateAttributes(t,i){var _this292=this;if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var _this$_displayer2=this._displayer,_r174=_this$_displayer2.applianceManager,n=_this$_displayer2.parametersFilter,s=n?n.filter(i):i;_r174.updateAttributesInvisiblePluginWithKeys(this.kind,t,s)}finally{Promise.resolve(function(){_this292.enableCallbackUpdate=!0})}}},{key:"destroy",value:function destroy(){var _this293=this;try{this.enableCallbackUpdate=!1;var t=this._displayer.applianceManager;t.removeInvisiblePlugin(this.kind)}finally{Promise.resolve(function(){_this293.enableCallbackUpdate=!0})}}},{key:"_dispose",value:function _dispose(t){this.disposer&&(this.disposer(),this.disposer=null),t&&this.enableCallbackUpdate&&this._callbacks.dispatch("onDestroy",function(i){return i()})}},{key:"isEnableUpdateAttributes",value:function isEnableUpdateAttributes(){if(this._displayer instanceof yn)return this._displayer.isRoomEnableModify();throw new Error("cannot update attributes when displayer is player")}}]);return ys}(),Tl=/*#__PURE__*/function(){function Tl(t,i,r){_classCallCheck(this,Tl);this.pluginClasses={};this.plugins={};this.paddingCreators={};this.disposer=null;this._isWatching=!1;this.logger=t,this.displayer=i,this.pluginClasses=this.createPluginClasses(r)}_createClass(Tl,[{key:"createPluginClasses",value:function createPluginClasses(t){var i={};var _iterator255=_createForOfIteratorHelper(t),_step255;try{for(_iterator255.s();!(_step255=_iterator255.n()).done;){var _r175=_step255.value;if(_r175.kind in i)throw new Error("duplicated kind from invisible plugin ".concat(JSON.stringify(_r175.kind)));i[_r175.kind]=_r175}}catch(err){_iterator255.e(err)}finally{_iterator255.f()}return Object.freeze(i)}},{key:"isWatching",get:function get(){return this._isWatching},set:function set(t){var _this294=this;this._isWatching!==t&&(this._isWatching=t,t&&!this.disposer?this.disposer=(0,gn.autorun)(function(){for(var i in _this294.pluginClasses){_this294.refreshPlugin(_this294.pluginClasses[i])}}):!t&&this.disposer&&(this.disposer(),this.disposer=null))}},{key:"get",value:function get(t){return this.plugins[t]||null}},{key:"create",value:function create(t,i){var _this295=this;return new Promise(function(r,n){var s=t.kind,o=_this295.displayer.applianceManager;try{if(_this295.addPaddingCreator(s,r),t!==_this295.pluginClasses[s])throw new Error("unregister invisible plugin class");o.putInvisiblePlugin(s,i)}catch(a){n(a),_this295.removePaddingCreator(s,r)}})}},{key:"dispose",value:function dispose(){this.disposer&&(this.disposer(),this.disposer=null);var t=!1;for(var i in this.plugins){try{this.plugins[i]._dispose(t)}catch(r){this.logger.error(r)}delete this.plugins[i]}}},{key:"refreshPlugin",value:function refreshPlugin(t){var i=this.displayer.applianceManager,r=t.kind;if(i.hasInvisibilePluginKind(r)){if(!this.plugins[r]){var s={kind:r,displayer:this.displayer},o=t,a=this.plugins[r]=new o(s);if(t.onCreate)try{t.onCreate(a)}catch(c){this.logger.error(c)}}var n=this.paddingCreators[r];if(n){delete this.paddingCreators[r];var _iterator256=_createForOfIteratorHelper(n),_step256;try{for(_iterator256.s();!(_step256=_iterator256.n()).done;){var _s39=_step256.value;_s39(this.plugins[r])}}catch(err){_iterator256.e(err)}finally{_iterator256.f()}}}else{var _n46=this.plugins[r],_s40=!0;if(_n46){delete this.plugins[r];try{_n46._dispose(_s40)}catch(o){this.logger.error(o)}if(t.onDestroy)try{t.onDestroy(_n46)}catch(o){this.logger.error(o)}}}}},{key:"addPaddingCreator",value:function addPaddingCreator(t,i){var r=this.paddingCreators[t];r||(r=this.paddingCreators[t]=[]),r.push(i)}},{key:"removePaddingCreator",value:function removePaddingCreator(t,i){var r=this.paddingCreators[t];if(r){var n=r.indexOf(i);n!==-1&&(r.splice(n,1),r.length===0&&delete this.paddingCreators[t])}}}]);return Tl}();function El(e,t){var i=T({},e),r=!1;for(var n in t){var s=t[n];e[n]!==s&&(i[n]=s,r=!0)}return r?i:null}var Io=/*#__PURE__*/function(){function Io(t){_classCallCheck(this,Io);this._state=Object.freeze(T({},t))}_createClass(Io,[{key:"state",get:function get(){return this._state}},{key:"putState",value:function putState(t){var i=El(this._state,t),r=!1;if(i){var n=this._state;this._state=Object.freeze(i),this.onStateUpdate(t,n),r=!0}return r}}]);return Io}();var Cu=x(require("react-dom")),xu=x(require("react"));var Dr=x(require("mobx"));var vu=x(require("react")),Su=/*#__PURE__*/function(){function Su(){_classCallCheck(this,Su)}_createClass(Su,[{key:"createCursor",value:function createCursor(){return{x:14,y:14,width:28,height:28,reactNode:vu.createElement(nP,null)}}}]);return Su}(),nP=function nP(){return vu.createElement("img",{alt:"laser",src:"https://sdk.netless.link/resource/mouse-cursor/laser-pointer-cursor.svg"})};var Lr;(function(i){i.SVG="svg",i.Canvas="canvas"})(Lr||(Lr={}));var ae;(function(r){r.Freedom="freedom",r.Follower="follower",r.Broadcaster="broadcaster"})(ae||(ae={}));var tv=x(require("mobx"));var Qb=5600,qb=4,Zb=41,Al=100,wu=17,Jb=75,ev=100;var Ol=x(require("react"));var Rl=/*#__PURE__*/function(_Ol$Component){_inherits(Rl,_Ol$Component);var _super90=_createSuper(Rl);function Rl(){var _this296;_classCallCheck(this,Rl);_this296=_super90.apply(this,arguments);_this296.onRef=function(t){var i=_this296.props.payload;if(!_this296._divElement&&t)_this296._divElement=t,i.onCursorComponentChanged(_assertThisInitialized(_this296));else if(_this296._divElement&&!t)try{i.onCursorComponentChanged(null)}finally{_this296._divElement=t}};return _this296}_createClass(Rl,[{key:"divElement",get:function get(){return this._divElement}},{key:"render",value:function render(){var _this$props103=this.props,t=_this$props103.cnode,i=_this$props103.size,r=_this$props103.payload;return Ol.createElement(gr,{context:t,onRef:this.onRef,style:i},r.reactNode)}}]);return Rl}(Ol.Component);Rl.isVisible=!1;var ku=/*#__PURE__*/function(){function ku(t){var _this297=this;_classCallCheck(this,ku);this.reactNode=null;this.onCursorComponentChanged=function(t){_this297.cursorComponent=t,t?_this297.adapter.onAddedCursor&&_this297.adapter.onAddedCursor(_this297):_this297.adapter.onRemovedCursor&&_this297.adapter.onRemovedCursor(_this297)};this.onComponentMoved=function(){if(_this297.adapter.onMovingCursor){var _t17=_this297.component.originX+_this297._x+_this297.screen.width/2,_i51=_this297.component.originY+_this297._y+_this297.screen.height/2;_this297.adapter.onMovingCursor(_this297,_t17,_i51)}};this.idPrefix=t.idPrefix,this.applianceManager=t.applianceManager,this.adapter=t.adapter,this.screen=t.screen,this.memberId=t.memberId;var i=this.adapter.createCursor(this.memberId);this._x=i.x,this._y=i.y,this._width=i.width,this._height=i.height,this.reactNode=i.reactNode||null,this.cursorDefinition=Bh({name:"Cursor"}),t.engine.bind(this.cursorDefinition)(Rl),this.component=this.screen.scene.addComponent({id:this.idPrefix+this.memberId,definition:this.cursorDefinition,originX:t.point.x-this._x,originY:t.point.y-this._y,width:i.width,height:i.height,orderIndex:this.memberId,absoluteCoordinates:!0,payload:{reactNode:this.reactNode,onCursorComponentChanged:this.onCursorComponentChanged}}),this.adapter.onMovingCursor&&this.component.addRectangleUpdatedListener(this.onComponentMoved)}_createClass(ku,[{key:"cursorMember",get:function get(){return this._cursorMember}},{key:"setCursorMember",value:function setCursorMember(t){var i;this._cursorMember&&!Nr(this._cursorMember,t)&&(this._cursorMember=t,(i=this.onCursorMemberChanged)==null||i.call(this,this._cursorMember))}},{key:"remove",value:function remove(){this.screen.scene.removeComponent(this.component),this.adapter.onMovingCursor&&this.component.removeRectangleUpdatedListener(this.onComponentMoved)}},{key:"x",get:function get(){return this._x}},{key:"y",get:function get(){return this._y}},{key:"width",get:function get(){return this._width}},{key:"height",get:function get(){return this._height}},{key:"divElement",get:function get(){if(!this.cursorComponent)throw new Error("cursor isn't added");return this.cursorComponent.divElement}},{key:"setReactNode",value:function setReactNode(t){this.reactNode=t,this.component.payload={reactNode:t,onCursorComponentChanged:this.onCursorComponentChanged}}},{key:"setCursorDescription",value:function setCursorDescription(t){var i=T({x:this._x,y:this._y,width:this._width,height:this._height},t),r=this._x-i.x,n=this._y-i.y;this.component.setRectangle(this.component.originX+r,this.component.originY+n,i.width,i.height),this._x=i.x,this._y=i.y,this._width=i.width,this._height=i.height}}]);return ku}();var Nl=/*#__PURE__*/function(){function Nl(t){var _this298=this;_classCallCheck(this,Nl);this.didMouseCursorMoved=!1;this.inactivityTimer=null;this.shouldAppearNextFrame=!0;this.cursor=null;this.disposer=null;this.refreshState=function(){var t=_this298.getCursorState(_this298.memberId),i=_this298.applianceManager.getViewState(_this298.memberId);t&&i&&_this298.willShow(_this298.applianceManager,t)?_this298.cursor?_this298.refreshCursorVisibleState(t,i,_this298.cursor):_this298.cursor=_this298.createCursor(t):_this298.cursor&&(_this298.removeCursor(_this298.cursor),_this298.cursor=null)};this.applianceManager=t.applianceManager,this.screen=t.screen,this.engine=t.engine,this.idPrefix=t.idPrefix,this.memberId=t.memberId,this.adapter=t.adapter,this.willShow=t.willShow,this.isFollowerFixedOnScreen=t.isFollowerFixedOnScreen,this.refreshAutorun(),this.refreshIsVisible()}_createClass(Nl,[{key:"isVisible",get:function get(){return this.isCursorInScene&&this.isKeepVisible}},{key:"getCursorState",value:function getCursorState(t){if(this.applianceManager.getCursorState)return this.applianceManager.getCursorState(t);var i;var _iterator257=_createForOfIteratorHelper(this.applianceManager.getMemberDisplayers()),_step257;try{for(_iterator257.s();!(_step257=_iterator257.n()).done;){var _r176=_step257.value;if(_r176.memberId===t){i={deviceType:_r176.deviceType,isPressed:_r176.isPressed,isActivity:_r176.isActivity,isCursorInScene:_r176.isCursorInScene,currentApplianceName:_r176.currentApplianceName,color:_r176.color,cursorX:_r176.cursorX,cursorY:_r176.cursorY};break}}}catch(err){_iterator257.e(err)}finally{_iterator257.f()}return i}},{key:"refreshCursorVisibleState",value:function refreshCursorVisibleState(t,i,r){this.setPositionProperties(t,i),this.setVisibleProperties(t),this.refreshComponentPosition(),r.setCursorMember({appliance:t.currentApplianceName,color:t.color,information:this.applianceManager.getInformationWithMemberId(this.memberId)})}},{key:"createCursor",value:function createCursor(t){return this.isCursorInScene=t.isCursorInScene,this.isPressed=t.isPressed,this.isActivity=t.isActivity,this.isKeepVisible=t.isActivity,this.cursorX=t.cursorX,this.cursorY=t.cursorY,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY,new ku({idPrefix:this.idPrefix,memberId:this.memberId,applianceManager:this.applianceManager,screen:this.screen,engine:this.engine,adapter:this.adapter,point:this.getCurrentComponentPosition()})}},{key:"removeCursor",value:function removeCursor(t){this.cleanInactivityDelayer(),t.remove()}},{key:"updateScreenSize",value:function updateScreenSize(){this.refreshComponentPosition()}},{key:"refreshAutorun",value:function refreshAutorun(){this.disposer&&this.disposer(),this.disposer=(0,tv.autorun)(this.refreshState)}},{key:"dispose",value:function dispose(){this.disposer&&(this.disposer(),this.disposer=null),this.cursor&&(this.removeCursor(this.cursor),this.cursor=null)}},{key:"setPositionProperties",value:function setPositionProperties(t,i){if(this.mode=i.mode,this.originX=i.originX,this.originY=i.originY,this.cursorX=t.cursorX,this.cursorY=t.cursorY,this.width=i.width,this.height=i.height,this.didMouseCursorMoved)this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY;else{var _r177=qb,n=this.width===0?1:this.screen.width/this.width,s=this.height===0?1:this.screen.height/this.height,o=(this.cursorX-this.latestCheckedCursorX)*this.width*n,a=(this.cursorY-this.latestCheckedCursorY)*this.height*s;o*o+a*a>=_r177*_r177&&(this.didMouseCursorMoved=!0,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY)}}},{key:"setVisibleProperties",value:function setVisibleProperties(t){var i=this.isActivity;this.isCursorInScene=t.isCursorInScene,this.isPressed=t.isPressed,this.isActivity=t.isActivity,i&&!this.isActivity?(this.delayInactivity(),this.checkMouseCursorMoved()):!i&&this.isActivity?(this.cleanInactivityDelayer(),this.isKeepVisible=!0):!this.isActivity&&this.checkMouseCursorMoved()&&this.delayInactivity(),this.refreshIsVisible()}},{key:"refreshComponentPosition",value:function refreshComponentPosition(){var t;if(this.isVisible){var i=this.getCurrentComponentPosition(),_r178=this.getNextAnimationMode();(t=this.cursor)==null||t.component.moveTo(i.x-this.cursor.x,i.y-this.cursor.y,_r178)}}},{key:"getNextAnimationMode",value:function getNextAnimationMode(){return this.shouldAppearNextFrame?(this.shouldAppearNextFrame=!1,Q.Immediately):this.isPressed?Q.Immediately:Q.Continuous}},{key:"getCurrentComponentPosition",value:function getCurrentComponentPosition(){var t,i;if(this.isFollowerFixedOnScreen(this.applianceManager)&&this.mode!==ae.Freedom){var _r179=this.width===0?1:this.screen.width/this.width,n=this.height===0?1:this.screen.height/this.height,s=Math.min(_r179,n),o=(this.screen.width-s*this.width)/2,a=(this.screen.height-s*this.height)/2;t=this.cursorX*this.width*s+o-this.screen.width/2,i=this.cursorY*this.height*s+a-this.screen.height/2}else{var _this$screen$camera3=this.screen.camera,_r180=_this$screen$camera3.centerX,_n47=_this$screen$camera3.centerY,_s41=_this$screen$camera3.scale;t=this.cursorX*this.width+this.originX,i=this.cursorY*this.height+this.originY,t=(t-_r180)*_s41,i=(i-_n47)*_s41}return{x:t,y:i}}},{key:"checkMouseCursorMoved",value:function checkMouseCursorMoved(){return this.didMouseCursorMoved?(this.didMouseCursorMoved=!1,!0):!1}},{key:"cleanInactivityDelayer",value:function cleanInactivityDelayer(){this.inactivityTimer!==null&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null)}},{key:"delayInactivity",value:function delayInactivity(){var _this299=this;this.inactivityTimer!==null&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),this.isActivity||(this.isKeepVisible=!0,this.refreshIsVisible(),this.inactivityTimer=setTimeout(function(){_this299.isKeepVisible=!1,_this299.inactivityTimer=null,_this299.refreshIsVisible()},Qb))}},{key:"refreshIsVisible",value:function refreshIsVisible(){var i;var t=this.isVisible;t||(this.shouldAppearNextFrame=!0),(i=this.cursor)==null||i.component.setVisible(this.engine,t)}}]);return Nl}();var Ll=/*#__PURE__*/function(){function Ll(t){var _this300=this;_classCallCheck(this,Ll);this.laserPointerCursorAdapter=new Su;this.nodes={};this._isHidden=!1;this.onAddedMember=function(t,i){var r=new Nl({memberId:i,idPrefix:"laser-pointer-",adapter:_this300.laserPointerCursorAdapter,applianceManager:t,engine:_this300.engine,screen:_this300.screen,isFollowerFixedOnScreen:_this300.isFollowerFixedOnScreen,willShow:function willShow(s,o){return o.currentApplianceName===X.laserPointer&&(!_this300.willHideObserver||i!==_this300.observerId)}}),n;_this300.cursorAdapter&&(n=new Nl({memberId:i,idPrefix:"cursor-",adapter:_this300.cursorAdapter,applianceManager:t,engine:_this300.engine,screen:_this300.screen,isFollowerFixedOnScreen:_this300.isFollowerFixedOnScreen,willShow:function willShow(s,o){return o.currentApplianceName!==X.laserPointer&&(!_this300.willHideObserver||i!==_this300.observerId)}})),_this300.nodes[i]={laserPointer:r,cursor:n}};this.onRemovedMember=function(t,i){var n;var r=_this300.nodes[i];r&&(delete _this300.nodes[i],r.laserPointer.dispose(),(n=r.cursor)==null||n.dispose())};this.onRefreshed=function(){var t;for(var i in _this300.nodes){var _r181=_this300.nodes[i];_r181.laserPointer.refreshAutorun(),(t=_r181.cursor)==null||t.refreshAutorun()}};this.isFollowerFixedOnScreen=function(t){var i=t.getViewState(_this300.observerId);return i?i.mode===ae.Broadcaster||i.mode===ae.Follower:!1};this.screen=t.screen,this.members=t.members,this.engine=this.getMouseCursorEngine(t.appVersion,t.engine),this.willHideObserver=t.willHideObserver,this.observerId=t.observerId,this.cursorAdapter=t.adapter,this._isHidden=t.isHidden,this.members.forEach(this.onAddedMember),this.members.callbacks.on("onAdded",this.onAddedMember),this.members.callbacks.on("onRemoved",this.onRemovedMember),this.members.callbacks.on("onRefreshed",this.onRefreshed),(0,Dr.makeObservable)(this,{observerId:Dr.observable,_isHidden:Dr.observable,setHidden:Dr.action,updateObserverId:Dr.action})}_createClass(Ll,[{key:"isHidden",get:function get(){return this._isHidden}},{key:"setHidden",value:function setHidden(t){this._isHidden!==t&&(this._isHidden=t)}},{key:"updateObserverId",value:function updateObserverId(t){this.observerId=t}},{key:"updateScreenSize",value:function updateScreenSize(){var t;for(var i in this.nodes){var _r182=this.nodes[i];_r182.laserPointer.updateScreenSize(),(t=_r182.cursor)==null||t.updateScreenSize()}}},{key:"release",value:function release(){var t;this.members.callbacks.off("onAdded",this.onAddedMember),this.members.callbacks.off("onRemoved",this.onRemovedMember),this.members.callbacks.off("onRefreshed",this.onRefreshed);for(var i in this.nodes){var _r183=this.nodes[i];_r183.laserPointer.dispose(),(t=_r183.cursor)==null||t.dispose(),delete this.nodes[i]}}},{key:"getMouseCursorEngine",value:function getMouseCursorEngine(t,i){if(i)return i;switch(t){case"2.0.0":return this.screen.scene.getEngineWithLegacyLayout(4);case"2.1.0":return this.screen.scene.getEngineWithLegacyLayout(5);default:throw new Error("invalid app version "+t);}}}]);return Ll}();function iv(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i.toDataURL("screenshot")}var Dl=/*#__PURE__*/function(){function Dl(t,i,r,n,s,o){var _this301=this;_classCallCheck(this,Dl);this._maskScreenObserverId=!0;this.onScreenSizeUpdated=function(t){_this301.cameraBoundState.setScreenSize(t),_this301.cursors&&_this301.cursors.updateScreenSize(),_this301.render.refreshSceneComponents(),_this301._onScreenSizeUpdated&&_this301._onScreenSizeUpdated(t)};this.updateCursorClassBySelector=function(t){if(_this301.applianceManager){var _i52=_this301.applianceManager.getMemberState();_i52&&_i52.currentApplianceName===X.selector&&_this301.updateCursorClass(t)}};var p;var a=r.modules,c=a.WhiteRender.WhiteboardRender;this.engines=r.engines,this.modules=r.modules,this.pluginManager=r.pluginManager,this.applianceManager=r.applianceManager,this.members=r.members,this.dynamicPpt=r.dynamicPpt,this.bezierCurvePainter=r.bezierCurvePainter,this.view=t,this._isCursorsHidden=s,this.observerId=i.observerId;var h=this.applianceManager.getViewState(),d=this.createScene(n.boundless,n.logger,n.renderEngine,a),u=Object.freeze(z(T({},i),{observerId:this.screenObserverId(i),deviceType:n.boundless.deviceType,dynamicPpt:this.dynamicPpt,disalbeImageHit:!1,disableOthersSelectingBox:!1,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,fontFamily:n.fontFamily,convertIdToUrl:n.urlInterrupter,updateTextarea:n.onTextareaUpdate,updateCursorClass:this.updateCursorClassBySelector,floatBarClass:n.floatBarClass,textareaHub:n.textareaHub}));if(this.screen=d.createScreen({className:"netless-whiteboard",context:u,engines:(p=this.engines)==null?void 0:p.enginesList,autoResize:n.autoResize,eventInterrupter:n.eventInterrupter,wrappedComponents:n.wrappedComponents,onRenderDuration:function onRenderDuration(f){return _this301.view.fireRenderDuration(f)}}),this.onCatchErrorWhenRender=n.onCatchErrorWhenRender,this._onScreenSizeUpdated=n.onScreenSizeUpdated,n.onCatchErrorWhenRender&&this.screen.addRenderErrorCatchedListener(n.onCatchErrorWhenRender),this.screen.addSizeUpdatedListener(this.onScreenSizeUpdated),o){var f=o.cameraBoundState;this.cameraBoundState=new Pl(this.screen,f.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=f.cameraman.disableBoundlessEvent,this.cameraBoundState.cameraman.disableCameraTransform=f.cameraman.disableCameraTransform,this.cameraBoundState.cameraman.handToolKey=f.cameraman.handToolKey}else this.cameraBoundState=new Pl(this.screen,n.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=n.disableOperations,this.cameraBoundState.cameraman.handToolKey=n.handToolKey;this.cameraBoundState.cameraman.adaptRectangle({originX:h.originX,originY:h.originY,width:h.width,height:h.height,adapterMode:hi.Centering,animationMode:Q.Immediately}),this.render=new c(this.screen,this.pluginManager,this.applianceManager,this.engines),this.setupViewContextState(t.state),setTimeout(function(){var f;_this301.cursors=new Ll({appVersion:r.appVersion,members:_this301.members,screen:_this301.screen,engine:(f=_this301.engines)==null?void 0:f.engines.mouseCurosrEngine,observerId:_this301.observerId,isHidden:_this301._isCursorsHidden,willHideObserver:n.willHideSelfCursor,adapter:n.cursorAdapter})},0)}_createClass(Dl,[{key:"isCursorsHidden",get:function get(){return this._isCursorsHidden},set:function set(t){this._isCursorsHidden!==t&&(this._isCursorsHidden=t,this.cursors&&this.cursors.setHidden(this._isCursorsHidden))}},{key:"maskFloatBar",get:function get(){return this.render.maskFloatBar},set:function set(t){this.render.maskFloatBar=t}},{key:"updateState",value:function updateState(t){"cameraBound"in t&&this.cameraBoundState.setCameraBound(t.cameraBound),this.syncCameraMoving(t.cameraMoving),"disableCameraTransform"in t&&(this.cameraman.disableCameraTransform=t.disableCameraTransform),"handToolActive"in t&&(this.cameraman.handToolActive=t.handToolActive),"handToolKey"in t&&(this.cameraman.handToolKey=t.handToolKey),"divElement"in t&&(this.screen.divElement=t.divElement)}},{key:"syncCameraMoving",value:function syncCameraMoving(t){if(t){var i=t.camera,_r184=t.toContaint;if(i){var n=i.animationMode||Q.Continuous;this.cameraman.transformCamera(z(T({},i),{animationMode:n}))}else if(_r184){var _n48=_r184.animationMode||Q.Continuous;this.cameraman.adaptRectangle(z(T({},_r184),{animationMode:_n48,adapterMode:hi.Centering}))}}}},{key:"setupViewContextState",value:function setupViewContextState(t){this.cameraBoundState.setCameraBound(t.cameraBound),this.syncCameraMoving(t.cameraMoving),this.cameraman.transformCamera(z(T({},t.cameraMoving),{animationMode:Q.Immediately})),this.cameraman.disableCameraTransform=t.disableCameraTransform,this.cameraman.handToolActive=t.handToolActive,this.cameraman.handToolKey=t.handToolKey,this.screen.divElement=t.divElement}},{key:"createScene",value:function createScene(t,i,r,_ref115){var n=_ref115.WhiteRender;if(n.createLayoutDescriptions){var s=n.createLayoutDescriptions(r);return t.createSceneWithLegacyLayoutDescriptions(s,i)}else return t.createScene(i)}},{key:"scenePath",get:function get(){return"/"+this.applianceManager.getCurrentScenePath().join("/")}},{key:"foucsScenePath",get:function get(){return this.render.foucsScenePath},set:function set(t){this.render.foucsScenePath=t}},{key:"cameraman",get:function get(){return this.cameraBoundState.cameraman}},{key:"maskScreenObserverId",get:function get(){return this._maskScreenObserverId},set:function set(t){this._maskScreenObserverId!==t&&(this._maskScreenObserverId=t,this.screen.context=Object.freeze(z(T({},this.screen.context),{observerId:t?re:this.observerId})))}},{key:"setCommonScreenContext",value:function setCommonScreenContext(t){var n;var i=this.observerId,r=t.observerId;this.screen.context=Object.freeze(z(T(T({},this.screen.context),t),{observerId:this.screenObserverId(t)})),i!==r&&(this.observerId=r,(n=this.cursors)==null||n.updateObserverId(r))}},{key:"setCameraBound",value:function setCameraBound(t){this.cameraBoundState.setCameraBound(t)}},{key:"resizeScreen",value:function resizeScreen(){this.screen.resize()}},{key:"refreshRender",value:function refreshRender(){this.render.refreshSceneComponents()}},{key:"fireReloadLibrary",value:function fireReloadLibrary(){this.render.rebuildSceneRender&&this.render.rebuildSceneRender()}},{key:"refreshCameraToFocus",value:function refreshCameraToFocus(){var _this$applianceManage=this.applianceManager.getViewState(),t=_this$applianceManage.originX,i=_this$applianceManage.originY,r=_this$applianceManage.width,n=_this$applianceManage.height,s={originX:t,originY:i,width:r,height:n};this.screen.adaptRectangle(z(T({},s),{animationMode:Q.Continuous,adapterMode:hi.Centering}))}},{key:"getTargetsMap",value:function getTargetsMap(_ref116,r){var t=_ref116.component,i=_ref116.engine;var n=this.modules.WhiteModel.ApplianceComponent,s;return Vt(t.payload,n)&&(this.render.getTargetsMap?s=this.render.getTargetsMap(t,r):s=this.render.findTargetsMap(t.id,i.orderIndex,r)),s}},{key:"cleanScreen",value:function cleanScreen(){var t;(t=this.render)==null||t.clean()}},{key:"release",value:function release(){var t;this.onCatchErrorWhenRender&&this.screen.removeRenderErrorCatchedListener(this.onCatchErrorWhenRender),this.screen.removeSizeUpdatedListener(this.onScreenSizeUpdated),(t=this.cursors)==null||t.release(),this.render.release(),this.cameraBoundState.cameraman.release()}},{key:"scenePreview",value:function scenePreview(t,i,r,n){var _this$modules$WhiteRe=this.modules.WhiteRender,s=_this$modules$WhiteRe.screenshot,o=_this$modules$WhiteRe.EnginesHub;if(s){this.screenshotEngines||(this.screenshotEngines=o&&new o("svg"));var a=Ft.parse(t),c=this.screen,h=r,d=n;h=typeof h!="number"?i.clientWidth:h,d=typeof d!="number"?i.clientHeight:d;var u=1;c.width!==0&&c.height!==0&&(u=Math.min(h/c.width,d/c.height)*c.camera.scale);var p={centerX:c.camera.centerX,centerY:c.camera.centerY,scale:u},f=s({applianceManager:this.applianceManager,engines:this.screenshotEngines,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:h,height:d,path:a,camera:p});if((0,xu.isValidElement)(f))Cu.render(f,i);else throw new Error("scene preview must render ReactElement")}}},{key:"fillSceneSnapshot",value:function fillSceneSnapshot(t,i,r,n){var _this$modules$WhiteRe2=this.modules.WhiteRender,s=_this$modules$WhiteRe2.screenshot,o=_this$modules$WhiteRe2.EnginesHub;if(s){this.screenshotEngines||(this.screenshotEngines=o&&new o("svg"));var a=Ft.parse(t),c=s({applianceManager:this.applianceManager,engines:this.screenshotEngines,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:r,height:n,path:a});if((0,xu.isValidElement)(c))Cu.render(c,i);else throw new Error("scene preview must render ReactElement")}}},{key:"generateScreenshot",value:function(){var _generateScreenshot=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee88(t,i,r){var n,o,s;return regeneratorRuntime.wrap(function _callee88$(_context92){while(1){switch(_context92.prev=_context92.next){case 0:if(t){o=Ft.parse(t);n=this.applianceManager.scenes.getScene(o)}else n=this.applianceManager.scene;if(n){_context92.next=3;break}throw new Error("cannot find scene with path ".concat(JSON.stringify(t)));case 3:s=this.findBackgroundImage(n);if(!s){_context92.next=10;break}_context92.next=7;return this.generateImage(s,i,r);case 7:_context92.t0=_context92.sent;_context92.next=11;break;case 10:_context92.t0=iv(1,1);case 11:return _context92.abrupt("return",_context92.t0);case 12:case"end":return _context92.stop();}}},_callee88,this)}));function generateScreenshot(_x158,_x159,_x160){return _generateScreenshot.apply(this,arguments)}return generateScreenshot}()},{key:"findBackgroundImage",value:function findBackgroundImage(t){var i=this.modules.WhiteModel.BackgroundImage;for(var _r185=0;_r185<t.componentsLength;++_r185){var n=t.componentAt(_r185);if(Vt(n,i))return n}return null}},{key:"generateImage",value:function(){var _generateImage=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee89(t,i,r){var n,s,o,a,h,d,u,p,f,m,g,c;return regeneratorRuntime.wrap(function _callee89$(_context93){while(1){switch(_context93.prev=_context93.next){case 0:n=document.createElement("canvas"),s=i,o=r;s===void 0&&(s=t.width),o===void 0&&(o=t.height),n.width=s,n.height=o;a=t.previewURL;if(!(!a&&/^https?:\/\//im.test(t.src)&&(a=t.src),a)){_context93.next=14;break}_context93.next=6;return bl(a);case 6:h=_context93.sent;d=n.getContext("2d");u=Math.min(s/t.width,o/t.height);p=t.width*u;f=t.height*u;m=(s-p)/2;g=(o-f)/2;d.drawImage(h,m,g,p,f);case 14:_context93.next=16;return new Promise(function(h){return n.toBlob(h)});case 16:c=_context93.sent;return _context93.abrupt("return",URL.createObjectURL(c));case 18:case"end":return _context93.stop();}}},_callee89)}));function generateImage(_x161,_x162,_x163){return _generateImage.apply(this,arguments)}return generateImage}()},{key:"updateCursorClass",value:function updateCursorClass(t){t!==null?this.screen.className="netless-whiteboard "+t:this.screen.className="netless-whiteboard"}},{key:"updateCursorStyle",value:function updateCursorStyle(t){t===null?this.screen.style=void 0:this.screen.style={cursor:t}}},{key:"screenObserverId",value:function screenObserverId(_ref117){var t=_ref117.observerId;return this._maskScreenObserverId?re:t}}]);return Dl}();var Pe;(function(n){n[n.Writable=0]="Writable",n[n.FollowSceneAndCamera=1]="FollowSceneAndCamera",n[n.FollowScene=2]="FollowScene",n[n.Freedom=3]="Freedom"})(Pe||(Pe={}));var Fl=/*#__PURE__*/function(_Io){_inherits(Fl,_Io);var _super91=_createSuper(Fl);function Fl(t,i,r,n,s,o,a){var _this302;_classCallCheck(this,Fl);_this302=_super91.call(this,s);_this302.extraWrappedComponents=Object.freeze([]);_this302.didRelease=!1;_this302.wannaFocusScenePath=void 0;_this302._mode=3;_this302.onSizeUpdated=function(_ref118){var t=_ref118.width,i=_ref118.height;_this302._size=Object.freeze({width:t,height:i}),_this302._callbacks.dispatch("onSizeUpdated",function(r){return r(_this302._size)})};_this302.onCameraUpdated=function(t){_this302._camera=Object.freeze({centerX:t.centerX,centerY:t.centerY,scale:t.scale}),typeof t.operatorId=="string"&&_this302._callbacks.dispatch("onCameraUpdatedByDevice",function(i){return i(_this302._camera)}),_this302._callbacks.dispatch("onCameraUpdated",function(i){return i(_this302._camera)})};_this302.onBoundlessEvent=function(t){_this302.delegate.onBoundlessEvent(t)};_this302.onHandToolActive=function(t){_this302._callbacks.dispatch("onHandToolActive",function(i){return i(t)})};_this302.onCameraTransformation=function(t){_this302._callbacks.dispatch("onCameraTransform",function(i){return i(t)})};_this302.id=t,_this302.commonScreenContext=i,_this302.params=r,_this302.node=new Dl(_assertThisInitialized(_this302),i,n,r,_this302.shouldHideCursors(n)),_this302.node.maskFloatBar=!1,_this302.latestScenePath=_this302.node.scenePath,_this302.delegate=o,_this302._callbacks=new Yt(a),_this302.registerScreenAndCameraman(_this302.node.screen,_this302.node.cameraman);return _this302}_createClass(Fl,[{key:"scenePath",get:function get(){return this.latestScenePath}},{key:"focusScenePath",get:function get(){return this.wannaFocusScenePath},set:function set(t){var _this303=this;this.wannaFocusScenePath!==t&&(this.wannaFocusScenePath=t,this.shouldFollowScene(this._mode)||this.watchScenePathUpdate(function(){_this303.node.foucsScenePath=t}))}},{key:"disableCameraTransform",get:function get(){return this.state.disableCameraTransform},set:function set(t){this.putState({disableCameraTransform:t})}},{key:"callbacks",get:function get(){return this._callbacks}},{key:"mode",get:function get(){return this._mode},set:function set(t){var _this304=this;this.assertNotRelease(),this._mode!==t&&this.watchScenePathUpdate(function(){_this304._mode===0&&_this304.delegate.onIsWriterChanged(!1),_this304.shouldFollowCamera(t)&&!_this304.shouldFollowCamera(_this304._mode)&&_this304.node.refreshCameraToFocus(),_this304.shouldFollowScene(t)&&!_this304.shouldFollowScene(_this304._mode)?_this304.node.foucsScenePath=void 0:!_this304.shouldFollowScene(t)&&_this304.shouldFollowScene(_this304._mode)&&(_this304.node.foucsScenePath=_this304.wannaFocusScenePath),_this304.node.maskScreenObserverId=_this304.shouldMaskScreenObserverId(t),t===0?(_this304.node.maskFloatBar=!1,_this304.delegate.onIsWriterChanged(!0)):_this304.node.maskFloatBar=!0,_this304._mode=t})}},{key:"wrappedComponents",get:function get(){return this.extraWrappedComponents},set:function set(t){this.extraWrappedComponents=Object.freeze(_toConsumableArray(t)),this.node.screen.wrappedComponents=[].concat(_toConsumableArray(t),_toConsumableArray(this.params.wrappedComponents))}},{key:"fireReloadLibrary",value:function fireReloadLibrary(){this.node.fireReloadLibrary()}},{key:"shouldMaskScreenObserverId",value:function shouldMaskScreenObserverId(t){return t!==0}},{key:"shouldFollowCamera",value:function shouldFollowCamera(t){switch(t){case 0:case 1:return!0;default:return!1;}}},{key:"shouldHideCursors",value:function shouldHideCursors(_ref119){var t=_ref119.applianceManager;var i="/"+t.getCurrentScenePath().join("/");return!!(this.wannaFocusScenePath&&!this.shouldFollowScene(this._mode)&&i!==this.wannaFocusScenePath)}},{key:"shouldFollowScene",value:function shouldFollowScene(t){switch(t){case 0:case 1:case 2:return!0;default:return!1;}}},{key:"camera",get:function get(){return this._camera}},{key:"size",get:function get(){return this._size}},{key:"screen",get:function get(){return this.node.screen}},{key:"cameraman",get:function get(){return this.node.cameraman}},{key:"divElement",get:function get(){return this.state.divElement},set:function set(t){this.putState({divElement:t})}},{key:"getTargetsMap",value:function getTargetsMap(t,i){return this.node.getTargetsMap(t,i)}},{key:"cancelCurrentContinuityEvent",value:function cancelCurrentContinuityEvent(){this.cameraman.cancelCurrentContinuityEvent()}},{key:"setCommonScreenContext",value:function setCommonScreenContext(t){this.assertNotRelease(),this.commonScreenContext=t,this.node.setCommonScreenContext(t)}},{key:"updateContext",value:function updateContext(t){var _this305=this;var i=this.node.maskFloatBar;this.assertNotRelease(),this.node.cleanScreen(),this.node.release(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.node=new Dl(this,this.commonScreenContext,t,this.handleUpdatedParams(this.params),this.shouldHideCursors(t),this.node),this.node.maskFloatBar=i,this.shouldFollowScene(this._mode)&&this.watchScenePathUpdate(function(){return _this305.node.foucsScenePath=_this305.wannaFocusScenePath}),this.registerScreenAndCameraman(this.node.screen,this.node.cameraman)}},{key:"handleUpdatedParams",value:function handleUpdatedParams(t){return this.extraWrappedComponents.length===0?t:z(T({},t),{wrappedComponents:[].concat(_toConsumableArray(this.extraWrappedComponents),_toConsumableArray(t.wrappedComponents))})}},{key:"setCameraBound",value:function setCameraBound(t){this.putState({cameraBound:t})}},{key:"moveCamera",value:function moveCamera(t){this.putState({cameraMoving:{camera:t}})}},{key:"moveCameraToContain",value:function moveCameraToContain(t){this.putState({cameraMoving:{toContaint:t}})}},{key:"updateDisableBoundlessEvent",value:function updateDisableBoundlessEvent(t){this.node.cameraman.disableBoundlessEvent=t}},{key:"updateCursorClass",value:function updateCursorClass(t){this.node.updateCursorClass(t)}},{key:"updateCursorStyle",value:function updateCursorStyle(t){this.node.updateCursorStyle(t)}},{key:"resizeScreen",value:function resizeScreen(){this.node.resizeScreen()}},{key:"refreshRender",value:function refreshRender(){var _this306=this;this.watchScenePathUpdate(function(){return _this306.node.refreshRender()})}},{key:"scenePreview",value:function scenePreview(t,i,r,n){return this.node.scenePreview(t,i,r,n)}},{key:"generateScreenshot",value:function generateScreenshot(t,i,r){return this.node.generateScreenshot(t,i,r)}},{key:"fillSceneSnapshot",value:function fillSceneSnapshot(t,i,r,n){this.node.fillSceneSnapshot(t,i,r,n)}},{key:"convertToPointInWorld",value:function convertToPointInWorld(_ref120){var t=_ref120.x,i=_ref120.y;return this.node.screen.convertPointToScene(t,i)}},{key:"fireRenderDuration",value:function fireRenderDuration(t){this._callbacks.dispatch("onRenderDuration",function(i){return i(t)})}},{key:"release",value:function release(){this.assertNotRelease(),this.node.release(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.didRelease=!0,this.delegate.onRelease()}},{key:"onStateUpdate",value:function onStateUpdate(t){this.node.updateState(t)}},{key:"registerScreenAndCameraman",value:function registerScreenAndCameraman(t,i){var _this307=this;var r=t.width,n=t.height,s=t.camera;(!this._size||this._size.width!==r||this._size.height!==n)&&(this._size=Object.freeze({width:r,height:n}),this._callbacks.dispatch("onSizeUpdated",function(o){return o(_this307._size)})),(!this._camera||!Nr(this._camera,s))&&(this._camera=Object.freeze(T({},s)),this._callbacks.dispatch("onCameraUpdated",function(o){return o(_this307._camera)})),t.addSizeUpdatedListener(this.onSizeUpdated),t.addCameraUpdatedListener(this.onCameraUpdated),i.addBoundlessEventListener(this.onBoundlessEvent),i.addHandToolActiveListener(this.onHandToolActive),i.addCameraTransformationListener(this.onCameraTransformation)}},{key:"unregisterScreenAndCameraman",value:function unregisterScreenAndCameraman(t,i){t.removeSizeUpdatedListener(this.onSizeUpdated),t.removeCameraUpdatedListener(this.onCameraUpdated),i.removeBoundlessEventListener(this.onBoundlessEvent),i.removeHandToolActiveListener(this.onHandToolActive),i.removeCameraTransformationListener(this.onCameraTransformation)}},{key:"assertNotRelease",value:function assertNotRelease(){if(this.didRelease)throw new Error("view did release")}},{key:"watchScenePathUpdate",value:function watchScenePathUpdate(t){try{return t()}finally{var i=this.latestScenePath,_r186=this.node.scenePath;this.wannaFocusScenePath&&!this.shouldFollowScene(this._mode)&&_r186!==this.wannaFocusScenePath?this.node.isCursorsHidden=!0:this.node.isCursorsHidden=!1,i!==_r186&&(this.latestScenePath=_r186,this._callbacks.dispatch("onScenePathUpdated",function(n){return n(_r186)}))}}}]);return Fl}(Io);var Bl=/*#__PURE__*/function(_Io2){_inherits(Bl,_Io2);var _super92=_createSuper(Bl);function Bl(t,i,r){var _this308;_classCallCheck(this,Bl);_this308=_super92.call(this,i);_this308.viewsMap={};_this308.previousViewId=0;_this308.writer=null;_this308.params=t,_this308.context=Object.freeze(T({},r)),_this308._dynamicPpt=r.dynamicPpt,_this308._callbacks=new Yt,_this308.commonScreenContext=Object.freeze({observerId:i.observerId,forcePPTLandscape:i.forcePPTLandscape,disalbeImageHit:i.disalbeImageHit,disableOthersSelectingBox:i.disableOthersSelectingBox});return _this308}_createClass(Bl,[{key:"writableView",get:function get(){return this.writer}},{key:"dynamicPpt",get:function get(){return this._dynamicPpt}},{key:"callbacks",get:function get(){return this._callbacks}},{key:"onStateUpdate",value:function onStateUpdate(t,i){var r,n;if("observerId"in t&&this.updateCommonScreenContext("observerId",t.observerId),"forcePPTLandscape"in t&&this.updateCommonScreenContext("forcePPTLandscape",t.forcePPTLandscape),"disalbeImageHit"in t&&this.updateCommonScreenContext("disalbeImageHit",t.disalbeImageHit),"disableOthersSelectingBox"in t&&this.updateCommonScreenContext("disableOthersSelectingBox",t.disableOthersSelectingBox),"disableBoundlessEvent"in t&&this.forEach(function(s){return s.updateDisableBoundlessEvent(t.disableBoundlessEvent)}),"cursorClass"in t&&((r=this.writer)==null||r.updateCursorClass(t.cursorClass)),"cursorStyle"in t&&((n=this.writer)==null||n.updateCursorStyle(t.cursorStyle)),"playerState"in t){var s=t.playerState,o=this.context.pluginManager;o.setPlayerState?o.setPlayerState(s):s.isPlaying!==void 0&&o.setPlayingState(s.isPlaying)}}},{key:"setupViewContext",value:function setupViewContext(t){t.updateDisableBoundlessEvent(this.state.disableBoundlessEvent),t.updateCursorClass(this.state.cursorClass),t.updateCursorClass(this.state.cursorStyle)}},{key:"updateCommonScreenContext",value:function updateCommonScreenContext(t,i){this.commonScreenContext=Object.freeze(z(T({},this.commonScreenContext),_defineProperty({},t,i)));for(var _r187 in this.viewsMap){this.viewsMap[_r187].setCommonScreenContext(this.commonScreenContext)}}},{key:"forEach",value:function forEach(t){for(var i in this.viewsMap){t(this.viewsMap[i])}}},{key:"createView",value:function createView(t,i){var _this309=this;var r="".concat(this.previousViewId+=1),n=Object.freeze({onIsWriterChanged:function onIsWriterChanged(o){return _this309.changeViewIsWriter(s,o)},onRelease:function onRelease(){return _this309.releaseView(s)},onBoundlessEvent:function onBoundlessEvent(o){_this309._callbacks.dispatch("onBoundlessEvent",function(a){return a(s,o)})}}),s=new Fl(r,this.commonScreenContext,this.params,this.context,t,n,i);return this.viewsMap[s.id]=s,this.setupViewContext(s),this._callbacks.dispatch("onCreatedView",function(o){return o(s)}),s}},{key:"updateContext",value:function updateContext(t){var _this310=this;for(var i in this.viewsMap){var _r188=this.viewsMap[i];_r188.updateContext(t),this.setupViewContext(_r188)}this._dynamicPpt=t.dynamicPpt,this.writer&&this._callbacks.dispatch("onWritableScreenChanged",function(i){return i(_this310.writer)})}},{key:"fireReloadLibrary",value:function fireReloadLibrary(){var t,i;(i=(t=this.context.pluginManager).refreshPluginInstances)==null||i.call(t);for(var _r189 in this.viewsMap){this.viewsMap[_r189].fireReloadLibrary()}}},{key:"changeViewIsWriter",value:function changeViewIsWriter(t,i){if(i){if(this.writer&&this.writer!==t)throw new Error("there is another view who's mode is Writable. it should be singleton");this.writer=t,this.writer.updateCursorClass(this.state.cursorClass),this.writer.updateCursorStyle(this.state.cursorStyle),this._callbacks.dispatch("onWritableViewChanged",function(r){return r(t)}),this._callbacks.dispatch("onWritableScreenChanged",function(r){return r(t)})}else this.writer===t&&(this.writer.updateCursorClass(null),this.writer.updateCursorStyle(null),this.writer=null,this._callbacks.dispatch("onWritableViewChanged",function(r){return r(null)}),this._callbacks.dispatch("onWritableScreenChanged",function(r){return r(null)}))}},{key:"releaseView",value:function releaseView(t){delete this.viewsMap[t.id],this.writer===t&&(this.writer=null),this._callbacks.dispatch("onReleasedView",function(i){return i(t)})}}]);return Bl}(Io);var jl=/*#__PURE__*/function(){function jl(t){_classCallCheck(this,jl);this.viewsHub=t}_createClass(jl,[{key:"writableView",get:function get(){return this.viewsHub.writableView}},{key:"createView",value:function createView(t){var i={cameraBound:{},handToolActive:!1,divElement:null,disableCameraTransform:!1};return this.viewsHub.createView(i,t)}},{key:"forEach",value:function forEach(t){this.viewsHub.forEach(t)}}]);return jl}();var Po=/*#__PURE__*/function(){function Po(t){_classCallCheck(this,Po);this._owner=void 0;this._state=Object.freeze(T({},t))}_createClass(Po,[{key:"owner",get:function get(){return this._owner}},{key:"state",get:function get(){return this._state||this._owner.state}},{key:"putState",value:function putState(t){var i;if(this._state){var _r190=El(this._state,t);_r190&&(this._state=Object.freeze(_r190)),i=!!_r190}else i=this._owner.putState(t);return i}},{key:"updateOwner",value:function updateOwner(t){this._owner=t,this._state=null}}]);return Po}();var at=x(require("mobx"));var Iu=/*#__PURE__*/function(){function Iu(t){var _this311=this;_classCallCheck(this,Iu);this._callbacks=new Yt;this.set={};this.autoUpdateMembers=function(){var t=_this311.applianceManager,i={};var _iterator258=_createForOfIteratorHelper(_this311.getMemberIds(t)),_step258;try{for(_iterator258.s();!(_step258=_iterator258.n()).done;){var _r192=_step258.value;_r192 in _this311.set?delete _this311.set[_r192]:_this311.dispatchEvent("onAdded",t,_r192),i[_r192]=_r192}}catch(err){_iterator258.e(err)}finally{_iterator258.f()}for(var _r191 in _this311.set){var n=_this311.set[_r191];_this311.dispatchEvent("onRemoved",t,n)}_this311.set=i};this.applianceManager=t,this.disposer=(0,at.autorun)(this.autoUpdateMembers),(0,at.makeObservable)(this,{refresh:at.action})}_createClass(Iu,[{key:"callbacks",get:function get(){return this._callbacks}},{key:"forEach",value:function forEach(t){for(var i in this.set){t(this.applianceManager,this.set[i])}}},{key:"refresh",value:function refresh(){var t=this.applianceManager;this.disposer(),this.disposer=(0,at.autorun)(this.autoUpdateMembers),this._callbacks.dispatch("onRefreshed",function(i){return i(t)})}},{key:"createMapper",value:function createMapper(t){return new rv(this,t)}},{key:"dispose",value:function dispose(){this.disposer()}},{key:"dispatchEvent",value:function dispatchEvent(t,i,r){var _this312=this;setTimeout(function(){_this312._callbacks.dispatch(t,function(s){return(0,at.runInAction)(function(){s(i,r)})})},0)}},{key:"getMemberIds",value:function getMemberIds(t){if(t.getMemberIds)return t.getMemberIds();var i=t.getMemberDisplayers(),r=[];var _iterator259=_createForOfIteratorHelper(i),_step259;try{for(_iterator259.s();!(_step259=_iterator259.n()).done;){var n=_step259.value.memberId;r.push(n)}}catch(err){_iterator259.e(err)}finally{_iterator259.f()}return r}}]);return Iu}(),rv=/*#__PURE__*/function(){function rv(t,i){var _this313=this;_classCallCheck(this,rv);this._nodes=[];this.memberIds={};this.onAdded=function(t,i){i in _this313.memberIds||(_this313.memberIds[i]=!0,_this313._nodes.push(new zl(t,i,_this313.mapper)))};this.onRemoved=function(t,i){var r=_this313._nodes.findIndex(function(n){return n.memberId===i});r!==-1&&(_this313._nodes.splice(r,1),delete _this313.memberIds[i])};this.onRefreshed=function(){_this313._nodes.splice(0,_this313._nodes.length),_this313.memberIds={},_this313.members.forEach(function(t,i){_this313.memberIds[i]=!0,_this313._nodes.push(new zl(t,i,_this313.mapper))})};this.members=t,this.mapper=i,this.members.forEach(function(r,n){_this313.memberIds[n]=!0,_this313._nodes.push(new zl(r,n,i))}),this.members.callbacks.on("onAdded",this.onAdded),this.members.callbacks.on("onRemoved",this.onRemoved),this.members.callbacks.on("onRefreshed",this.onRefreshed),(0,at.makeObservable)(this,{_nodes:at.observable,targets:at.computed})}_createClass(rv,[{key:"targets",get:function get(){var t=[];var _iterator260=_createForOfIteratorHelper(this._nodes),_step260;try{for(_iterator260.s();!(_step260=_iterator260.n()).done;){var i=_step260.value;t.push(i.target)}}catch(err){_iterator260.e(err)}finally{_iterator260.f()}return t}},{key:"dispose",value:function dispose(){this.members.callbacks.off("onAdded",this.onAdded),this.members.callbacks.off("onRemoved",this.onRemoved),this.members.callbacks.off("onRefreshed",this.onRefreshed)}}]);return rv}(),zl=/*#__PURE__*/function(){function zl(t,i,r){_classCallCheck(this,zl);this.applianceManager=t,this.memberId=i,this.mapper=r,(0,at.makeObservable)(this,{target:at.computed})}_createClass(zl,[{key:"target",get:function get(){return this.mapper(this.applianceManager,this.memberId)}}]);return zl}();function nv(e){var _i53;if(!("getRectangle"in e.prototype))return e;var t=e;return _i53=/*#__PURE__*/function(_t18){_inherits(i,_t18);var _super93=_createSuper(i);function i(){var _this314;_classCallCheck(this,i);_this314=_super93.apply(this,arguments);_this314.cacheSegments={};_this314.cacheIdentifiers=[];_this314.isWrapped=!0;return _this314}_createClass(i,[{key:"getPrecisionSegments",value:function getPrecisionSegments(n){var s=_get(_getPrototypeOf(i.prototype),"getPrecisionSegments",this).call(this,n);return s||(s=this.cacheSegments[n]||null),s}},{key:"completePainting",value:function completePainting(n){var s=_get(_getPrototypeOf(i.prototype),"completePainting",this).call(this);if(s){var o,a;n?(o=n.originX,a=n.originY):(o=s.left,a=s.top),this.cachePrecisionSegments(s.identifier,{points:s.points,beginIndex:s.beginIndex,left:o,top:a})}return s}},{key:"fireRemoveComponent",value:function fireRemoveComponent(n){delete this.cacheSegments[n],_get(_getPrototypeOf(i.prototype),"fireRemoveComponent",this).call(this,n)}},{key:"cachePrecisionSegments",value:function cachePrecisionSegments(n,s){if(!this.cacheSegments[n]){this.cacheSegments[n]=s,this.cacheIdentifiers.push(n);var _i54=_i53,o=_i54.maxCacheCount;if(this.cacheIdentifiers.length>o){var a=this.cacheIdentifiers.shift();delete this.cacheSegments[a]}}}}]);return i}(t),_i53.maxCacheCount=3,_i53}var Ul=500,bs="/";function sv(e){return _typeof(e)=="object"&&e!==null}var Mo=/*#__PURE__*/function(){function Mo(_ref121){var _this315=this;var t=_ref121.logger,i=_ref121.region,r=_ref121.boundless,n=_ref121.useMobXState,s=_ref121.preloadDynamicPPT,o=_ref121.userFonts,a=_ref121.pptHandler,c=_ref121.globalStateUpdater,h=_ref121.screenType,d=_ref121.cameraBound,u=_ref121.renderEngine,p=_ref121.autoResize,f=_ref121.plugins,m=_ref121.wrappedComponents,g=_ref121.floatBarClass,y=_ref121.useMultiViews,b=_ref121.willHideSelfCursor,S=_ref121.disableCameraTransform,w=_ref121.memberStateStorage,P=_ref121.onlyCallbackRemoteStateModify,A=_ref121.invisiblePlugins,E=_ref121.handToolKey,R=_ref121.fontFamily,N=_ref121.disableOperations,_=_ref121.disableOthersSelectingBox,ie=_ref121.cursorAdapter,ce=_ref121.eraserRadiusCursor,U=_ref121.textareaHub,He=_ref121.eventInterrupter,ii=_ref121.callbacks,Ae=_ref121.urlInterrupter,bt=_ref121.onTextareaUpdate,_e=_ref121.userPayload,lt=_ref121.pptParams;_classCallCheck(this,Mo);this.magixEventsManager=new uu;this.preloadDynamicPPT=!1;this.mainViewProxy=null;this.membersMapper=null;this.context=null;this._views=null;this.libraryNodeFetcher=/*#__PURE__*/function(){var _ref122=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee90(t){var i,r,n;return regeneratorRuntime.wrap(function _callee90$(_context94){while(1){switch(_context94.prev=_context94.next){case 0:i="".concat(ee.modules.identifier,"/").concat(t.libIdentifier);_context94.next=3;return vb(i);case 3:r=_context94.sent;n=r.WhiteModel["default"];return _context94.abrupt("return",(_this315.logger.info("load modules ",i),Object.freeze({modules:r,libraryClass:n,appVersion:t.appVersion})));case 6:case"end":return _context94.stop();}}},_callee90)}));return function(_x164){return _ref122.apply(this,arguments)}}();this.covertMemberDisplayerToMember=function(t,i){var r=_this315.getMemberInformation(t,i),n=r?r.session:"",s=r&&r.payload,o=_this315.memberState(i);return o||(o=_this315.getDefaultMemberState()),{memberId:i,memberState:o,session:n,payload:se(s)}};this.logger=t,this.region=i,this.useMobXState=n,this.textareaHub=U,this.boundless=r,this.screenType=h,this.eraserRadiusCursor=ce,this.pluginOperator=this.createPluginOperator(),this.plugins=f,this.autoResize=p,this.cameraObserver=new lu,this.wrappedComponents=Object.freeze(_toConsumableArray(m)),this.onlyCallbackRemoteStateModify=P,this.invisiblePluginNode=new Tl(t,this,A),this.callbacks=new Yt(ii),this.preloadDynamicPPT=s,this.viewsParams=Object.freeze({logger:t,renderEngine:u,boundless:r,cameraBound:d,fontFamily:R,cursorAdapter:ie,autoResize:p,floatBarClass:g,memberStateStorage:w,wrappedComponents:this.createWrappedComponents(),disableOperations:N,disableOthersSelectingBox:_,willHideSelfCursor:b,handToolKey:E,eventInterrupter:He,urlInterrupter:Ae,onTextareaUpdate:bt,textareaHub:U,userPayload:_e,pptParams:lt,onScreenSizeUpdated:function onScreenSizeUpdated(Ye){return _this315.onScreenSizeUpdated(Ye)}}),this.dynamicPptParams={globalStateUpdater:c,observerId:re,userFonts:o,preload:s,pptHandler:a,logger:t,pptParams:lt,userPayload:_e,pptAssetsOrigin:"https://convertcdn.netless.link/dynamicConvert",onPPTLoadProgress:function onPPTLoadProgress(Ye,nr){return _this315.callbacks.dispatch("onPPTLoadProgress",function(zr){return zr(Ye,nr)})},onPPTMediaPause:function onPPTMediaPause(Ye,nr){return _this315.callbacks.dispatch("onPPTMediaPause",function(zr){return zr(Ye,nr)})},onPPTMediaPlay:function onPPTMediaPlay(Ye,nr){return _this315.callbacks.dispatch("onPPTMediaPlay",function(zr){return zr(Ye,nr)})}},this.viewsHubProxy=new Po({observerId:re,forcePPTLandscape:!1,disalbeImageHit:!1,disableBoundlessEvent:!0,disableOthersSelectingBox:!1,cursorClass:null,cursorStyle:null,playerState:Object.freeze({isPlaying:!0,timestamp:0,playbackSpeed:1})}),y||(this.mainViewProxy=new Po({cameraBound:d,handToolActive:!1,divElement:null,disableCameraTransform:!!S}))}_createClass(Mo,[{key:"enableWriteNow",get:function get(){return!1}},{key:"deviceType",get:function get(){return this.boundless.deviceType}},{key:"observerId",get:function get(){return this.viewsHubProxy.state.observerId}},{key:"version",get:function get(){return ee.sdkVersion}},{key:"viewsHub",get:function get(){return this.viewsHubProxy.owner}},{key:"useMultiViews",get:function get(){return!this.mainViewProxy}},{key:"mainView",get:function get(){return this.assertMainViewProxy().owner}},{key:"members",get:function get(){return this._members}},{key:"memberStateStorage",get:function get(){return this.viewsParams.memberStateStorage}},{key:"onScreenSizeUpdated",value:function onScreenSizeUpdated(t){}},{key:"createWrappedComponents",value:function createWrappedComponents(){return[].concat(_toConsumableArray(this.wrappedComponents),[fs(pu,this)])}},{key:"createPluginOperator",value:function createPluginOperator(){return Object.freeze({remove:function remove(){throw new Error("it is not a writable room")},update:function update(){throw new Error("it is not a writable room")},getPlugin:function getPlugin(){throw new Error("it is not a writable room")}})}},{key:"scalePptToFit",value:function scalePptToFit(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Q.Continuous;var i=this.state.sceneState.scenes[this.state.sceneState.index];i.ppt&&this.moveCameraToContain({originX:-i.ppt.width/2,originY:-i.ppt.height/2,width:i.ppt.width,height:i.ppt.height,animationMode:t})}},{key:"scenePathType",value:function scenePathType(t){var i=t.replace(/\/$/g,"").split(bs);i.shift();var r=this.applianceManager.scenes.findSceneOrGroup(i),n=this.context.modules.WhiteModel.SceneNode;if(r&&Vt(r,n))return ot.Page;if(r)return ot.Dir;for(;i.length>1;){i.pop();var s=this.applianceManager.scenes.findSceneOrGroup(i);if(s&&Vt(s,n))return ot.Conflict}return ot.None}},{key:"entireScenes",value:function entireScenes(){var t=this.applianceManager,i=se(t.getAllScenePaths()),r={};var _iterator261=_createForOfIteratorHelper(i),_step261;try{for(_iterator261.s();!(_step261=_iterator261.n()).done;){var n=_step261.value;var s=se(t.getScene(n)),o=n.slice(0,-1),a="".concat(bs).concat(o.join(bs));r[a]=r[a]||[],s&&r[a].push(s)}}catch(err){_iterator261.e(err)}finally{_iterator261.f()}return r}},{key:"refreshViewSize",value:function refreshViewSize(){var t;this.autoResize||(t=this.viewsHubProxy.owner)==null||t.forEach(function(i){return i.resizeScreen()})}},{key:"getCurrentSceneState",value:function getCurrentSceneState(){var t=this.applianceManager,i=se(t.getCurrentScenePath()),r=Ft.stringify(i),n=i.pop(),s=t.getSceneNames(i),o=Ft.stringify(i),a=[],c=Number.NaN;for(var h=0;h<s.length;++h){var d=s[h],u=t.getScene([].concat(_toConsumableArray(i),[d]));(u==null?void 0:u.name)===n&&(c=h),a[h]=se(u)}return{sceneName:n,scenePath:r,contextPath:o,scenes:a,index:c}}},{key:"assignAttributes",value:function assignAttributes(t,i){if(this.context){var _r193=i;if(_r193===void 0||sv(_r193)){var n=this.context.pluginManager.findPlugin(t);n&&sv(n.defaultAttributes)&&(_r193=T(T({},n.defaultAttributes),_r193))}return _r193}}},{key:"hasLibraryNode",get:function get(){return!!this.context}},{key:"getDefaultMemberState",value:function getDefaultMemberState(){return{currentApplianceName:X.pencil,strokeColor:[0,0,0],strokeWidth:4,textSize:16,bold:!1,italic:!1,underline:!1,lineThrough:!1}}},{key:"bezierCurvePainter",get:function get(){return this.context?this.context.bezierCurvePainter:null}},{key:"getCursorStyleWithRadius",value:function getCursorStyleWithRadius(t){return t===0?void 0:this.eraserRadiusCursor.cursorStyle(t)}},{key:"putPlayerState",value:function putPlayerState(t){var i=Object.freeze(T(T({},this.viewsHubProxy.state.playerState),t));this.viewsHubProxy.putState({playerState:i})}},{key:"updateLibraryNode",value:function updateLibraryNode(t){var d;this._members=new Iu(this.applianceManager),this.membersMapper=(d=this.membersMapper)!=null?d:this._members.createMapper(this.covertMemberDisplayerToMember);var i=t.modules,_i$WhiteRender=i.WhiteRender,r=_i$WhiteRender.createDynamicPpt,n=_i$WhiteRender.EnginesHub,s=_i$WhiteRender.BezierCurvePainter,o=this.createPluginManager(i,this.pluginOperator,this.plugins),a=this.createBezierCurvePainter(s),c=r(z(T({},this.dynamicPptParams),{observerId:this.viewsHubProxy.state.observerId})),h=Object.freeze({appVersion:t.appVersion,applianceManager:this.applianceManager,members:this._members,pluginManager:o,dynamicPpt:c,bezierCurvePainter:a,engines:n&&new n(this.viewsParams.renderEngine),modules:i});if(this.viewsHubProxy.owner)this.viewsHubProxy.owner.updateContext(h);else{var u=this.viewsHubProxy.state,p=new Bl(this.viewsParams,u,h);if(this.viewsHubProxy.updateOwner(p),this._views=new jl(p),this.mainViewProxy){var f=this.mainViewProxy.state,m=p.createView(f);m.mode=Pe.Writable,this.mainViewProxy.updateOwner(m),this.cameraObserver.setupMainView(m),m.callbacks.forwardTo("onHandToolActive",this.callbacks),m.callbacks.forwardTo("onRenderDuration",this.callbacks)}}this.context=Object.freeze({modules:i,pluginManager:o,bezierCurvePainter:a}),this.refreshViewSize()}},{key:"createPluginManager",value:function createPluginManager(t,i,r){var n=t.WhiteRender.PluginManager,s=r?r.plugins:{},o=new n(s,i);return r&&r.setPluginManager(o),o}},{key:"createBezierCurvePainter",value:function createBezierCurvePainter(t){var i=null;if(t){var _r194=t;this.disablePencilWrittingLimitFrequency||(_r194=nv(t)),i=new _r194([.1,.3,.5,.7,.9,1])}return i}},{key:"refreshRender",value:function refreshRender(){var t;(t=this.viewsHubProxy.owner)==null||t.forEach(function(i){return i.refreshRender()})}},{key:"disableOthersSelectingBox",get:function get(){return this.viewsHubProxy.state.disableOthersSelectingBox},set:function set(t){this.viewsHubProxy.putState({disableOthersSelectingBox:t})}},{key:"views",get:function get(){if(this.mainViewProxy)throw new Error("you can only read views when useMultiViews is true");if(!this._views)throw new Error("views is not ready");return this._views}},{key:"dispose",value:function dispose(){var t,i,r;(t=this.viewsHubProxy.owner)==null||t.forEach(function(n){return n.release()}),this.eraserRadiusCursor.release(),this.invisiblePluginNode.dispose(),this.cameraObserver.dispose(),(i=this.membersMapper)==null||i.dispose(),this._members.dispose(),(r=this.memberStateStorage)==null||r.dispose()}},{key:"setObserverId",value:function setObserverId(t){var r;((r=this.viewsHubProxy.owner)==null?void 0:r.putState({observerId:t}))&&this.dynamicPpt.updateObserverId&&this.dynamicPpt.updateObserverId(t)}},{key:"dynamicPpt",get:function get(){return this.viewsHubProxy.owner.dynamicPpt}},{key:"fetchNextPptSlideIfNeeded",value:function fetchNextPptSlideIfNeeded(t){var i;if(this.preloadDynamicPPT&&t.index+1<t.scenes.length){var n=(i=t.scenes[t.index+1].ppt)==null?void 0:i.src;this.dynamicPpt.getPptSildeDefinition(n||"")}}},{key:"getRoomMembers",value:function getRoomMembers(){return this.membersMapper.targets}},{key:"getInvisiblePlugin",value:function getInvisiblePlugin(t){return this.invisiblePluginNode.get(t)}},{key:"dispatchMagixEventWithObject",value:function dispatchMagixEventWithObject(t,i,r){var n=t;ge(n.payload)&&(n=z(T({},n),{payload:n.payload.primitiveBuffer})),this.magixEventsManager.dispatchEvent(n,i,r)}},{key:"addMagixEventListener",value:function addMagixEventListener(t,i,r){var n=this.standardizeOptions(r),s=!!n.fireSelfEventAfterCommit,o=n.fireInterval;o===void 0?this.magixEventsManager.addMagixEventListener(t,i,s):(o<Ul&&(this.logger.warn("fireInterval ".concat(o,"ms of event ").concat(JSON.stringify(t)," can't less than ").concat(Ul,"ms, it's will be reset as ").concat(Ul,"ms")),o=Ul),this.magixEventsManager.addMagixEventsListener(t,i,o,s))}},{key:"standardizeOptions",value:function standardizeOptions(t){return typeof t=="undefined"?{}:typeof t=="number"?{fireInterval:t}:t}},{key:"removeMagixEventListener",value:function removeMagixEventListener(t,i){this.magixEventsManager.removeMagixEventListener(t,i)}},{key:"waitMagixEvent",value:function waitMagixEvent(t){return this.magixEventsManager.waitMagixEvent(t)}},{key:"memberState",value:function memberState(t){return se(this.applianceManager.getMemberState(t))}},{key:"getMemberInformation",value:function getMemberInformation(t,i){if(t.getMemberInformation)return t.getMemberInformation(i);var r=t.getMemberDisplayers();var _iterator262=_createForOfIteratorHelper(r),_step262;try{for(_iterator262.s();!(_step262=_iterator262.n()).done;){var n=_step262.value;if(n.memberId===i)return n.information}}catch(err){_iterator262.e(err)}finally{_iterator262.f()}}},{key:"assertMainViewProxy",value:function assertMainViewProxy(){var t=this.mainViewProxy;if(!t)throw new Error("can not use these methods or properties. you should pass useMultiViews: false");return t}},{key:"scenePreview",value:function scenePreview(t,i,r,n){var s=this.assertMainViewProxy().owner;s&&s.scenePreview(t,i,r,n)}},{key:"generateScreenshot",value:function(){var _generateScreenshot2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee91(t,i,r){return regeneratorRuntime.wrap(function _callee91$(_context95){while(1){switch(_context95.prev=_context95.next){case 0:return _context95.abrupt("return",this.assertMainViewProxy().owner.generateScreenshot(t,i,r));case 1:case"end":return _context95.stop();}}},_callee91,this)}));function generateScreenshot(_x165,_x166,_x167){return _generateScreenshot2.apply(this,arguments)}return generateScreenshot}()},{key:"fillSceneSnapshot",value:function fillSceneSnapshot(t,i,r,n){var s;(s=this.assertMainViewProxy().owner)==null||s.fillSceneSnapshot(t,i,r,n)}},{key:"convertToPointInWorld",value:function convertToPointInWorld(t){var i=this.assertMainViewProxy().owner;return i?i.convertToPointInWorld(t):{x:t.x,y:t.y}}},{key:"handToolActive",get:function get(){return this.assertMainViewProxy().state.handToolActive},set:function set(t){this.assertMainViewProxy().putState({handToolActive:t})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",function(n){return n(t)})}},{key:"handToolKey",get:function get(){return this.assertMainViewProxy().state.handToolKey}},{key:"disableCameraTransform",get:function get(){return this.assertMainViewProxy().state.disableCameraTransform},set:function set(t){this.assertMainViewProxy().putState({disableCameraTransform:t})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",function(n){return n(t)})}},{key:"bindHtmlElement",value:function bindHtmlElement(t){this.assertMainViewProxy().putState({divElement:t})}},{key:"setCameraBound",value:function setCameraBound(t){this.assertMainViewProxy().putState({cameraBound:t})}},{key:"moveCamera",value:function moveCamera(t){this.assertMainViewProxy().putState({cameraMoving:{camera:t}})}},{key:"moveCameraToContain",value:function moveCameraToContain(t){this.assertMainViewProxy().putState({cameraMoving:{toContaint:t}})}}]);return Mo}();var te;(function(s){s.Connecting="connecting",s.Connected="connected",s.Reconnecting="reconnecting",s.Disconnecting="disconnecting",s.Disconnected="disconnected"})(te||(te={}));var Fr;(function(r){r.ThrowError="throwError",r.Warn="warn",r.Ignore="ignore"})(Fr||(Fr={}));var gv=x(require("uuid"));var Pu=/*#__PURE__*/function(){function Pu(t,i,r){_classCallCheck(this,Pu);this.enableDrawPoint=t;this.disableNewPencil=i;this.undoStack=r}_createClass(Pu,[{key:"becomeWritable",value:function becomeWritable(t){if(this.disableNewPencil){var i=t.getMemberState();if(i){var _r195=i.pencilOptions;_r195?_r195=z(T({},_r195),{disableBezier:!0}):_r195={disableBezier:!0,enableDrawPoint:!1,sparseHump:3,sparseWidth:4};var _t$setMemberStateWith=t.setMemberStateWithCommitter({pencilOptions:_r195}),n=_t$setMemberStateWith.committer;n&&this.undoStack.commit(n)}}}},{key:"shouldUseNewPencil",value:function shouldUseNewPencil(t){return!this.disableNewPencil&&t===X.pencil}}]);return Pu}();var ov=Object.freeze({x:0,y:0});function sP(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Vl(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function av(e){return Math.pow(e.x,2)+Math.pow(e.y,2)}function ir(e,t){return{x:e.x+t.x,y:e.y+t.y}}function lv(){for(var _len24=arguments.length,e=new Array(_len24),_key24=0;_key24<_len24;_key24++){e[_key24]=arguments[_key24]}return{x:e.reduce(function(t,i){return t+i.x},0),y:e.reduce(function(t,i){return t+i.y},0)}}function Bt(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Me(e,t){return{x:e.x*t,y:e.y*t}}function oP(e,t){return{x:e.x/t,y:e.y/t}}function cv(e){var t=Vl(e);return t===0?e:oP(e,t)}function Br(e,t){return e.x*t.x+e.y*t.y}function hv(e,t){if(e.length<2)return[];var i=e.length,r=uv(e[1],e[0]),n=uv(e[i-2],e[i-1]);return Mu(e,r,n,t)}function Mu(e,t,i,r){var n=20;if(e.length===2){var m=sP(e[0],e[1])/3;return[{curve:[e[0],ir(e[0],Me(t,m)),ir(e[1],Me(i,m)),e[1]],beginIndex:0,count:e.length}]}var s=hP(e),_dv=dv(e,s,s,t,i),_dv2=_slicedToArray(_dv,3),o=_dv2[0],a=_dv2[1],c=_dv2[2];if(a===0||a<r)return[{curve:o,beginIndex:0,count:e.length}];if(a<r*r){var _m28=s,g=a,y=c;for(var b=0;b<n;b++){var _dv3,_dv4;if(_m28=lP(o,e,_m28),(_dv3=dv(e,s,_m28,t,i),_dv4=_slicedToArray(_dv3,3),o=_dv4[0],a=_dv4[1],c=_dv4[2],_dv3),a<r)return[{curve:o,beginIndex:0,count:e.length}];if(c===y){var S=a/g;if(S>.9999&&S<1.0001)break}g=a,y=c}}var h=Bt(e[c-1],e[c+1]);if(h.x===0&&h.y===0){var _Bt=Bt(e[c-1],e[c]),_m29=_Bt.x,_g10=_Bt.y;h={x:-_g10,y:_m29}}var d=cv(h),u=Me(d,-1),p=Mu(e.slice(0,c+1),t,d,r),f=Mu(e.slice(c),u,i,r);var _iterator263=_createForOfIteratorHelper(f),_step263;try{for(_iterator263.s();!(_step263=_iterator263.n()).done;){var _m30=_step263.value;_m30.beginIndex+=c}}catch(err){_iterator263.e(err)}finally{_iterator263.f()}return[].concat(_toConsumableArray(p),_toConsumableArray(f))}function dv(e,t,i,r,n){var s=aP(e,i,r,n),_dP=dP(e,s,t),_dP2=_slicedToArray(_dP,2),o=_dP2[0],a=_dP2[1];return[s,o,a]}function aP(e,t,i,r){var n=e[0],s=e[e.length-1],o=[n,ov,ov,s],a=t.map(function(b){var S=1-b;return[Me(i,3*b*(S*S)),Me(r,3*S*(b*b))]}),c=[[0,0],[0,0]],h=[0,0];for(var _i55=0,_Array$from=Array.from(t.entries());_i55<_Array$from.length;_i55++){var _Array$from$_i=_slicedToArray(_Array$from[_i55],2),b=_Array$from$_i[0],S=_Array$from$_i[1];var _a$b=_slicedToArray(a[b],2),w=_a$b[0],P=_a$b[1];c[0][0]+=Br(w,w),c[0][1]+=Br(w,P),c[1][0]+=Br(w,P),c[1][1]+=Br(P,P);var A=Bt(e[b],Wl([n,n,s,s],S));h[0]+=Br(w,A),h[1]+=Br(P,A)}var d=c[0][0]*c[1][1]-c[1][0]*c[0][1],u=c[0][0]*h[1]-c[1][0]*h[0],p=h[0]*c[1][1]-h[1]*c[0][1],f=d===0?0:p/d,m=d===0?0:u/d,g=Vl(Bt(n,s)),y=1e-6*g;return f<y||m<y?(o[1]=ir(n,Me(i,g/3)),o[2]=ir(s,Me(r,g/3))):(o[1]=ir(n,Me(i,f)),o[2]=ir(s,Me(r,m))),o}function lP(e,t,i){return i.map(function(r,n){return cP(e,t[n],r)})}function cP(e,t,i){var r=Bt(Wl(e,i),t),n=mP(e,i),s=Br(r,n),o=av(n)+2*Br(r,fP(e,i));return o===0?i:i-s/o}function hP(e){var t=[],i,r,n;return e.forEach(function(s,o){i=o>0?r+Vl(Bt(s,n)):0,t.push(i),r=i,n=s}),t=t.map(function(s){return r===0?0:s/r}),t}function dP(e,t,i){var r=0,n=Math.floor(e.length/2),s=uP(t,10);for(var o=1;o<e.length-1;o++){var a=e[o],c=pP(t,i[o],s,10),h=Bt(Wl(t,c),a),d=av(h);d>r&&(r=d,n=o)}return[r,n]}function uP(e,t){var i=[0],r=e[0],n=0;for(var s=1;s<=t;s++){var o=Wl(e,s/t);n+=Vl(Bt(o,r)),i.push(n),r=o}return i=i.map(function(s){return s/n}),i}function pP(e,t,i,r){if(t<0)return 0;if(t>1)return 1;for(var n=1;n<=r;n++){if(t<=i[n]){var s=(n-1)/r,o=n/r,a=i[n-1],c=i[n];return(t-a)/(c-a)*(o-s)+s}}return Number.NaN}function uv(e,t){return cv(Bt(e,t))}function Wl(e,t){var i=1-t,r=Me(e[0],Math.pow(i,3)),n=Me(e[1],3*Math.pow(i,2)*t),s=Me(e[2],3*i*Math.pow(t,2)),o=Me(e[3],Math.pow(t,3));return lv(r,n,s,o)}function mP(e,t){var i=1-t,r=Me(Bt(e[1],e[0]),3*Math.pow(i,2)),n=Me(Bt(e[2],e[1]),6*i*t),s=Me(Bt(e[3],e[2]),3*Math.pow(t,2));return lv(r,n,s)}function fP(e,t){return ir(Me(ir(Bt(e[2],Me(e[1],2)),e[0]),6*(1-t)),Me(ir(Bt(e[3],Me(e[2],2)),e[1]),6*t))}var To=/*#__PURE__*/function(){function To(t){var _this316=this;_classCallCheck(this,To);this.onLimiterInvoke=function(){if(_this316.nextInvoker)try{_this316.nextInvoker()}finally{_this316.nextInvoker=void 0}};this.limiter=new ct(t,this.onLimiterInvoke)}_createClass(To,[{key:"limitDuration",get:function get(){return this.limiter.limitDuration},set:function set(t){this.limiter.limitDuration=t}},{key:"invoke",value:function invoke(t){this.nextInvoker=t,this.limiter.invoke()}},{key:"flush",value:function flush(){this.nextInvoker&&this.onLimiterInvoke(),this.cancel()}},{key:"cancel",value:function cancel(){this.nextInvoker=void 0,this.limiter.cancel()}}]);return To}();var jr=/*#__PURE__*/function(){function jr(t,i,r,n,s){var _this317=this;_classCallCheck(this,jr);this.paintingShape=null;this.extraSteups=0;this.lastCurveBeginIndex=0;this.points=[];this.commiter=null;this.onAddExtraSteups=function(){var t;(t=_this317.invoker)==null||t.flush(),_this317.applianceManager.addBezierCurveExtraSteups(),_this317.extraSteups+=1,_this317.extraSteups>=_this317.bezierCurvePainter.maxExtraSteups&&_this317.fountain.stop()};this.applianceManager=t,this.cameraObserver=i,this.pencilOptions=r,this.bezierCurvePainter=n,this.fountain=new Hl(this.onAddExtraSteups),!s&&n.isWrapped?this.invoker=new To(Zb):this.invoker=null}_createClass(jr,[{key:"pushBoundlessMouseEvent",value:function pushBoundlessMouseEvent(t,i){switch(this.commiter=null,t){case v.MouseDown:case v.SortedTouchStart:{this.onMouseDown(i);break}case v.MouseMove:case v.SortedTouchMove:{this.onMouseMove(i);break}case v.MouseUp:case v.SortedTouchEnd:case v.SortedTouchCancel:{this.onMouseUp(i);break}case v.MouseLeave:{this.onMouseLeave(i);break}}return this.commiter}},{key:"onMouseDown",value:function onMouseDown(_ref123){var t=_ref123.x,i=_ref123.y;this.paintingShape||(this.paintingShape=this.createCurveShape(t,i),this.points.push(this.createStrokePoint(t,i)),this.fountain.touch())}},{key:"onMouseMove",value:function onMouseMove(t){if(this.paintingShape){var i=t.x,_r196=t.y;this.points.push(this.createStrokePoint(i,_r196)),this.fitCurvesIfNeed(),this.fountain.touch()}else this.applianceManager.onMouseMove(t)}},{key:"onMouseUp",value:function onMouseUp(_ref124){var t=_ref124.x,i=_ref124.y;var r;this.paintingShape&&((r=this.invoker)==null||r.flush(),this.fountain.stop(),this.shouldCancelPaintingPencil()?this.applianceManager.cancelPencilPainting(t,i):this.commiter=this.applianceManager.completePencilPainting(t,i),this.bezierCurvePainter.completePainting(this.paintingShape),this.points=[],this.paintingShape=null)}},{key:"onMouseLeave",value:function onMouseLeave(t){this.paintingShape||(this.commiter=this.applianceManager.onMouseLeave(t))}},{key:"createStrokePoint",value:function createStrokePoint(t,i){var r=this.points[this.points.length-1],n=0;if(r){var s=t-r.x,o=i-r.y;n=r.distance+Math.sqrt(s*s+o*o)}return this.points.length<jr.maxSegmentsPointsCount?this.bezierCurvePainter.pushPoint(t,i):this.bezierCurvePainter.touchPoint(t,i),{x:t,y:i,distance:n}}},{key:"createCurveShape",value:function createCurveShape(t,i){var r=this.applianceManager.createBezierCurve({x:t,y:i}),n=Ls(r);return this.bezierCurvePainter.startPainting(n),this.paintingShape=r,this.extraSteups=0,this.lastCurveBeginIndex=0,r}},{key:"fitCurvesIfNeed",value:function fitCurvesIfNeed(){var _this318=this;if(this.points.length>1){var t=0;this.extraSteups>0&&(this.extraSteups-=1,t=1),this.invoker&&this.points.length<jr.maxSegmentsPointsCount?this.invoker.invoke(function(){return _this318.syncCurve(t)}):this.syncCurve(t)}}},{key:"syncCurve",value:function syncCurve(t){var i=jr.fitCurveMaxError/this.cameraObserver.cameraState.scale,r=this.points.slice(this.lastCurveBeginIndex),n=hv(r,Math.pow(i,2));if(n.length===1){var s=n[0].curve,o=this.points.length-this.lastCurveBeginIndex,a=this.createBezierCurve(s,0,o);this.applianceManager.updateBezierCurveTail(a,t)}else if(n.length>1){var _s42=0,_o33=[];var _iterator264=_createForOfIteratorHelper(n),_step264;try{for(_iterator264.s();!(_step264=_iterator264.n()).done;){var _step264$value=_step264.value,_a29=_step264$value.curve,c=_step264$value.beginIndex,h=_step264$value.count;_o33.push(this.createBezierCurve(_a29,c,h)),_s42=Math.max(_s42,c)}}catch(err){_iterator264.e(err)}finally{_iterator264.f()}this.lastCurveBeginIndex+=_s42,this.applianceManager.splitBezierCurveTail(_o33,t)}}},{key:"shouldCancelPaintingPencil",value:function shouldCancelPaintingPencil(){if(!this.paintingShape||this.pencilOptions.enableDrawPoint)return!1;if(this.bezierCurvePainter.getRectangle){var t=Ls(this.paintingShape),i=this.bezierCurvePainter.getRectangle(t);if(i){var _r197=this.paintingShape.hitTestingBoxMargin/5,n=i.width,s=i.height;if(n>_r197||s>_r197)return!1}return!0}else return this.paintingShape.isLikePoint()}},{key:"createBezierCurve",value:function createBezierCurve(t,i,r){var s=r-2,o=this.points[i],a=this.points[i+r-1];return{point1:t[1],point2:t[2],point3:t[3],hiddenPoints:s,cubic:this.fitCubic(i,r),distance:a.distance-o.distance}}},{key:"fitCubic",value:function fitCubic(t,i){var r=null,n=this.points[t].distance,s=this.points[t+i-1].distance-n;if(i>=3&&s>0){var o=[],a=[];for(var c=0;c<i;++c){var h=this.points[t+c].distance;o[c]=(h-n)/s,a[c]=c/(i-1)}r=jr.getLinearRegression(o,a)}return r||(r=_toConsumableArray(jr.defaultCubic)),r}}],[{key:"getLinearRegression",value:function getLinearRegression(t,i){var r=null,n=0,s=0,o=0,a=0,c=0;for(var h=1;h<t.length;++h){var d=t[h],u=i[h];if(d!==0){var p=d*d,f=u/p;n+=f,s+=d,o+=p,a+=f*d,c+=1}}if(c>2){var _h15=s/c,_d13=n/c,_u19=(a-_d13*_h15)/(o-s*s/c),_p19=_d13-_u19*_h15,_f15=_p19+_u19;r=[_p19/_f15,_u19/_f15,0,0]}return r}}]);return jr}(),vs=jr;vs.fitCurveMaxError=1,vs.maxSegmentsPointsCount=350,vs.defaultCubic=Object.freeze(jr.getLinearRegression([0,.2,.4,.6,.8,1],[0,.2,.4,.6,.8,1]));var _l=/*#__PURE__*/function(){function _l(t){var _this319=this;_classCallCheck(this,_l);this.onGush=t;this.sleepTimer=null;this.gushInterval=null;this.onTick=function(){_this319.sleepTimer=null,_this319.gushInterval=setTimeout(_this319.onTick,_l.GushInterval),_this319.onGush()}}_createClass(_l,[{key:"touch",value:function touch(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&clearTimeout(this.sleepTimer),this.sleepTimer=setTimeout(this.onTick,_l.SleepDuration)}},{key:"stop",value:function stop(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&(clearTimeout(this.sleepTimer),this.sleepTimer=null)}}]);return _l}(),Hl=_l;Hl.SleepDuration=17*4,Hl.GushInterval=17;var Tu=/*#__PURE__*/function(){function Tu(t){_classCallCheck(this,Tu);this.inputs={};this.outputs={};this.previousId=0;this.pressedInputId="";this.isPressed=!1;this.output=void 0;this.outputSwitch=t}_createClass(Tu,[{key:"createInput",value:function createInput(){var _this320=this;var t="".concat(this.previousId+=1),i=Object.freeze({id:t,pushEvent:function pushEvent(r){return _this320.pushEventByInput(t,r)}});return this.inputs[t]={input:i,isPressed:!1},i}},{key:"removeInput",value:function removeInput(t){var i=this.inputs[t.id];(i==null?void 0:i.input)===t&&(delete this.inputs[t.id],this.pressedInputId=t.id,this.pressedInputId&&(this.pressedInputId=""))}},{key:"putOutput",value:function putOutput(t,i){this.outputs[t]=i}},{key:"pushEventByInput",value:function pushEventByInput(t,i){var r=this.inputs[t];switch(i.kind){case v.MouseDown:case v.SortedTouchStart:{r.isPressed=!0,this.isPressed=!0,this.pressedInputId===""&&(this.pressedInputId=t,this.pushEvent(r.input,i));break}case v.MouseMove:case v.MouseLeave:case v.SortedTouchMove:{(this.pressedInputId===""&&!r.isPressed||this.pressedInputId===t)&&this.pushEvent(r.input,i);break}case v.MouseUp:case v.SortedTouchEnd:case v.SortedTouchCancel:{this.pressedInputId===t&&(this.pressedInputId="",this.pushEvent(r.input,i)),r.isPressed=!1,this.isPressed=!1;break}}}},{key:"pushEvent",value:function pushEvent(t,i){var s;var r=this.outputSwitch(t),n=this.outputs[r];if(this.output===void 0||this.output!==r){var o=this.output!==void 0?this.outputs[this.output]:void 0;this.output=r,this.isPressed&&((s=o==null?void 0:o.onCancel)==null||s.call(o,i,t),n==null||n.onEvent(i,t))}else n==null||n.onEvent(i,t)}}]);return Tu}();var ti=x(require("mobx"));var Eo=/*#__PURE__*/function(){function Eo(t,i){var _this321=this;_classCallCheck(this,Eo);this.isReadonlyMode=!1;this.isOverrideWithFreedom=!1;this.overrideDisposer=null;this.previousRectangle=null;this.onCreatedView=function(t){_this321.previousRectangle&&_this321.refreshScreenRectangle(t,_this321.previousRectangle)};this.viewsHub=t,this.applianceManager=i,this.followerCheckingDisposer=(0,ti.reaction)(function(){return _this321.getCurrentMode()===ae.Follower},function(r){r?_this321.refreshCameraRectangle():_this321.previousRectangle=null}),t.callbacks.on("onCreatedView",this.onCreatedView),(0,ti.makeObservable)(this,{isReadonlyMode:ti.observable,isOverrideWithFreedom:ti.observable,setReadonlyMode:ti.action,overrideWithFreedom:ti.action})}_createClass(Eo,[{key:"release",value:function release(){this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null),this.viewsHub.callbacks.off("onCreatedView",this.onCreatedView),this.followerCheckingDisposer()}},{key:"setReadonlyMode",value:function setReadonlyMode(t){this.isReadonlyMode!==t&&(this.isReadonlyMode=t,this.overrideDisposer&&!t&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"overrideWithFreedom",value:function overrideWithFreedom(t){var _this322=this;this.isReadonlyMode&&this.isOverrideWithFreedom!==t&&(this.isOverrideWithFreedom=t,t?this.overrideDisposer=(0,ti.when)(function(){return _this322.applianceManager.getViewState().mode===ae.Freedom},function(){_this322.isReadonlyMode&&_this322.isOverrideWithFreedom&&(_this322.isOverrideWithFreedom=!1),_this322.overrideDisposer=null}):this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"getBroadcastState",value:function getBroadcastState(){var t=this.applianceManager,i=t.getBroadcasterId();return{mode:this.getCurrentMode(),broadcasterId:i}}},{key:"getCurrentMode",value:function getCurrentMode(){return this.isReadonlyMode&&this.isOverrideWithFreedom?ae.Freedom:this.applianceManager.getViewState().mode}},{key:"refreshCameraRectangle",value:function refreshCameraRectangle(){var _this323=this;var _this$applianceManage2=this.applianceManager.getViewState(),t=_this$applianceManage2.originX,i=_this$applianceManage2.originY,r=_this$applianceManage2.width,n=_this$applianceManage2.height,s={originX:t,originY:i,width:r,height:n};(!this.previousRectangle||this.previousRectangle.originX!==t||this.previousRectangle.originY!==i||this.previousRectangle.width!==r||this.previousRectangle.height!==n)&&(this.viewsHub.forEach(function(o){return _this323.refreshScreenRectangle(o,s)}),this.previousRectangle=s)}},{key:"refreshScreenRectangle",value:function refreshScreenRectangle(t,i){var r=t.mode;(r===Pe.Writable||r===Pe.FollowSceneAndCamera)&&t.screen.adaptRectangle(z(T({},i),{animationMode:Q.Continuous,adapterMode:hi.Centering}))}}]);return Eo}();var $l=.45,Eu=4.35,gP=90,Au=/*#__PURE__*/function(){function Au(t,i){_classCallCheck(this,Au);this.deviceType=t;this.screenType=i;this.previousPoint={x:0,y:0};this.previousTimestamp=0;this.currentSpeed=0;this.isPressed=!1}_createClass(Au,[{key:"radius",value:function radius(t,i,r){switch(this.updatePressed(i,r),this.deviceType){case Se.Touch:return 36/bo(this.screenType);default:return t===X.eraser?this.getSpeedRaidus():0;}}},{key:"updatePressed",value:function updatePressed(t,i){if(this.isPressed!==i&&(this.isPressed=i,i?(this.previousPoint.x=0,this.previousPoint.y=0,this.previousTimestamp=Date.now(),this.currentSpeed=0):this.currentSpeed=0),i){var _r198=Date.now(),n=t.x-this.previousPoint.x,s=t.y-this.previousPoint.y,o=_r198-this.previousTimestamp,a=o===0?0:Math.sqrt(n*n+s*s)/o;this.previousPoint.x=t.x,this.previousPoint.y=t.y,this.previousTimestamp=_r198,this.currentSpeed=(a+this.currentSpeed)/2}}},{key:"getSpeedRaidus",value:function getSpeedRaidus(){var t=this.currentSpeed;t>Eu?t=Eu:t<$l&&(t=$l);var i=t-$l,r=Eu-$l;return gP*i/r/bo(this.screenType)}}]);return Au}();var Ie;(function(n){n[n.Down=0]="Down",n[n.Move=1]="Move",n[n.Up=2]="Up",n[n.Leave=3]="Leave"})(Ie||(Ie={}));var Gl=/*#__PURE__*/function(){function Gl(t,i){var _this324=this;_classCallCheck(this,Gl);this.invoker=new To(Al);this.latestHitTestIdentifies=[];this.isPressed=!1;this.onStart=function(t){var i=_this324.getProxyEventKind(t),r=_this324.createProxyEvent(t,0);if(r&&(_this324.pushProxyEvent(r),i===2)){var n=_this324.createProxyEvent(t,2);n&&_this324.pushProxyEvent(n)}};this.onEvent=function(t){var i=_this324.createProxyEvent(t);i&&_this324.pushProxyEvent(i)};this.onCancel=function(t){var i=_this324.createProxyEvent(t,2);i&&_this324.pushProxyEvent(i)};this.radiusSelector=t,this.delegate=i}_createClass(Gl,[{key:"release",value:function release(){this.invoker.cancel()}},{key:"pushProxyEvent",value:function pushProxyEvent(t){var _this325=this;switch(t.boundlessEvent.kind){case v.MouseDown:{this.invoker.limitDuration=wu,this.isPressed=!0;break}case v.MouseUp:{this.invoker.limitDuration=Al,this.isPressed=!1;break}}switch(t.kind){case 0:{this.invoker.limitDuration=wu;break}case 2:{this.invoker.limitDuration=Al;break}}var i=t.mouseEvent.hitTestIdentifies;t.boundlessEvent.kind===v.MouseMove&&!this.isHitTestIdentifiesDifferent(i)?this.invoker.invoke(function(){return _this325.callbackReceiveMouseEvent(t)}):(this.invoker.cancel(),this.callbackReceiveMouseEvent(t)),this.latestHitTestIdentifies=i}},{key:"callbackReceiveMouseEvent",value:function callbackReceiveMouseEvent(_ref125){var t=_ref125.kind,i=_ref125.eraserRadius,r=_ref125.mouseEvent;this.onReceviedMouseEvent&&this.onReceviedMouseEvent(t,i,r)}},{key:"createProxyEvent",value:function createProxyEvent(t,i){var r=null,n=this.delegate.getWritableScreen();if(n){var s=0,o,a=this.delegate.getCurrentApplianceName(),c=t.pointOnScreen,h=i!=null?i:this.getProxyEventKind(t);if(a===X.selector||a===X.eraser){var u=this.radiusSelector.radius(a,c,this.isPressed);this.isPressed&&a===X.eraser&&(s=u),o=n.hitTest(c.x,c.y,u)}else o=[];var d=this.createMouseEvent(n,t,o);r={kind:h,eraserRadius:s,applianceName:a,mouseEvent:d,boundlessEvent:t}}return r}},{key:"createMouseEvent",value:function createMouseEvent(t,i,r){var n=i.nativeEvent,s;if(n&&n.target){var a=t.findComponentWithTarget(n.target);a&&(s=this.delegate.getTargetsMap(a,n))}return s||(s={}),{x:i.pointOnScene.x,y:i.pointOnScene.y,targetsMap:s,hitTestIdentifies:r}}},{key:"getProxyEventKind",value:function getProxyEventKind(t){switch(t.kind){case v.MouseDown:case v.SortedTouchStart:return 0;case v.MouseMove:case v.SortedTouchMove:return 1;case v.MouseUp:case v.SortedTouchEnd:case v.SortedTouchCancel:return 2;case v.MouseLeave:return 3;default:throw new Error("invalid kind ".concat(t.kind));}}},{key:"isHitTestIdentifiesDifferent",value:function isHitTestIdentifiesDifferent(t){var i=this.latestHitTestIdentifies.length!==t.length;if(!i)for(var _r199=0;_r199<t.length;++_r199){var n=t[_r199],s=this.latestHitTestIdentifies[_r199];if(i=n!==s,i)break}return i}}]);return Gl}();var Ou=/*#__PURE__*/function(){function Ou(t,i){_classCallCheck(this,Ou);this.eventsInput=t;this.convertPointToScene=i}_createClass(Ou,[{key:"inputDown",value:function inputDown(t,i){this.pushEvent(v.MouseDown,t,i)}},{key:"inputMove",value:function inputMove(t,i){this.pushEvent(v.MouseMove,t,i)}},{key:"inputUp",value:function inputUp(t,i){this.pushEvent(v.MouseUp,t,i)}},{key:"pushEvent",value:function pushEvent(t,i,r){var s={kind:t,isOnScreen:!0,pointOnScreen:{x:i,y:r},pointOnScene:this.convertPointToScene(i,r)};this.eventsInput.pushEvent(s)}}]);return Ou}();var rr;(function(n){n[n.Hand=0]="Hand",n[n.NewPencil=1]="NewPencil",n[n.Others=2]="Others",n[n.Ignore=3]="Ignore"})(rr||(rr={}));var Ru=/*#__PURE__*/function(){function Ru(t){var _this326=this;_classCallCheck(this,Ru);this.views2Inputs={};this.inputs2Views={};this.onCreatedView=function(t){var i=_this326.eventChannel.createInput();_this326.views2Inputs[t.id]=i,_this326.inputs2Views[i.id]=t};this.onReleasedView=function(t){var i=_this326.views2Inputs[t.id];i&&(delete _this326.views2Inputs[t.id],delete _this326.inputs2Views[i.id],_this326.eventChannel.removeInput(i))};this.onBoundlessEvent=function(t,i){var r;switch(i.kind){case v.MouseDown:case v.MouseMove:case v.MouseUp:case v.MouseLeave:case v.SortedTouchStart:case v.SortedTouchMove:case v.SortedTouchEnd:case v.SortedTouchCancel:{(r=_this326.views2Inputs[t.id])==null||r.pushEvent(i);break}case v.KeyDown:case v.KeyUp:{t===_this326.viewsHub.writableView&&_this326.onKeyPressed(i);break}}};this.onReceviedPencilMouseEvent=function(t,i,r){var n;switch(t){case Ie.Down:{n=v.MouseDown;break}case Ie.Move:{n=v.MouseMove;break}case Ie.Up:{n=v.MouseUp;break}case Ie.Leave:{n=v.MouseLeave;break}}var s=_this326._bezierPencilAppliance.pushBoundlessMouseEvent(n,r);s&&_this326.onCommit(s)};this.onReceviedOthersMouseEvent=function(t,i,r){var n=null;switch(t){case Ie.Down:{n=_this326.magix.trigger.onMouseDown(r);break}case Ie.Move:{n=_this326.magix.trigger.onMouseMove(r);break}case Ie.Up:{n=_this326.magix.trigger.onMouseUp(r);break}case Ie.Leave:{n=_this326.magix.trigger.onMouseLeave(r);break}}_this326.viewsHub.putState({cursorStyle:_this326.getCursorStyleWithRadius(i)}),n&&_this326.onCommit(n)};this.magix=t.magix,this.viewsHub=t.viewsHub,this.pencilOptions=t.pencilOptions,this.getCursorStyleWithRadius=t.getCursorStyleWithRadius,this.onKeyPressed=t.onKeyPressed,this.onCommit=t.onCommit,this.onReceivedHandMouseEvent=t.onReceivedHandMouseEvent,this.onHandMouseEventCompleted=t.onHandMouseEventCompleted;var i=new Au(t.deviceType,t.screenType),r={isWorking:function isWorking(){return _this326.magix.phase===L.Connected},getWritableScreen:function getWritableScreen(){return _this326.viewsHub.writableView&&_this326.viewsHub.writableView.screen},getCurrentApplianceName:function getCurrentApplianceName(){return _this326.magix.trigger.getMemberState().currentApplianceName},getTargetsMap:function getTargetsMap(n,s){var o;return(o=_this326.viewsHub.writableView)==null?void 0:o.getTargetsMap(n,s)}};this._viewStateObserver=new Eo(this.viewsHub,this.magix.trigger),this._bezierPencilAppliance=new vs(this.magix.trigger,t.cameraObserver,this.pencilOptions,t.bezierCurvePainter,t.disablePencilWrittingLimitFrequency),this.pencilChannel=new Gl(i,r),this.othersChannel=new Gl(i,r),this.eventChannel=this.createEventsChannel(),this.viewsHub.callbacks.on("onBoundlessEvent",this.onBoundlessEvent),this.viewsHub.callbacks.on("onCreatedView",this.onCreatedView),this.viewsHub.callbacks.on("onReleasedView",this.onReleasedView),this.viewsHub.forEach(function(n){return _this326.onCreatedView(n)}),this.pencilChannel.onReceviedMouseEvent=this.onReceviedPencilMouseEvent,this.othersChannel.onReceviedMouseEvent=this.onReceviedOthersMouseEvent,this.customEventInput=this.eventChannel.createInput(),this.customInput=new Ou(this.customEventInput,t.convertPointToScene)}_createClass(Ru,[{key:"viewStateObserver",get:function get(){return this._viewStateObserver}},{key:"bezierPencilAppliance",get:function get(){return this._bezierPencilAppliance}},{key:"release",value:function release(){this._viewStateObserver.release(),this.pencilChannel.release(),this.othersChannel.release(),this.viewsHub.callbacks.off("onBoundlessEvent",this.onBoundlessEvent),this.viewsHub.callbacks.off("onCreatedView",this.onCreatedView),this.viewsHub.callbacks.off("onReleasedView",this.onReleasedView)}},{key:"createEventsChannel",value:function createEventsChannel(){var _this327=this;var t=new Tu(function(i){if(i.id===_this327.customEventInput.id||_this327.inputs2Views[i.id]===_this327.viewsHub.writableView){var _r200=_this327.magix.trigger.getMemberState().currentApplianceName;return _r200===X.hand?0:_this327.pencilOptions.shouldUseNewPencil(_r200)?1:2}else return 3});return t.putOutput(1,this.pencilChannel),t.putOutput(2,this.othersChannel),t.putOutput(0,{onEvent:this.onReceivedHandMouseEvent,onCancel:this.onHandMouseEventCompleted}),t}}]);return Ru}();var Nu=/*#__PURE__*/function(){function Nu(t){_classCallCheck(this,Nu);this.lastCommitValues={};this.sumNodes={};this.maxValues={};this.minValues={};this.lastCommitTimestamp=Date.now(),this.backgroundValues=Object.freeze(T({},t))}_createClass(Nu,[{key:"report",value:function report(){var t={},i={},r={};for(var n in this.backgroundValues){var s=this.backgroundValues[n],o=this.sumNodes[n],a=this.maxValues[n],c=this.minValues[n];if(o===void 0)t[n]=s;else if(o.otherValueSum===void 0)t[n]=o.firstValue;else{var h=this.lastCommitTimestamp-o.beginAt,d=h/o.count,u=o.firstValue*d+o.otherValueSum,p=d+h;p>0?t[n]=u/p:t[n]=s}a===void 0?i[n]=s:i[n]=a,c===void 0?r[n]=s:r[n]=c}return this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={},{averageValues:t,maxValues:i,minValues:r}}},{key:"clean",value:function clean(){this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={};for(var t in this.lastCommitValues){delete this.lastCommitValues[t]}}},{key:"commit",value:function commit(t){var i=Date.now();this.commitSumValues(i,t),this.commitMaxAndMinValues(t),this.lastCommitTimestamp=i}},{key:"commitSumValues",value:function commitSumValues(t,i){for(var _r201 in i){i[_r201]!==void 0&&(this.lastCommitValues[_r201]=i[_r201])}for(var _r202 in this.lastCommitValues){var n=this.lastCommitValues[_r202],s=this.sumNodes[_r202];s===void 0?this.sumNodes[_r202]={beginAt:t,firstValue:n,count:1,otherValueSum:n}:(s.count+=1,s.otherValueSum===void 0?s.otherValueSum=n*(t-s.beginAt):s.otherValueSum+=n*(t-this.lastCommitTimestamp))}}},{key:"commitMaxAndMinValues",value:function commitMaxAndMinValues(t){for(var i in t){var _r203=t[i],n=this.maxValues[i],s=this.minValues[i];n===void 0?this.maxValues[i]=_r203:this.maxValues[i]=Math.max(n,_r203),s===void 0?this.minValues[i]=_r203:this.minValues[i]=Math.min(s,_r203)}}}]);return Nu}();var Xl=/*#__PURE__*/function(){function Xl(_ref126){var _this328=this;var t=_ref126.connection,i=_ref126.disconnection,r=_ref126.sample;_classCallCheck(this,Xl);this.statisticsTimer=null;this.onReportStatistics=function(){_this328.statisticsTimer=null,_this328.latestReportAt=Date.now();var _this328$statistics$r=_this328.statistics.report(),t=_this328$statistics$r.maxValues,i=_this328$statistics$r.minValues,r=_this328$statistics$r.averageValues;_this328.sampleCommitter.commit({maxRTT:t.rtt,minRTT:i.rtt,averageRTT:r.rtt,maxQueue:t.illusionQueueLength,minQueue:i.illusionQueueLength,averageQueue:r.illusionQueueLength,maxInterval:t.frameReceivedInterval,minInterval:i.frameReceivedInterval,averageInterval:r.frameReceivedInterval})};this.connectionCommitter=t,this.disconnectionCommitter=i,this.sampleCommitter=r,this.statistics=new Nu({rtt:0,frameReceivedInterval:0,illusionQueueLength:0})}_createClass(Xl,[{key:"commitConnection",value:function commitConnection(t){this.connectionCommitter.commit(t)}},{key:"commitDisconnection",value:function commitDisconnection(t){this.disconnectionCommitter.commit(t)}},{key:"commitStatistics",value:function commitStatistics(t){if(this.latestReportAt===void 0&&(this.latestReportAt=Date.now()),this.statisticsTimer===null){var i=this.latestReportAt+Xl.reportStatisticsInterval,_r204=Date.now(),n=i-_r204;n<0&&(n=Xl.reportStatisticsInterval,this.statistics.clean()),this.statisticsTimer=setTimeout(this.onReportStatistics,n)}this.statistics.commit(t)}},{key:"stop",value:function stop(){this.statisticsTimer!==null&&(clearTimeout(this.statisticsTimer),this.statisticsTimer=null)}}]);return Xl}(),Kl=Xl;Kl.reportStatisticsInterval=60*1e3;var le;(function(b){b.Hand="cursor-hand",b.HandGrasp="cursor-hand-grasp",b.LaserPointer="cursor-laserPointer",b.Selector="cursor-selector",b.Pencil="cursor-pencil",b.Eraser="cursor-eraser",b.Rectangle="cursor-rectangle",b.Ellipse="cursor-ellipse",b.Shape="cursor-shape",b.Straight="cursor-straight",b.Arrow="cursor-arrow",b.Text="cursor-text",b.Nwse="cursor-nwse",b.Nesw="cursor-nesw",b.Ns="cursor-ns",b.Ew="cursor-ew",b.Ban="ban"})(le||(le={}));var pv=Object.freeze((_Object$freeze={},_defineProperty(_Object$freeze,le.Hand,Object.freeze(["url(".concat(Ve["hand-loosen"],") 7 7, auto;"),"-webkit-image-set(url(".concat(Ve["hand-loosen"],") 7 7, auto);")])),_defineProperty(_Object$freeze,le.HandGrasp,Object.freeze(["url(".concat(Ve["hand-grasp"],") 6 6, auto;"),"-webkit-image-set(url(".concat(Ve["hand-grasp"],") 6 6, auto);")])),_defineProperty(_Object$freeze,le.LaserPointer,Object.freeze(["url(".concat(Ve["laser-pointer-cursor"],") 14 14, auto;"),"-webkit-image-set(url(".concat(Ve["laser-pointer-cursor"],") 14 14, auto);")])),_defineProperty(_Object$freeze,le.Selector,Object.freeze(["url(".concat(Ve["selector-cursor"],") 5 4, auto;"),"-webkit-image-set(\n            url(".concat(Ve["selector-cursor"],") 1x,\n            url(").concat(Ve["selector-cursor@2x"],") 2x) 5 4, auto;")])),_defineProperty(_Object$freeze,le.Pencil,Object.freeze(["url(".concat(Ve["pencil-cursor"],") 2 22, auto;"),"-webkit-image-set(\n            url(".concat(Ve["pencil-cursor"],") 1x,\n            url(").concat(Ve["pencil-cursor@2x"],") 2x) 2 22, auto;")])),_defineProperty(_Object$freeze,le.Eraser,Object.freeze(["url(".concat(Ve["easer-cursor"],") 8 18, auto;"),"-webkit-image-set(\n            url(".concat(Ve["easer-cursor"],") 1x,\n            url(").concat(Ve["easer-cursor@2x"],") 2x) 8 18, auto;")])),_defineProperty(_Object$freeze,le.Rectangle,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze,le.Ellipse,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze,le.Shape,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze,le.Straight,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze,le.Arrow,Object.freeze(["crosshair;"])),_defineProperty(_Object$freeze,le.Text,Object.freeze(["text;"])),_defineProperty(_Object$freeze,le.Nwse,Object.freeze(["nwse-resize;"])),_defineProperty(_Object$freeze,le.Nesw,Object.freeze(["nesw-resize;"])),_defineProperty(_Object$freeze,le.Ns,Object.freeze(["ns-resize;"])),_defineProperty(_Object$freeze,le.Ew,Object.freeze(["ew-resize;"])),_defineProperty(_Object$freeze,le.Ban,Object.freeze(["not-allowed"])),_Object$freeze)),mv=/*#__PURE__*/function(){function mv(){_classCallCheck(this,mv);this.isInjected=!1}_createClass(mv,[{key:"injectDefaultStyleIfNotInjectBefore",value:function injectDefaultStyleIfNotInjectBefore(){this.isInjected||(this.injectToDom(pv),this.isInjected=!0)}},{key:"injectCustomStyle",value:function injectCustomStyle(t){if(this.isInjected)throw new Error("cannot be called repeatedly, or after new WhiteWebSdk().");var i=T(T({},pv),t);this.injectToDom(i),this.isInjected=!0}},{key:"injectToDom",value:function injectToDom(t){if(Object.keys(t).length>0){var i=document.createElement("style"),_r205=[];for(var s in t){var o=t[s];if(o){var a=".netless-whiteboard.".concat(s," {\n                        ").concat(o.map(function(c){return"cursor: ".concat(c)}).join(""),"\n                    }");_r205.push(a)}}i.appendChild(document.createTextNode(_r205.join("")));var n=document.head;n&&n.appendChild(i)}}}]);return mv}(),Lu=new mv;function fv(e){Lu.injectCustomStyle(e)}var Ss=x(require("mobx")),Du=/*#__PURE__*/function(){function Du(t){_classCallCheck(this,Du);this.useMobX=t}_createClass(Du,[{key:"filter",value:function filter(t){return this.useMobX?this.copyValue(t):t}},{key:"copyValue",value:function copyValue(t){return _typeof(t)!="object"||t===null?t:(0,Ss.isObservableObject)(t)?this.copyObservableObject(t):(0,Ss.isObservableArray)(t)||t instanceof Array?this.copyArray(t):this.copyObject(t)}},{key:"copyObservableObject",value:function copyObservableObject(t){var i={};var _iterator265=_createForOfIteratorHelper((0,Ss.keys)(t)),_step265;try{for(_iterator265.s();!(_step265=_iterator265.n()).done;){var _r206=_step265.value;i[_r206]=this.copyValue(t[_r206])}}catch(err){_iterator265.e(err)}finally{_iterator265.f()}return i}},{key:"copyArray",value:function copyArray(t){var i=[],r=t.length;for(var n=0;n<r;++n){i[n]=this.copyValue(t[n])}return i}},{key:"copyObject",value:function copyObject(t){var i={};for(var _r207 in t){i[_r207]=this.copyValue(t[_r207])}return i}}]);return Du}();var Fu=/*#__PURE__*/function(){function Fu(t,i,r){var _this329=this;_classCallCheck(this,Fu);this.queue=[];this.limiter=new ct(i,function(){var n=_this329.queue.shift();if(n){try{r(n.event,n.payload)}catch(s){t.error(s)}_this329.queue.length>0&&_this329.limiter.invoke()}})}_createClass(Fu,[{key:"dispatch",value:function dispatch(t,i){this.queue.push({event:t,payload:i}),this.limiter.invoke()}}]);return Fu}();function Ti(e){if(_typeof(e)=="object"){if(e===null)return null;if(e instanceof Array)return e.map(function(t){return Ti(t)});{var t={};for(var i in e){var _r208=Ti(e[i]);_r208!==void 0&&(t[i]=_r208)}return t}}else return typeof e=="function"?void 0:e}var yP=500,bP="__netlessMemberState",vP=1,Ao="modules",ws=/*#__PURE__*/function(){function ws(t){var _this330=this;_classCallCheck(this,ws);this.writingBuffer=null;this.invoker=function(){var t=_this330.writingBuffer;t&&_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee92(){var i;return regeneratorRuntime.wrap(function _callee92$(_context96){while(1){switch(_context96.prev=_context96.next){case 0:_this330.limiter.freeze();_context96.prev=1;i={uid:_this330.uid,timestamp:Date.now(),memberState:t};_context96.next=5;return _this330.write(_this330.uuid,JSON.stringify(i));case 5:_context96.prev=5;_this330.limiter.unfreeze();return _context96.finish(5);case 8:case"end":return _context96.stop();}}},_callee92,null,[[1,,5,8]])}))()["catch"](function(i){return console.error(i)})};this.uid=t,this.limiter=new ct(yP,this.invoker)}_createClass(ws,[{key:"getMemberState",value:function(){var _getMemberState=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee93(t,i){var r,n;return regeneratorRuntime.wrap(function _callee93$(_context97){while(1){switch(_context97.prev=_context97.next){case 0:_context97.next=2;return this.read(t);case 2:r=_context97.sent;if(!r){_context97.next=7;break}n=JSON.parse(r);if(!(n.uid===i)){_context97.next=7;break}return _context97.abrupt("return",this.writingBuffer=n.memberState);case 7:return _context97.abrupt("return",null);case 8:case"end":return _context97.stop();}}},_callee93,this)}));function getMemberState(_x168,_x169){return _getMemberState.apply(this,arguments)}return getMemberState}()},{key:"setMemberState",value:function setMemberState(t){var i={currentApplianceName:t.currentApplianceName,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,textSize:t.textSize,bold:t.bold,italic:t.italic,underline:t.underline,lineThrough:t.lineThrough};for(var _r209 in i){i[_r209]===void 0&&delete i[_r209]}this.limiter.invoke(),this.writingBuffer=T(T({},this.writingBuffer),Ti(i))}},{key:"dispose",value:function dispose(){this.limiter.cancel(),this.writingBuffer=null}},{key:"read",value:function(){var _read=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee94(t){var r,n;return regeneratorRuntime.wrap(function _callee94$(_context98){while(1){switch(_context98.prev=_context98.next){case 0:_context98.next=2;return ws.dbp;case 2:r=_context98.sent.transaction([Ao],"readonly").objectStore(Ao).get(t);_context98.next=5;return Bu(r);case 5:n=_context98.sent;return _context98.abrupt("return",(typeof n!="string"&&(n=void 0),n));case 7:case"end":return _context98.stop();}}},_callee94)}));function read(_x170){return _read.apply(this,arguments)}return read}()},{key:"write",value:function(){var _write=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee95(t,i){var n;return regeneratorRuntime.wrap(function _callee95$(_context99){while(1){switch(_context99.prev=_context99.next){case 0:_context99.next=2;return ws.dbp;case 2:n=_context99.sent.transaction([Ao],"readwrite").objectStore(Ao).put(i,t);_context99.next=5;return Bu(n);case 5:case"end":return _context99.stop();}}},_callee95)}));function write(_x171,_x172){return _write.apply(this,arguments)}return write}()}],[{key:"dbp",get:function get(){if(!this._dbp){var t=indexedDB.open(bP,vP);t.onupgradeneeded=function(i){i.target.result.createObjectStore(Ao)},this._dbp=Bu(t)}return this._dbp}}]);return ws}();function Bu(e){return new Promise(function(t,i){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var _r210=new Error(e.error.message);_r210.name=e.error.name,i(_r210)}else i(new Error("failed with null Error"))}})}var yn=/*#__PURE__*/function(_Mo){_inherits(yn,_Mo);var _super94=_createSuper(yn);function yn(t){var _this331;_classCallCheck(this,yn);_this331=_super94.call(this,{logger:t.whiteLogger,region:t.region,useMobXState:t.useMobXState,screenType:t.screenType,renderEngine:t.renderEngine,boundless:t.boundless,cameraBound:t.cameraBound,autoResize:t.autoResize,plugins:t.plugins,invisiblePlugins:t.invisiblePlugins,wrappedComponents:t.wrappedComponents,preloadDynamicPPT:t.preloadDynamicPPT,disableCameraTransform:t.disableCameraTransform,useMultiViews:t.useMultiViews,userFonts:t.userFonts,handToolKey:t.handToolKey,fontFamily:t.fontFamily,memberStateStorage:t.disableKeepMemberState?void 0:new ws(t.userPayload.uid),onlyCallbackRemoteStateModify:t.onlyCallbackRemoteStateModify,pptHandler:{onPageJumpTo:function onPageJumpTo(i,r){return _this331.pptJumpTo(i,r)},onPageToNext:function onPageToNext(){return _this331.nextPpt()},onPageToPrev:function onPageToPrev(){return _this331.previousPpt()}},textareaHub:t.floatBarOptions&&new au,floatBarClass:t.floatBarOptions&&Yl,globalStateUpdater:function globalStateUpdater(i){return _this331.setGlobalState(i)},disableOperations:!1,disableOthersSelectingBox:t.disableOthersSelectingBox,willHideSelfCursor:!0,cursorAdapter:t.cursorAdapter,eraserRadiusCursor:t.eraserRadiusCursor,eventInterrupter:function eventInterrupter(i){return _this331.willInterruptEvent(i)},urlInterrupter:t.urlInterrupter,onTextareaUpdate:function onTextareaUpdate(i,r,n){_this331.magix.isWritable&&(_this331.applianceManager.updateTextarea(i,r),_this331.undoStack.onTextareaUpdate(!!n))},callbacks:t.callbacks,pptParams:t.pptParams,userPayload:t.userPayload});_this331.apiFetch=gl.fetch("api");_this331._phase=te.Connecting;_this331._isWritable=!1;_this331._enableWriteNow=!1;_this331.isEraser=!1;_this331.writableView=null;_this331.copyBuffer=null;_this331.beginReconnectAt=0;_this331.isHandGrasp=!1;_this331.onWritableScreenChanged=function(t){_this331.writableView!==t&&(_this331.writableView&&(_this331.writableView.cameraman.removeCameraTransformationListener(_this331.onCameraTransform),_this331.writableView.screen.removeCameraUpdatedListener(_this331.onCameraUpdated)),_this331.writableView=t,t&&(t.cameraman.addCameraTransformationListener(_this331.onCameraTransform),t.screen.addCameraUpdatedListener(_this331.onCameraUpdated)))};_this331.onRoomStateChanged=function(t){t.globalState&&_this331.dynamicPpt.setGlobalState(Ti(t.globalState)),t.memberState&&(_this331.isEraser=t.memberState.currentApplianceName===X.eraser,_this331.refreshShouldDisableImageHit(),_this331.refreshCursorClass()),t.sceneState&&_this331.fetchNextPptSlideIfNeeded(t.sceneState),_this331.callbacks.dispatch("onRoomStateChanged",function(i){return i(t)})};_this331.convertPointToScene=function(t,i){var r=_this331.viewsHub.writableView;return r?r.screen.convertPointToScene(t,i):{x:t,y:i}};_this331.onBoundlessKeyEvent=function(t){var r;var i=_this331.hotKeys.checkHotKey(t);switch(i&&(_this331.handleHotKey(i,t),(r=t.nativeEvent)==null||r.preventDefault()),t.kind){case v.KeyDown:{_this331.callbacks.dispatch("onKeyDown",function(n){return n(t.nativeEvent)});break}case v.KeyUp:{_this331.callbacks.dispatch("onKeyUp",function(n){return n(t.nativeEvent)});break}}};_this331.onReceivedHandMouseEvent=function(t,i){var r,n;if(_this331.magix.phase===L.Connected)switch(t.kind){case v.MouseDown:case v.SortedTouchStart:{_this331.isHandGrasp=!0,(r=_this331.writableView)==null||r.putState({handToolActive:!0}),_this331.refreshCursorClass();break}case v.MouseUp:case v.SortedTouchEnd:case v.SortedTouchCancel:{_this331.isHandGrasp=!1,(n=_this331.writableView)==null||n.putState({handToolActive:!1}),_this331.refreshCursorClass();break}}};_this331.onHandMouseEventCompleted=function(){var t;_this331.isHandGrasp=!1,(t=_this331.writableView)==null||t.putState({handToolActive:!1}),_this331.refreshCursorClass()};_this331.onModified=function(){if(_this331._phase===te.Connected){var _t19=_this331.roomInput.viewStateObserver;ae.Follower===_t19.getCurrentMode()&&_t19.refreshCameraRectangle(),_this331.refreshRender()}};_this331.onReconnected=function(t){var i,r;(i=_this331.statistics)==null||i.commitConnection(z(T({},t),{isReconnection:!0})),_this331.viewsHub.fireReloadLibrary(),_this331.members.refresh(),_this331.syncCameraToRemote(),_this331.magix.isWritable&&((r=_this331.memberStateStorage)==null||r.getMemberState(_this331._uuid,_this331.uid).then(function(n){n&&_this331.stateTrigger.activeUpdate("memberState",function(){return _this331.applianceManager.setMemberState(n)})}))};_this331.onDisconnectWithError=function(t){var r;_this331.beginReconnectAt!==0&&((r=_this331.statistics)==null||r.commitDisconnection({isReconnection:!0,duration:Date.now()-_this331.beginReconnectAt})),_this331.callbacks.dispatch("onDisconnectWithError",function(n){return n(t)})<=0&&_this331.logger.error(t)};_this331.updateSelfUserId=function(t){t===void 0?(_this331.setObserverId(re),_this331._isWritable=!1):(_this331.setObserverId(t),_this331._isWritable=!0),_this331.refreshCursorClass(),_this331.refreshSyncOperations()};_this331.onCameraTransform=function(t){te.Connected===_this331._phase&&di.Begin===t&&ae.Follower===_this331.stateTrigger.state.broadcastState.mode&&(_this331._isWritable?_this331.applianceManager.setViewState({mode:ae.Freedom}):_this331.roomInput.viewStateObserver.overrideWithFreedom(!0))};_this331.onCameraUpdated=function(){if(_this331._isWritable)switch(_this331.stateTrigger.state.broadcastState.mode){case ae.Broadcaster:case ae.Freedom:{_this331.syncCameraToRemoteLimiter.invoke();break}}};_this331.syncCameraToRemote=function(){var t=_this331.viewsHub.writableView;if(_this331._isWritable&&t&&_this331.phase===te.Connected){var i=t.screen,_r211=i.visionRectangle,n=i.camera.scale*bo(_this331.screenType);_this331.applianceManager.setViewState({originX:_r211.originX,originY:_r211.originY,width:_r211.width,height:_r211.height,pixelWidth:n})}};_this331.updateSession=function(t){_this331.logger.context=z(T({},_this331.logger.context),{session:t})};_this331.onPhaseChanged=function(t){_this331.logger.info("change room phase to "+t),t===L.Disconnected&&_this331.dispose();var i=te.Connecting;switch(t){case L.Ready:case L.Connecting:{i=te.Connecting;break}case L.Connected:{i=te.Connected;break}case L.Reconnecting:{i=te.Reconnecting;break}case L.Disconnecting:{i=te.Disconnecting;break}case L.Disconnected:{i=te.Disconnected;break}}switch(i){case te.Reconnecting:{_this331.beginReconnectAt=Date.now();break}case te.Connected:{_this331.beginReconnectAt=0;break}}var r=_this331._phase!==i;_this331._phase=i,_this331.refreshSyncOperations(),_this331.refreshCursorClass(),r&&_this331.callbacks.dispatch("onPhaseChanged",function(n){return n(i)})};_this331.dispatchEvent=function(t,i){var r=i;r instanceof ArrayBuffer&&(r=ri(r)),_this331.magix.dispatch(t,r)};_this331.uid=t.userPayload.uid,_this331.floatBarDelegate=_this331.createFloatBarDelegate(),_this331.statistics=t.qualityComitters&&new Kl(t.qualityComitters),_this331.rejectWhenReadonlyErrorLevel=t.rejectWhenReadonlyErrorLevel||Fr.ThrowError,_this331.disablePencilWrittingLimitFrequency=t.disablePencilWrittingLimitFrequency,_this331.magix=t.akkoApp.createMagix({logger:_this331.logger,userPayload:t.userPayload,libraryNodeFetcher:_this331.libraryNodeFetcher,callbacks:{onPhaseChanged:_this331.onPhaseChanged,onDisconnectWithError:_this331.onDisconnectWithError,onModified:_this331.onModified,onSelfUserIdUpdate:_this331.updateSelfUserId,onSessionChanged:_this331.updateSession,onEventFire:function onEventFire(i){return _this331.dispatchMagixEventWithObject(i,!1,i.authorId===_this331.observerId)},onEventFireACK:function onEventFireACK(i){return _this331.dispatchMagixEventWithObject(i,!0,i.authorId===_this331.observerId)},onReconnected:_this331.onReconnected,onKickedWithReason:function onKickedWithReason(i){return _this331.callbacks.dispatch("onKickedWithReason",function(r){return r(i)})},onCatchErrorWhenAppendFrame:function onCatchErrorWhenAppendFrame(i,r){_this331.callbacks.dispatch("onCatchErrorWhenAppendFrame",function(n){return n(i,r)})},onSliceChanged:function onSliceChanged(i){return _this331.callbacks.dispatch("onSliceChanged",function(r){return r(i)})},onReceivedRttReport:_this331.statistics&&function(i){return _this331.statistics.commitStatistics({rtt:i})},onIllusionQueueLengthChanged:_this331.statistics&&function(i){_this331.statistics.commitStatistics({illusionQueueLength:i})},onFrameReceivedInterval:_this331.statistics&&function(i){_this331.statistics.commitStatistics({frameReceivedInterval:i})}}}),_this331.eventsQueue=t.disableMagixEventDispatchLimit?null:new Fu(_this331.logger,Jb,_this331.dispatchEvent),_this331._disableDeviceInputs=t.disableDeviceInputs,_this331._disableEraseImage=t.disableEraseImage,_this331.syncCameraToRemoteLimiter=new ct(ev,_this331.syncCameraToRemote),_this331.undoStack=new ou({execute:function execute(i){return _this331.applianceManager.execute(i)},onCanUndoStepsUpdate:function onCanUndoStepsUpdate(i){return _this331.callbacks.dispatch("onCanUndoStepsUpdate",function(r){return r(i)})},onCanRedoStepsUpdate:function onCanRedoStepsUpdate(i){return _this331.callbacks.dispatch("onCanRedoStepsUpdate",function(r){return r(i)})}}),_this331.hotKeys=new su(t.hotKeys),_this331.parametersFilter=new Du(t.useMobXState),_this331.floatBarOptions=t.floatBarOptions;return _this331}_createClass(yn,[{key:"customInput",get:function get(){return this.roomInput.customInput}},{key:"applianceManager",get:function get(){return this.magix.trigger}},{key:"isWritable",get:function get(){return this.magix.isWritable}},{key:"enableWriteNow",get:function get(){return this._enableWriteNow}},{key:"setWritable",value:function(){var _setWritable2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee96(t){var _this332=this;var r,i,n,o,s;return regeneratorRuntime.wrap(function _callee96$(_context100){while(1){switch(_context100.prev=_context100.next){case 0:this.logger.info("set writable "+t);i=this.roomInput.viewStateObserver;if(!t){_context100.next=14;break}_context100.next=5;return this.magix.setWritable(t,this.deviceType);case 5:this.pencilOptions.becomeWritable(this.applianceManager);n=this.applianceManager.getViewState().mode;if(n!==ae.Broadcaster){o=i.getCurrentMode();o!==n&&this.stateTrigger.activeUpdate("broadcastState",function(){return _this332.applianceManager.setViewState({mode:o}),i.getBroadcastState()})}_context100.next=10;return(r=this.memberStateStorage)==null?void 0:r.getMemberState(this._uuid,this.uid);case 10:s=_context100.sent;s&&this.applianceManager.setMemberState(s),i.setReadonlyMode(!1);_context100.next=17;break;case 14:i.setReadonlyMode(!0);_context100.next=17;return this.magix.setWritable(t);case 17:case"end":return _context100.stop();}}},_callee96,this)}));function setWritable(_x173){return _setWritable2.apply(this,arguments)}return setWritable}()},{key:"disableDeviceInputs",get:function get(){return this._disableDeviceInputs},set:function set(t){this._disableDeviceInputs=t,this.refreshSyncOperations(),this.refreshCursorClass()}},{key:"disableEraseImage",get:function get(){return this._disableEraseImage},set:function set(t){this._disableEraseImage=t,this.refreshShouldDisableImageHit()}},{key:"disableSerialization",get:function get(){return this._phase===te.Connected?!this.applianceManager.enableExecute:!0},set:function set(t){this.isRoomEnableModify()&&(t&&(this.copyBuffer=null),this.applianceManager.setEnableExecute(!t))}},{key:"uuid",get:function get(){return this._uuid}},{key:"session",get:function get(){return this.magix.session}},{key:"slice",get:function get(){return this.magix.slice}},{key:"roomToken",get:function get(){return this._roomToken}},{key:"phase",get:function get(){return this._phase}},{key:"calibrationTimestamp",get:function get(){return this.magix.calibrationTimestamp}},{key:"state",get:function get(){return this.stateTrigger.state}},{key:"timeDelay",get:function get(){return this.magix.timeDelay},set:function set(t){this.magix.timeDelay=t}},{key:"setupLibraryNode",value:function setupLibraryNode(t,i){var _this333=this;var o;this.updateLibraryNode(i),this.roomInput=new Ru({deviceType:t,screenType:this.screenType,magix:this.magix,viewsHub:this.viewsHub,cameraObserver:this.cameraObserver,pencilOptions:this.pencilOptions,bezierCurvePainter:this.bezierCurvePainter,disablePencilWrittingLimitFrequency:this.disablePencilWrittingLimitFrequency,convertPointToScene:this.convertPointToScene,getCursorStyleWithRadius:function getCursorStyleWithRadius(a){return _this333.getCursorStyleWithRadius(a)},onKeyPressed:this.onBoundlessKeyEvent,onReceivedHandMouseEvent:this.onReceivedHandMouseEvent,onHandMouseEventCompleted:this.onHandMouseEventCompleted,onCommit:function onCommit(a){return _this333.undoStack.commit(a)}}),this.viewsHub.callbacks.on("onWritableScreenChanged",this.onWritableScreenChanged),this.onWritableScreenChanged(this.viewsHub.writableView);var r=this.roomInput.viewStateObserver,n=this.cameraObserver,s=this.applianceManager;this.stateTrigger=new yo({useMobXMode:this.useMobXState,disableMaskKey:this.onlyCallbackRemoteStateModify,onStateChanged:this.onRoomStateChanged,propertyGetters:{globalState:function globalState(){return se(s.getGlobalState())},memberState:function memberState(){return se(s.getMemberState())||_this333.getDefaultMemberState()},roomMembers:function roomMembers(){return _this333.getRoomMembers()},sceneState:function sceneState(){return _this333.getCurrentSceneState()},broadcastState:function broadcastState(){return r.getBroadcastState()},cameraState:function cameraState(){return n.cameraState}}}),this.invisiblePluginNode.isWatching=!0,this.isEraser=((o=this.stateTrigger.state.memberState)==null?void 0:o.currentApplianceName)===X.eraser,this.dynamicPpt.setGlobalState(se(s.getGlobalState())),this.undoStack.setCurrentScenePath(this.stateTrigger.state.sceneState.scenePath),this.refreshCursorClass(),this.refreshShouldDisableImageHit(),this.refreshSyncOperations()}},{key:"dispose",value:function dispose(){_get(_getPrototypeOf(yn.prototype),"dispose",this).call(this),this.roomInput&&this.roomInput.release(),this.stateTrigger&&this.stateTrigger.release()}},{key:"handleHotKey",value:function handleHotKey(t,i){switch(t){case"duplicate":{this.duplicate();break}case"copy":{this.copy();break}case"paste":{this.paste();break}case"undo":{this.undo();break}case"redo":{this.redo();break}case"delete":{this["delete"]();break}case"lock":{var _r212=this.sendToApplianceManager(t,i);_r212&&this.undoStack.commit(_r212);break}case"changeToSelector":{this.setMemberState({currentApplianceName:X.selector});break}case"changeToClick":{this.setMemberState({currentApplianceName:X.clicker});break}case"changeToLaserPointer":{this.setMemberState({currentApplianceName:X.laserPointer});break}case"changeToPencil":{this.setMemberState({currentApplianceName:X.pencil});break}case"changeToRectangle":{this.setMemberState({currentApplianceName:X.rectangle});break}case"changeToEllipse":{this.setMemberState({currentApplianceName:X.ellipse});break}case"changeToEraser":{this.setMemberState({currentApplianceName:X.eraser});break}case"changeToText":{this.setMemberState({currentApplianceName:X.text});break}case"changeToStraight":{this.setMemberState({currentApplianceName:X.straight});break}case"changeToArrow":{this.setMemberState({currentApplianceName:X.arrow});break}case"changeToHand":{this.setMemberState({currentApplianceName:X.hand});break}}}},{key:"sendToApplianceManager",value:function sendToApplianceManager(t,i){var r=null,n={kind:t};switch(i.kind){case v.KeyDown:{r=this.applianceManager.onKeyDown(n);break}case v.KeyUp:{r=this.applianceManager.onKeyUp(n);break}}return r}},{key:"willInterruptEvent",value:function willInterruptEvent(t){if(t instanceof KeyboardEvent){var i=!1;return this.callbacks.dispatch("willInterceptKeyboardEvent",function(r){r(t)&&(i=!0)}),this.releaseAllTextareaByEsc(t),i}return!1}},{key:"refreshSyncOperations",value:function refreshSyncOperations(){var t=!this._isWritable||this._phase===te.Reconnecting||this._phase===te.Disconnecting||this._phase===te.Disconnected,i=t||this._disableDeviceInputs;this.hasLibraryNode&&(this.viewsHub.putState({disableBoundlessEvent:i}),this.dynamicPpt.setDisableInteractive(i)),this._enableWriteNow!==t&&(this._enableWriteNow=t,this.callbacks.dispatch("onEnableWriteNowChanged",function(r){return r(t)}))}},{key:"connect",value:function(){var _connect6=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee97(t){var _this334=this;var r,n,s,i,_yield$this$magix$con,o,a,c;return regeneratorRuntime.wrap(function _callee97$(_context101){while(1){switch(_context101.prev=_context101.next){case 0:i=Date.now();_context101.prev=1;this._uuid=t.uuid,this._roomToken=t.roomToken,this.pencilOptions=new Pu(t.enableDrawPoint,t.disableNewPencil,this.undoStack),this.memberStateStorage&&(this.memberStateStorage.uuid=t.uuid);_context101.next=5;return this.magix.connect({uuid:t.uuid,region:t.region||ee.defaultRegion,roomToken:t.roomToken,connectedPayload:t.deviceType,isWritable:t.isWritable});case 5:_yield$this$magix$con=_context101.sent;o=_yield$this$magix$con.libraryNode;a=_yield$this$magix$con.statistics;if(!(this.logger.context=z(T({},this.logger.context),{session:this.magix.session}),this.setupLibraryNode(t.deviceType,o),this.magix.isWritable&&this.updateSelfUserId(this.magix.selfUserId),this._isWritable||this.roomInput.viewStateObserver.setReadonlyMode(!0),this._isWritable)){_context101.next=14;break}this.pencilOptions.becomeWritable(this.applianceManager);_context101.next=12;return(r=this.memberStateStorage)==null?void 0:r.getMemberState(this._uuid,this.uid);case 12:c=_context101.sent;c&&this.stateTrigger.activeUpdate("memberState",function(){return _this334.applianceManager.setMemberState(c)});case 14:(n=this.statistics)==null||n.commitConnection(z(T({},a),{isReconnection:!1})),this.logger.info("join room success"),this.fetchNextPptSlideIfNeeded(this.state.sceneState);_context101.next=20;break;case 17:_context101.prev=17;_context101.t0=_context101["catch"](1);throw(s=this.statistics)==null||s.commitDisconnection({isReconnection:!1,duration:Date.now()-i}),this.logger.error("join room fail"),this.logger.error(_context101.t0),_context101.t0;case 20:case"end":return _context101.stop();}}},_callee97,this,[[1,17]])}));function connect(_x174){return _connect6.apply(this,arguments)}return connect}()},{key:"onScreenSizeUpdated",value:function onScreenSizeUpdated(){this.stateTrigger.state.broadcastState.mode!==ae.Follower&&this.syncCameraToRemoteLimiter.invoke()}},{key:"syncBlockTimestamp",value:function syncBlockTimestamp(t){this.magix.syncBlockTimestamp(t)}},{key:"stopBlockTimestamp",value:function stopBlockTimestamp(){this.magix.stopBlockTimestamp()}},{key:"dispatchMagixEvent",value:function dispatchMagixEvent(t,i){if(this.isRoomEnableModify())if(this.eventsQueue)this.eventsQueue.dispatch(t,i);else try{this.dispatchEvent(t,i)}catch(r){this.logger.error(r)}}},{key:"disconnect",value:function(){var _disconnect2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee98(){return regeneratorRuntime.wrap(function _callee98$(_context102){while(1){switch(_context102.prev=_context102.next){case 0:if(!(this._phase===te.Disconnected)){_context102.next=2;break}throw new Error("room did disconnect");case 2:_context102.next=4;return this.magix.disconnect();case 4:case"end":return _context102.stop();}}},_callee98,this)}));function disconnect(){return _disconnect2.apply(this,arguments)}return disconnect}()},{key:"setGlobalState",value:function setGlobalState(t){var _this335=this;return this.isRoomEnableModify()?this.stateTrigger.activeUpdate("globalState",function(){var i=_this335.parametersFilter.filter(t),r=se(_this335.applianceManager.setGlobalState(i));return _this335.dynamicPpt.setGlobalState(Ti(r)),r}):this.stateTrigger.state.globalState}},{key:"setMemberState",value:function setMemberState(t){var _this336=this;var i,r;if(this.isRoomEnableModify()){var n=this.parametersFilter.filter(t);n.currentApplianceName&&((i=this.viewsHub.writableView)==null||i.cancelCurrentContinuityEvent(),this.beforeSceneChangeStoreCommit());var s=this.stateTrigger.activeUpdate("memberState",function(){var _this336$applianceMan=_this336.applianceManager.setMemberStateWithCommitter(n),o=_this336$applianceMan.memberState,a=_this336$applianceMan.committer;return a&&_this336.undoStack.commit(a),se(o)});return this.refreshCursorClass(),(r=this.memberStateStorage)==null||r.setMemberState(n),s}else return this.stateTrigger.state.memberState}},{key:"setViewMode",value:function setViewMode(t){var _this337=this;this.assertRoomIsConnected();var i=this.roomInput.viewStateObserver;if(this._isWritable)this.stateTrigger.activeUpdate("broadcastState",function(){return _this337.applianceManager.setViewState({mode:t}),i.getBroadcastState()}),t===ae.Follower&&i.refreshCameraRectangle();else switch(t){case ae.Follower:{i.overrideWithFreedom(!1),i.refreshCameraRectangle();break}case ae.Freedom:{i.overrideWithFreedom(!0);break}case ae.Broadcaster:throw new Error("cannot be broadcaster when room.isWritable is false");}}},{key:"nextPpt",value:function nextPpt(){var _this$stateTrigger$st=this.stateTrigger.state.sceneState,t=_this$stateTrigger$st.scenes,i=_this$stateTrigger$st.index;i<t.length-1&&this.setSceneIndex(i+1)}},{key:"previousPpt",value:function previousPpt(){var t=this.stateTrigger.state.sceneState.index;t>=1&&this.setSceneIndex(t-1)}},{key:"pptJumpTo",value:function pptJumpTo(t,i){var r="".concat(t,"/").concat(i,".slide"),n=this.state.sceneState.scenes,s=n.findIndex(function(o){return!!o.ppt&&o.ppt.src.endsWith(r)});s>0&&this.setSceneIndex(s)}},{key:"updatePptPageInfo",value:function updatePptPageInfo(){var _this$stateTrigger$st2=this.stateTrigger.state.sceneState,t=_this$stateTrigger$st2.scenes,i=_this$stateTrigger$st2.index,r=t[i],n=r.ppt&&r.ppt.src,s=n&&this.dynamicPpt.getSlideUrl&&this.dynamicPpt.getSlideUrl(n);s&&this.setGlobalState(Ti(this.dynamicPpt.globalStateWith({uuid:s.uuid,pageIndex:s.index,disableAutoPlay:!1})))}},{key:"setScenePath",value:function setScenePath(t){var _this338=this;if(this.isRoomEnableModify()){this.logger.info("change scene path ".concat(t));var i=this.applianceManager,_r213=this.scenePathType(t),n=t;if(_r213===ot.Dir){var s=se(i.getSceneNames(Ft.parse(t))).shift();n=s===void 0?n:[n,s].join(bs)}this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",function(){return i.changeScene(Ft.parse(n)),_this338.undoStack.setCurrentScenePath(n),_this338.getCurrentSceneState()}),this.updatePptPageInfo()}}},{key:"setSceneIndex",value:function setSceneIndex(t){var _this339=this;if(this.isRoomEnableModify()){var i=this.stateTrigger.state.sceneState.scenes[t];if(!i)throw new Error("index ".concat(t," is out of range"));var _r214=this.applianceManager,n=_toConsumableArray(_r214.getCurrentScenePath());n.pop(),n.push(i.name),this.logger.info("change scene index ".concat(t," /").concat(n.join("/"))),this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",function(){_r214.changeScene(n);var s=_this339.getCurrentSceneState();return _this339.undoStack.setCurrentScenePath(s.scenePath),s}),this.updatePptPageInfo()}}},{key:"moveCamera",value:function moveCamera(t){this.assertRoomIsConnected(),_get(_getPrototypeOf(yn.prototype),"moveCamera",this).call(this,t)}},{key:"moveCameraToContain",value:function moveCameraToContain(t){this.assertRoomIsConnected(),_get(_getPrototypeOf(yn.prototype),"moveCameraToContain",this).call(this,t)}},{key:"putScenes",value:function putScenes(t,i,r){var _this340=this;if(this.isRoomEnableModify()){var n=[];var _iterator266=_createForOfIteratorHelper(i),_step266;try{for(_iterator266.s();!(_step266=_iterator266.n()).done;){var s=_step266.value;s.name!==void 0?n.push(this.parametersFilter.filter(s)):n.push({name:(0,gv.v1)().replace(/-/g,""),ppt:s.ppt})}}catch(err){_iterator266.e(err)}finally{_iterator266.f()}this.stateTrigger.activeUpdate("sceneState",function(){return _this340.applianceManager.putScenes(Ft.parse(t),n,r),_this340.getCurrentSceneState()})}}},{key:"cleanCurrentScene",value:function cleanCurrentScene(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!0;if(this.isRoomEnableModify()){var i=this.applianceManager.cleanCurrentScene(t);i&&this.undoStack.commit(i)}}},{key:"removeScenes",value:function removeScenes(t){var _this341=this;this.isRoomEnableModify()&&this.stateTrigger.activeUpdate("sceneState",function(){return _this341.applianceManager.removeScenes(Ft.parse(t)),_this341.getCurrentSceneState()})}},{key:"moveScene",value:function moveScene(t,i){var _this342=this;this.isRoomEnableModify()&&this.stateTrigger.activeUpdate("sceneState",function(){return _this342.applianceManager.moveScene(Ft.parse(t),Ft.parse(i)),_this342.getCurrentSceneState()})}},{key:"createWrappedComponents",value:function createWrappedComponents(){return[].concat(_toConsumableArray(_get(_getPrototypeOf(yn.prototype),"createWrappedComponents",this).call(this)),[fs(mu,this)])}},{key:"createPluginOperator",value:function createPluginOperator(){var _this343=this;return Object.freeze(z(T({},_get(_getPrototypeOf(yn.prototype),"createPluginOperator",this).call(this)),{remove:function remove(t){return _this343.removePlugin(t)},update:function update(t,i){return _this343.updatePlugin(t,i)},getPlugin:function getPlugin(t){return _this343.applianceManager.getPlugin(t)}}))}},{key:"insertImage",value:function insertImage(t){this.isRoomEnableModify()&&this.applianceManager.insertImage(t)}},{key:"completeImageUpload",value:function completeImageUpload(t,i){if(this.isRoomEnableModify()){var _r215=this.applianceManager.completeImageUpload(t,i);_r215&&this.undoStack.commit(_r215)}}},{key:"lockImage",value:function lockImage(t,i){this.isRoomEnableModify()&&this.applianceManager.lockImage(t,i)}},{key:"createInvisiblePlugin",value:function createInvisiblePlugin(t,i){return this.invisiblePluginNode.create(t,i)}},{key:"insertPlugin",value:function insertPlugin(t,i){if(this.isRoomEnableModify()){var _r216=i,n=_r216&&_r216.attributes,s=this.assignAttributes(t,n);return s!==n&&(_r216=z(T({},_r216),{attributes:s})),this.applianceManager.insertPlugin(t,_r216).identifier}else return Wr}},{key:"removePlugin",value:function removePlugin(t){var i=!1;return this.isRoomEnableModify()&&(i=!!this.applianceManager.removePlugin(t)),i}},{key:"updatePlugin",value:function updatePlugin(t,i){var r=!1;return this.isRoomEnableModify()&&(r=!!this.applianceManager.updatePlugin(t,i)),r}},{key:"getPluginAttributes",value:function getPluginAttributes(t){this.assertRoomIsConnected();var i=this.applianceManager.getPlugin(t);return i&&i.attributes}},{key:"getPluginRectangle",value:function getPluginRectangle(t){this.assertRoomIsConnected();var i=this.applianceManager.getPlugin(t);return i&&{originX:i.originX,originY:i.originY,width:i.width,height:i.height}}},{key:"duplicate",value:function duplicate(){if(this.isRoomEnableModify()){var t=12,i=t*(Math.random()*2-1),_r217=t*(Math.random()*2-1),n=this.applianceManager.duplicate(i,_r217);n&&this.undoStack.commit(n)}}},{key:"updateTextFontSize",value:function updateTextFontSize(t){var r;(r=this.memberStateStorage)==null||r.setMemberState({textSize:t}),this.applianceManager.setMemberState({textSize:t});var i=this.applianceManager.updateTextareaFontSize(t);i&&this.undoStack.commit(i)}},{key:"updateTextFormat",value:function updateTextFormat(t){var i;if(this.textareaHub){var _r218={};"bold"in t&&(_r218.bold=t.bold),"italic"in t&&(_r218.italic=t.italic),"underline"in t&&(_r218.underline=t.underline),"lineThrough"in t&&(_r218.lineThrough=t.lineThrough),"color"in t&&(_r218.strokeColor=t.color),(i=this.memberStateStorage)==null||i.setMemberState(_r218),this.applianceManager.setMemberState(_r218);var n=this.textareaHub.getTextareaSizeMap(t),s=this.applianceManager.updateTextareaFormat(t,n);s&&this.undoStack.commit(s)}}},{key:"copy",value:function copy(){this.isRoomEnableModify()&&(this.copyBuffer=this.applianceManager.copy())}},{key:"paste",value:function paste(){if(this.isRoomEnableModify()&&this.copyBuffer){var t=12,i=t*(Math.random()*2-1),_r219=t*(Math.random()*2-1),n=this.applianceManager.paste(this.copyBuffer,i,_r219);n&&this.undoStack.commit(n)}}},{key:"canUndoSteps",get:function get(){return this.undoStack.canUndoSteps}},{key:"canRedoSteps",get:function get(){return this.undoStack.canRedoSteps}},{key:"undo",value:function undo(){return this.isRoomEnableModify()&&(this.applianceManager.hasEditingTextarea()&&this.beforeSceneChangeStoreCommit(),this.undoStack.undo()),this.undoStack.canUndoSteps}},{key:"redo",value:function redo(){return this.isRoomEnableModify()&&this.undoStack.redo(),this.undoStack.canRedoSteps}},{key:"delete",value:function _delete(){if(this.isRoomEnableModify()){var t=this.applianceManager["delete"]();t&&this.undoStack.commit(t)}}},{key:"lockImages",value:function lockImages(t){this.applianceManager.lockImages(t)}},{key:"moveSelectedComponentsToTop",value:function moveSelectedComponentsToTop(){this.applianceManager.moveSelectedComponentsToTop()}},{key:"moveSelectedComponentsToBottom",value:function moveSelectedComponentsToBottom(){this.applianceManager.moveSelectedComponentsToBottom()}},{key:"pptNextStep",value:function pptNextStep(){this.isRoomEnableModify()&&this.pptMoveStep(1)}},{key:"pptPreviousStep",value:function pptPreviousStep(){this.isRoomEnableModify()&&this.pptMoveStep(-1)}},{key:"pptMoveStep",value:function pptMoveStep(t){var _this$stateTrigger$st3=this.stateTrigger.state.sceneState,i=_this$stateTrigger$st3.scenes,r=_this$stateTrigger$st3.index,n=i[r],s=n.ppt&&n.ppt.src;if(s&&this.dynamicPpt.getSlideUrl(s))this.dynamicPpt.moveStep(t);else{var a=r+t;a>=0&&a<i.length&&this.setSceneIndex(a)}}},{key:"refreshCursorClass",value:function refreshCursorClass(){var t;switch(this.phase){case te.Reconnecting:case te.Disconnecting:case te.Disconnected:{t=le.Ban;break}case te.Connected:{if(this._isWritable&&this.stateTrigger){var i=this.stateTrigger.state.memberState;if(i&&this.magix.isWritable&&!this._disableDeviceInputs)switch(i.currentApplianceName){case X.hand:{t=this.isHandGrasp?le.HandGrasp:le.Hand;break}default:{t="cursor-"+i.currentApplianceName;break}}else t=null}break}}t!==void 0&&this.viewsHub.putState({cursorClass:t})}},{key:"refreshShouldDisableImageHit",value:function refreshShouldDisableImageHit(){this.viewsHub.putState({disalbeImageHit:this._disableEraseImage&&this.isEraser})}},{key:"exportScene",value:function(){var _exportScene=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee99(t){var r;return regeneratorRuntime.wrap(function _callee99$(_context103){while(1){switch(_context103.prev=_context103.next){case 0:if(!(this.scenePathType(t)!==ot.Page)){_context103.next=2;break}throw new Error("can export a page, because of ".concat(t,"'s scene path type is not a scene page"));case 2:_context103.next=4;return this.apiFetch("http://api/v5/rooms/".concat(this.uuid,"/scenes-export/"),{method:"POST",headers:{token:this.roomToken,"content-type":"application/json"},body:JSON.stringify({path:t})});case 4:r=_context103.sent;if(!(r.status===201)){_context103.next=9;break}_context103.next=8;return r.blob();case 8:return _context103.abrupt("return",_context103.sent);case 9:_context103.t0=Error;_context103.t1="export scene fail: ";_context103.next=13;return r.text();case 13:_context103.t2=_context103.sent;_context103.t3=_context103.t1.concat.call(_context103.t1,_context103.t2);throw new _context103.t0(_context103.t3);case 16:case"end":return _context103.stop();}}},_callee99,this)}));function exportScene(_x175){return _exportScene.apply(this,arguments)}return exportScene}()},{key:"importScene",value:function(){var _importScene=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee100(t,i){var r,d,n,s,o,c,h;return regeneratorRuntime.wrap(function _callee100$(_context104){while(1){switch(_context104.prev=_context104.next){case 0:r=this.scenePathType(t);if(!(r===ot.Page||r===ot.Conflict)){_context104.next=4;break}d=r===ot.Page?"".concat(t," is a scene page"):"".concat(t," path contains a page");throw new Error("can't import a scene in ".concat(t,", because of ").concat(d));case 4:_context104.next=6;return this.getSceneFromBlob(i);case 6:n=_context104.sent;s=n.name;o=[t,s].join(bs);if(!(this.scenePathType(o)===ot.Dir)){_context104.next=11;break}throw new Error("can't import a scene in ".concat(o," because of ").concat(o," contains scene page"));case 11:c=new FormData;c.append("dir",t),c.append("payload",i);_context104.next=15;return this.apiFetch("http://api/v5/rooms/".concat(this.uuid,"/scenes-import/"),{method:"POST",headers:{token:this.roomToken},body:c});case 15:h=_context104.sent;if(!(h.status>=300)){_context104.next=24;break}_context104.t0=Error;_context104.t1="import scene fail: ";_context104.next=21;return h.text();case 21:_context104.t2=_context104.sent;_context104.t3=_context104.t1.concat.call(_context104.t1,_context104.t2);throw new _context104.t0(_context104.t3);case 24:return _context104.abrupt("return",n);case 25:case"end":return _context104.stop();}}},_callee100,this)}));function importScene(_x176,_x177){return _importScene.apply(this,arguments)}return importScene}()},{key:"getSceneFromBlob",value:function(){var _getSceneFromBlob=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee101(t){var _this344=this;return regeneratorRuntime.wrap(function _callee101$(_context105){while(1){switch(_context105.prev=_context105.next){case 0:return _context105.abrupt("return",new Promise(function(i,r){var n=new FileReader;n.readAsArrayBuffer(t),n.onloadend=function(){if(n.result instanceof ArrayBuffer)try{var s=ri(n.result),o=_this344.applianceManager.getSceneFromFile(s);i(o)}catch(s){i(s)}else i(new Error("wrong content"))},n.onerror=function(s){r(s)}}));case 1:case"end":return _context105.stop();}}},_callee101)}));function getSceneFromBlob(_x178){return _getSceneFromBlob.apply(this,arguments)}return getSceneFromBlob}()},{key:"isRoomEnableModify",value:function isRoomEnableModify(){if(this.assertRoomIsConnected(),this._isWritable)return!0;switch(this.rejectWhenReadonlyErrorLevel){case Fr.ThrowError:throw new Error("you can only call it when room is writable");case Fr.Warn:{this.logger.warn("you can only call it when room is writable");break}}return!1}},{key:"createFloatBarDelegate",value:function createFloatBarDelegate(){var _this345=this;return Object.freeze({"delete":function _delete(){return _this345["delete"]()},lockImages:function lockImages(t){return _this345.lockImages(t)},moveSelectedComponentsToTop:function moveSelectedComponentsToTop(){return _this345.moveSelectedComponentsToTop()},moveSelectedComponentsToBottom:function moveSelectedComponentsToBottom(){return _this345.moveSelectedComponentsToBottom()},duplicate:function duplicate(){return _this345.duplicate()},updateTextareaFontSize:function updateTextareaFontSize(t){return _this345.updateTextFontSize(t)},updateTextareaFormat:function updateTextareaFormat(t){return _this345.updateTextFormat(t)}})}},{key:"assertRoomIsConnected",value:function assertRoomIsConnected(){if(this._phase!==te.Connected)throw new Error("you can only call it when room is connected. the phase of room is "+this._phase)}},{key:"beforeSceneChangeStoreCommit",value:function beforeSceneChangeStoreCommit(){var t=this.applianceManager.releaseAllTextarea();t&&this.undoStack.commit(t)}},{key:"releaseAllTextareaByEsc",value:function releaseAllTextareaByEsc(t){if(t.code==="Escape"){var i=this.applianceManager.releaseAllTextarea();i&&this.undoStack.commit(i)}}}]);return yn}(Mo);var Xe;(function(o){o.WaitingFirstFrame="waitingFirstFrame",o.Playing="playing",o.Pause="pause",o.Stopped="stop",o.Ended="ended",o.Buffering="buffering"})(Xe||(Xe={}));var Ei;(function(i){i.Directory="directory",i.Freedom="freedom"})(Ei||(Ei={}));var bn;(function(n){n.Success="success",n.SuccessButUnnecessary="successButUnnecessary",n.Override="override",n.Stopped="stopped"})(bn||(bn={}));var Ql=x(require("mobx"));var SP=new Date("2019-06-23Z00:00:00").getTime(),vn=/*#__PURE__*/function(_Mo2){_inherits(vn,_Mo2);var _super95=_createSuper(vn);function vn(t){var _this346;_classCallCheck(this,vn);_this346=_super95.call(this,{logger:t.logger,region:t.region,useMobXState:t.useMobXState,screenType:t.screenType,renderEngine:t.renderEngine,boundless:t.boundless,cameraBound:t.cameraBound,autoResize:t.autoResize,plugins:t.plugins,invisiblePlugins:t.invisiblePlugins,wrappedComponents:t.wrappedComponents,preloadDynamicPPT:t.preloadDynamicPPT,userFonts:t.userFonts,handToolKey:t.handToolKey,fontFamily:t.fontFamily,onlyCallbackRemoteStateModify:t.onlyCallbackRemoteStateModify,disableOthersSelectingBox:t.disableOthersSelectingBox,disableCameraTransform:t.disableCameraTransform,useMultiViews:t.useMultiViews,disableOperations:!0,willHideSelfCursor:!1,cursorAdapter:t.cursorAdapter,eraserRadiusCursor:t.eraserRadiusCursor,urlInterrupter:t.urlInterrupter,pptParams:t.pptParams,callbacks:t.callbacks});_this346.didLoadFirstFrame=!1;_this346.observerMode=Ei.Directory;_this346.onTriggerBuilt=function(){_this346.hasLibraryNode&&(_this346.viewsHub.fireReloadLibrary(),_this346.members.refresh())};_this346.onLibraryNodeChanged=function(t,i){var n;var r=_this346.hasLibraryNode;if(_this346.updateLibraryNode(i),!r){var _assertThisInitialize=_assertThisInitialized(_this346),s=_assertThisInitialize.applianceManager,o=_assertThisInitialize.cameraObserver;_this346.viewStateObserver=new Eo(_this346.viewsHub,s),_this346.stateTrigger=new yo({useMobXMode:_this346.useMobXState,disableMaskKey:_this346.onlyCallbackRemoteStateModify,onStateChanged:_this346.onPlayerStateChanged,propertyGetters:{observerMode:function observerMode(){return _this346.observerMode},globalState:function globalState(){return se(s.getGlobalState())},roomMembers:function roomMembers(){return _this346.getRoomMembers()},sceneState:function sceneState(){return _this346.getCurrentSceneState()},cameraState:function cameraState(){return o.cameraState}}}),_this346.useMultiViews||(n=_this346.mainView)==null||n.callbacks.on("onCameraTransform",_this346.onCameraTransform)}};_this346.onPhaseChanged=function(t){var i=!1;!_this346.didLoadFirstFrame&&_this346.hasFrameToDisplay(t)&&(_this346.didLoadFirstFrame=!0,i=!0,_this346.fetchNextPptSlideIfNeeded(_this346.state.sceneState),_this346.setupAfterLoadFirstFrame()),_this346.updatePhaseByReconstructorPhase(_this346.reconstructor.phase)&&(_this346.logger.info("change player phase to "+_this346._phase),_this346.callbacks.dispatch("onPhaseChanged",function(n){return n(_this346._phase)}),_this346.dynamicPpt&&_this346.dynamicPpt.replayPasue&&_this346.dynamicPpt.replayPasue(_this346._phase!==Xe.Playing)),i&&_this346.callbacks.dispatch("onLoadFirstFrame",function(n){return n()}),_this346.invisiblePluginNode.isWatching=_this346._phase===Xe.Playing||_this346._phase===Xe.Pause};_this346.onPlayerStateChanged=function(t){t.globalState&&_this346.dynamicPpt.setGlobalState(Ti(t.globalState)),t.sceneState&&_this346.fetchNextPptSlideIfNeeded(t.sceneState),_this346.callbacks.dispatch("onPlayerStateChanged",function(i){return i(t)})};_this346.onSliceChanged=function(t){_this346.logger.context=z(T({},_this346.logger.context),{slice:t&&t.uuid}),_this346.refreshForcePPTLandscapeWithSlice(t),_this346.callbacks.dispatch("onSliceChanged",function(i){return i(t.uuid)})};_this346.onCameraTransform=function(t){t===di.Begin&&_this346.observerMode===Ei.Directory&&(_this346.observerMode=Ei.Freedom)};_this346.onModified=function(){_this346.viewStateObserver&&_this346.observerMode===Ei.Directory&&_this346.viewStateObserver.refreshCameraRectangle(),_this346.refreshRender()};_this346.callbacks.on("onProgressTimeChanged",function(i){return _this346.putPlayerState({timestamp:i})}),(0,Ql.makeObservable)(_assertThisInitialized(_this346),{observerMode:Ql.observable});return _this346}_createClass(vn,[{key:"applianceManager",get:function get(){return this.reconstructor.trigger}},{key:"parametersFilter",get:function get(){}},{key:"playbackSpeed",get:function get(){return this.reconstructor.playbackSpeed},set:function set(t){this.reconstructor.playbackSpeed=t,this.putPlayerState({playbackSpeed:t})}},{key:"disablePencilWrittingLimitFrequency",get:function get(){return!1}},{key:"setupReconstructor",value:function(){var _setupReconstructor=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee102(t){return regeneratorRuntime.wrap(function _callee102$(_context106){while(1){switch(_context106.prev=_context106.next){case 0:_context106.prev=0;_context106.next=3;return t.akkoApp.createReconstructor({logger:this.logger,roomToken:t.roomToken,clientVersion:ee.sdkVersion,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:this.createReconstructorCallbacks(),rangeQuery:{region:t.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration}});case 3:this.reconstructor=_context106.sent;this.updatePhaseByReconstructorPhase(this.reconstructor.phase);this.logger.info("setup player success");this.logger.context=z(T({},this.logger.context),{uuid:this.reconstructor.roomUUID,slice:this.reconstructor.slice&&this.reconstructor.slice.uuid});_context106.next=12;break;case 9:_context106.prev=9;_context106.t0=_context106["catch"](0);throw this.logger.error("setup player fail"),this.logger.error(_context106.t0),_context106.t0;case 12:case"end":return _context106.stop();}}},_callee102,this,[[0,9]])}));function setupReconstructor(_x179){return _setupReconstructor.apply(this,arguments)}return setupReconstructor}()},{key:"createReconstructorCallbacks",value:function createReconstructorCallbacks(){var _this347=this;return{onEventFire:function onEventFire(t){return _this347.dispatchMagixEventWithObject(t,!1,!1)},onSliceChanged:this.onSliceChanged,onTriggerBuilt:this.onTriggerBuilt,onLibraryNodeChanged:this.onLibraryNodeChanged,onPhaseChanged:this.onPhaseChanged,onModified:this.onModified,onIsPlayableChanged:function onIsPlayableChanged(t){return _this347.callbacks.dispatch("onIsPlayableChanged",function(i){return i(t)})},onProgressTimeChanged:function onProgressTimeChanged(t){return _this347.callbacks.dispatch("onProgressTimeChanged",function(i){return i(t)})},onStoppedWithError:function onStoppedWithError(t){return _this347.callbacks.dispatch("onStoppedWithError",function(i){return i(t)})},onCatchErrorWhenAppendFrame:function onCatchErrorWhenAppendFrame(t,i){_this347.callbacks.dispatch("onCatchErrorWhenAppendFrame",function(r){return r(t,i)})}}}},{key:"hasFrameToDisplay",value:function hasFrameToDisplay(t){switch(t){case de.Playing:case de.Pause:case de.Buffering:case de.Ended:return!0;default:return!1;}}},{key:"setupAfterLoadFirstFrame",value:function setupAfterLoadFirstFrame(){this.reconstructor.slice&&this.refreshForcePPTLandscapeWithSlice(this.reconstructor.slice),this.dynamicPpt.setGlobalState(se(this.applianceManager.getGlobalState()))}},{key:"dispose",value:function dispose(){var t;_get(_getPrototypeOf(vn.prototype),"dispose",this).call(this),this.viewStateObserver&&this.viewStateObserver.release(),this.stateTrigger&&this.stateTrigger.release(),this.useMultiViews||(t=this.mainView)==null||t.callbacks.on("onCameraTransform",this.onCameraTransform)}},{key:"createWrappedComponents",value:function createWrappedComponents(){return[].concat(_toConsumableArray(_get(_getPrototypeOf(vn.prototype),"createWrappedComponents",this).call(this)),[fs(fu,this)])}},{key:"refreshForcePPTLandscapeWithSlice",value:function refreshForcePPTLandscapeWithSlice(t){t.beginTimestamp<=SP?this.viewsHub.putState({forcePPTLandscape:!0}):this.viewsHub.putState({forcePPTLandscape:!1})}},{key:"setObserverMode",value:function setObserverMode(t){var _this348=this;this.stateTrigger.activeUpdate("observerMode",function(){return _this348.observerMode=t}),this.viewStateObserver&&t===Ei.Directory&&this.viewStateObserver.refreshCameraRectangle()}},{key:"state",get:function get(){if(!this.hasLibraryNode)throw new Error("can't read state before load first frame");return this.stateTrigger.state}},{key:"roomUUID",get:function get(){return this.reconstructor.roomUUID}},{key:"slice",get:function get(){return this.reconstructor.slice&&this.reconstructor.slice.uuid}},{key:"isPlayable",get:function get(){return this.reconstructor.isPlayable}},{key:"phase",get:function get(){return this._phase}},{key:"progressTime",get:function get(){return this.reconstructor.progressTime}},{key:"timeDuration",get:function get(){return this.reconstructor.duration}},{key:"framesCount",get:function get(){return this.reconstructor.framesCount}},{key:"beginTimestamp",get:function get(){return this.reconstructor.beginTimestamp}},{key:"play",value:function play(){this.assertRoomIsConnected(),this.reconstructor.play()}},{key:"pause",value:function pause(){this.assertRoomIsConnected(),this.reconstructor.pause()}},{key:"stop",value:function stop(){if(this._phase===Xe.Stopped)throw new Error("player did stop");this.reconstructor.stop(),this.dispose()}},{key:"seekToProgressTime",value:function(){var _seekToProgressTime=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee103(t){return regeneratorRuntime.wrap(function _callee103$(_context107){while(1){switch(_context107.prev=_context107.next){case 0:this.assertRoomIsConnected();_context107.next=3;return this.reconstructor.seekToProgressTime(t);case 3:_context107.t0=_context107.sent;_context107.next=_context107.t0===Ht.Success?6:_context107.t0===Ht.SuccessButUnnecessary?7:_context107.t0===Ht.Override?8:_context107.t0===Ht.Stopped?9:10;break;case 6:return _context107.abrupt("return",bn.Success);case 7:return _context107.abrupt("return",bn.SuccessButUnnecessary);case 8:return _context107.abrupt("return",bn.Override);case 9:return _context107.abrupt("return",bn.Stopped);case 10:throw new Error("invalid result");case 11:case"end":return _context107.stop();}}},_callee103,this)}));function seekToProgressTime(_x180){return _seekToProgressTime.apply(this,arguments)}return seekToProgressTime}()},{key:"updatePhaseByReconstructorPhase",value:function updatePhaseByReconstructorPhase(t){var i=vn.covertPhase(t),r=this._phase!==i;return r&&(this._phase=i,this.putPlayerState({isPlaying:i===Xe.Playing})),r}},{key:"assertRoomIsConnected",value:function assertRoomIsConnected(){if(this._phase===Xe.Stopped)throw new Error("you cannot call it when phase of player is stopped")}}],[{key:"covertPhase",value:function covertPhase(t){switch(t){case de.WaitingFirstFrame:return Xe.WaitingFirstFrame;case de.Playing:return Xe.Playing;case de.Pause:return Xe.Pause;case de.Stopped:return Xe.Stopped;case de.Ended:return Xe.Ended;case de.Buffering:case de.Seeking:return Xe.Buffering;default:throw new Error("invalid phase ".concat(t));}}}]);return vn}(Mo);var Yl=/*#__PURE__*/function(_Oo$Component){_inherits(Yl,_Oo$Component);var _super96=_createSuper(Yl);function Yl(){_classCallCheck(this,Yl);return _super96.apply(this,arguments)}_createClass(Yl,[{key:"render",value:function render(){var _this349=this;return Oo.createElement(xo,null,function(t){return Oo.createElement(ms,z(T({},_this349.props),{room:t}))})}}],[{key:"willInterruptEvent",value:function willInterruptEvent(){return ms.willInterruptEvent()}}]);return Yl}(Oo.Component);function ju(e){var t;return typeof e=="boolean"?e?t=Object.freeze({colors:yv()}):t=void 0:e&&(t=Object.freeze({colors:yv(e.colors)})),t}function yv(e){return e?Object.freeze(e.map(function(t){return Object.freeze(_toConsumableArray(t))})):wP}var wP=Object.freeze([Object.freeze([224,32,32]),Object.freeze([250,100,0]),Object.freeze([247,181,0]),Object.freeze([109,212,0]),Object.freeze([68,215,182]),Object.freeze([50,197,255]),Object.freeze([0,145,255]),Object.freeze([98,54,255]),Object.freeze([182,32,224]),Object.freeze([109,114,120]),Object.freeze([0,0,0]),Object.freeze([255,255,255])]);var kP=Object.defineProperty,CP=Object.defineProperties,xP=Object.getOwnPropertyDescriptors,bv=Object.getOwnPropertySymbols,IP=Object.prototype.hasOwnProperty,PP=Object.prototype.propertyIsEnumerable,vv=function vv(e,t,i){return t in e?kP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},Sv=function Sv(e,t){for(var i in t||(t={})){IP.call(t,i)&&vv(e,i,t[i])}if(bv){var _iterator267=_createForOfIteratorHelper(bv(t)),_step267;try{for(_iterator267.s();!(_step267=_iterator267.n()).done;){var i=_step267.value;PP.call(t,i)&&vv(e,i,t[i])}}catch(err){_iterator267.e(err)}finally{_iterator267.f()}}return e},MP=function MP(e,t){return CP(e,xP(t))},TP=/*#__PURE__*/function(){var _ref128=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee104(e,t){var i;return regeneratorRuntime.wrap(function _callee104$(_context108){while(1){switch(_context108.prev=_context108.next){case 0:_context108.next=2;return window.fetch(t,{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});case 2:i=_context108.sent;if(i.ok){_context108.next=5;break}throw new Error("report log failed, request status code: ".concat(i.status,", statusText: ").concat(i.statusText));case 5:case"end":return _context108.stop();}}},_callee104)}));return function TP(_x181,_x182){return _ref128.apply(this,arguments)}}(),wv=/*#__PURE__*/function(){function wv(e,t,i){_classCallCheck(this,wv);this.argusEncoder=e,this.timestampKey=i,this.reportQueueManage=new Mf(wv.logQueue,t,TP,console.warn)}_createClass(wv,[{key:"report",value:function report(e,t){var i=this.convertToBody(e),r=this.argusEncoder.encode(t,i);this.reportQueueManage.report(r)["catch"](function(){})}},{key:"convertToBody",value:function convertToBody(e){var t=e.timestamp,i=e.logObject,r={};this.timestampKey!==void 0&&(r[this.timestampKey]="".concat(t));for(var n in i){r[n]="".concat(i[n])}return r}}]);return wv}(),kv=wv;kv.logQueue=new Pf;var ql=/*#__PURE__*/function(){function ql(e){_classCallCheck(this,ql);this.events=e.events,this.argusEncoder=new If(e.events,e.vid),this.reporter=new kv(this.argusEncoder,e.reportResourceURL,e.timestampKey),this.logger=new Gn({prefix:e.prefix,levelMask:e.printLevelMask}),this.reportLevelMaskIndex=js[e.reportLevelMask||"info"]}_createClass(ql,[{key:"commit",value:function commit(e,t){this.reportLogNode(e,{timestamp:Date.now(),logObject:Sv({},t)})}},{key:"log",value:function log(e,t,i,r){if(this.logger.log(e,t,i),js[t]>=this.reportLevelMaskIndex){var n={timestamp:Date.now(),logObject:MP(Sv({},r),{level:t,message:i})};this.reportLogNode(e,n)}}},{key:"isSupportedEvents",value:function isSupportedEvents(e){return e in this.events}},{key:"reportLogNode",value:function reportLogNode(e,t){try{this.reporter.report(t,e)}catch(i){console.warn(i)}}}]);return ql}();var jt=x(require("protobufjs/minimal")),Te=jt.Reader,Ro=jt.Writer,k=jt.util,Ee=jt.roots["default"]||(jt.roots["default"]={}),Cv=Ee.WhiteBoardPlayer=function(){function e(t){if(t)for(var i=Object.keys(t),_r220=0;_r220<i.length;++_r220){t[i[_r220]]!=null&&(this[i[_r220]]=t[i[_r220]])}}return e.prototype.lts=k.Long?k.Long.fromBits(0,0,!1):0,e.prototype.uuid="",e.prototype.region="",e.prototype.slice="",e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.vid=0,e.prototype.clientIP="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=Ro.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(18).string(i.uuid),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(26).string(i.region),i.slice!=null&&Object.hasOwnProperty.call(i,"slice")&&r.uint32(34).string(i.slice),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(42).string(i.team),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(50).string(i.app),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(58).string(i.akkoVersion),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(66).string(i.sdkVersion),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(74).string(i.nativeVersion),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(82).string(i.platform),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(90).string(i.os),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(98).string(i.createdAt),i.level!=null&&Object.hasOwnProperty.call(i,"level")&&r.uint32(106).string(i.level),i.message!=null&&Object.hasOwnProperty.call(i,"message")&&r.uint32(114).string(i.message),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(120).int32(i.vid),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(130).string(i.clientIP),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Te||(i=Te.create(i));var n=r===void 0?i.len:i.pos+r,s=new Ee.WhiteBoardPlayer;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.uuid=i.string();break;case 3:s.region=i.string();break;case 4:s.slice=i.string();break;case 5:s.team=i.string();break;case 6:s.app=i.string();break;case 7:s.akkoVersion=i.string();break;case 8:s.sdkVersion=i.string();break;case 9:s.nativeVersion=i.string();break;case 10:s.platform=i.string();break;case 11:s.os=i.string();break;case 12:s.createdAt=i.string();break;case 13:s.level=i.string();break;case 14:s.message=i.string();break;case 15:s.vid=i.int32();break;case 16:s.clientIP=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Te||(i=new Te(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!k.isInteger(i.lts)&&!(i.lts&&k.isInteger(i.lts.low)&&k.isInteger(i.lts.high))?"lts: integer|Long expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!k.isString(i.uuid)?"uuid: string expected":i.region!=null&&i.hasOwnProperty("region")&&!k.isString(i.region)?"region: string expected":i.slice!=null&&i.hasOwnProperty("slice")&&!k.isString(i.slice)?"slice: string expected":i.team!=null&&i.hasOwnProperty("team")&&!k.isString(i.team)?"team: string expected":i.app!=null&&i.hasOwnProperty("app")&&!k.isString(i.app)?"app: string expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!k.isString(i.akkoVersion)?"akkoVersion: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!k.isString(i.sdkVersion)?"sdkVersion: string expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!k.isString(i.nativeVersion)?"nativeVersion: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!k.isString(i.platform)?"platform: string expected":i.os!=null&&i.hasOwnProperty("os")&&!k.isString(i.os)?"os: string expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!k.isString(i.createdAt)?"createdAt: string expected":i.level!=null&&i.hasOwnProperty("level")&&!k.isString(i.level)?"level: string expected":i.message!=null&&i.hasOwnProperty("message")&&!k.isString(i.message)?"message: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!k.isInteger(i.vid)?"vid: integer expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!k.isString(i.clientIP)?"clientIP: string expected":null},e.fromObject=function(i){if(i instanceof Ee.WhiteBoardPlayer)return i;var r=new Ee.WhiteBoardPlayer;return i.lts!=null&&(k.Long?(r.lts=k.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.uuid!=null&&(r.uuid=String(i.uuid)),i.region!=null&&(r.region=String(i.region)),i.slice!=null&&(r.slice=String(i.slice)),i.team!=null&&(r.team=String(i.team)),i.app!=null&&(r.app=String(i.app)),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.platform!=null&&(r.platform=String(i.platform)),i.os!=null&&(r.os=String(i.os)),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.level!=null&&(r.level=String(i.level)),i.message!=null&&(r.message=String(i.message)),i.vid!=null&&(r.vid=i.vid|0),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(k.Long){var s=new k.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.uuid="",n.region="",n.slice="",n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.createdAt="",n.level="",n.message="",n.vid=0,n.clientIP=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?k.Long.prototype.toString.call(i.lts):r.longs===Number?new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.slice!=null&&i.hasOwnProperty("slice")&&(n.slice=i.slice),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.level!=null&&i.hasOwnProperty("level")&&(n.level=i.level),i.message!=null&&i.hasOwnProperty("message")&&(n.message=i.message),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},e}(),xv=Ee.WhiteBoardQualityConnection=function(){function e(t){if(t)for(var i=Object.keys(t),_r221=0;_r221<i.length;++_r221){t[i[_r221]]!=null&&(this[i[_r221]]=t[i[_r221]])}}return e.prototype.lts=k.Long?k.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.isReconnection="",e.prototype.retryCount="",e.prototype.buildWebSocketDuration="",e.prototype.buildMagixDuration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.clientIP="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=Ro.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(18).string(i.team),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(26).string(i.app),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(34).string(i.akkoVersion),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(42).string(i.sdkVersion),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(50).string(i.nativeVersion),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(58).string(i.platform),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(66).string(i.os),i.kind!=null&&Object.hasOwnProperty.call(i,"kind")&&r.uint32(74).string(i.kind),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(82).string(i.uuid),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(90).string(i.region),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&r.uint32(98).string(i.userId),i.session!=null&&Object.hasOwnProperty.call(i,"session")&&r.uint32(106).string(i.session),i.isReconnection!=null&&Object.hasOwnProperty.call(i,"isReconnection")&&r.uint32(114).string(i.isReconnection),i.retryCount!=null&&Object.hasOwnProperty.call(i,"retryCount")&&r.uint32(122).string(i.retryCount),i.buildWebSocketDuration!=null&&Object.hasOwnProperty.call(i,"buildWebSocketDuration")&&r.uint32(130).string(i.buildWebSocketDuration),i.buildMagixDuration!=null&&Object.hasOwnProperty.call(i,"buildMagixDuration")&&r.uint32(138).string(i.buildMagixDuration),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(146).string(i.createdAt),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(152).int32(i.vid),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(162).string(i.clientIP),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Te||(i=Te.create(i));var n=r===void 0?i.len:i.pos+r,s=new Ee.WhiteBoardQualityConnection;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.team=i.string();break;case 3:s.app=i.string();break;case 4:s.akkoVersion=i.string();break;case 5:s.sdkVersion=i.string();break;case 6:s.nativeVersion=i.string();break;case 7:s.platform=i.string();break;case 8:s.os=i.string();break;case 9:s.kind=i.string();break;case 10:s.uuid=i.string();break;case 11:s.region=i.string();break;case 12:s.userId=i.string();break;case 13:s.session=i.string();break;case 14:s.isReconnection=i.string();break;case 15:s.retryCount=i.string();break;case 16:s.buildWebSocketDuration=i.string();break;case 17:s.buildMagixDuration=i.string();break;case 18:s.createdAt=i.string();break;case 19:s.vid=i.int32();break;case 20:s.clientIP=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Te||(i=new Te(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!k.isInteger(i.lts)&&!(i.lts&&k.isInteger(i.lts.low)&&k.isInteger(i.lts.high))?"lts: integer|Long expected":i.team!=null&&i.hasOwnProperty("team")&&!k.isString(i.team)?"team: string expected":i.app!=null&&i.hasOwnProperty("app")&&!k.isString(i.app)?"app: string expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!k.isString(i.akkoVersion)?"akkoVersion: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!k.isString(i.sdkVersion)?"sdkVersion: string expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!k.isString(i.nativeVersion)?"nativeVersion: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!k.isString(i.platform)?"platform: string expected":i.os!=null&&i.hasOwnProperty("os")&&!k.isString(i.os)?"os: string expected":i.kind!=null&&i.hasOwnProperty("kind")&&!k.isString(i.kind)?"kind: string expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!k.isString(i.uuid)?"uuid: string expected":i.region!=null&&i.hasOwnProperty("region")&&!k.isString(i.region)?"region: string expected":i.userId!=null&&i.hasOwnProperty("userId")&&!k.isString(i.userId)?"userId: string expected":i.session!=null&&i.hasOwnProperty("session")&&!k.isString(i.session)?"session: string expected":i.isReconnection!=null&&i.hasOwnProperty("isReconnection")&&!k.isString(i.isReconnection)?"isReconnection: string expected":i.retryCount!=null&&i.hasOwnProperty("retryCount")&&!k.isString(i.retryCount)?"retryCount: string expected":i.buildWebSocketDuration!=null&&i.hasOwnProperty("buildWebSocketDuration")&&!k.isString(i.buildWebSocketDuration)?"buildWebSocketDuration: string expected":i.buildMagixDuration!=null&&i.hasOwnProperty("buildMagixDuration")&&!k.isString(i.buildMagixDuration)?"buildMagixDuration: string expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!k.isString(i.createdAt)?"createdAt: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!k.isInteger(i.vid)?"vid: integer expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!k.isString(i.clientIP)?"clientIP: string expected":null},e.fromObject=function(i){if(i instanceof Ee.WhiteBoardQualityConnection)return i;var r=new Ee.WhiteBoardQualityConnection;return i.lts!=null&&(k.Long?(r.lts=k.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.team!=null&&(r.team=String(i.team)),i.app!=null&&(r.app=String(i.app)),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.platform!=null&&(r.platform=String(i.platform)),i.os!=null&&(r.os=String(i.os)),i.kind!=null&&(r.kind=String(i.kind)),i.uuid!=null&&(r.uuid=String(i.uuid)),i.region!=null&&(r.region=String(i.region)),i.userId!=null&&(r.userId=String(i.userId)),i.session!=null&&(r.session=String(i.session)),i.isReconnection!=null&&(r.isReconnection=String(i.isReconnection)),i.retryCount!=null&&(r.retryCount=String(i.retryCount)),i.buildWebSocketDuration!=null&&(r.buildWebSocketDuration=String(i.buildWebSocketDuration)),i.buildMagixDuration!=null&&(r.buildMagixDuration=String(i.buildMagixDuration)),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.vid!=null&&(r.vid=i.vid|0),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(k.Long){var s=new k.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.isReconnection="",n.retryCount="",n.buildWebSocketDuration="",n.buildMagixDuration="",n.createdAt="",n.vid=0,n.clientIP=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?k.Long.prototype.toString.call(i.lts):r.longs===Number?new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.kind!=null&&i.hasOwnProperty("kind")&&(n.kind=i.kind),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.userId!=null&&i.hasOwnProperty("userId")&&(n.userId=i.userId),i.session!=null&&i.hasOwnProperty("session")&&(n.session=i.session),i.isReconnection!=null&&i.hasOwnProperty("isReconnection")&&(n.isReconnection=i.isReconnection),i.retryCount!=null&&i.hasOwnProperty("retryCount")&&(n.retryCount=i.retryCount),i.buildWebSocketDuration!=null&&i.hasOwnProperty("buildWebSocketDuration")&&(n.buildWebSocketDuration=i.buildWebSocketDuration),i.buildMagixDuration!=null&&i.hasOwnProperty("buildMagixDuration")&&(n.buildMagixDuration=i.buildMagixDuration),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},e}(),Iv=Ee.WhiteBoardQualityDisconnection=function(){function e(t){if(t)for(var i=Object.keys(t),_r222=0;_r222<i.length;++_r222){t[i[_r222]]!=null&&(this[i[_r222]]=t[i[_r222]])}}return e.prototype.lts=k.Long?k.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.duration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.isReconnection="",e.prototype.clientIP="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=Ro.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(18).string(i.team),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(26).string(i.app),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(34).string(i.akkoVersion),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(42).string(i.sdkVersion),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(50).string(i.nativeVersion),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(58).string(i.platform),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(66).string(i.os),i.kind!=null&&Object.hasOwnProperty.call(i,"kind")&&r.uint32(74).string(i.kind),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(82).string(i.uuid),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(90).string(i.region),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&r.uint32(98).string(i.userId),i.session!=null&&Object.hasOwnProperty.call(i,"session")&&r.uint32(106).string(i.session),i.duration!=null&&Object.hasOwnProperty.call(i,"duration")&&r.uint32(122).string(i.duration),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(130).string(i.createdAt),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(136).int32(i.vid),i.isReconnection!=null&&Object.hasOwnProperty.call(i,"isReconnection")&&r.uint32(146).string(i.isReconnection),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(154).string(i.clientIP),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Te||(i=Te.create(i));var n=r===void 0?i.len:i.pos+r,s=new Ee.WhiteBoardQualityDisconnection;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.team=i.string();break;case 3:s.app=i.string();break;case 4:s.akkoVersion=i.string();break;case 5:s.sdkVersion=i.string();break;case 6:s.nativeVersion=i.string();break;case 7:s.platform=i.string();break;case 8:s.os=i.string();break;case 9:s.kind=i.string();break;case 10:s.uuid=i.string();break;case 11:s.region=i.string();break;case 12:s.userId=i.string();break;case 13:s.session=i.string();break;case 15:s.duration=i.string();break;case 16:s.createdAt=i.string();break;case 17:s.vid=i.int32();break;case 18:s.isReconnection=i.string();break;case 19:s.clientIP=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Te||(i=new Te(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!k.isInteger(i.lts)&&!(i.lts&&k.isInteger(i.lts.low)&&k.isInteger(i.lts.high))?"lts: integer|Long expected":i.team!=null&&i.hasOwnProperty("team")&&!k.isString(i.team)?"team: string expected":i.app!=null&&i.hasOwnProperty("app")&&!k.isString(i.app)?"app: string expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!k.isString(i.akkoVersion)?"akkoVersion: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!k.isString(i.sdkVersion)?"sdkVersion: string expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!k.isString(i.nativeVersion)?"nativeVersion: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!k.isString(i.platform)?"platform: string expected":i.os!=null&&i.hasOwnProperty("os")&&!k.isString(i.os)?"os: string expected":i.kind!=null&&i.hasOwnProperty("kind")&&!k.isString(i.kind)?"kind: string expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!k.isString(i.uuid)?"uuid: string expected":i.region!=null&&i.hasOwnProperty("region")&&!k.isString(i.region)?"region: string expected":i.userId!=null&&i.hasOwnProperty("userId")&&!k.isString(i.userId)?"userId: string expected":i.session!=null&&i.hasOwnProperty("session")&&!k.isString(i.session)?"session: string expected":i.duration!=null&&i.hasOwnProperty("duration")&&!k.isString(i.duration)?"duration: string expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!k.isString(i.createdAt)?"createdAt: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!k.isInteger(i.vid)?"vid: integer expected":i.isReconnection!=null&&i.hasOwnProperty("isReconnection")&&!k.isString(i.isReconnection)?"isReconnection: string expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!k.isString(i.clientIP)?"clientIP: string expected":null},e.fromObject=function(i){if(i instanceof Ee.WhiteBoardQualityDisconnection)return i;var r=new Ee.WhiteBoardQualityDisconnection;return i.lts!=null&&(k.Long?(r.lts=k.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.team!=null&&(r.team=String(i.team)),i.app!=null&&(r.app=String(i.app)),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.platform!=null&&(r.platform=String(i.platform)),i.os!=null&&(r.os=String(i.os)),i.kind!=null&&(r.kind=String(i.kind)),i.uuid!=null&&(r.uuid=String(i.uuid)),i.region!=null&&(r.region=String(i.region)),i.userId!=null&&(r.userId=String(i.userId)),i.session!=null&&(r.session=String(i.session)),i.duration!=null&&(r.duration=String(i.duration)),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.vid!=null&&(r.vid=i.vid|0),i.isReconnection!=null&&(r.isReconnection=String(i.isReconnection)),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(k.Long){var s=new k.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.duration="",n.createdAt="",n.vid=0,n.isReconnection="",n.clientIP=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?k.Long.prototype.toString.call(i.lts):r.longs===Number?new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.kind!=null&&i.hasOwnProperty("kind")&&(n.kind=i.kind),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.userId!=null&&i.hasOwnProperty("userId")&&(n.userId=i.userId),i.session!=null&&i.hasOwnProperty("session")&&(n.session=i.session),i.duration!=null&&i.hasOwnProperty("duration")&&(n.duration=i.duration),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.isReconnection!=null&&i.hasOwnProperty("isReconnection")&&(n.isReconnection=i.isReconnection),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},e}(),Pv=Ee.WhiteBoardQualitySample=function(){function e(t){if(t)for(var i=Object.keys(t),_r223=0;_r223<i.length;++_r223){t[i[_r223]]!=null&&(this[i[_r223]]=t[i[_r223]])}}return e.prototype.lts=k.Long?k.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.maxRTT="",e.prototype.minRTT="",e.prototype.averageRTT="",e.prototype.maxQueue="",e.prototype.minQueue="",e.prototype.averageQueue="",e.prototype.maxInterval="",e.prototype.minInterval="",e.prototype.averageInterval="",e.prototype.vid=0,e.prototype.createdAt="",e.prototype.clientIP="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=Ro.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(18).string(i.team),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(26).string(i.app),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(34).string(i.akkoVersion),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(42).string(i.sdkVersion),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(50).string(i.nativeVersion),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(58).string(i.platform),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(66).string(i.os),i.kind!=null&&Object.hasOwnProperty.call(i,"kind")&&r.uint32(74).string(i.kind),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(82).string(i.uuid),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(90).string(i.region),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&r.uint32(98).string(i.userId),i.session!=null&&Object.hasOwnProperty.call(i,"session")&&r.uint32(106).string(i.session),i.maxRTT!=null&&Object.hasOwnProperty.call(i,"maxRTT")&&r.uint32(114).string(i.maxRTT),i.minRTT!=null&&Object.hasOwnProperty.call(i,"minRTT")&&r.uint32(122).string(i.minRTT),i.averageRTT!=null&&Object.hasOwnProperty.call(i,"averageRTT")&&r.uint32(130).string(i.averageRTT),i.maxQueue!=null&&Object.hasOwnProperty.call(i,"maxQueue")&&r.uint32(138).string(i.maxQueue),i.minQueue!=null&&Object.hasOwnProperty.call(i,"minQueue")&&r.uint32(146).string(i.minQueue),i.averageQueue!=null&&Object.hasOwnProperty.call(i,"averageQueue")&&r.uint32(154).string(i.averageQueue),i.maxInterval!=null&&Object.hasOwnProperty.call(i,"maxInterval")&&r.uint32(162).string(i.maxInterval),i.minInterval!=null&&Object.hasOwnProperty.call(i,"minInterval")&&r.uint32(170).string(i.minInterval),i.averageInterval!=null&&Object.hasOwnProperty.call(i,"averageInterval")&&r.uint32(178).string(i.averageInterval),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(184).int32(i.vid),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(194).string(i.createdAt),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(202).string(i.clientIP),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Te||(i=Te.create(i));var n=r===void 0?i.len:i.pos+r,s=new Ee.WhiteBoardQualitySample;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.team=i.string();break;case 3:s.app=i.string();break;case 4:s.akkoVersion=i.string();break;case 5:s.sdkVersion=i.string();break;case 6:s.nativeVersion=i.string();break;case 7:s.platform=i.string();break;case 8:s.os=i.string();break;case 9:s.kind=i.string();break;case 10:s.uuid=i.string();break;case 11:s.region=i.string();break;case 12:s.userId=i.string();break;case 13:s.session=i.string();break;case 14:s.maxRTT=i.string();break;case 15:s.minRTT=i.string();break;case 16:s.averageRTT=i.string();break;case 17:s.maxQueue=i.string();break;case 18:s.minQueue=i.string();break;case 19:s.averageQueue=i.string();break;case 20:s.maxInterval=i.string();break;case 21:s.minInterval=i.string();break;case 22:s.averageInterval=i.string();break;case 23:s.vid=i.int32();break;case 24:s.createdAt=i.string();break;case 25:s.clientIP=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Te||(i=new Te(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!k.isInteger(i.lts)&&!(i.lts&&k.isInteger(i.lts.low)&&k.isInteger(i.lts.high))?"lts: integer|Long expected":i.team!=null&&i.hasOwnProperty("team")&&!k.isString(i.team)?"team: string expected":i.app!=null&&i.hasOwnProperty("app")&&!k.isString(i.app)?"app: string expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!k.isString(i.akkoVersion)?"akkoVersion: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!k.isString(i.sdkVersion)?"sdkVersion: string expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!k.isString(i.nativeVersion)?"nativeVersion: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!k.isString(i.platform)?"platform: string expected":i.os!=null&&i.hasOwnProperty("os")&&!k.isString(i.os)?"os: string expected":i.kind!=null&&i.hasOwnProperty("kind")&&!k.isString(i.kind)?"kind: string expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!k.isString(i.uuid)?"uuid: string expected":i.region!=null&&i.hasOwnProperty("region")&&!k.isString(i.region)?"region: string expected":i.userId!=null&&i.hasOwnProperty("userId")&&!k.isString(i.userId)?"userId: string expected":i.session!=null&&i.hasOwnProperty("session")&&!k.isString(i.session)?"session: string expected":i.maxRTT!=null&&i.hasOwnProperty("maxRTT")&&!k.isString(i.maxRTT)?"maxRTT: string expected":i.minRTT!=null&&i.hasOwnProperty("minRTT")&&!k.isString(i.minRTT)?"minRTT: string expected":i.averageRTT!=null&&i.hasOwnProperty("averageRTT")&&!k.isString(i.averageRTT)?"averageRTT: string expected":i.maxQueue!=null&&i.hasOwnProperty("maxQueue")&&!k.isString(i.maxQueue)?"maxQueue: string expected":i.minQueue!=null&&i.hasOwnProperty("minQueue")&&!k.isString(i.minQueue)?"minQueue: string expected":i.averageQueue!=null&&i.hasOwnProperty("averageQueue")&&!k.isString(i.averageQueue)?"averageQueue: string expected":i.maxInterval!=null&&i.hasOwnProperty("maxInterval")&&!k.isString(i.maxInterval)?"maxInterval: string expected":i.minInterval!=null&&i.hasOwnProperty("minInterval")&&!k.isString(i.minInterval)?"minInterval: string expected":i.averageInterval!=null&&i.hasOwnProperty("averageInterval")&&!k.isString(i.averageInterval)?"averageInterval: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!k.isInteger(i.vid)?"vid: integer expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!k.isString(i.createdAt)?"createdAt: string expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!k.isString(i.clientIP)?"clientIP: string expected":null},e.fromObject=function(i){if(i instanceof Ee.WhiteBoardQualitySample)return i;var r=new Ee.WhiteBoardQualitySample;return i.lts!=null&&(k.Long?(r.lts=k.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.team!=null&&(r.team=String(i.team)),i.app!=null&&(r.app=String(i.app)),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.platform!=null&&(r.platform=String(i.platform)),i.os!=null&&(r.os=String(i.os)),i.kind!=null&&(r.kind=String(i.kind)),i.uuid!=null&&(r.uuid=String(i.uuid)),i.region!=null&&(r.region=String(i.region)),i.userId!=null&&(r.userId=String(i.userId)),i.session!=null&&(r.session=String(i.session)),i.maxRTT!=null&&(r.maxRTT=String(i.maxRTT)),i.minRTT!=null&&(r.minRTT=String(i.minRTT)),i.averageRTT!=null&&(r.averageRTT=String(i.averageRTT)),i.maxQueue!=null&&(r.maxQueue=String(i.maxQueue)),i.minQueue!=null&&(r.minQueue=String(i.minQueue)),i.averageQueue!=null&&(r.averageQueue=String(i.averageQueue)),i.maxInterval!=null&&(r.maxInterval=String(i.maxInterval)),i.minInterval!=null&&(r.minInterval=String(i.minInterval)),i.averageInterval!=null&&(r.averageInterval=String(i.averageInterval)),i.vid!=null&&(r.vid=i.vid|0),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(k.Long){var s=new k.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.maxRTT="",n.minRTT="",n.averageRTT="",n.maxQueue="",n.minQueue="",n.averageQueue="",n.maxInterval="",n.minInterval="",n.averageInterval="",n.vid=0,n.createdAt="",n.clientIP=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?k.Long.prototype.toString.call(i.lts):r.longs===Number?new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.kind!=null&&i.hasOwnProperty("kind")&&(n.kind=i.kind),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.userId!=null&&i.hasOwnProperty("userId")&&(n.userId=i.userId),i.session!=null&&i.hasOwnProperty("session")&&(n.session=i.session),i.maxRTT!=null&&i.hasOwnProperty("maxRTT")&&(n.maxRTT=i.maxRTT),i.minRTT!=null&&i.hasOwnProperty("minRTT")&&(n.minRTT=i.minRTT),i.averageRTT!=null&&i.hasOwnProperty("averageRTT")&&(n.averageRTT=i.averageRTT),i.maxQueue!=null&&i.hasOwnProperty("maxQueue")&&(n.maxQueue=i.maxQueue),i.minQueue!=null&&i.hasOwnProperty("minQueue")&&(n.minQueue=i.minQueue),i.averageQueue!=null&&i.hasOwnProperty("averageQueue")&&(n.averageQueue=i.averageQueue),i.maxInterval!=null&&i.hasOwnProperty("maxInterval")&&(n.maxInterval=i.maxInterval),i.minInterval!=null&&i.hasOwnProperty("minInterval")&&(n.minInterval=i.minInterval),i.averageInterval!=null&&i.hasOwnProperty("averageInterval")&&(n.averageInterval=i.averageInterval),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},e}(),Mv=Ee.WhiteBoardRealtime=function(){function e(t){if(t)for(var i=Object.keys(t),_r224=0;_r224<i.length;++_r224){t[i[_r224]]!=null&&(this[i[_r224]]=t[i[_r224]])}}return e.prototype.lts=k.Long?k.Long.fromBits(0,0,!1):0,e.prototype.akkoVersion="",e.prototype.app="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.os="",e.prototype.platform="",e.prototype.region="",e.prototype.sdkVersion="",e.prototype.session="",e.prototype.team="",e.prototype.userId="",e.prototype.uuid="",e.prototype.vid=0,e.prototype.nativeVersion="",e.prototype.clientIP="",e.prototype.suid="",e.create=function(i){return new e(i)},e.encode=function(i,r){return r||(r=Ro.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&r.uint32(8).int64(i.lts),i.akkoVersion!=null&&Object.hasOwnProperty.call(i,"akkoVersion")&&r.uint32(18).string(i.akkoVersion),i.app!=null&&Object.hasOwnProperty.call(i,"app")&&r.uint32(26).string(i.app),i.createdAt!=null&&Object.hasOwnProperty.call(i,"createdAt")&&r.uint32(34).string(i.createdAt),i.level!=null&&Object.hasOwnProperty.call(i,"level")&&r.uint32(42).string(i.level),i.message!=null&&Object.hasOwnProperty.call(i,"message")&&r.uint32(50).string(i.message),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&r.uint32(58).string(i.os),i.platform!=null&&Object.hasOwnProperty.call(i,"platform")&&r.uint32(66).string(i.platform),i.region!=null&&Object.hasOwnProperty.call(i,"region")&&r.uint32(74).string(i.region),i.sdkVersion!=null&&Object.hasOwnProperty.call(i,"sdkVersion")&&r.uint32(82).string(i.sdkVersion),i.session!=null&&Object.hasOwnProperty.call(i,"session")&&r.uint32(90).string(i.session),i.team!=null&&Object.hasOwnProperty.call(i,"team")&&r.uint32(98).string(i.team),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&r.uint32(106).string(i.userId),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&r.uint32(114).string(i.uuid),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&r.uint32(120).int32(i.vid),i.nativeVersion!=null&&Object.hasOwnProperty.call(i,"nativeVersion")&&r.uint32(130).string(i.nativeVersion),i.clientIP!=null&&Object.hasOwnProperty.call(i,"clientIP")&&r.uint32(138).string(i.clientIP),i.suid!=null&&Object.hasOwnProperty.call(i,"suid")&&r.uint32(146).string(i.suid),r},e.encodeDelimited=function(i,r){return this.encode(i,r).ldelim()},e.decode=function(i,r){i instanceof Te||(i=Te.create(i));var n=r===void 0?i.len:i.pos+r,s=new Ee.WhiteBoardRealtime;for(;i.pos<n;){var o=i.uint32();switch(o>>>3){case 1:s.lts=i.int64();break;case 2:s.akkoVersion=i.string();break;case 3:s.app=i.string();break;case 4:s.createdAt=i.string();break;case 5:s.level=i.string();break;case 6:s.message=i.string();break;case 7:s.os=i.string();break;case 8:s.platform=i.string();break;case 9:s.region=i.string();break;case 10:s.sdkVersion=i.string();break;case 11:s.session=i.string();break;case 12:s.team=i.string();break;case 13:s.userId=i.string();break;case 14:s.uuid=i.string();break;case 15:s.vid=i.int32();break;case 16:s.nativeVersion=i.string();break;case 17:s.clientIP=i.string();break;case 18:s.suid=i.string();break;default:i.skipType(o&7);break;}}return s},e.decodeDelimited=function(i){return i instanceof Te||(i=new Te(i)),this.decode(i,i.uint32())},e.verify=function(i){return _typeof(i)!="object"||i===null?"object expected":i.lts!=null&&i.hasOwnProperty("lts")&&!k.isInteger(i.lts)&&!(i.lts&&k.isInteger(i.lts.low)&&k.isInteger(i.lts.high))?"lts: integer|Long expected":i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&!k.isString(i.akkoVersion)?"akkoVersion: string expected":i.app!=null&&i.hasOwnProperty("app")&&!k.isString(i.app)?"app: string expected":i.createdAt!=null&&i.hasOwnProperty("createdAt")&&!k.isString(i.createdAt)?"createdAt: string expected":i.level!=null&&i.hasOwnProperty("level")&&!k.isString(i.level)?"level: string expected":i.message!=null&&i.hasOwnProperty("message")&&!k.isString(i.message)?"message: string expected":i.os!=null&&i.hasOwnProperty("os")&&!k.isString(i.os)?"os: string expected":i.platform!=null&&i.hasOwnProperty("platform")&&!k.isString(i.platform)?"platform: string expected":i.region!=null&&i.hasOwnProperty("region")&&!k.isString(i.region)?"region: string expected":i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&!k.isString(i.sdkVersion)?"sdkVersion: string expected":i.session!=null&&i.hasOwnProperty("session")&&!k.isString(i.session)?"session: string expected":i.team!=null&&i.hasOwnProperty("team")&&!k.isString(i.team)?"team: string expected":i.userId!=null&&i.hasOwnProperty("userId")&&!k.isString(i.userId)?"userId: string expected":i.uuid!=null&&i.hasOwnProperty("uuid")&&!k.isString(i.uuid)?"uuid: string expected":i.vid!=null&&i.hasOwnProperty("vid")&&!k.isInteger(i.vid)?"vid: integer expected":i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&!k.isString(i.nativeVersion)?"nativeVersion: string expected":i.clientIP!=null&&i.hasOwnProperty("clientIP")&&!k.isString(i.clientIP)?"clientIP: string expected":i.suid!=null&&i.hasOwnProperty("suid")&&!k.isString(i.suid)?"suid: string expected":null},e.fromObject=function(i){if(i instanceof Ee.WhiteBoardRealtime)return i;var r=new Ee.WhiteBoardRealtime;return i.lts!=null&&(k.Long?(r.lts=k.Long.fromValue(i.lts)).unsigned=!1:typeof i.lts=="string"?r.lts=parseInt(i.lts,10):typeof i.lts=="number"?r.lts=i.lts:_typeof(i.lts)=="object"&&(r.lts=new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber())),i.akkoVersion!=null&&(r.akkoVersion=String(i.akkoVersion)),i.app!=null&&(r.app=String(i.app)),i.createdAt!=null&&(r.createdAt=String(i.createdAt)),i.level!=null&&(r.level=String(i.level)),i.message!=null&&(r.message=String(i.message)),i.os!=null&&(r.os=String(i.os)),i.platform!=null&&(r.platform=String(i.platform)),i.region!=null&&(r.region=String(i.region)),i.sdkVersion!=null&&(r.sdkVersion=String(i.sdkVersion)),i.session!=null&&(r.session=String(i.session)),i.team!=null&&(r.team=String(i.team)),i.userId!=null&&(r.userId=String(i.userId)),i.uuid!=null&&(r.uuid=String(i.uuid)),i.vid!=null&&(r.vid=i.vid|0),i.nativeVersion!=null&&(r.nativeVersion=String(i.nativeVersion)),i.clientIP!=null&&(r.clientIP=String(i.clientIP)),i.suid!=null&&(r.suid=String(i.suid)),r},e.toObject=function(i,r){r||(r={});var n={};if(r.defaults){if(k.Long){var s=new k.Long(0,0,!1);n.lts=r.longs===String?s.toString():r.longs===Number?s.toNumber():s}else n.lts=r.longs===String?"0":0;n.akkoVersion="",n.app="",n.createdAt="",n.level="",n.message="",n.os="",n.platform="",n.region="",n.sdkVersion="",n.session="",n.team="",n.userId="",n.uuid="",n.vid=0,n.nativeVersion="",n.clientIP="",n.suid=""}return i.lts!=null&&i.hasOwnProperty("lts")&&(typeof i.lts=="number"?n.lts=r.longs===String?String(i.lts):i.lts:n.lts=r.longs===String?k.Long.prototype.toString.call(i.lts):r.longs===Number?new k.LongBits(i.lts.low>>>0,i.lts.high>>>0).toNumber():i.lts),i.akkoVersion!=null&&i.hasOwnProperty("akkoVersion")&&(n.akkoVersion=i.akkoVersion),i.app!=null&&i.hasOwnProperty("app")&&(n.app=i.app),i.createdAt!=null&&i.hasOwnProperty("createdAt")&&(n.createdAt=i.createdAt),i.level!=null&&i.hasOwnProperty("level")&&(n.level=i.level),i.message!=null&&i.hasOwnProperty("message")&&(n.message=i.message),i.os!=null&&i.hasOwnProperty("os")&&(n.os=i.os),i.platform!=null&&i.hasOwnProperty("platform")&&(n.platform=i.platform),i.region!=null&&i.hasOwnProperty("region")&&(n.region=i.region),i.sdkVersion!=null&&i.hasOwnProperty("sdkVersion")&&(n.sdkVersion=i.sdkVersion),i.session!=null&&i.hasOwnProperty("session")&&(n.session=i.session),i.team!=null&&i.hasOwnProperty("team")&&(n.team=i.team),i.userId!=null&&i.hasOwnProperty("userId")&&(n.userId=i.userId),i.uuid!=null&&i.hasOwnProperty("uuid")&&(n.uuid=i.uuid),i.vid!=null&&i.hasOwnProperty("vid")&&(n.vid=i.vid),i.nativeVersion!=null&&i.hasOwnProperty("nativeVersion")&&(n.nativeVersion=i.nativeVersion),i.clientIP!=null&&i.hasOwnProperty("clientIP")&&(n.clientIP=i.clientIP),i.suid!=null&&i.hasOwnProperty("suid")&&(n.suid=i.suid),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},e}();var Sn;(function(r){r.Connected="connected",r.ConnectFailed="connectFailed",r.Sample="sample"})(Sn||(Sn={}));var Tv=Object.freeze({Realtime:Object.freeze({eventID:9115,proto:Mv}),Player:Object.freeze({eventID:9118,proto:Cv})}),Ev=Object.freeze({QualityConnection:Object.freeze({eventID:9120,proto:xv}),QualityDisconnection:Object.freeze({eventID:9121,proto:Iv}),QualitySample:Object.freeze({eventID:9123,proto:Pv})});function wn(e,t){var n;var i=EP(),r={team:e,app:t,platform:(i==null?void 0:i.platform)||"browser",akkoVersion:Oe,sdkVersion:ee.sdkVersion,nativeVersion:i==null?void 0:i.nativeVersion,os:(n=window.navigator)==null?void 0:n.platform};for(var s in r){r[s]===void 0&&delete r[s]}return r}function EP(){var e=window.__nativeTags;if(_typeof(e)=="object"&&e!==null){var t=e.nativeVersion,i=e.platform;if(typeof t=="string"&&typeof i=="string")return{nativeVersion:t,platform:i}}return null}var gi;(function(r){r.AlwaysReport="alwaysReport",r.BanReport="banReport",r.DependsOnRemote="dependsOnRemote"})(gi||(gi={}));var Zl=/*#__PURE__*/function(){function Zl(t,i,r){_classCallCheck(this,Zl);this.teamUUID=t,this.appUUID=i,this.loggerHub=this.createLoggerHub(r)}_createClass(Zl,[{key:"createLoggerHub",value:function createLoggerHub(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i="[White]",r=t.reportDebugLogMode||gi.AlwaysReport,n;switch(r){case gi.BanReport:{n=new Gn({prefix:i,levelMask:t.printLevelMask});break}case gi.AlwaysReport:case gi.DependsOnRemote:{var _ee$log$argusOptions=ee.log.argusOptions,s=_ee$log$argusOptions.reportResourceURL,o=_ee$log$argusOptions.vid;n=new ql({vid:o,reportResourceURL:s,prefix:i,reportLevelMask:t.reportLevelMask,printLevelMask:t.printLevelMask,timestampKey:"createdAt",events:Tv});break}default:throw new Error("unrecognized LoggerReportMode ".concat(JSON.stringify(r)));}return n}},{key:"createRealtimeLogger",value:function createRealtimeLogger(t,i,r){var n=Object.freeze(z(T({},wn(this.teamUUID,this.appUUID)),{uuid:t,uid:i,suid:i,region:r}));return zs(this.loggerHub,"Realtime",n)}},{key:"createPlayerLogger",value:function createPlayerLogger(t){var i=Object.freeze(z(T({},wn(this.teamUUID,this.appUUID)),{region:t}));return zs(this.loggerHub,"Player",i)}}]);return Zl}();var Jl=/*#__PURE__*/function(){function Jl(t,i){_classCallCheck(this,Jl);var _ee$log$argusOptions2=ee.log.argusOptions,r=_ee$log$argusOptions2.reportResourceURL,n=_ee$log$argusOptions2.vid;this.loggerHub=new ql({vid:n,reportResourceURL:r,timestampKey:"createdAt",events:Ev}),this.teamUUID=t,this.appUUID=i}_createClass(Jl,[{key:"createQualityConnectionCommitter",value:function createQualityConnectionCommitter(t,i){var r=Object.freeze(z(T({},wn(this.teamUUID,this.appUUID)),{kind:Sn.Connected,uuid:t,region:i}));return va(this.loggerHub,"QualityConnection",r)}},{key:"createQualityDisconnectionCommitter",value:function createQualityDisconnectionCommitter(t,i){var r=Object.freeze(z(T({},wn(this.teamUUID,this.appUUID)),{kind:Sn.ConnectFailed,uuid:t,region:i}));return va(this.loggerHub,"QualityDisconnection",r)}},{key:"createQualitySampleCommitter",value:function createQualitySampleCommitter(t,i){var r=Object.freeze(z(T({},wn(this.teamUUID,this.appUUID)),{kind:Sn.Sample,uuid:t,region:i}));return va(this.loggerHub,"QualitySample",r)}}]);return Jl}();function Av(e){return e}var Rv=1024,Lt;(function(n){n.Desktop="desktop",n.Phone="phone",n.Pad="pad",n.TV="tv"})(Lt||(Lt={}));var ks=/*#__PURE__*/function(){function ks(t){_classCallCheck(this,ks);this.version=ee.sdkVersion;var n;var _this$parseAppIdentif=this.parseAppIdentifier(t.appIdentifier),i=_this$parseAppIdentif.teamUUID,r=_this$parseAppIdentif.appUUID;if(t.deviceType&&t.screenType)this.deviceType=t.deviceType,this.screenType=t.screenType;else if(t.deviceType&&!t.screenType)this.deviceType=t.deviceType,this.screenType=t.deviceType===Se.Desktop?Lt.Desktop:Lt.Phone;else if(!t.deviceType&&t.screenType)this.deviceType=t.screenType===Lt.Desktop?Se.Desktop:Se.Touch,this.screenType=t.screenType;else switch(Ov["default"].deviceType){case"mouseOnly":{this.deviceType=Se.Desktop,this.screenType=Lt.Desktop;break}case"touchOnly":{this.deviceType=Se.Touch,this.screenType=Lt.Phone;break}case"hybrid":{this.deviceType=Se.Surface,this.screenType=Lt.Desktop;break}}if(t.renderEngine!==Lr.SVG&&!this.isCanvasRenderEngineAvailable()?this.renderEngine=Lr.SVG:t.renderEngine?this.renderEngine=t.renderEngine:this.renderEngine=Lr.Canvas,this.region=t.region||ee.defaultRegion,this.pptParams=t.pptParams,((n=t.loggerOptions)==null?void 0:n.disableReportLog)!==void 0)throw new Error("loggserOptions.disableReportLog is deprecated. please replace it with reportDebugLogMode or reportQualityMode");this.enableReportQuality(t.loggerOptions)&&(this.qualityLoggerFactory=new Jl(i,r)),this.whiteLoggerFactory=new Zl(i,r,t.loggerOptions),this.akkoApp=new uh({appIdentifier:t.appIdentifier,observerAdapter:new Cb,clientVersion:ee.sdkVersion,enableAnimationFrame:!0,jsxFactory:ec.createElement,escapeObjectFilter:ec.isValidElement,reconnectionOptions:t.reconnectionOptions,netStateAdapter:ks.netState,convertIdToUrl:t.urlInterrupter||function(s){return s},configsInterrupter:Av,shuntApiHosts:ee.shuntApiHosts,onAkkoSetupFailed:t.onWhiteSetupFailed}),this.preloadDynamicPPT=!!t.preloadDynamicPPT,this.fonts=Object.freeze(T({},t.fonts)),this.handToolKey=t.handToolKey,this.fontFamily=t.fontFamily,this.urlInterrupter=t.urlInterrupter||function(s){return s},this.boundless=new qs(this.deviceType),this.plugins=this.assertPlugins(t.plugins),this.invisiblePlugins=this.assertInvisiblePlugins(t.invisiblePlugins),this.wrappedComponents=Object.freeze(t.wrappedComponents?_toConsumableArray(t.wrappedComponents):[]),this.useMobXState=!!t.useMobXState,this.onlyCallbackRemoteStateModify=!!t.onlyCallbackRemoteStateModify,Lu.injectDefaultStyleIfNotInjectBefore()}_createClass(ks,[{key:"joinRoom",value:function(){var _joinRoom=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee105(t,i){var r,n,s,o,a,c;return regeneratorRuntime.wrap(function _callee105$(_context109){while(1){switch(_context109.prev=_context109.next){case 0:r=t.uuid,n=t.region||this.region,s=this.standardizeUserPayload(t.uid,t.userPayload),o=this.whiteLoggerFactory.createRealtimeLogger(r,s.uid,n),a=this.qualityLoggerFactory&&{connection:this.qualityLoggerFactory.createQualityConnectionCommitter(r,n),disconnection:this.qualityLoggerFactory.createQualityDisconnectionCommitter(r,n),sample:this.qualityLoggerFactory.createQualitySampleCommitter(r,n)},c=new yn({whiteLogger:o,qualityComitters:a,region:n,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!t.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(t.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,t.wrappedComponents),akkoApp:this.akkoApp,preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,cameraBound:this.standardizeCameraBound(t.cameraBound),userPayload:s,disableDeviceInputs:!!t.disableDeviceInputs,disableCameraTransform:t.disableCameraTransform,disableMagixEventDispatchLimit:!!t.disableMagixEventDispatchLimit,disableEraseImage:!!t.disableEraseImage,disableOthersSelectingBox:!!t.disableOthersSelectingBox,disablePencilWrittingLimitFrequency:!!t.disablePencilWrittingLimitFrequency,useMultiViews:t.useMultiViews,onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,cursorAdapter:t.cursorAdapter,hotKeys:t.hotKeys,rejectWhenReadonlyErrorLevel:t.rejectWhenReadonlyErrorLevel,eraserRadiusCursor:new vl(o),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,floatBarOptions:ju(t.floatBar),callbacks:i});_context109.next=3;return c.connect({uuid:r,region:n,roomToken:t.roomToken,userPayload:s,deviceType:this.deviceType,isWritable:ks.defaultValue(t.isWritable,!0),enableDrawPoint:ks.defaultValue(t.enableDrawPoint,!1),disableNewPencil:ks.defaultValue(t.disableNewPencil,!0)});case 3:return _context109.abrupt("return",c);case 4:case"end":return _context109.stop();}}},_callee105,this)}));function joinRoom(_x183,_x184){return _joinRoom.apply(this,arguments)}return joinRoom}()},{key:"isPlayable",value:function(){var _isPlayable=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee106(t){var i;return regeneratorRuntime.wrap(function _callee106$(_context110){while(1){switch(_context110.prev=_context110.next){case 0:i={region:t.region||this.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration};_context110.next=3;return this.akkoApp.searchSlices(i);case 3:_context110.t0=_context110.sent.length;return _context110.abrupt("return",_context110.t0>0);case 5:case"end":return _context110.stop();}}},_callee106,this)}));function isPlayable(_x185){return _isPlayable.apply(this,arguments)}return isPlayable}()},{key:"replayRoom",value:function(){var _replayRoom=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee107(t,i){var r,n,s;return regeneratorRuntime.wrap(function _callee107$(_context111){while(1){switch(_context111.prev=_context111.next){case 0:if(!t.mediaURL){_context111.next=2;break}throw new Error("mediaURL was deprecated. please to see https://github.com/netless-io/netless-combine-player");case 2:r=t.region||this.region,n=this.whiteLoggerFactory.createPlayerLogger(r),s=new vn({logger:n,region:r,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!t.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(t.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,t.wrappedComponents),preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,cameraBound:this.standardizeCameraBound(t.cameraBound),onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,disableCameraTransform:t.disableCameraTransform,disableOthersSelectingBox:!!t.disableOthersSelectingBox,useMultiViews:t.useMultiViews,cursorAdapter:t.cursorAdapter,eraserRadiusCursor:new vl(n),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,callbacks:i});_context111.next=5;return s.setupReconstructor({akkoApp:this.akkoApp,region:r,slice:t.slice,room:t.room,roomToken:t.roomToken,beginTimestamp:t.beginTimestamp,duration:t.duration});case 5:return _context111.abrupt("return",s);case 6:case"end":return _context111.stop();}}},_callee107,this)}));function replayRoom(_x186,_x187){return _replayRoom.apply(this,arguments)}return replayRoom}()},{key:"standardizeUserPayload",value:function standardizeUserPayload(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=i;if(t===void 0)throw new Error("expect uid on parameters");if(typeof t!="string")throw new Error("invalid uid. ".concat(t," should be string"));if(t.length>Rv)throw new Error("invalid uid. length cannot over ".concat(Rv));if(_typeof(r)!="object"||r===null)throw new Error("invalid payload. ".concat(r," should be object"));if(r=T({},r),"uid"in r&&r.uid!==t)throw new Error("payload did have uid ".concat(r.uid," that is not equals to ").concat(t));return r.uid=t,r}},{key:"pptConverter",value:function pptConverter(t){return new us(t)}},{key:"standardizeCameraBound",value:function standardizeCameraBound(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return T({maxContentMode:Co(10),minContentMode:Co(.1),width:1/0,height:1/0},t)}},{key:"enableReportQuality",value:function enableReportQuality(t){return(t==null?void 0:t.reportQualityMode)!==gi.BanReport}},{key:"isCanvasRenderEngineAvailable",value:function isCanvasRenderEngineAvailable(){var t=["setTransform","translate","scale","drawImage","getTransform","resetTransform","clearRect","fillStyle","lineWidth","strokeStyle","lineJoin","lineCap","beginPath","moveTo","quadraticCurveTo","bezierCurveTo","stroke","lineTo","arc","fill","ellipse","setLineDash","strokeRect","closePath"],i=document.createElement("canvas");if(i===void 0)return!1;var r=i.getContext("2d");if(r===null)return!1;for(var _i56=0,_t20=t;_i56<_t20.length;_i56++){var n=_t20[_i56];if(!(n in r))return!1}return!0}},{key:"parseAppIdentifier",value:function parseAppIdentifier(t){if(!/^[0-9a-zA-Z\-_]+\/[0-9a-zA-Z\-_]+$/.test(t))throw new Error("find invalid appIdentifier: ".concat(JSON.stringify(t)));var _t$split2=t.split("/"),_t$split3=_slicedToArray(_t$split2,2),i=_t$split3[0],r=_t$split3[1];return{teamUUID:i,appUUID:r}}},{key:"assertPlugins",value:function assertPlugins(t){var i;return t&&(t instanceof gs?i=t:console.warn("plugins is not instance of Plugins. plugins will not be working. you should call createPlugins() to create it")),i||(i=new gs({})),i}},{key:"assertInvisiblePlugins",value:function assertInvisiblePlugins(t){var i=[];if(t){var _iterator268=_createForOfIteratorHelper(t),_step268;try{for(_iterator268.s();!(_step268=_iterator268.n()).done;){var _r225=_step268.value;this.isValidInvisiblePluginClass(_r225)&&i.push(_r225)}}catch(err){_iterator268.e(err)}finally{_iterator268.f()}}return Object.freeze(i)}},{key:"isValidInvisiblePluginClass",value:function isValidInvisiblePluginClass(t){if(typeof t.kind!="string")return console.warn("invisible plugin class is invalid. expect `public static readonly kind: string = 'xxx';`"),!1;var i=t.prototype;for(;i!==null;){if(i===ys.prototype)return!0;i=Object.getPrototypeOf(i)}return console.warn("invisible plugin class is not extends InvisiblePlugin"),!1}},{key:"mergeArray",value:function mergeArray(t,i){var r=_toConsumableArray(t);if(i){var _iterator269=_createForOfIteratorHelper(i),_step269;try{for(_iterator269.s();!(_step269=_iterator269.n()).done;){var n=_step269.value;t.indexOf(n)===-1&&r.push(n)}}catch(err){_iterator269.e(err)}finally{_iterator269.f()}}return r}}],[{key:"defaultValue",value:function defaultValue(t,i){return t===void 0?i:t}}]);return ks}(),zu=ks;zu.netState=new ru;function Nv(e){return e instanceof yn}function Lv(e){return e instanceof vn}var AP=ee.sdkVersion;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */ /**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */